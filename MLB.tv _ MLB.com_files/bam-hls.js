(function(root,factory){"object"===typeof exports&&"object"===typeof module?module.exports=factory():"function"===typeof define&&define.amd?define([],factory):"object"===typeof exports?exports["bam-hls"]=factory():root["bam-hls"]=factory()})(this,function(){return function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={exports:{},id:moduleId,loaded:!1};return modules[moduleId].call(module.exports,module,module.exports,__webpack_require__),module.loaded=!0,module.exports}return __webpack_require__.m=modules,__webpack_require__.c=installedModules,__webpack_require__.p="",__webpack_require__(0)}([function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _HlsStream=__webpack_require__(105),_HlsStream2=_interopRequireDefault(_HlsStream);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=_HlsStream2.default,module.exports=exports["default"]},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _typeof="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"===typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};function noop(){}var fakeLogger={trace:noop,debug:noop,log:noop,warn:noop,info:noop,error:noop},exportedLogger=fakeLogger;function formatMsg(type,msg){var myMsg="["+type+"] > "+msg;return myMsg}function consolePrintFn(type){var func=self.console[type];return func?function(){for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];args[0]&&(args[0]=formatMsg(type,args[0])),func.apply(self.console,args)}:noop}function exportLoggerFunctions(debugConfig){for(var _len2=arguments.length,functions=Array(_len2>1?_len2-1:0),_key2=1;_key2<_len2;_key2++)functions[_key2-1]=arguments[_key2];functions.forEach(function(type){exportedLogger[type]=debugConfig[type]?debugConfig[type].bind(debugConfig):consolePrintFn(type)})}exports.enableLogs=function(debugConfig){if(debugConfig===!0||"object"===("undefined"===typeof debugConfig?"undefined":_typeof(debugConfig))){exportLoggerFunctions(debugConfig,"debug","log","info","warn","error");try{exportedLogger.log()}catch(e){exportedLogger=fakeLogger}}else exportedLogger=fakeLogger},exports.logger=exportedLogger},function(module,exports,__webpack_require__){var global=__webpack_require__(8),core=__webpack_require__(18),hide=__webpack_require__(24),redefine=__webpack_require__(31),ctx=__webpack_require__(19),PROTOTYPE="prototype",$export=function(type,name,source){var key,own,out,exp,IS_FORCED=type&$export.F,IS_GLOBAL=type&$export.G,IS_STATIC=type&$export.S,IS_PROTO=type&$export.P,IS_BIND=type&$export.B,target=IS_GLOBAL?global:IS_STATIC?global[name]||(global[name]={}):(global[name]||{})[PROTOTYPE],exports=IS_GLOBAL?core:core[name]||(core[name]={}),expProto=exports[PROTOTYPE]||(exports[PROTOTYPE]={});IS_GLOBAL&&(source=name);for(key in source)own=!IS_FORCED&&target&&void 0!==target[key],out=(own?target:source)[key],exp=IS_BIND&&own?ctx(out,global):IS_PROTO&&"function"==typeof out?ctx(Function.call,out):out,target&&redefine(target,key,out,type&$export.U),exports[key]!=out&&hide(exports,key,exp),IS_PROTO&&expProto[key]!=out&&(expProto[key]=out)};global.core=core,$export.F=1,$export.G=2,$export.S=4,$export.P=8,$export.B=16,$export.W=32,$export.U=64,$export.R=128,module.exports=$export},function(module){"use strict";var _module$exports;function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}module.exports=(_module$exports={MEDIA_ATTACHING:"hlsMediaAttaching",MEDIA_ATTACHED:"hlsMediaAttached",MEDIA_DETACHING:"hlsMediaDetaching",MEDIA_DETACHED:"hlsMediaDetached",BUFFER_RESET:"hlsBufferReset",BUFFER_CODECS:"hlsBufferCodecs",BUFFER_CREATED:"hlsBufferCreated",BUFFER_APPENDING:"hlsBufferAppending",BUFFER_APPENDED:"hlsBufferAppended",BUFFER_EOS:"hlsBufferEos",BUFFER_FLUSHING:"hlsBufferFlushing",BUFFER_FLUSHED:"hlsBufferFlushed",BUFFER_SOURCE_SEEKING:"hlsBufferSourceSeeking"},_defineProperty(_module$exports,"BUFFER_SOURCE_SEEKING","hlsBufferSourceSeeking"),_defineProperty(_module$exports,"BUFFER_WAIT","hlsBufferWait"),_defineProperty(_module$exports,"MANIFEST_LOADING","hlsManifestLoading"),_defineProperty(_module$exports,"MANIFEST_LOADED","hlsManifestLoaded"),_defineProperty(_module$exports,"MANIFEST_PARSED","hlsManifestParsed"),_defineProperty(_module$exports,"LEVEL_SWITCHING","hlsLevelSwitching"),_defineProperty(_module$exports,"LEVEL_LOADING","hlsLevelLoading"),_defineProperty(_module$exports,"LEVEL_LOADED","hlsLevelLoaded"),_defineProperty(_module$exports,"LEVEL_UPDATED","hlsLevelUpdated"),_defineProperty(_module$exports,"LEVEL_PTS_UPDATED","hlsLevelPtsUpdated"),_defineProperty(_module$exports,"LEVEL_DURATION_UPDATED","hlsLevelDurationUpdated"),_defineProperty(_module$exports,"AUDIO_TRACKS_UPDATED","hlsAudioTracksUpdated"),_defineProperty(_module$exports,"AUDIO_TRACK_SWITCH","hlsAudioTrackSwitch"),_defineProperty(_module$exports,"AUDIO_TRACK_SWITCHING","hlsAudioTrackSwitching"),_defineProperty(_module$exports,"AUDIO_TRACK_SWITCHED","hlsAudioTrackSwitched"),_defineProperty(_module$exports,"AUDIO_TRACK_LOADING","hlsAudioTrackLoading"),_defineProperty(_module$exports,"AUDIO_TRACK_LOADED","hlsAudioTrackLoaded"),_defineProperty(_module$exports,"SUBTITLE_TRACKS_UPDATED","hlsSubtitleTracksUpdated"),_defineProperty(_module$exports,"SUBTITLE_TRACK_SWITCH","hlsSubtitleTrackSwitch"),_defineProperty(_module$exports,"SUBTITLE_TRACK_LOADING","hlsSubtitleTrackLoading"),_defineProperty(_module$exports,"SUBTITLE_TRACK_LOADED","hlsSubtitleTrackLoaded"),_defineProperty(_module$exports,"SUBTITLE_FRAG_PROCESSED","hlsSubtitleFragProcessed"),_defineProperty(_module$exports,"INIT_PTS_FOUND","hlsInitPtsFound"),_defineProperty(_module$exports,"FRAG_LOADING","hlsFragLoading"),_defineProperty(_module$exports,"FRAG_LOAD_PROGRESS","hlsFragLoadProgress"),_defineProperty(_module$exports,"FRAG_LOAD_EMERGENCY_ABORTED","hlsFragLoadEmergencyAborted"),_defineProperty(_module$exports,"FRAG_LOADED","hlsFragLoaded"),_defineProperty(_module$exports,"FRAG_DECRYPTED","hlsFragDecrypted"),_defineProperty(_module$exports,"FRAG_PARSING_INIT_SEGMENT","hlsFragParsingInitSegment"),_defineProperty(_module$exports,"FRAG_PARSING_USERDATA","hlsFragParsingUserdata"),_defineProperty(_module$exports,"FRAG_PARSING_METADATA","hlsFragParsingMetadata"),_defineProperty(_module$exports,"FRAG_PARSING_DATA","hlsFragParsingData"),_defineProperty(_module$exports,"FRAG_PARSED","hlsFragParsed"),_defineProperty(_module$exports,"FRAG_BUFFERED","hlsFragBuffered"),_defineProperty(_module$exports,"FPS_DROP","hlsFpsDrop"),_defineProperty(_module$exports,"FPS_DROP_LEVEL_CAPPING","hlsFpsDropLevelCapping"),_defineProperty(_module$exports,"ERROR","hlsError"),_defineProperty(_module$exports,"DESTROYING","hlsDestroying"),_defineProperty(_module$exports,"KEY_LOADING","hlsKeyLoading"),_defineProperty(_module$exports,"KEY_LOADED","hlsKeyLoaded"),_defineProperty(_module$exports,"TEXT_TRACK_ADDED","hlsTextTrackAdded"),_defineProperty(_module$exports,"TEXT_TRACK_CHANGED","hlsTextTrackChanged"),_defineProperty(_module$exports,"START_POSITION_SET","hlsStartPositionSet"),_defineProperty(_module$exports,"LOGTUBE_LOG","hlsLogtubeLog"),_defineProperty(_module$exports,"FRAG_DATERANGE_UPDATE","hlsFragDaterangeUpdate"),_defineProperty(_module$exports,"STREAM_STATE_TRANSITION","hlsStreamStateTransition"),_defineProperty(_module$exports,"STREAM_ALL_LEVELS_PARSED","hlsStreamAllLevelsParsed"),_defineProperty(_module$exports,"STREAM_ALL_LEVELS_LOADED","hlsStreamAllLevelsLoaded"),_defineProperty(_module$exports,"STREAM_LIVETIME_CHANGED","hlsStreamLivetimeChanged"),_defineProperty(_module$exports,"STREAM_BASEPDT_FOUND","hlsStreamBasepdtFound"),_defineProperty(_module$exports,"STREAM_DESYNC","hlsStreamDesync"),_defineProperty(_module$exports,"AUDIO_TRACK_UPDATED","hlsAudioTrackUpdated"),_defineProperty(_module$exports,"SUBTITLE_TRACK_UPDATED","hlsSubtitleTrackUpdated"),_defineProperty(_module$exports,"BITRATE_ESTIMATE_UPDATED","hlsBitrateEstimateUpdated"),_defineProperty(_module$exports,"LEVEL_SELECTION_FINISHED","hlsLevelSelectionFinished"),_defineProperty(_module$exports,"FRAG_START_FOUND","hlsFragStartFound"),_defineProperty(_module$exports,"SEEK_READY","hlsSeekReady"),_module$exports)},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.ErrorTypes={NETWORK_ERROR:"networkError",MEDIA_ERROR:"mediaError",MUX_ERROR:"muxError",OTHER_ERROR:"otherError"},exports.ErrorDetails={MANIFEST_LOAD_ERROR:"manifestLoadError",MANIFEST_LOAD_TIMEOUT:"manifestLoadTimeOut",MANIFEST_PARSING_ERROR:"manifestParsingError",MANIFEST_INCOMPATIBLE_CODECS_ERROR:"manifestIncompatibleCodecsError",LEVEL_LOAD_ERROR:"levelLoadError",LEVEL_LOAD_TIMEOUT:"levelLoadTimeOut",LEVEL_SWITCH_ERROR:"levelSwitchError",LEVEL_UNEXPECTED_GAP_ERROR:"levelUnexpectedGapError",AUDIO_TRACK_LOAD_ERROR:"audioTrackLoadError",AUDIO_TRACK_LOAD_TIMEOUT:"audioTrackLoadTimeOut",FRAG_LOAD_ERROR:"fragLoadError",FRAG_LOOP_LOADING_ERROR:"fragLoopLoadingError",FRAG_LOAD_TIMEOUT:"fragLoadTimeOut",FRAG_DECRYPT_ERROR:"fragDecryptError",FRAG_PARSING_ERROR:"fragParsingError",REMUX_ALLOC_ERROR:"remuxAllocError",DEMUX_WORKER_ALLOC_ERROR:"demuxWorkerAllocError",KEY_LOAD_ERROR:"keyLoadError",KEY_LOAD_TIMEOUT:"keyLoadTimeOut",BUFFER_ADD_CODEC_ERROR:"bufferAddCodecError",BUFFER_APPEND_ERROR:"bufferAppendError",BUFFER_APPENDING_ERROR:"bufferAppendingError",BUFFER_STALLED_ERROR:"bufferStalledError",BUFFER_FULL_ERROR:"bufferFullError",BUFFER_SEEK_OVER_HOLE:"bufferSeekOverHole",BUFFER_NUDGE_ON_STALL:"bufferNudgeOnStall",INTERNAL_EXCEPTION:"internalException",WEBVTT_EXCEPTION:"webVTTException",STREAM_SYNC_FAILED:"streamSyncFailed",MEDIA_PLAY_FAILED:"mediaPlayFailed",STREAM_TIMEOUT:"streamTimeout",PROMISE_IS_OVERLOADED:"promiseIsOverloaded",DRM_ERROR:"drmError"}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _typeof="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"===typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_logger=__webpack_require__(1),_errors=__webpack_require__(4),_events=__webpack_require__(3),_events2=_interopRequireDefault(_events);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var EventHandler=function(){function EventHandler(hls){_classCallCheck(this,EventHandler),this.hls=hls,this.onEvent=this.onEvent.bind(this);for(var _len=arguments.length,events=Array(_len>1?_len-1:0),_key=1;_key<_len;_key++)events[_key-1]=arguments[_key];this.handledEvents=events,this.useGenericHandler=!0,this.registerListeners()}return _createClass(EventHandler,[{key:"destroy",value:function(){this.unregisterListeners(),this.onEvent=null}},{key:"isEventHandler",value:function(){return"object"===_typeof(this.handledEvents)&&this.handledEvents.length&&"function"===typeof this.onEvent}},{key:"registerListeners",value:function(){this.isEventHandler()&&this.handledEvents.forEach(function(event){if("hlsEventGeneric"===event)throw new Error("Forbidden event name: "+event);this.hls.on(event,this.onEvent)}.bind(this))}},{key:"unregisterListeners",value:function(){this.isEventHandler()&&(this.handledEvents.forEach(function(event){this.hls.off(event,this.onEvent)}.bind(this)),this.handledEvents=null)}},{key:"onEvent",value:function(event,data){this.onEventGeneric(event,data)}},{key:"onEventGeneric",value:function(event,data){var eventToFunction=function(event,data){var funcName="on"+event.replace("hls","");if("function"!==typeof this[funcName])throw new Error("Event "+event+" has no generic handler in this "+this.constructor.name+" class (tried "+funcName+")");return this[funcName].bind(this,data)};try{eventToFunction.call(this,event,data).call()}catch(err){_logger.logger.error("internal error happened while processing "+event+":"+err.message),this.hls.trigger(_events2.default.ERROR,{type:_errors.ErrorTypes.OTHER_ERROR,details:_errors.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:event,err:err})}}}]),EventHandler}();exports.default=EventHandler,module.exports=exports["default"]},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _typeof="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"===typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_logger=__webpack_require__(1),_HlsEvents=__webpack_require__(14),_HlsEvents2=_interopRequireDefault(_HlsEvents),_detectBrowser=__webpack_require__(47),_detectBrowser2=_interopRequireDefault(_detectBrowser),_semver=__webpack_require__(99),_semver2=_interopRequireDefault(_semver);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var Utils=function(){function Utils(){_classCallCheck(this,Utils)}return _createClass(Utils,null,[{key:"isFunction",value:function(func){return"function"===typeof func}},{key:"isObject",value:function(obj){return obj&&"object"===("undefined"===typeof obj?"undefined":_typeof(obj))}},{key:"isArray",value:function(array){return Array.isArray(array)}},{key:"isEmptyArray",value:function(array){return Utils.isArray(array)&&0===array.length}},{key:"isString",value:function(str){return"string"===typeof str}},{key:"isNull",value:function(value){return null===value}},{key:"isDefined",value:function(value){return void 0!==value}},{key:"isPhantom",value:function(){return Utils.isBrowser()&&"phantom"===_detectBrowser2.default.name}},{key:"isChrome",value:function(){return Utils.isBrowser()&&"chrome"===_detectBrowser2.default.name}},{key:"isEdge",value:function(){return Utils.isBrowser()&&"edge"===_detectBrowser2.default.name}},{key:"isIE",value:function(){return Utils.isBrowser()&&"ie"===_detectBrowser2.default.name}},{key:"isElectron",value:function(){return Utils.isBrowser()&&"electron"===_detectBrowser2.default.name}},{key:"isSafari",value:function(){return Utils.isBrowser()&&"safari"===_detectBrowser2.default.name}},{key:"isFirefox",value:function(){return Utils.isBrowser()&&"firefox"===_detectBrowser2.default.name}},{key:"isTizen",value:function(){return Utils.isBrowser()&&"tizen"===_detectBrowser2.default.name}},{key:"isTizen2",value:function(){return Utils.isTizen()&&_semver2.default.satisfies(_detectBrowser2.default.version,"2.x.x")}},{key:"isTizen3",value:function(){return Utils.isTizen()&&_semver2.default.satisfies(_detectBrowser2.default.version,">=3.x.x")}},{key:"isMacOS",value:function(){return"macintosh"===_detectBrowser2.default.platform}},{key:"isWin8Point1",value:function(){return"windows"===_detectBrowser2.default.platform&&"unknown"!==_detectBrowser2.default.platformVersion&&_semver2.default.satisfies(_detectBrowser2.default.platformVersion,"6.3.0")}},{key:"isFirefoxMacOS",value:function(){return Utils.isFirefox()&&Utils.isMacOS()}},{key:"isFirefoxBadWorker",value:function(){return Utils.isFirefoxMacOS()&&_semver2.default.satisfies(_detectBrowser2.default.version,"<54.0.0")}},{key:"isIEWin8Point1",value:function(){return Utils.isIE()&&Utils.isWin8Point1()}},{key:"isBrowser",value:function(){return"undefined"!==typeof navigator}},{key:"isChromeMacOS",value:function(){return Utils.isChrome()&&Utils.isMacOS()}},{key:"areFunctionsDifferentiated",value:function(){var testFunction1=function(){this._testFunctionProperty="TESTING"},testFunction2=function(){this._testFunctionProperty="TESTING"};return testFunction1!==testFunction2}},{key:"isWallaby",value:function(){return"undefined"!==typeof wallaby}},{key:"isWebpack",value:function(){return"undefined"!==typeof __webpack_require__.m}},{key:"hasWorker",value:function(){return"undefined"!==typeof Worker}},{key:"isPropertySettable",value:function(classInstance,prop){var settable=!1;if(prop in classInstance){var propDescriptor=Object.getOwnPropertyDescriptor(Object.getPrototypeOf(classInstance),prop);void 0!==propDescriptor.set&&(settable=!0)}return settable}},{key:"getClassName",value:function(classInstance){return classInstance.constructor.name}},{key:"getClassPropertyName",value:function(classInstance,propetyName){return Utils.getClassName(classInstance)+"."+propetyName}},{key:"applyValueToSetter",value:function(classInstance,prop,value){Utils.isPropertySettable(classInstance,prop)?(_logger.logger.log("applyValueToSetter: "+Utils.getClassPropertyName(classInstance,prop)+" = "+value),classInstance[prop]=value):_logger.logger.log("applyValueToSetter: "+Utils.getClassPropertyName(classInstance,prop)+" is not settable ("+value+")")}},{key:"applyConfig",value:function(classInstance){var config=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};for(var prop in config)config.hasOwnProperty(prop)&&Utils.applyValueToSetter(classInstance,prop,config[prop])}},{key:"throwIfNotEvent",value:function(event){if(void 0===_HlsEvents2.default[event])throw new Error("event: "+event+" is not a known Event")}},{key:"propertyCanNotBeThrow",value:function(value,canNotBe,propertyName){throw new Error(propertyName+" can not be "+canNotBe+", ( "+value+" )")}},{key:"propertyCanNotBeWarn",value:function(value,canNotBe,propertyName){_logger.logger.warn(propertyName+" can not be "+canNotBe+", ( "+value+" ), the value will be adjusted accordingly")}},{key:"propertyMustBeThrow",value:function(value,mustBe,propertyName){throw new Error(propertyName+" must be "+mustBe+", ( "+value+" )")}},{key:"checkLessThanMinusOneAndThrow",value:function(value,propertyName){value<-1&&Utils.propertyCanNotBeThrow(value,"less than -1",propertyName)}},{key:"checkLessThanZeroPointZeroAndThrow",value:function(value,propertyName){value<0&&Utils.propertyCanNotBeThrow(value,"less than 0.0",propertyName)}},{key:"checkLessThanZeroPointZeroAndWarn",value:function(value,propertyName){value<0&&Utils.propertyCanNotBeWarn(value,"less than 0.0",propertyName)}},{key:"checkEqualToZeroPointZeroAndThrow",value:function(value,propertyName){0===value&&Utils.propertyCanNotBeThrow(value,"equal to 0.0",propertyName)}},{key:"checkMoreThanOnePointZeroAndThrow",value:function(value,propertyName){value>1&&Utils.propertyCanNotBeThrow(value,"more than 1.0",propertyName)}},{key:"checkLessThanOnePointZeroAndThrow",value:function(value,propertyName){value<1&&Utils.propertyCanNotBeThrow(value,"less than 1.0",propertyName)}},{key:"checkNotIntegerAndThrow",value:function(value,propertyName){Number.isInteger?Number.isInteger(value)||Utils.propertyMustBeThrow(value,"an integer",propertyName):("number"!==typeof value&&Utils.propertyMustBeThrow(value,"an integer",propertyName),isFinite(value)||Utils.propertyMustBeThrow(value,"an integer",propertyName),value%1!==0&&Utils.propertyMustBeThrow(value,"an integer",propertyName))}},{key:"checkNotFiniteAndThrow",value:function(value,propertyName){Number.isFinite?Number.isFinite(value)||Utils.propertyMustBeThrow(value,"a finite number",propertyName):("number"!==typeof value&&Utils.propertyMustBeThrow(value,"a finite number",propertyName),isFinite(value)||Utils.propertyMustBeThrow(value,"a finite number",propertyName))}},{key:"checkNotNumberAndThrow",value:function(value,propertyName){"number"!==typeof value&&Utils.propertyMustBeThrow(value,"a number",propertyName)}},{key:"checkNotFunctionAndThrow",value:function(value,propertyName){Utils.isFunction(value)||Utils.propertyMustBeThrow(value,"a function",propertyName)}},{key:"checkNotNullableFunctionAndThrow",value:function(value,propertyName){Utils.isFunction(value)||!Utils.isDefined(value)||Utils.isNull(value)||Utils.propertyMustBeThrow(value,"a function, undefined, or null",propertyName)}},{key:"isValidDate",value:function(date){var validDate=!1;return"[object Date]"===Object.prototype.toString.call(date)&&(isNaN(date.getTime())||(validDate=!0)),validDate}},{key:"msErrToHex",value:function(errCode){return"0x"+(errCode>>>0).toString(16).toUpperCase()}},{key:"getTimeForPdt",value:function(pdt){return Utils.isValidDate(pdt)?pdt.getTime()/1e3:0}},{key:"getPdtForTime",value:function(time){return new Date(1e3*time)}},{key:"isPromiseOverloaded",value:function(){var result=!1;try{result=Utils.isChrome()&&!(fetch("")instanceof Promise)}catch(e){}return result}},{key:"version",get:function(){return"3.2.1"}}]),Utils}();exports.default=Utils,module.exports=exports["default"]},function(module,exports,__webpack_require__){var store=__webpack_require__(92)("wks"),uid=__webpack_require__(59),Symbol=__webpack_require__(8).Symbol,USE_SYMBOL="function"==typeof Symbol,$exports=module.exports=function(name){return store[name]||(store[name]=USE_SYMBOL&&Symbol[name]||(USE_SYMBOL?Symbol:uid)("Symbol."+name))};$exports.store=store},function(module){var global=module.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=global)},function(module,exports,__webpack_require__){var toInteger=__webpack_require__(32),min=Math.min;module.exports=function(it){return it>0?min(toInteger(it),9007199254740991):0}},function(module,exports,__webpack_require__){"use strict";var fails=__webpack_require__(23);module.exports=function(method,arg){return!!method&&fails(function(){arg?method.call(null,function(){},1):method.call(null)})}},function(module){"use strict";var Stream=function(){this.init=function(){var listeners={};this.on=function(type,listener){listeners[type]||(listeners[type]=[]),listeners[type]=listeners[type].concat(listener)},this.off=function(type,listener){var index;return!!listeners[type]&&(index=listeners[type].indexOf(listener),listeners[type]=listeners[type].slice(),listeners[type].splice(index,1),index>-1)},this.trigger=function(type){var callbacks,i,length,args;if(callbacks=listeners[type],callbacks)if(2===arguments.length)for(length=callbacks.length,i=0;i<length;++i)callbacks[i].call(this,arguments[1]);else{for(args=[],i=arguments.length,i=1;i<arguments.length;++i)args.push(arguments[i]);for(length=callbacks.length,i=0;i<length;++i)callbacks[i].apply(this,args)}},this.dispose=function(){listeners={}}}};Stream.prototype.pipe=function(destination){return this.on("data",function(data){destination.push(data)}),this.on("done",function(flushSource){destination.flush(flushSource)}),destination},Stream.prototype.push=function(data){this.trigger("data",data)},Stream.prototype.flush=function(flushSource){this.trigger("done",flushSource)},module.exports=Stream},function(module,exports,__webpack_require__){var defined=__webpack_require__(51);module.exports=function(it){return Object(defined(it))}},function(module,exports,__webpack_require__){var UNSCOPABLES=__webpack_require__(7)("unscopables"),ArrayProto=Array.prototype;void 0==ArrayProto[UNSCOPABLES]&&__webpack_require__(24)(ArrayProto,UNSCOPABLES,{}),module.exports=function(key){ArrayProto[UNSCOPABLES][key]=!0}},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var HlsEvents={STREAM_ERROR:"STREAM_ERROR",STREAM_UNLOADED:"STREAM_UNLOADED",STREAM_LOADING:"STREAM_LOADING",STREAM_LOADED:"STREAM_LOADED",STREAM_FETCHING:"STREAM_FETCHING",STREAM_PLAYBACK:"STREAM_PLAYBACK",PLAYBACK_NOTREADY:"PLAYBACK_NOTREADY",PLAYBACK_PAUSED:"PLAYBACK_PAUSED",PLAYBACK_BUFFERING:"PLAYBACK_BUFFERING",PLAYBACK_PLAYING:"PLAYBACK_PLAYING",PLAYBACK_SEEKING:"PLAYBACK_SEEKING",PLAYBACK_ENDED:"PLAYBACK_ENDED",MEDIA_WIRING:"MEDIA_WIRING",MEDIA_WIRED:"MEDIA_WIRED",MEDIA_ATTACHING:"MEDIA_ATTACHING",MEDIA_ATTACHED:"MEDIA_ATTACHED",MEDIA_DETACHING:"MEDIA_DETACHING",MEDIA_DETACHED:"MEDIA_DETACHED",STREAM_CANPLAY:"STREAM_CANPLAY",STREAM_CANPLAYTHROUGH:"STREAM_CANPLAYTHROUGH",STREAM_BUFFERING_STARTED:"STREAM_BUFFERING_STARTED",STREAM_BUFFERING_FINISHED:"STREAM_BUFFERING_FINISHED",STREAM_SEEKING_FINISHED:"STREAM_SEEKING_FINISHED",STREAM_STARTPOSITION_SET:"STREAM_STARTPOSITION_SET",STREAM_PREFETCH:"STREAM_PREFETCH",STREAM_PAUSE:"STREAM_PAUSE",STREAM_PLAY:"STREAM_PLAY",STREAM_STATE_CHANGED:"STREAM_STATE_CHANGED",STREAM_PLAYBACKSTATE_CHANGED:"STREAM_PLAYBACKSTATE_CHANGED",STREAM_MEDIASTATE_CHANGED:"STREAM_MEDIASTATE_CHANGED",STREAM_VARIANTS_CHANGED:"STREAM_VARIANTS_CHANGED",STREAM_ISLIVE_CHANGED:"STREAM_ISLIVE_CHANGED",STREAM_LIVETIME_CHANGED:"STREAM_LIVETIME_CHANGED",STREAM_ISSLIDINGWINDOW_CHANGED:"STREAM_ISSLIDINGWINDOW_CHANGED",STREAM_ISAUDIOONLY_CHANGED:"STREAM_ISAUDIOONLY_CHANGED",STREAM_ISMULTITHREADED_CHANGED:"STREAM_ISMULTITHREADED_CHANGED",STREAM_MEDIA_CHANGED:"STREAM_MEDIA_CHANGED",STREAM_CHOSENVARIANT_CHANGED:"STREAM_CHOSENVARIANT_CHANGED",STREAM_CHOSENBITRATE_CHANGED:"STREAM_CHOSENBITRATE_CHANGED",STREAM_NETWORKMETRICS_CHANGED:"STREAM_NETWORKMETRICS_CHANGED",STREAM_DURATION_CHANGED:"STREAM_DURATION_CHANGED",STREAM_BASEPDT_CHANGED:"STREAM_BASEPDT_CHANGED",STREAM_SUBTITLERENDITIONS_CHANGED:"STREAM_SUBTITLERENDITIONS_CHANGED",STREAM_SUBTITLERENDITION_CHANGED:"STREAM_SUBTITLERENDITION_CHANGED",STREAM_AUDIORENDITIONS_CHANGED:"STREAM_AUDIORENDITIONS_CHANGED",STREAM_AUDIORENDITION_CHANGED:"STREAM_AUDIORENDITION_CHANGED",STREAM_TIMEUPDATE:"STREAM_TIMEUPDATE",STREAM_PLAYHEAD_BEHIND_SLIDING_WINDOW:"STREAM_PLAYHEAD_BEHIND_SLIDING_WINDOW",STREAM_PLAYBACKRATE_CHANGED:"STREAM_PLAYBACKRATE_CHANGED",STREAM_DISPOSING:"STREAM_DISPOSING",STREAM_DISPOSED:"STREAM_DISPOSED",STREAM_DATERANGE_UPDATE:"STREAM_DATERANGE_UPDATE",TIMED_METADATA_UPDATE:"TIMED_METADATA_UPDATE",TIMED_METADATA_PTS_REACHED:"TIMED_METADATA_PTS_REACHED",MEDIA_CANPLAY:"MEDIA_CANPLAY",MEDIA_CANPLAYTHROUGH:"MEDIA_CANPLAYTHROUGH",MEDIA_PAUSE:"MEDIA_PAUSE",MEDIA_PLAY:"MEDIA_PLAY",MEDIA_SEEKING:"MEDIA_SEEKING",MEDIA_SEEKED:"MEDIA_SEEKED",MEDIA_ENDED:"MEDIA_ENDED",MEDIA_DURATIONCHANGE:"MEDIA_DURATIONCHANGE",MEDIA_LOADEDDATA:"MEDIA_LOADEDDATA",MEDIA_RATECHANGE:"MEDIA_RATECHANGE",MEDIA_VOLUMECHANGE:"MEDIA_VOLUMECHANGE",MEDIA_TIMEUPDATE:"MEDIA_TIMEUPDATE",MEDIA_CONTROLLER_WIRED:"MEDIA_CONTROLLER_WIRED",MEDIA_CONTROLLER_UNWIRED:"MEDIA_CONTROLLER_UNWIRED",MEDIA_CONTROLLER_ERROR:"MEDIA_CONTROLLER_ERROR",MEDIA_ELEMENT_ERROR:"MEDIA_ELEMENT_ERROR",HLSJS_ERROR:"HLSJS_ERROR",HLSJS_MEDIA_ATTACHED:"HLSJS_MEDIA_ATTACHED",HLSJS_MEDIA_DETACHED:"HLSJS_MEDIA_DETACHED",HLSJS_SEEK_READY:"HLSJS_SEEK_READY",MANIFEST_LOADED:"MANIFEST_LOADED",MANIFEST_PARSED:"MANIFEST_PARSED",VARIANT_LOADED:"VARIANT_LOADED",VARIANT_UPDATED:"VARIANT_UPDATED",VARIANT_DURATION_UPDATED:"VARIANT_DURATION_UPDATED",CHUNK_LOADED:"CHUNK_LOADED",CHUNK_BUFFERED:"CHUNK_BUFFERED",BUFFER_FLUSHED:"BUFFER_FLUSHED",LOGTUBE_LOG:"LOGTUBE_LOG",TEST_EVENT_INTERNAL:"TEST_EVENT_INTERNAL",TEST_EVENT:"TEST_EVENT"};exports.default=HlsEvents,module.exports=exports["default"]},function(module){module.exports=function(it){if("function"!=typeof it)throw TypeError(it+" is not a function!");return it}},function(module,exports,__webpack_require__){var isObject=__webpack_require__(20);module.exports=function(it){if(!isObject(it))throw TypeError(it+" is not an object!");return it}},function(module,exports,__webpack_require__){var ctx=__webpack_require__(19),IObject=__webpack_require__(38),toObject=__webpack_require__(12),toLength=__webpack_require__(9),asc=__webpack_require__(49);module.exports=function(TYPE,$create){var IS_MAP=1==TYPE,IS_FILTER=2==TYPE,IS_SOME=3==TYPE,IS_EVERY=4==TYPE,IS_FIND_INDEX=6==TYPE,NO_HOLES=5==TYPE||IS_FIND_INDEX,create=$create||asc;return function($this,callbackfn,that){for(var val,res,O=toObject($this),self=IObject(O),f=ctx(callbackfn,that,3),length=toLength(self.length),index=0,result=IS_MAP?create($this,length):IS_FILTER?create($this,0):void 0;length>index;index++)if((NO_HOLES||index in self)&&(val=self[index],res=f(val,index,O),TYPE))if(IS_MAP)result[index]=res;else if(res)switch(TYPE){case 3:return!0;case 5:return val;case 6:return index;case 2:result.push(val)}else if(IS_EVERY)return!1;return IS_FIND_INDEX?-1:IS_SOME||IS_EVERY?IS_EVERY:result}}},function(module){var core=module.exports={version:"2.5.3"};"number"==typeof __e&&(__e=core)},function(module,exports,__webpack_require__){var aFunction=__webpack_require__(15);module.exports=function(fn,that,length){if(aFunction(fn),void 0===that)return fn;switch(length){case 1:return function(a){return fn.call(that,a)};case 2:return function(a,b){return fn.call(that,a,b)};case 3:return function(a,b,c){return fn.call(that,a,b,c)}}return function(){return fn.apply(that,arguments)}}},function(module){module.exports=function(it){return"object"===typeof it?null!==it:"function"===typeof it}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_typeDetect=__webpack_require__(215),_typeDetect2=_interopRequireDefault(_typeDetect);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var ArrayHelper=function(){function ArrayHelper(){_classCallCheck(this,ArrayHelper)}return _createClass(ArrayHelper,null,[{key:"makeUint8Array",value:function(array){var result=array,arrayType=(0,_typeDetect2.default)(result);if("Uint8Array"!==arrayType)if("ArrayBuffer"===arrayType)result=new Uint8Array(result);else{if("Int32Array"!==arrayType)throw new Error("ArrayHelper.makeUint8Array unhandled array type "+arrayType);result=new Uint8Array(result.buffer,result.byteOffset,result.byteLength)}return result}},{key:"makeModulo16",value:function(data){if("Uint8Array"!==(0,_typeDetect2.default)(data))throw new Error("ArrayHelper.makeModulo16 data must be Uint8Array {"+(0,_typeDetect2.default)(data)+"}");var myData=data,truncated=!1,len=data.length,lenMod16=len%16;return 0!==lenMod16&&(myData=myData.subarray(0,len-lenMod16),truncated=!0),{data:myData,truncated:truncated}}}]),ArrayHelper}();exports.default=ArrayHelper,module.exports=exports["default"]},function(module){var toString={}.toString;module.exports=function(it){return toString.call(it).slice(8,-1);
}},function(module){module.exports=function(exec){try{return!!exec()}catch(e){return!0}}},function(module,exports,__webpack_require__){var dP=__webpack_require__(30),createDesc=__webpack_require__(56);module.exports=__webpack_require__(27)?function(object,key,value){return dP.f(object,key,createDesc(1,value))}:function(object,key,value){return object[key]=value,object}},function(module){"use strict";var BufferHelper={isBuffered:function(media,position){if(media)for(var buffered=media.buffered,i=0;i<buffered.length;i++)if(position>=buffered.start(i)&&position<=buffered.end(i))return!0;return!1},bufferInfo:function(media,pos,maxHoleDuration){try{if(media){var vbuffered=media.buffered,buffered=[],i=void 0;for(i=0;i<vbuffered.length;i++)buffered.push({start:vbuffered.start(i),end:vbuffered.end(i)});return this.bufferedInfo(buffered,pos,maxHoleDuration)}return{len:0,start:pos,end:pos,nextStart:void 0}}catch(err){return{len:0,start:pos,end:pos,nextStart:void 0}}},bufferedInfo:function(buffered,pos,maxHoleDuration){var buffered2=[],bufferLen=void 0,bufferStart=void 0,bufferEnd=void 0,bufferStartNext=void 0,i=void 0;for(buffered.sort(function(a,b){var diff=a.start-b.start;return diff?diff:b.end-a.end}),i=0;i<buffered.length;i++){var buf2len=buffered2.length;if(buf2len){var buf2end=buffered2[buf2len-1].end;buffered[i].start-buf2end<maxHoleDuration?buffered[i].end>buf2end&&(buffered2[buf2len-1].end=buffered[i].end):buffered2.push(buffered[i])}else buffered2.push(buffered[i])}for(i=0,bufferLen=0,bufferStart=bufferEnd=pos;i<buffered2.length;i++){var start=buffered2[i].start,end=buffered2[i].end;if(pos+maxHoleDuration>=start&&pos<end)bufferStart=start,bufferEnd=end,bufferLen=bufferEnd-pos;else if(pos+maxHoleDuration<start){bufferStartNext=start;break}}return{len:bufferLen,start:bufferStart,end:bufferEnd,nextStart:bufferStartNext}}};module.exports=BufferHelper},function(module){"use strict";module.exports={H264_STREAM_TYPE:27,ADTS_STREAM_TYPE:15,METADATA_STREAM_TYPE:21}},function(module,exports,__webpack_require__){module.exports=!__webpack_require__(23)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(module){var hasOwnProperty={}.hasOwnProperty;module.exports=function(it,key){return hasOwnProperty.call(it,key)}},function(module){module.exports={}},function(module,exports,__webpack_require__){var anObject=__webpack_require__(16),IE8_DOM_DEFINE=__webpack_require__(174),toPrimitive=__webpack_require__(185),dP=Object.defineProperty;exports.f=__webpack_require__(27)?Object.defineProperty:function(O,P,Attributes){if(anObject(O),P=toPrimitive(P,!0),anObject(Attributes),IE8_DOM_DEFINE)try{return dP(O,P,Attributes)}catch(e){}if("get"in Attributes||"set"in Attributes)throw TypeError("Accessors not supported!");return"value"in Attributes&&(O[P]=Attributes.value),O}},function(module,exports,__webpack_require__){var global=__webpack_require__(8),hide=__webpack_require__(24),has=__webpack_require__(28),SRC=__webpack_require__(59)("src"),TO_STRING="toString",$toString=Function[TO_STRING],TPL=(""+$toString).split(TO_STRING);__webpack_require__(18).inspectSource=function(it){return $toString.call(it)},(module.exports=function(O,key,val,safe){var isFunction="function"==typeof val;isFunction&&(has(val,"name")||hide(val,"name",key)),O[key]!==val&&(isFunction&&(has(val,SRC)||hide(val,SRC,O[key]?""+O[key]:TPL.join(String(key)))),O===global?O[key]=val:safe?O[key]?O[key]=val:hide(O,key,val):(delete O[key],hide(O,key,val)))})(Function.prototype,TO_STRING,function(){return"function"==typeof this&&this[SRC]||$toString.call(this)})},function(module){var ceil=Math.ceil,floor=Math.floor;module.exports=function(it){return isNaN(it=+it)?0:(it>0?floor:ceil)(it)}},function(module,exports,__webpack_require__){var IObject=__webpack_require__(38),defined=__webpack_require__(51);module.exports=function(it){return IObject(defined(it))}},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_RESULT__;!function(undefined){var isArray=Array.isArray?Array.isArray:function(obj){return"[object Array]"===Object.prototype.toString.call(obj)},defaultMaxListeners=10;function init(){this._events={},this._conf&&configure.call(this,this._conf)}function configure(conf){conf?(this._conf=conf,conf.delimiter&&(this.delimiter=conf.delimiter),this._events.maxListeners=conf.maxListeners!==undefined?conf.maxListeners:defaultMaxListeners,conf.wildcard&&(this.wildcard=conf.wildcard),conf.newListener&&(this.newListener=conf.newListener),conf.verboseMemoryLeak&&(this.verboseMemoryLeak=conf.verboseMemoryLeak),this.wildcard&&(this.listenerTree={})):this._events.maxListeners=defaultMaxListeners}function logPossibleMemoryLeak(count,eventName){var errorMsg="(node) warning: possible EventEmitter memory "+"leak detected. %d listeners added. "+"Use emitter.setMaxListeners() to increase limit.";this.verboseMemoryLeak?(errorMsg+=" Event name: %s.",void 0):void 0,console.trace&&void 0}function EventEmitter(conf){this._events={},this.newListener=!1,this.verboseMemoryLeak=!1,configure.call(this,conf)}EventEmitter.EventEmitter2=EventEmitter;function searchListenerTree(handlers,type,tree,i){if(!tree)return[];var leaf,len,branch,xTree,xxTree,isolatedBranch,endReached,listeners=[],typeLength=type.length,currentType=type[i],nextType=type[i+1];if(i===typeLength&&tree._listeners){if("function"===typeof tree._listeners)return handlers&&handlers.push(tree._listeners),[tree];for(leaf=0,len=tree._listeners.length;leaf<len;leaf++)handlers&&handlers.push(tree._listeners[leaf]);return[tree]}if("*"===currentType||"**"===currentType||tree[currentType]){if("*"===currentType){for(branch in tree)"_listeners"!==branch&&tree.hasOwnProperty(branch)&&(listeners=listeners.concat(searchListenerTree(handlers,type,tree[branch],i+1)));return listeners}if("**"===currentType){endReached=i+1===typeLength||i+2===typeLength&&"*"===nextType,endReached&&tree._listeners&&(listeners=listeners.concat(searchListenerTree(handlers,type,tree,typeLength)));for(branch in tree)"_listeners"!==branch&&tree.hasOwnProperty(branch)&&("*"===branch||"**"===branch?(tree[branch]._listeners&&!endReached&&(listeners=listeners.concat(searchListenerTree(handlers,type,tree[branch],typeLength))),listeners=listeners.concat(searchListenerTree(handlers,type,tree[branch],i))):listeners=branch===nextType?listeners.concat(searchListenerTree(handlers,type,tree[branch],i+2)):listeners.concat(searchListenerTree(handlers,type,tree[branch],i)));return listeners}listeners=listeners.concat(searchListenerTree(handlers,type,tree[currentType],i+1))}if(xTree=tree["*"],xTree&&searchListenerTree(handlers,type,xTree,i+1),xxTree=tree["**"],xxTree)if(i<typeLength){xxTree._listeners&&searchListenerTree(handlers,type,xxTree,typeLength);for(branch in xxTree)"_listeners"!==branch&&xxTree.hasOwnProperty(branch)&&(branch===nextType?searchListenerTree(handlers,type,xxTree[branch],i+2):branch===currentType?searchListenerTree(handlers,type,xxTree[branch],i+1):(isolatedBranch={},isolatedBranch[branch]=xxTree[branch],searchListenerTree(handlers,type,{"**":isolatedBranch},i+1)))}else xxTree._listeners?searchListenerTree(handlers,type,xxTree,typeLength):xxTree["*"]&&xxTree["*"]._listeners&&searchListenerTree(handlers,type,xxTree["*"],typeLength);return listeners}function growListenerTree(type,listener){type="string"===typeof type?type.split(this.delimiter):type.slice();for(var i=0,len=type.length;i+1<len;i++)if("**"===type[i]&&"**"===type[i+1])return;var tree=this.listenerTree,name=type.shift();while(name!==undefined){if(tree[name]||(tree[name]={}),tree=tree[name],0===type.length)return tree._listeners?("function"===typeof tree._listeners&&(tree._listeners=[tree._listeners]),tree._listeners.push(listener),!tree._listeners.warned&&this._events.maxListeners>0&&tree._listeners.length>this._events.maxListeners&&(tree._listeners.warned=!0,logPossibleMemoryLeak.call(this,tree._listeners.length,name))):tree._listeners=listener,!0;name=type.shift()}return!0}EventEmitter.prototype.delimiter=".",EventEmitter.prototype.setMaxListeners=function(n){n!==undefined&&(this._events||init.call(this),this._events.maxListeners=n,this._conf||(this._conf={}),this._conf.maxListeners=n)},EventEmitter.prototype.event="",EventEmitter.prototype.once=function(event,fn){return this.many(event,1,fn),this},EventEmitter.prototype.many=function(event,ttl,fn){var self=this;if("function"!==typeof fn)throw new Error("many only accepts instances of Function");function listener(){0===--ttl&&self.off(event,listener),fn.apply(this,arguments)}return listener._origin=fn,this.on(event,listener),self},EventEmitter.prototype.emit=function(){this._events||init.call(this);var type=arguments[0];if("newListener"===type&&!this.newListener&&!this._events.newListener)return!1;var args,l,i,j,handler,al=arguments.length;if(this._all&&this._all.length){if(handler=this._all.slice(),al>3)for(args=new Array(al),j=0;j<al;j++)args[j]=arguments[j];for(i=0,l=handler.length;i<l;i++)switch(this.event=type,al){case 1:handler[i].call(this,type);break;case 2:handler[i].call(this,type,arguments[1]);break;case 3:handler[i].call(this,type,arguments[1],arguments[2]);break;default:handler[i].apply(this,args)}}if(this.wildcard){handler=[];var ns="string"===typeof type?type.split(this.delimiter):type.slice();searchListenerTree.call(this,handler,ns,this.listenerTree,0)}else{if(handler=this._events[type],"function"===typeof handler){switch(this.event=type,al){case 1:handler.call(this);break;case 2:handler.call(this,arguments[1]);break;case 3:handler.call(this,arguments[1],arguments[2]);break;default:for(args=new Array(al-1),j=1;j<al;j++)args[j-1]=arguments[j];handler.apply(this,args)}return!0}handler&&(handler=handler.slice())}if(handler&&handler.length){if(al>3)for(args=new Array(al-1),j=1;j<al;j++)args[j-1]=arguments[j];for(i=0,l=handler.length;i<l;i++)switch(this.event=type,al){case 1:handler[i].call(this);break;case 2:handler[i].call(this,arguments[1]);break;case 3:handler[i].call(this,arguments[1],arguments[2]);break;default:handler[i].apply(this,args)}return!0}if(!this._all&&"error"===type)throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");return!!this._all},EventEmitter.prototype.emitAsync=function(){this._events||init.call(this);var type=arguments[0];if("newListener"===type&&!this.newListener&&!this._events.newListener)return Promise.resolve([!1]);var args,l,i,j,handler,promises=[],al=arguments.length;if(this._all){if(al>3)for(args=new Array(al),j=1;j<al;j++)args[j]=arguments[j];for(i=0,l=this._all.length;i<l;i++)switch(this.event=type,al){case 1:promises.push(this._all[i].call(this,type));break;case 2:promises.push(this._all[i].call(this,type,arguments[1]));break;case 3:promises.push(this._all[i].call(this,type,arguments[1],arguments[2]));break;default:promises.push(this._all[i].apply(this,args))}}if(this.wildcard){handler=[];var ns="string"===typeof type?type.split(this.delimiter):type.slice();searchListenerTree.call(this,handler,ns,this.listenerTree,0)}else handler=this._events[type];if("function"===typeof handler)switch(this.event=type,al){case 1:promises.push(handler.call(this));break;case 2:promises.push(handler.call(this,arguments[1]));break;case 3:promises.push(handler.call(this,arguments[1],arguments[2]));break;default:for(args=new Array(al-1),j=1;j<al;j++)args[j-1]=arguments[j];promises.push(handler.apply(this,args))}else if(handler&&handler.length){if(al>3)for(args=new Array(al-1),j=1;j<al;j++)args[j-1]=arguments[j];for(i=0,l=handler.length;i<l;i++)switch(this.event=type,al){case 1:promises.push(handler[i].call(this));break;case 2:promises.push(handler[i].call(this,arguments[1]));break;case 3:promises.push(handler[i].call(this,arguments[1],arguments[2]));break;default:promises.push(handler[i].apply(this,args))}}else if(!this._all&&"error"===type)return arguments[1]instanceof Error?Promise.reject(arguments[1]):Promise.reject("Uncaught, unspecified 'error' event.");return Promise.all(promises)},EventEmitter.prototype.on=function(type,listener){if("function"===typeof type)return this.onAny(type),this;if("function"!==typeof listener)throw new Error("on only accepts instances of Function");return this._events||init.call(this),this.emit("newListener",type,listener),this.wildcard?(growListenerTree.call(this,type,listener),this):(this._events[type]?("function"===typeof this._events[type]&&(this._events[type]=[this._events[type]]),this._events[type].push(listener),!this._events[type].warned&&this._events.maxListeners>0&&this._events[type].length>this._events.maxListeners&&(this._events[type].warned=!0,logPossibleMemoryLeak.call(this,this._events[type].length,type))):this._events[type]=listener,this)},EventEmitter.prototype.onAny=function(fn){if("function"!==typeof fn)throw new Error("onAny only accepts instances of Function");return this._all||(this._all=[]),this._all.push(fn),this},EventEmitter.prototype.addListener=EventEmitter.prototype.on,EventEmitter.prototype.off=function(type,listener){if("function"!==typeof listener)throw new Error("removeListener only takes instances of Function");var handlers,leafs=[];if(this.wildcard){var ns="string"===typeof type?type.split(this.delimiter):type.slice();leafs=searchListenerTree.call(this,null,ns,this.listenerTree,0)}else{if(!this._events[type])return this;handlers=this._events[type],leafs.push({_listeners:handlers})}for(var iLeaf=0;iLeaf<leafs.length;iLeaf++){var leaf=leafs[iLeaf];if(handlers=leaf._listeners,isArray(handlers)){for(var position=-1,i=0,length=handlers.length;i<length;i++)if(handlers[i]===listener||handlers[i].listener&&handlers[i].listener===listener||handlers[i]._origin&&handlers[i]._origin===listener){position=i;break}if(position<0)continue;return this.wildcard?leaf._listeners.splice(position,1):this._events[type].splice(position,1),0===handlers.length&&(this.wildcard?delete leaf._listeners:delete this._events[type]),this.emit("removeListener",type,listener),this}(handlers===listener||handlers.listener&&handlers.listener===listener||handlers._origin&&handlers._origin===listener)&&(this.wildcard?delete leaf._listeners:delete this._events[type],this.emit("removeListener",type,listener))}function recursivelyGarbageCollect(root){if(root!==undefined){var keys=Object.keys(root);for(var i in keys){var key=keys[i],obj=root[key];obj instanceof Function||"object"!==typeof obj||null===obj||(Object.keys(obj).length>0&&recursivelyGarbageCollect(root[key]),0===Object.keys(obj).length&&delete root[key])}}}return recursivelyGarbageCollect(this.listenerTree),this},EventEmitter.prototype.offAny=function(fn){var fns,i=0,l=0;if(fn&&this._all&&this._all.length>0){for(fns=this._all,i=0,l=fns.length;i<l;i++)if(fn===fns[i])return fns.splice(i,1),this.emit("removeListenerAny",fn),this}else{for(fns=this._all,i=0,l=fns.length;i<l;i++)this.emit("removeListenerAny",fns[i]);this._all=[]}return this},EventEmitter.prototype.removeListener=EventEmitter.prototype.off,EventEmitter.prototype.removeAllListeners=function(type){if(0===arguments.length)return!this._events||init.call(this),this;if(this.wildcard)for(var ns="string"===typeof type?type.split(this.delimiter):type.slice(),leafs=searchListenerTree.call(this,null,ns,this.listenerTree,0),iLeaf=0;iLeaf<leafs.length;iLeaf++){var leaf=leafs[iLeaf];leaf._listeners=null}else this._events&&(this._events[type]=null);return this},EventEmitter.prototype.listeners=function(type){if(this.wildcard){var handlers=[],ns="string"===typeof type?type.split(this.delimiter):type.slice();return searchListenerTree.call(this,handlers,ns,this.listenerTree,0),handlers}return this._events||init.call(this),this._events[type]||(this._events[type]=[]),isArray(this._events[type])||(this._events[type]=[this._events[type]]),this._events[type]},EventEmitter.prototype.listenerCount=function(type){return this.listeners(type).length},EventEmitter.prototype.listenersAny=function(){return this._all?this._all:[]},0?"object"===typeof exports?module.exports=EventEmitter:window.EventEmitter2=EventEmitter:(__WEBPACK_AMD_DEFINE_RESULT__=function(){return EventEmitter}.call(exports,__webpack_require__,exports,module),!(__WEBPACK_AMD_DEFINE_RESULT__!==undefined&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__)))}()},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_HlsUtils=__webpack_require__(6),_HlsUtils2=_interopRequireDefault(_HlsUtils);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var EventHandlers=function(){function EventHandlers(){var config=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,EventHandlers),this._handlers={},this._hlsEventsWired=!1,this._hlsEvents=null,this._hlsObjToBindTo=null,this._hlsEmitter=null,this._mediaEvents=null,this._hlsJsEvents=null,_HlsUtils2.default.applyConfig(this,config)}return _createClass(EventHandlers,[{key:"dispose",value:function(){this._hlsEventsWired&&this.unwireHlsEvents(),this._hlsEvents=null,this._hlsObjToBindTo=null,this._hlsEmitter=null,this._mediaEvents=null,this._hlsJsEvents=null,this._handlers=null}},{key:"setHlsEventsList",value:function(objToBindTo,emitter,eventsList){if(EventHandlers.verifyEventsList(eventsList),this._hlsEvents)throw new Error("HlsEvents already set");if(!_HlsUtils2.default.isObject(objToBindTo))throw new Error("objToBindTo must be type: object, "+objToBindTo);if(!_HlsUtils2.default.isObject(emitter))throw new Error("emitter must be type: object, "+emitter);if(!_HlsUtils2.default.isFunction(emitter.on)||!_HlsUtils2.default.isFunction(emitter.off))throw new Error("emitter :"+emitter+" does not appear to be an emitter");return this._hlsObjToBindTo=objToBindTo,this._hlsEmitter=emitter,this._hlsEvents=eventsList,this}},{key:"wireHlsEvent",value:function(_ref){var event=_ref.event,func=_ref.func,handler=this.createEventHandler(this._hlsObjToBindTo,func);if(!handler)throw new Error("no handler for event: "+event+", func: "+func);this._hlsEmitter.on(event,handler)}},{key:"unwireHlsEvent",value:function(_ref2){var event=_ref2.event,func=_ref2.func,handler=this.getHandlerForFunction(func);handler&&this._hlsEmitter.off(event,handler)}},{key:"wireHlsEvents",value:function(){var _this=this;if(this._hlsEventsWired)throw new Error("hlsEvents are already wired");if(!_HlsUtils2.default.isObject(this._hlsObjToBindTo))throw new Error("No hlsObjToBindTo: "+this._hlsObjToBindTo);if(!_HlsUtils2.default.isObject(this._hlsEmitter))throw new Error("No hlsEmitter: "+this._hlsEmitter);this._hlsEvents.forEach(function(event){return _this.wireHlsEvent(event)}),this._hlsEventsWired=!0}},{key:"unwireHlsEvents",value:function(){var _this2=this;if(!this._hlsEventsWired)throw new Error("hlsEvents aren't wired");this._hlsEvents.forEach(function(event){return _this2.unwireHlsEvent(event)}),this._hlsEventsWired=!1}},{key:"getHandlerKeyForFunction",value:function(func){if(!_HlsUtils2.default.isFunction(func))throw new Error("getHandlerForFunction requires a function as argument");return"Handler: "+func}},{key:"getHandlerForFunction",value:function(func){return this._handlers[this.getHandlerKeyForFunction(func)]}},{key:"createEventHandler",value:function(obj,func){var handlerName=this.getHandlerKeyForFunction(func);return this._handlers[handlerName]||(this._handlers[handlerName]=func.bind(obj)),this._handlers[handlerName]}}],[{key:"verifyEventsList",value:function(eventsList){if(!eventsList||!eventsList.forEach||!_HlsUtils2.default.isFunction(eventsList.forEach))throw new Error("verifyEventsList: invalid eventslist");eventsList.forEach(function(event){if(!event.event)throw new Error("verifyEventsList: invalid event: '"+event.event+"', func: '"+event.func+"'");if(!_HlsUtils2.default.isFunction(event.func))throw new Error("verifyEventsList: event: '"+event.event+"' invalid func: '"+event.func+"'")})}}]),EventHandlers}();exports.default=EventHandlers,module.exports=exports["default"]},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var KeySystems={FAIRPLAY:"FAIRPLAY",PLAYREADY:"PLAYREADY",WIDEVINE:"WIDEVINE",CLEARKEY:"CLEARKEY"};exports.default=KeySystems,module.exports=exports["default"]},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var DataTypes={MANIFEST:"MANIFEST",CHUNK:"CHUNK",KEY:"KEY"};exports.default=DataTypes,module.exports=exports["default"]},function(module,exports,__webpack_require__){var cof=__webpack_require__(22);module.exports=Object("z").propertyIsEnumerable(0)?Object:function(it){return"String"==cof(it)?it.split(""):Object(it)}},function(module,exports,__webpack_require__){var toInteger=__webpack_require__(32),max=Math.max,min=Math.min;module.exports=function(index,length){return index=toInteger(index),index<0?max(index+length,0):min(index,length)}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_ArrayHelper=__webpack_require__(21),_ArrayHelper2=_interopRequireDefault(_ArrayHelper),_errors=__webpack_require__(4),_events=__webpack_require__(3),_events2=_interopRequireDefault(_events),_KeySystems=__webpack_require__(36),_KeySystems2=_interopRequireDefault(_KeySystems),_logger=__webpack_require__(1);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var EME=function(){function EME(hls,keySystemName,obtainKeySystemConfigCallback,totalSessions){_classCallCheck(this,EME),this._obtainKeySystemConfigCallback=obtainKeySystemConfigCallback,this._keySystemName=keySystemName,this._keySystemConfig=null,this._keySystem=null,this._caps=null,this._hls=hls,this._totalSessions=totalSessions,this._keySystemName===_KeySystems2.default.WIDEVINE?this._keySystem="com.widevine.alpha":this._keySystemName===_KeySystems2.default.PLAYREADY?this._keySystem="com.microsoft.playready":this._keySystemName===_KeySystems2.default.FAIRPLAY?this._keySystem="com.apple.fps.2_0":this._keySystemName===_KeySystems2.default.CLEARKEY&&(this._keySystem="org.w3.clearkey")}return _createClass(EME,[{key:"obtainData",value:function(dataPromise,event){var _this=this;dataPromise?dataPromise.then(function(data){try{var promise=event.target.update(new Uint8Array(data));promise&&promise.catch(function(err){_this.onError(err)})}catch(err){_this.onError(err)}}).catch(function(err){_this.onError({message:err})}):this.onError({message:" The promise is not defined in the keySystemConfig"})}},{key:"obtainCertificate",value:function(event){this._keySystemConfig?this.obtainData(this._keySystemConfig.certificate,event):this.onError({message:" The keySystemConfig has not been set"})}},{key:"obtainLicense",value:function(event){if(this._keySystemConfig&&this._keySystemConfig.obtainLicenseCallback){var data=_ArrayHelper2.default.makeUint8Array(event.message);this.obtainData(this._keySystemConfig.obtainLicenseCallback(this._keySystemName,data),event)}else this.onError({message:" The keySystemConfig has not been set"})}},{key:"onError",value:function(err){_logger.logger.error("EME error : "+err.message),this._hls&&this._hls.trigger(_events2.default.ERROR,{type:_errors.ErrorTypes.MEDIA_ERROR,details:_errors.ErrorDetails.DRM_ERROR,fatal:!0,reason:err.message})}},{key:"setKeySystemConfig",value:function(keySystemData){this._obtainKeySystemConfigCallback&&(this._keySystemConfig=this._obtainKeySystemConfigCallback(this._keySystemName,keySystemData))}},{key:"keySystem",get:function(){return this._keySystem}},{key:"keySystemName",get:function(){return this._keySystemName}}],[{key:"capabilities",get:function(){return this._caps||(this._caps=new Promise(function(resolve){var keySystems=["com.apple.fps.2_0","com.microsoft.playready","com.widevine.alpha","org.w3.clearkey"],supportedKeySystems=[],i=0;if(window.navigator.requestMediaKeySystemAccess)(function(){var count=0,options=[{initDataTypes:["cenc"]}];for(options[0].audioCapabilities=[{contentType:'audio/mp4; codecs="mp4a.40.2"'}],options[0].videoCapabilities=[{contentType:'video/mp4; codecs="avc1.4d401f"'}],i=0;i<keySystems.length;i++)navigator.requestMediaKeySystemAccess(keySystems[i],options).then(function(keySystemAccess){supportedKeySystems.push(keySystemAccess.keySystem),count++,count===keySystems.length&&resolve(supportedKeySystems)}).catch(function(){count++,count===keySystems.length&&resolve(supportedKeySystems)})})();else{if(window.WebKitMediaKeys)for(i=0;i<keySystems.length;i++)window.WebKitMediaKeys.isTypeSupported(keySystems[i],"video/mp4")&&supportedKeySystems.push(keySystems[i]);if(window.MSMediaKeys)for(i=0;i<keySystems.length;i++)window.MSMediaKeys.isTypeSupported(keySystems[i],"video/mp4")&&supportedKeySystems.push(keySystems[i]);resolve(supportedKeySystems)}})),this._caps}}]),EME}();exports.default=EME,module.exports=exports["default"]},function(module,exports,__webpack_require__){"use strict";var _AdtsStream,Stream=__webpack_require__(11),ADTS_SAMPLING_FREQUENCIES=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];_AdtsStream=function(){var buffer;_AdtsStream.prototype.init.call(this),this.push=function(packet){var frameLength,protectionSkipBytes,frameEnd,oldBuffer,sampleCount,adtsFrameDuration,i=0,frameNum=0;if("audio"===packet.type){buffer?(oldBuffer=buffer,buffer=new Uint8Array(oldBuffer.byteLength+packet.data.byteLength),buffer.set(oldBuffer),buffer.set(packet.data,oldBuffer.byteLength)):buffer=packet.data;while(i+5<buffer.length)if(255===buffer[i]&&240===(246&buffer[i+1])){if(protectionSkipBytes=2*(1&~buffer[i+1]),frameLength=(3&buffer[i+3])<<11|buffer[i+4]<<3|(224&buffer[i+5])>>5,sampleCount=1024*((3&buffer[i+6])+1),adtsFrameDuration=9e4*sampleCount/ADTS_SAMPLING_FREQUENCIES[(60&buffer[i+2])>>>2],frameEnd=i+frameLength,buffer.byteLength<frameEnd)return;if(this.trigger("data",{pts:packet.pts+frameNum*adtsFrameDuration,dts:packet.dts+frameNum*adtsFrameDuration,sampleCount:sampleCount,audioobjecttype:(buffer[i+2]>>>6&3)+1,channelcount:(1&buffer[i+2])<<2|(192&buffer[i+3])>>>6,samplerate:ADTS_SAMPLING_FREQUENCIES[(60&buffer[i+2])>>>2],samplingfrequencyindex:(60&buffer[i+2])>>>2,samplesize:16,data:buffer.subarray(i+7+protectionSkipBytes,frameEnd)}),buffer.byteLength===frameEnd)return buffer=void 0,void 0;frameNum++,buffer=buffer.subarray(frameEnd)}else i++}},this.flush=function(){this.trigger("done")}},_AdtsStream.prototype=new Stream,module.exports=_AdtsStream},function(module,exports,__webpack_require__){"use strict";var _H264Stream,_NalByteStream,PROFILES_WITH_OPTIONAL_SPS_DATA,Stream=__webpack_require__(11),ExpGolomb=__webpack_require__(161);_NalByteStream=function(){var i,buffer,syncPoint=0;_NalByteStream.prototype.init.call(this),this.push=function(data){var swapBuffer;for(buffer?(swapBuffer=new Uint8Array(buffer.byteLength+data.data.byteLength),swapBuffer.set(buffer),swapBuffer.set(data.data,buffer.byteLength),buffer=swapBuffer):buffer=data.data;syncPoint<buffer.byteLength-3;syncPoint++)if(1===buffer[syncPoint+2]){i=syncPoint+5;break}while(i<buffer.byteLength)switch(buffer[i]){case 0:if(0!==buffer[i-1]){i+=2;break}if(0!==buffer[i-2]){i++;break}syncPoint+3!==i-2&&this.trigger("data",buffer.subarray(syncPoint+3,i-2));do i++;while(1!==buffer[i]&&i<buffer.length);syncPoint=i-2,i+=3;break;case 1:if(0!==buffer[i-1]||0!==buffer[i-2]){i+=3;break}this.trigger("data",buffer.subarray(syncPoint+3,i-2)),syncPoint=i-2,i+=3;break;default:i+=3}buffer=buffer.subarray(syncPoint),i-=syncPoint,syncPoint=0},this.flush=function(){buffer&&buffer.byteLength>3&&this.trigger("data",buffer.subarray(syncPoint+3)),buffer=null,syncPoint=0,this.trigger("done")}},_NalByteStream.prototype=new Stream,PROFILES_WITH_OPTIONAL_SPS_DATA={100:!0,110:!0,122:!0,244:!0,44:!0,83:!0,86:!0,118:!0,128:!0,138:!0,139:!0,134:!0},_H264Stream=function(){var self,trackId,currentPts,currentDts,discardEmulationPreventionBytes,readSequenceParameterSet,skipScalingList,nalByteStream=new _NalByteStream;_H264Stream.prototype.init.call(this),self=this,this.push=function(packet){"video"===packet.type&&(trackId=packet.trackId,currentPts=packet.pts,currentDts=packet.dts,nalByteStream.push(packet))},nalByteStream.on("data",function(data){var event={trackId:trackId,pts:currentPts,dts:currentDts,data:data};switch(31&data[0]){case 5:event.nalUnitType="slice_layer_without_partitioning_rbsp_idr";break;case 6:event.nalUnitType="sei_rbsp",event.escapedRBSP=discardEmulationPreventionBytes(data.subarray(1));break;case 7:event.nalUnitType="seq_parameter_set_rbsp",event.escapedRBSP=discardEmulationPreventionBytes(data.subarray(1)),event.config=readSequenceParameterSet(event.escapedRBSP);break;case 8:event.nalUnitType="pic_parameter_set_rbsp";break;case 9:event.nalUnitType="access_unit_delimiter_rbsp"}self.trigger("data",event)}),nalByteStream.on("done",function(){self.trigger("done")}),this.flush=function(){nalByteStream.flush()},skipScalingList=function(count,expGolombDecoder){var j,deltaScale,lastScale=8,nextScale=8;for(j=0;j<count;j++)0!==nextScale&&(deltaScale=expGolombDecoder.readExpGolomb(),nextScale=(lastScale+deltaScale+256)%256),lastScale=0===nextScale?lastScale:nextScale},discardEmulationPreventionBytes=function(data){var newLength,newData,length=data.byteLength,emulationPreventionBytesPositions=[],i=1;while(i<length-2)0===data[i]&&0===data[i+1]&&3===data[i+2]?(emulationPreventionBytesPositions.push(i+2),i+=2):i++;if(0===emulationPreventionBytesPositions.length)return data;newLength=length-emulationPreventionBytesPositions.length,newData=new Uint8Array(newLength);var sourceIndex=0;for(i=0;i<newLength;sourceIndex++,i++)sourceIndex===emulationPreventionBytesPositions[0]&&(sourceIndex++,emulationPreventionBytesPositions.shift()),newData[i]=data[sourceIndex];return newData},readSequenceParameterSet=function(data){var expGolombDecoder,profileIdc,levelIdc,profileCompatibility,chromaFormatIdc,picOrderCntType,numRefFramesInPicOrderCntCycle,picWidthInMbsMinus1,picHeightInMapUnitsMinus1,frameMbsOnlyFlag,scalingListCount,sarRatio,aspectRatioIdc,i,frameCropLeftOffset=0,frameCropRightOffset=0,frameCropTopOffset=0,frameCropBottomOffset=0,sarScale=1;if(expGolombDecoder=new ExpGolomb(data),profileIdc=expGolombDecoder.readUnsignedByte(),profileCompatibility=expGolombDecoder.readUnsignedByte(),levelIdc=expGolombDecoder.readUnsignedByte(),expGolombDecoder.skipUnsignedExpGolomb(),PROFILES_WITH_OPTIONAL_SPS_DATA[profileIdc]&&(chromaFormatIdc=expGolombDecoder.readUnsignedExpGolomb(),3===chromaFormatIdc&&expGolombDecoder.skipBits(1),expGolombDecoder.skipUnsignedExpGolomb(),expGolombDecoder.skipUnsignedExpGolomb(),expGolombDecoder.skipBits(1),expGolombDecoder.readBoolean()))for(scalingListCount=3!==chromaFormatIdc?8:12,i=0;i<scalingListCount;i++)expGolombDecoder.readBoolean()&&(i<6?skipScalingList(16,expGolombDecoder):skipScalingList(64,expGolombDecoder));
if(expGolombDecoder.skipUnsignedExpGolomb(),picOrderCntType=expGolombDecoder.readUnsignedExpGolomb(),0===picOrderCntType)expGolombDecoder.readUnsignedExpGolomb();else if(1===picOrderCntType)for(expGolombDecoder.skipBits(1),expGolombDecoder.skipExpGolomb(),expGolombDecoder.skipExpGolomb(),numRefFramesInPicOrderCntCycle=expGolombDecoder.readUnsignedExpGolomb(),i=0;i<numRefFramesInPicOrderCntCycle;i++)expGolombDecoder.skipExpGolomb();if(expGolombDecoder.skipUnsignedExpGolomb(),expGolombDecoder.skipBits(1),picWidthInMbsMinus1=expGolombDecoder.readUnsignedExpGolomb(),picHeightInMapUnitsMinus1=expGolombDecoder.readUnsignedExpGolomb(),frameMbsOnlyFlag=expGolombDecoder.readBits(1),0===frameMbsOnlyFlag&&expGolombDecoder.skipBits(1),expGolombDecoder.skipBits(1),expGolombDecoder.readBoolean()&&(frameCropLeftOffset=expGolombDecoder.readUnsignedExpGolomb(),frameCropRightOffset=expGolombDecoder.readUnsignedExpGolomb(),frameCropTopOffset=expGolombDecoder.readUnsignedExpGolomb(),frameCropBottomOffset=expGolombDecoder.readUnsignedExpGolomb()),expGolombDecoder.readBoolean()&&expGolombDecoder.readBoolean()){switch(aspectRatioIdc=expGolombDecoder.readUnsignedByte(),aspectRatioIdc){case 1:sarRatio=[1,1];break;case 2:sarRatio=[12,11];break;case 3:sarRatio=[10,11];break;case 4:sarRatio=[16,11];break;case 5:sarRatio=[40,33];break;case 6:sarRatio=[24,11];break;case 7:sarRatio=[20,11];break;case 8:sarRatio=[32,11];break;case 9:sarRatio=[80,33];break;case 10:sarRatio=[18,11];break;case 11:sarRatio=[15,11];break;case 12:sarRatio=[64,33];break;case 13:sarRatio=[160,99];break;case 14:sarRatio=[4,3];break;case 15:sarRatio=[3,2];break;case 16:sarRatio=[2,1];break;case 255:sarRatio=[expGolombDecoder.readUnsignedByte()<<8|expGolombDecoder.readUnsignedByte(),expGolombDecoder.readUnsignedByte()<<8|expGolombDecoder.readUnsignedByte()]}sarRatio&&(sarScale=sarRatio[0]/sarRatio[1])}return{profileIdc:profileIdc,levelIdc:levelIdc,profileCompatibility:profileCompatibility,width:Math.ceil((16*(picWidthInMbsMinus1+1)-2*frameCropLeftOffset-2*frameCropRightOffset)*sarScale),height:(2-frameMbsOnlyFlag)*(picHeightInMapUnitsMinus1+1)*16-2*frameCropTopOffset-2*frameCropBottomOffset}}},_H264Stream.prototype=new Stream,module.exports={H264Stream:_H264Stream,NalByteStream:_NalByteStream}},function(module){"use strict";var _FlvTag;_FlvTag=function(type,extraData){var i,adHoc=0,bufferStartSize=16384,prepareWrite=function(flv,count){var bytes,minLength=flv.position+count;minLength<flv.bytes.byteLength||(bytes=new Uint8Array(2*minLength),bytes.set(flv.bytes.subarray(0,flv.position),0),flv.bytes=bytes,flv.view=new DataView(flv.bytes.buffer))},widthBytes=_FlvTag.widthBytes||new Uint8Array("width".length),heightBytes=_FlvTag.heightBytes||new Uint8Array("height".length),videocodecidBytes=_FlvTag.videocodecidBytes||new Uint8Array("videocodecid".length);if(!_FlvTag.widthBytes){for(i=0;i<"width".length;i++)widthBytes[i]="width".charCodeAt(i);for(i=0;i<"height".length;i++)heightBytes[i]="height".charCodeAt(i);for(i=0;i<"videocodecid".length;i++)videocodecidBytes[i]="videocodecid".charCodeAt(i);_FlvTag.widthBytes=widthBytes,_FlvTag.heightBytes=heightBytes,_FlvTag.videocodecidBytes=videocodecidBytes}switch(this.keyFrame=!1,type){case _FlvTag.VIDEO_TAG:this.length=16,bufferStartSize*=6;break;case _FlvTag.AUDIO_TAG:this.length=13,this.keyFrame=!0;break;case _FlvTag.METADATA_TAG:this.length=29,this.keyFrame=!0;break;default:throw new Error("Unknown FLV tag type")}this.bytes=new Uint8Array(bufferStartSize),this.view=new DataView(this.bytes.buffer),this.bytes[0]=type,this.position=this.length,this.keyFrame=extraData,this.pts=0,this.dts=0,this.writeBytes=function(bytes,offset,length){var end,start=offset||0;length=length||bytes.byteLength,end=start+length,prepareWrite(this,length),this.bytes.set(bytes.subarray(start,end),this.position),this.position+=length,this.length=Math.max(this.length,this.position)},this.writeByte=function(byte){prepareWrite(this,1),this.bytes[this.position]=byte,this.position++,this.length=Math.max(this.length,this.position)},this.writeShort=function(short){prepareWrite(this,2),this.view.setUint16(this.position,short),this.position+=2,this.length=Math.max(this.length,this.position)},this.negIndex=function(pos){return this.bytes[this.length-pos]},this.nalUnitSize=function(){return 0===adHoc?0:this.length-(adHoc+4)},this.startNalUnit=function(){if(adHoc>0)throw new Error("Attempted to create new NAL wihout closing the old one");adHoc=this.length,this.length+=4,this.position=this.length},this.endNalUnit=function(nalContainer){var nalStart,nalLength;this.length===adHoc+4?this.length-=4:adHoc>0&&(nalStart=adHoc+4,nalLength=this.length-nalStart,this.position=adHoc,this.view.setUint32(this.position,nalLength),this.position=this.length,nalContainer&&nalContainer.push(this.bytes.subarray(nalStart,nalStart+nalLength))),adHoc=0},this.writeMetaDataDouble=function(key,val){var i;if(prepareWrite(this,2+key.length+9),this.view.setUint16(this.position,key.length),this.position+=2,"width"===key)this.bytes.set(widthBytes,this.position),this.position+=5;else if("height"===key)this.bytes.set(heightBytes,this.position),this.position+=6;else if("videocodecid"===key)this.bytes.set(videocodecidBytes,this.position),this.position+=12;else for(i=0;i<key.length;i++)this.bytes[this.position]=key.charCodeAt(i),this.position++;this.position++,this.view.setFloat64(this.position,val),this.position+=8,this.length=Math.max(this.length,this.position),++adHoc},this.writeMetaDataBoolean=function(key,val){var i;for(prepareWrite(this,2),this.view.setUint16(this.position,key.length),this.position+=2,i=0;i<key.length;i++)prepareWrite(this,1),this.bytes[this.position]=key.charCodeAt(i),this.position++;prepareWrite(this,2),this.view.setUint8(this.position,1),this.position++,this.view.setUint8(this.position,val?1:0),this.position++,this.length=Math.max(this.length,this.position),++adHoc},this.finalize=function(){var dtsDelta,len;switch(this.bytes[0]){case _FlvTag.VIDEO_TAG:this.bytes[11]=7|(this.keyFrame||extraData?16:32),this.bytes[12]=extraData?0:1,dtsDelta=this.pts-this.dts,this.bytes[13]=(16711680&dtsDelta)>>>16,this.bytes[14]=(65280&dtsDelta)>>>8,this.bytes[15]=(255&dtsDelta)>>>0;break;case _FlvTag.AUDIO_TAG:this.bytes[11]=175,this.bytes[12]=extraData?0:1;break;case _FlvTag.METADATA_TAG:this.position=11,this.view.setUint8(this.position,2),this.position++,this.view.setUint16(this.position,10),this.position+=2,this.bytes.set([111,110,77,101,116,97,68,97,116,97],this.position),this.position+=10,this.bytes[this.position]=8,this.position++,this.view.setUint32(this.position,adHoc),this.position=this.length,this.bytes.set([0,0,9],this.position),this.position+=3,this.length=this.position}return len=this.length-11,this.bytes[1]=(16711680&len)>>>16,this.bytes[2]=(65280&len)>>>8,this.bytes[3]=(255&len)>>>0,this.bytes[4]=(16711680&this.dts)>>>16,this.bytes[5]=(65280&this.dts)>>>8,this.bytes[6]=(255&this.dts)>>>0,this.bytes[7]=(4278190080&this.dts)>>>24,this.bytes[8]=0,this.bytes[9]=0,this.bytes[10]=0,prepareWrite(this,4),this.view.setUint32(this.length,this.length),this.length+=4,this.position+=4,this.bytes=this.bytes.subarray(0,this.length),this.frameTime=_FlvTag.frameTime(this.bytes),this}},_FlvTag.AUDIO_TAG=8,_FlvTag.VIDEO_TAG=9,_FlvTag.METADATA_TAG=18,_FlvTag.isAudioFrame=function(tag){return _FlvTag.AUDIO_TAG===tag[0]},_FlvTag.isVideoFrame=function(tag){return _FlvTag.VIDEO_TAG===tag[0]},_FlvTag.isMetaData=function(tag){return _FlvTag.METADATA_TAG===tag[0]},_FlvTag.isKeyFrame=function(tag){return _FlvTag.isVideoFrame(tag)?23===tag[11]:!!_FlvTag.isAudioFrame(tag)||!!_FlvTag.isMetaData(tag)},_FlvTag.frameTime=function(tag){var pts=tag[4]<<16;return pts|=tag[5]<<8,pts|=tag[6]<<0,pts|=tag[7]<<24,pts},module.exports=_FlvTag},function(module,exports,__webpack_require__){"use strict";var muxjs={codecs:__webpack_require__(144),mp4:__webpack_require__(155),flv:__webpack_require__(148),mp2t:__webpack_require__(152)};muxjs.mp4.tools=__webpack_require__(158),muxjs.flv.tools=__webpack_require__(157),muxjs.mp2t.tools=__webpack_require__(159),module.exports=muxjs},function(module,exports,__webpack_require__){"use strict";var _TransportPacketStream,_TransportParseStream,_ElementaryStream,Stream=__webpack_require__(11),CaptionStream=__webpack_require__(151),StreamTypes=__webpack_require__(26),TimestampRolloverStream=__webpack_require__(75).TimestampRolloverStream,m2tsStreamTypes=__webpack_require__(26),MP2T_PACKET_LENGTH=188,SYNC_BYTE=71;_TransportPacketStream=function(tube){var buffer=new Uint8Array(MP2T_PACKET_LENGTH),logTube=tube,bytesInBuffer=0;_TransportPacketStream.prototype.init.call(this),this.push=function(bytes){var everything,startIndex=0,endIndex=MP2T_PACKET_LENGTH,corrupt=!1;bytesInBuffer?(everything=new Uint8Array(bytes.byteLength+bytesInBuffer),everything.set(buffer.subarray(0,bytesInBuffer)),everything.set(bytes,bytesInBuffer),bytesInBuffer=0):everything=bytes;while(endIndex<everything.byteLength)everything[startIndex]!==SYNC_BYTE||everything[endIndex]!==SYNC_BYTE?(corrupt=!0,startIndex++,endIndex++):(this.trigger("data",everything.subarray(startIndex,endIndex)),startIndex+=MP2T_PACKET_LENGTH,endIndex+=MP2T_PACKET_LENGTH);corrupt===!0&&logTube&&logTube.log("m2ts.js: Lost pkt alignment at least once while processing the transport stream chunk"),startIndex<everything.byteLength&&(buffer.set(everything.subarray(startIndex),0),bytesInBuffer=everything.byteLength-startIndex)},this.flush=function(){bytesInBuffer===MP2T_PACKET_LENGTH&&buffer[0]===SYNC_BYTE&&(this.trigger("data",buffer),bytesInBuffer=0),this.trigger("done")}},_TransportPacketStream.prototype=new Stream,_TransportParseStream=function(tube){var parsePsi,parsePat,parsePmt,self;_TransportParseStream.prototype.init.call(this),self=this,this.packetsWaitingForPmt=[],this.programMapTable=void 0,parsePsi=function(payload,psi){var offset=0;psi.payloadUnitStartIndicator&&(offset+=payload[offset]+1),"pat"===psi.type?parsePat(payload.subarray(offset),psi):parsePmt(payload.subarray(offset),psi)},parsePat=function(payload,pat){pat.section_number=payload[7],pat.last_section_number=payload[8],self.pmtPid=(31&payload[10])<<8|payload[11],pat.pmtPid=self.pmtPid},parsePmt=function(payload,pmt){var sectionLength,tableEnd,programInfoLength,offset;if(1&payload[5]){self.programMapTable={},self.audioPid=8191,sectionLength=(15&payload[1])<<8|payload[2],tableEnd=3+sectionLength-4,programInfoLength=(15&payload[10])<<8|payload[11],offset=12+programInfoLength;while(offset<tableEnd){var pid=(31&payload[offset+1])<<8|payload[offset+2],streamType=payload[offset];self.programMapTable[pid]=streamType,15===streamType&&pid<self.audioPid&&(self.audioPid=pid),offset+=((15&payload[offset+3])<<8|payload[offset+4])+5}pmt.programMapTable=self.programMapTable;while(self.packetsWaitingForPmt.length)self.processPes_.apply(self,self.packetsWaitingForPmt.shift())}},this.push=function(packet){var result={},offset=4;result.payloadUnitStartIndicator=!!(64&packet[1]),result.pid=31&packet[1],result.pid<<=8,result.pid|=packet[2],(48&packet[3])>>>4>1&&(offset+=packet[offset]+1),0===result.pid?(result.type="pat",parsePsi(packet.subarray(offset),result),this.trigger("data",result)):result.pid===this.pmtPid?(result.type="pmt",parsePsi(packet.subarray(offset),result),this.trigger("data",result)):void 0===this.programMapTable?this.packetsWaitingForPmt.push([packet,offset,result]):this.processPes_(packet,offset,result)},this.processPes_=function(packet,offset,result){result.streamType=this.programMapTable[result.pid],15===result.streamType?result.pid===this.audioPid&&(result.type="pes",result.data=packet.subarray(offset),this.trigger("data",result)):(result.type="pes",result.data=packet.subarray(offset),this.trigger("data",result))}},_TransportParseStream.prototype=new Stream,_TransportParseStream.STREAM_TYPES={h264:27,adts:15},_ElementaryStream=function(tube){var self=this,video={data:[],size:0},audio={data:[],size:0},timedMetadata={data:[],size:0},logTube=tube,parsePes=function(payload,pes){var ptsDtsFlags;pes.dataAlignmentIndicator=0!==(4&payload[6]),ptsDtsFlags=payload[7],192&ptsDtsFlags&&(pes.pts=(14&payload[9])<<27|(255&payload[10])<<20|(254&payload[11])<<12|(255&payload[12])<<5|(254&payload[13])>>>3,pes.pts*=4,pes.pts+=(6&payload[13])>>>1,pes.dts=pes.pts,64&ptsDtsFlags&&(pes.dts=(14&payload[14])<<27|(255&payload[15])<<20|(254&payload[16])<<12|(255&payload[17])<<5|(254&payload[18])>>>3,pes.dts*=4,pes.dts+=(6&payload[18])>>>1)),pes.data=payload.subarray(9+payload[8])},flushStream=function(stream,type){var fragment,packetData=new Uint8Array(stream.size),event={type:type},i=0;if(stream.data.length){event.trackId=stream.data[0].pid;var payloadUnitStartIndicator=stream.data[0].payloadUnitStartIndicator;while(stream.data.length)fragment=stream.data.shift(),packetData.set(fragment.data,i),i+=fragment.data.byteLength;payloadUnitStartIndicator===!0?parsePes(packetData,event):(logTube&&logTube.log("m2ts.js: trailing frame found"),event.data=fragment.data),stream.size=0,self.trigger("data",event)}};_ElementaryStream.prototype.init.call(this),this.push=function(data){({pat:function(){},pes:function(){var stream,streamType;switch(data.streamType){case StreamTypes.H264_STREAM_TYPE:case m2tsStreamTypes.H264_STREAM_TYPE:stream=video,streamType="video";break;case StreamTypes.ADTS_STREAM_TYPE:stream=audio,streamType="audio";break;case StreamTypes.METADATA_STREAM_TYPE:stream=timedMetadata,streamType="timed-metadata";break;default:return}data.payloadUnitStartIndicator&&flushStream(stream,streamType),stream.data.push(data),stream.size+=data.data.byteLength},pmt:function(){var k,track,event={type:"metadata",tracks:[]},programMapTable=data.programMapTable;for(k in programMapTable)programMapTable.hasOwnProperty(k)&&(track={timelineStartInfo:{baseMediaDecodeTime:0},lastTimelineStartInfo:{}},track.id=+k,programMapTable[k]===m2tsStreamTypes.H264_STREAM_TYPE?(track.codec="avc",track.type="video"):programMapTable[k]===m2tsStreamTypes.ADTS_STREAM_TYPE&&(track.codec="adts",track.type="audio"),event.tracks.push(track));self.trigger("data",event)}})[data.type]()},this.flush=function(){flushStream(video,"video"),flushStream(audio,"audio"),flushStream(timedMetadata,"timed-metadata"),this.trigger("done")}},_ElementaryStream.prototype=new Stream;var m2ts={PAT_PID:0,MP2T_PACKET_LENGTH:MP2T_PACKET_LENGTH,TransportPacketStream:_TransportPacketStream,TransportParseStream:_TransportParseStream,ElementaryStream:_ElementaryStream,TimestampRolloverStream:TimestampRolloverStream,CaptionStream:CaptionStream.CaptionStream,Cea608Stream:CaptionStream.Cea608Stream,MetadataStream:__webpack_require__(153)};for(var type in StreamTypes)StreamTypes.hasOwnProperty(type)&&(m2ts[type]=StreamTypes[type]);module.exports=m2ts},function(module,exports,__webpack_require__){"use strict";var _VideoSegmentStream,_AudioSegmentStream,_Transmuxer,_CoalesceStream,createDefaultSample,isLikelyAacData,collectDtsInfo,clearDtsInfo,calculateTrackBaseMediaDecodeTime,arrayEquals,applyCompositionTimeOffsetToBaseMediaDecodeTime,sumFrameByteLengths,Stream=__webpack_require__(11),mp4=__webpack_require__(76),m2ts=__webpack_require__(45),AdtsStream=__webpack_require__(41),H264Stream=__webpack_require__(42).H264Stream,AacStream=__webpack_require__(142),coneOfSilence=__webpack_require__(145),clock=__webpack_require__(160),AUDIO_PROPERTIES=["audioobjecttype","channelcount","samplerate","samplingfrequencyindex","samplesize","startTime","fragmentDuration","totalSamples"],VIDEO_PROPERTIES=["width","height","profileIdc","levelIdc","profileCompatibility","startTime","fragmentDuration","totalSamples"],ONE_SECOND_IN_TS=9e4;createDefaultSample=function(){return{size:0,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0,degradationPriority:0}}},isLikelyAacData=function(data){return data[0]==="I".charCodeAt(0)&&data[1]==="D".charCodeAt(0)&&data[2]==="3".charCodeAt(0)},arrayEquals=function(a,b){var i;if(a.length!==b.length)return!1;for(i=0;i<a.length;i++)if(a[i]!==b[i])return!1;return!0},sumFrameByteLengths=function(array){var i,currentObj,sum=0;for(i=0;i<array.length;i++)currentObj=array[i],sum+=currentObj.data.byteLength;return sum},_AudioSegmentStream=function(track){var adtsFrames=[],sequenceNumber=0,earliestAllowedDts=0,audioAppendStartTs=0,gapDuration=0,videoBaseMediaDecodeTime=1/0;_AudioSegmentStream.prototype.init.call(this),this.push=function(data){collectDtsInfo(track,data),track&&AUDIO_PROPERTIES.forEach(function(prop){track[prop]=data[prop]}),adtsFrames.push(data)},track.timescale=track.samplerate,this.setEarliestDts=function(earliestDts){earliestAllowedDts=earliestDts-track.timelineStartInfo.baseMediaDecodeTime},this.setVideoBaseMediaDecodeTime=function(baseMediaDecodeTime){videoBaseMediaDecodeTime=baseMediaDecodeTime},this.setAudioAppendStart=function(timestamp){audioAppendStartTs=timestamp},this.setGapDuration=function(gap){gapDuration=gap},this.flush=function(){var frames,moof,mdat,boxes,frameDuration=1024/track.samplerate*ONE_SECOND_IN_TS;if(0===adtsFrames.length)return this.trigger("done","AudioSegmentStream"),void 0;if(frames=adtsFrames,void 0!==track.lastMinSegmentDts&&track.lastMinSegmentDts>=track.minSegmentDts-3*frameDuration&&track.lastMinSegmentDts<=track.minSegmentDts+3*frameDuration?track.duplicateFrag=!0:track.duplicateFrag=!1,track.lastMinSegmentDts=track.minSegmentDts,track.lastTimelineStartInfo&&(void 0===track.lastTimelineStartInfo.baseMediaDecodeTime||track.lastTimelineStartInfo.baseMediaDecodeTime!=track.timelineStartInfo.baseMediaDecodeTime))if(track.lastTimelineStartInfo.baseMediaDecodeTime=track.timelineStartInfo.baseMediaDecodeTime,track.frameInsertCount){var silentFrame=coneOfSilence[track.samplerate],i=void 0;for(silentFrame||(silentFrame=frames[0].data),i=0;i<track.frameInsertCount;i++)frames.splice(i,0,{data:silentFrame});track.frameInsertCount=0}else track.frameDropCount&&(frames.splice(0,track.frameDropCount),track.frameDropCount=0);track.samples=this.generateSampleTable_(frames),track.baseMediaDecodeTime=track.nextBMDT*(track.samplerate/ONE_SECOND_IN_TS),track.totalSamples=track.samples.length,track.fragmentDuration=1024/track.samplerate*track.totalSamples,track.timescale=track.samplerate,track.startTime=track.baseMediaDecodeTime/track.samplerate,track.duplicateFrag===!1&&(track.nextBMDT+=frameDuration*track.totalSamples),mdat=mp4.mdat(this.concatenateFrameData_(frames)),adtsFrames=[],moof=mp4.moof(sequenceNumber,[track]),boxes=new Uint8Array(moof.byteLength+mdat.byteLength),sequenceNumber++,boxes.set(moof),boxes.set(mdat,moof.byteLength),this.trigger("data",{track:track,boxes:boxes}),this.trigger("done","AudioSegmentStream"),clearDtsInfo(track)},this.prefixWithSilence_=function(track,frames){var baseMediaDecodeTimeTs,silentFrame,i,frameDuration=0,audioGapDuration=0,audioFillFrameCount=0,audioFillDuration=0;if(frames.length&&(baseMediaDecodeTimeTs=clock.audioTsToVideoTs(track.baseMediaDecodeTime,track.samplerate),frameDuration=Math.ceil(ONE_SECOND_IN_TS/(track.samplerate/1024)),audioAppendStartTs&&videoBaseMediaDecodeTime&&(audioGapDuration=baseMediaDecodeTimeTs-Math.max(audioAppendStartTs,videoBaseMediaDecodeTime),audioFillFrameCount=Math.floor(audioGapDuration/frameDuration),audioFillDuration=audioFillFrameCount*frameDuration),!(audioFillFrameCount<1||audioFillDuration>ONE_SECOND_IN_TS/2))){for(silentFrame=coneOfSilence[track.samplerate],silentFrame||(silentFrame=frames[0].data),i=0;i<audioFillFrameCount;i++)frames.splice(i,0,{data:silentFrame});track.baseMediaDecodeTime-=Math.floor(clock.videoTsToAudioTs(audioFillDuration,track.samplerate))}},this.trimAdtsFramesByEarliestDts_=function(adtsFrames){return track.minSegmentDts>=earliestAllowedDts?adtsFrames:(track.minSegmentDts=1/0,adtsFrames.filter(function(currentFrame){return currentFrame.dts>=earliestAllowedDts&&(track.minSegmentDts=Math.min(track.minSegmentDts,currentFrame.dts),track.minSegmentPts=track.minSegmentDts,!0)}))},this.generateSampleTable_=function(frames){var i,currentFrame,samples=[];for(i=0;i<frames.length;i++)currentFrame=frames[i],samples.push({size:currentFrame.data.byteLength,duration:1024});return samples},this.concatenateFrameData_=function(frames){var i,currentFrame,dataOffset=0,data=new Uint8Array(sumFrameByteLengths(frames));for(i=0;i<frames.length;i++)currentFrame=frames[i],data.set(currentFrame.data,dataOffset),dataOffset+=currentFrame.data.byteLength;return data}},_AudioSegmentStream.prototype=new Stream,_VideoSegmentStream=function(track){var config,gapDuration,pps,sequenceNumber=0,nalUnits=[];_VideoSegmentStream.prototype.init.call(this),delete track.minPTS,this.lastGopsDuration=void 0,this.constantGopsDuration=!0,this.gopCache_=[],this.push=function(nalUnit){collectDtsInfo(track,nalUnit),"seq_parameter_set_rbsp"!==nalUnit.nalUnitType||config||(config=nalUnit.config,track.sps=[nalUnit.data],VIDEO_PROPERTIES.forEach(function(prop){track[prop]=config[prop]},this)),"pic_parameter_set_rbsp"!==nalUnit.nalUnitType||pps||(pps=nalUnit.data,track.pps=[nalUnit.data]),nalUnits.push(nalUnit)},this.setGapDuration=function(gap){gapDuration=gap},this.flush=function(){var frames,gopForFusion,gops,moof,mdat,boxes;while(nalUnits.length){if("access_unit_delimiter_rbsp"===nalUnits[0].nalUnitType)break;nalUnits.shift()}if(0===nalUnits.length)return this.resetStream_(),this.trigger("done","VideoSegmentStream"),void 0;if(frames=this.groupNalsIntoFrames_(nalUnits),gops=this.groupFramesIntoGops_(frames),track.fragmentDuration=gops.duration/ONE_SECOND_IN_TS,track.startTime=track.nextBMDT/ONE_SECOND_IN_TS,track.timescale=ONE_SECOND_IN_TS,gops[0][0].keyFrame||(gopForFusion=this.getGopForFusion_(nalUnits[0],track),gopForFusion?(gops.unshift(gopForFusion),gops.byteLength+=gopForFusion.byteLength,gops.nalCount+=gopForFusion.nalCount,gops.pts=gopForFusion.pts,gops.dts=gopForFusion.dts,gops.duration+=gopForFusion.duration,track.fusionDuration+=gopForFusion.duration):gops=this.extendFirstKeyFrame_(gops),collectDtsInfo(track,gops)),track.samples=this.generateSampleTable_(gops),track.totalSamples=track.samples.length,mdat=mp4.mdat(this.concatenateNalData_(gops)),this.gopCache_.unshift({gop:gops.pop(),pps:track.pps,sps:track.sps}),this.gopCache_.length=Math.min(6,this.gopCache_.length),nalUnits=[],track.baseMediaDecodeTime=track.nextBMDT-track.fusionDuration,this.trigger("baseMediaDecodeTime",track.baseMediaDecodeTime),gapDuration){var extensionTime=0;track.lastMinSegmentDts&&this.lastGopsDuration&&(extensionTime=track.minSegmentDts-(track.lastMinSegmentDts+this.lastGopsDuration)),track.samples[0].duration+=extensionTime,gops.duration+=extensionTime}if(track.lastTimelineStartInfo&&(void 0===track.lastTimelineStartInfo.baseMediaDecodeTime||track.lastTimelineStartInfo.baseMediaDecodeTime!=track.timelineStartInfo.baseMediaDecodeTime)&&(this.trigger("timelineStartInfo",track.timelineStartInfo),track.lastTimelineStartInfo.baseMediaDecodeTime=track.timelineStartInfo.baseMediaDecodeTime,track.truncateDuration&&(track.samples[0].duration+=track.truncateDuration,gops.duration+=track.truncateDuration,track.truncateDuration=0),track.allowNegativeTFDT)){var initialCTO=track.samples[0].compositionTimeOffset;track.baseMediaDecodeTime-=initialCTO,track.nextBMDT-=initialCTO}void 0!==track.lastMinSegmentDts&&track.lastMinSegmentDts===track.minSegmentDts?track.duplicateFrag=!0:(track.nextBMDT+=gops.duration,track.duplicateFrag=!1),track.lastMinSegmentDts=track.minSegmentDts,this.lastGopsDuration=gops.duration,moof=mp4.moof(sequenceNumber,[track]),boxes=new Uint8Array(moof.byteLength+mdat.byteLength),sequenceNumber++,boxes.set(moof),boxes.set(mdat,moof.byteLength),this.trigger("data",{track:track,boxes:boxes}),this.trigger("done","VideoSegmentStream"),this.resetStream_()},this.resetGOPS=function(){this.gopCache_=[],this.lastGopsDuration=void 0,this.constantGopsDuration=!0},this.resetStream_=function(){clearDtsInfo(track),config=void 0,pps=void 0},this.getGopForFusion_=function(nalUnit){var dtsDistance,nearestGopObj,currentGop,currentGopObj,i,halfSecond=45e3,allowableOverlap=1e4,nearestDistance=1/0;for(i=0;i<this.gopCache_.length;i++)currentGopObj=this.gopCache_[i],currentGop=currentGopObj.gop,track.pps&&arrayEquals(track.pps[0],currentGopObj.pps[0])&&track.sps&&arrayEquals(track.sps[0],currentGopObj.sps[0])&&(currentGop.dts<track.timelineStartInfo.dts||(dtsDistance=nalUnit.dts-currentGop.dts-currentGop.duration,dtsDistance>=-allowableOverlap&&dtsDistance<=halfSecond&&(!nearestGopObj||nearestDistance>dtsDistance)&&(nearestGopObj=currentGopObj,nearestDistance=dtsDistance)));return nearestGopObj?nearestGopObj.gop:null},this.extendFirstKeyFrame_=function(gops){var currentGop;return!gops[0][0].keyFrame&&gops.length>1&&(currentGop=gops.shift(),gops.byteLength-=currentGop.byteLength,gops.nalCount-=currentGop.nalCount,gops[0][0].dts=currentGop.dts,gops[0][0].pts=currentGop.pts,gops[0][0].duration+=currentGop.duration),gops},this.groupNalsIntoFrames_=function(nalUnits){var i,currentNal,currentFrame=[],frames=[];for(currentFrame.byteLength=0,i=0;i<nalUnits.length;i++)currentNal=nalUnits[i],"access_unit_delimiter_rbsp"===currentNal.nalUnitType?(currentFrame.length&&(currentFrame.duration=currentNal.dts-currentFrame.dts,frames.push(currentFrame)),currentFrame=[currentNal],currentFrame.byteLength=currentNal.data.byteLength,void 0!==currentNal.pts?currentFrame.pts=currentNal.pts:currentFrame.pts=0,void 0!==currentNal.dts?currentFrame.dts=currentNal.dts:currentFrame.dts=0):("slice_layer_without_partitioning_rbsp_idr"===currentNal.nalUnitType&&(currentFrame.keyFrame=!0),void 0===currentNal.dts&&(currentNal.dts=0),currentFrame.duration=currentNal.dts-currentFrame.dts,currentFrame.byteLength+=currentNal.data.byteLength,currentFrame.push(currentNal));return frames.length&&(!currentFrame.duration||currentFrame.duration<=0)&&(currentFrame.duration=frames[frames.length-1].duration),frames.push(currentFrame),frames},this.groupFramesIntoGops_=function(frames){var i,currentFrame,currentGop=[],gops=[];for(currentGop.byteLength=0,currentGop.nalCount=0,currentGop.duration=0,currentGop.pts=frames[0].pts,currentGop.dts=frames[0].dts,gops.byteLength=0,gops.nalCount=0,gops.duration=0,gops.pts=frames[0].pts,gops.dts=frames[0].dts,i=0;i<frames.length;i++)currentFrame=frames[i],currentFrame.keyFrame?(currentGop.length&&(gops.push(currentGop),gops.byteLength+=currentGop.byteLength,gops.nalCount+=currentGop.nalCount,gops.duration+=currentGop.duration),currentGop=[currentFrame],currentGop.nalCount=currentFrame.length,currentGop.byteLength=currentFrame.byteLength,currentGop.pts=currentFrame.pts,currentGop.dts=currentFrame.dts,currentGop.duration=currentFrame.duration):(currentGop.duration+=currentFrame.duration,currentGop.nalCount+=currentFrame.length,currentGop.byteLength+=currentFrame.byteLength,currentGop.push(currentFrame));return gops.length&&currentGop.duration<=0&&(currentGop.duration=gops[gops.length-1].duration),gops.byteLength+=currentGop.byteLength,gops.nalCount+=currentGop.nalCount,gops.duration+=currentGop.duration,gops.push(currentGop),gops},this.generateSampleTable_=function(gops,baseDataOffset){var h,i,sample,currentGop,currentFrame,dataOffset=baseDataOffset||0,samples=[];for(h=0;h<gops.length;h++)for(currentGop=gops[h],i=0;i<currentGop.length;i++)currentFrame=currentGop[i],sample=createDefaultSample(),sample.dataOffset=dataOffset,sample.compositionTimeOffset=currentFrame.pts-currentFrame.dts,sample.duration=currentFrame.duration,sample.size=4*currentFrame.length,sample.size+=currentFrame.byteLength,currentFrame.keyFrame?(sample.flags.dependsOn=2,sample.flags.isNonSyncSample=0):sample.flags.isNonSyncSample=1,dataOffset+=sample.size,samples.push(sample);return samples},this.concatenateNalData_=function(gops){var h,i,j,currentGop,currentFrame,currentNal,dataOffset=0,nalsByteLength=gops.byteLength,numberOfNals=gops.nalCount,totalByteLength=nalsByteLength+4*numberOfNals,data=new Uint8Array(totalByteLength),view=new DataView(data.buffer);for(h=0;h<gops.length;h++)for(currentGop=gops[h],i=0;i<currentGop.length;i++)for(currentFrame=currentGop[i],j=0;j<currentFrame.length;j++)currentNal=currentFrame[j],view.setUint32(dataOffset,currentNal.data.byteLength),dataOffset+=4,data.set(currentNal.data,dataOffset),dataOffset+=currentNal.data.byteLength;return data}},_VideoSegmentStream.prototype=new Stream,collectDtsInfo=function(track,data){"number"===typeof data.pts&&(void 0===track.timelineStartInfo.pts&&(track.timelineStartInfo.pts=data.pts),void 0===track.minSegmentPts?track.minSegmentPts=data.pts:track.minSegmentPts=Math.min(track.minSegmentPts,data.pts),void 0===track.maxSegmentPts?track.maxSegmentPts=data.pts:track.maxSegmentPts=Math.max(track.maxSegmentPts,data.pts)),"number"===typeof data.dts&&(void 0===track.timelineStartInfo.dts&&(track.timelineStartInfo.dts=data.dts),void 0===track.minSegmentDts?track.minSegmentDts=data.dts:track.minSegmentDts=Math.min(track.minSegmentDts,data.dts),void 0===track.maxSegmentDts?track.maxSegmentDts=data.dts:track.maxSegmentDts=Math.max(track.maxSegmentDts,data.dts)),"number"===typeof data.pts&&"number"===typeof data.dts&&(track.maxCompositionTimeOffset=Math.max(track.maxCompositionTimeOffset,data.pts-data.dts))},clearDtsInfo=function(track){delete track.minSegmentDts,delete track.maxSegmentDts,delete track.minSegmentPts,delete track.maxSegmentPts},applyCompositionTimeOffsetToBaseMediaDecodeTime=function(track,baseMediaDecodeTime,firstSampleCompositionTimeOffset){if(track.minSegmentPts>track.timelineStartInfo.pts){var compositionTimeOffset=track.timelineStartInfo.pts-track.timelineStartInfo.dts;0===compositionTimeOffset?firstSampleCompositionTimeOffset>0&&(baseMediaDecodeTime+=firstSampleCompositionTimeOffset):0===firstSampleCompositionTimeOffset&&(baseMediaDecodeTime-=compositionTimeOffset)}return baseMediaDecodeTime},calculateTrackBaseMediaDecodeTime=function(track){var baseMediaDecodeTime,scale,timeSinceStartOfTimeline=0;return void 0!==track.minSegmentDts&&void 0!==track.timelineStartInfo.dts&&(timeSinceStartOfTimeline=track.minSegmentDts-track.timelineStartInfo.dts),baseMediaDecodeTime=track.timelineStartInfo.baseMediaDecodeTime,baseMediaDecodeTime+=timeSinceStartOfTimeline,baseMediaDecodeTime=Math.max(0,baseMediaDecodeTime),"audio"===track.type&&(scale=track.samplerate/ONE_SECOND_IN_TS,baseMediaDecodeTime*=scale,baseMediaDecodeTime=Math.floor(baseMediaDecodeTime)),baseMediaDecodeTime},_CoalesceStream=function(options,metadataStream){this.numberOfTracks=0,this.metadataStream=metadataStream,"undefined"!==typeof options.remux?this.remuxTracks=!!options.remux:this.remuxTracks=!0,this.baseMediaDecodeTime=options.baseMediaDecodeTime||0,"undefined"!==typeof options.duration&&(this.duration=options.duration),this.logTube=options.logTube,this.pendingTracks=[],this.videoTrack=null,this.pendingBoxes=[],this.pendingCaptions=[],this.pendingMetadata=[],this.pendingBytes=0,this.emittedTracks=0,_CoalesceStream.prototype.init.call(this),this.push=function(output){return output.text?this.pendingCaptions=output.userData.slice(0):output.frames?this.pendingMetadata.push(output):(this.pendingTracks.push(output.track),this.pendingBoxes.push(output.boxes),this.pendingBytes+=output.boxes.byteLength,"video"===output.track.type&&(this.videoTrack=output.track),"audio"===output.track.type&&(this.audioTrack=output.track),void 0)}},_CoalesceStream.prototype=new Stream,_CoalesceStream.prototype.flush=function(flushSource){var initSegment,segmentTime,i,offset=0,event={captions:[],metadata:[],info:{},audioInfo:{}},timelineStartPts=0,timelineStartDts=0;if(this.pendingTracks.length<this.numberOfTracks){if("VideoSegmentStream"!==flushSource&&"AudioSegmentStream"!==flushSource)return;if(this.remuxTracks)return;if(0===this.pendingTracks.length)return this.emittedTracks++,this.emittedTracks>=this.numberOfTracks&&(this.trigger("done"),this.emittedTracks=0),void 0}for(1===this.pendingTracks.length?(event.type=this.pendingTracks[0].type,event.duplicate=this.pendingTracks[0].duplicateFrag,event.timeStamp=this.pendingTracks[0].minSegmentDts,
this.videoTrack?(timelineStartPts=this.videoTrack.timelineStartInfo.pts,timelineStartDts=this.videoTrack.timelineStartInfo.dts,segmentTime=this.videoTrack.baseMediaDecodeTime,VIDEO_PROPERTIES.forEach(function(prop){event.info[prop]=this.videoTrack[prop]},this)):this.audioTrack&&(timelineStartPts=this.audioTrack.timelineStartInfo.pts,timelineStartDts=this.audioTrack.timelineStartInfo.dts,segmentTime=this.audioTrack.baseMediaDecodeTime,AUDIO_PROPERTIES.forEach(function(prop){event.info[prop]=this.audioTrack[prop]},this))):this.pendingTracks.length>1&&(event.type="combined",event.duplicate=this.pendingTracks[0].duplicateFrag,this.videoTrack&&(timelineStartPts=this.videoTrack.timelineStartInfo.pts,timelineStartDts=this.videoTrack.timelineStartInfo.dts,segmentTime=this.videoTrack.baseMediaDecodeTime,VIDEO_PROPERTIES.forEach(function(prop){event.info[prop]=this.videoTrack[prop]},this)),this.audioTrack&&(timelineStartPts=this.audioTrack.timelineStartInfo.pts,timelineStartDts=this.audioTrack.timelineStartInfo.dts,segmentTime=this.audioTrack.baseMediaDecodeTime,AUDIO_PROPERTIES.forEach(function(prop){event.audioInfo[prop]=this.audioTrack[prop]},this))),this.emittedTracks+=this.pendingTracks.length,i=0;i<this.pendingTracks.length;i++)this.pendingTracks[i].duration=this.duration*this.pendingTracks[i].timescale;for(initSegment=mp4.initSegment(this.pendingTracks),event.initSegment=new Uint8Array(initSegment.byteLength),event.initSegment.set(initSegment),event.data=new Uint8Array(this.pendingBytes),i=0;i<this.pendingBoxes.length;i++)event.data.set(this.pendingBoxes[i],offset),offset+=this.pendingBoxes[i].byteLength;if(this.pendingCaptions.length>0){var lastPts=this.pendingCaptions[0].pts;for(this.pendingCaptions[0].pts=this.pendingTracks[0].baseMediaDecodeTime/ONE_SECOND_IN_TS,i=1;i<this.pendingCaptions.length;i++){var nextPts=this.pendingCaptions[i].pts;this.pendingCaptions[i].pts=this.pendingCaptions[i-1].pts+(nextPts-lastPts)/ONE_SECOND_IN_TS,lastPts=nextPts}event.captions=this.pendingCaptions.slice(0)}if(this.pendingMetadata.length>0){for(i=0;i<this.pendingMetadata.length;i++)this.pendingMetadata[i].pts?this.pendingMetadata[i].pts=this.baseMediaDecodeTime+(this.pendingMetadata[i].pts-timelineStartPts):this.pendingMetadata[i].pts=this.baseMediaDecodeTime+segmentTime,this.pendingMetadata[i].dts?this.pendingMetadata[i].dts=this.baseMediaDecodeTime+(this.pendingMetadata[i].dts-timelineStartDts):this.pendingMetadata[i].dts=this.baseMediaDecodeTime+segmentTime,this.pendingMetadata[i].pts/=ONE_SECOND_IN_TS,this.pendingMetadata[i].dts/=ONE_SECOND_IN_TS;event.metadata=this.pendingMetadata.slice(0)}event.metadata.dispatchType=this.metadataStream.dispatchType,this.pendingTracks.length=0,this.videoTrack=null,this.pendingBoxes.length=0,this.pendingCaptions.length=0,this.pendingBytes=0,this.pendingMetadata.length=0,this.trigger("data",event),this.emittedTracks>=this.numberOfTracks&&(this.trigger("done"),this.emittedTracks=0)},_Transmuxer=function(options){var videoTrack,audioTrack,self=this,hasFlushed=!0;_Transmuxer.prototype.init.call(this),options=options||{},this.baseMediaDecodeTime=options.baseMediaDecodeTime||0,this.allowNegativeTFDT=options.allowNegativeTFDT||!1,this.logTube=options.logTube||null,this.transmuxPipeline_={},this.setupAacPipeline=function(){var pipeline={};this.transmuxPipeline_=pipeline,pipeline.type="aac",pipeline.metadataStream=new m2ts.MetadataStream,pipeline.aacStream=new AacStream,pipeline.audioTimestampRolloverStream=new m2ts.TimestampRolloverStream("audio"),pipeline.timedMetadataTimestampRolloverStream=new m2ts.TimestampRolloverStream("timed-metadata"),pipeline.adtsStream=new AdtsStream,pipeline.coalesceStream=new _CoalesceStream(options,pipeline.metadataStream),pipeline.headOfPipeline=pipeline.aacStream,pipeline.aacStream.pipe(pipeline.audioTimestampRolloverStream).pipe(pipeline.adtsStream),pipeline.aacStream.pipe(pipeline.timedMetadataTimestampRolloverStream).pipe(pipeline.metadataStream).pipe(pipeline.coalesceStream),pipeline.metadataStream.on("timestamp",function(frame){pipeline.aacStream.setTimestamp(frame.timeStamp)}),pipeline.aacStream.on("data",function(data){"timed-metadata"!==data.type||pipeline.audioSegmentStream||(audioTrack=audioTrack||{nextBMDT:self.baseMediaDecodeTime,maxCompositionTimeOffset:0,timelineStartInfo:{baseMediaDecodeTime:self.baseMediaDecodeTime},codec:"adts",type:"audio",id:2},pipeline.coalesceStream.numberOfTracks++,pipeline.audioSegmentStream=new _AudioSegmentStream(audioTrack),pipeline.adtsStream.pipe(pipeline.audioSegmentStream).pipe(pipeline.coalesceStream))}),pipeline.coalesceStream.on("data",this.trigger.bind(this,"data")),pipeline.coalesceStream.on("done",this.trigger.bind(this,"done"))},this.setupTsPipeline=function(){var pipeline={};this.transmuxPipeline_=pipeline,pipeline.type="ts",pipeline.metadataStream=new m2ts.MetadataStream,pipeline.packetStream=new m2ts.TransportPacketStream(self.logTube),pipeline.parseStream=new m2ts.TransportParseStream(self.logTube),pipeline.elementaryStream=new m2ts.ElementaryStream(self.logTube),pipeline.videoTimestampRolloverStream=new m2ts.TimestampRolloverStream("video"),pipeline.audioTimestampRolloverStream=new m2ts.TimestampRolloverStream("audio"),pipeline.timedMetadataTimestampRolloverStream=new m2ts.TimestampRolloverStream("timed-metadata"),pipeline.adtsStream=new AdtsStream,pipeline.h264Stream=new H264Stream,pipeline.captionStream=new m2ts.CaptionStream,pipeline.coalesceStream=new _CoalesceStream(options,pipeline.metadataStream),pipeline.headOfPipeline=pipeline.packetStream,pipeline.packetStream.pipe(pipeline.parseStream).pipe(pipeline.elementaryStream),pipeline.elementaryStream.pipe(pipeline.videoTimestampRolloverStream).pipe(pipeline.h264Stream),pipeline.elementaryStream.pipe(pipeline.audioTimestampRolloverStream).pipe(pipeline.adtsStream),pipeline.elementaryStream.pipe(pipeline.timedMetadataTimestampRolloverStream).pipe(pipeline.metadataStream).pipe(pipeline.coalesceStream),pipeline.h264Stream.pipe(pipeline.captionStream).pipe(pipeline.coalesceStream),pipeline.elementaryStream.on("data",function(data){var i;if("metadata"===data.type){i=data.tracks.length,pipeline.coalesceStream.baseMediaDecodeTime=self.baseMediaDecodeTime;while(i--)videoTrack||"video"!==data.tracks[i].type?audioTrack||"audio"!==data.tracks[i].type||(audioTrack=data.tracks[i],audioTrack.timelineStartInfo.baseMediaDecodeTime=self.baseMediaDecodeTime,audioTrack.nextBMDT=self.baseMediaDecodeTime,audioTrack.maxCompositionTimeOffset=0,audioTrack.fusionDuration=0,audioTrack.id=2):(videoTrack=data.tracks[i],videoTrack.timelineStartInfo.baseMediaDecodeTime=self.baseMediaDecodeTime,videoTrack.allowNegativeTFDT=self.allowNegativeTFDT,videoTrack.nextBMDT=self.baseMediaDecodeTime,videoTrack.maxCompositionTimeOffset=0,videoTrack.fusionDuration=0,videoTrack.id=1);videoTrack&&!pipeline.videoSegmentStream&&(pipeline.coalesceStream.numberOfTracks++,pipeline.videoSegmentStream=new _VideoSegmentStream(videoTrack),pipeline.videoSegmentStream.on("timelineStartInfo",function(timelineStartInfo){if(audioTrack){var audioFrameDuration=1024/audioTrack.samplerate*ONE_SECOND_IN_TS,avGap=timelineStartInfo.dts-audioTrack.timelineStartInfo.dts;avGap<0?(videoTrack.truncateDuration=-avGap%audioFrameDuration,audioTrack.frameInsertCount=(-avGap-videoTrack.truncateDuration)/audioFrameDuration):avGap>0&&(videoTrack.truncateDuration=-avGap%audioFrameDuration,audioTrack.frameDropCount=(avGap- -videoTrack.truncateDuration)/audioFrameDuration),0!==avGap&&(timelineStartInfo.pts+=videoTrack.truncateDuration,timelineStartInfo.dts+=videoTrack.truncateDuration,videoTrack.minSegmentPts+=videoTrack.truncateDuration,videoTrack.minSegmentDts+=videoTrack.truncateDuration,audioTrack.minSegmentPts=videoTrack.minSegmentPts,audioTrack.minSegmentDts=videoTrack.minSegmentDts),audioTrack.timelineStartInfo=timelineStartInfo,pipeline.audioSegmentStream.setEarliestDts(timelineStartInfo.dts)}}),pipeline.videoSegmentStream.on("baseMediaDecodeTime",function(baseMediaDecodeTime){audioTrack&&pipeline.audioSegmentStream.setVideoBaseMediaDecodeTime(baseMediaDecodeTime)}),pipeline.h264Stream.pipe(pipeline.videoSegmentStream).pipe(pipeline.coalesceStream)),audioTrack&&!pipeline.audioSegmentStream&&(pipeline.coalesceStream.numberOfTracks++,pipeline.audioSegmentStream=new _AudioSegmentStream(audioTrack),pipeline.adtsStream.pipe(pipeline.audioSegmentStream).pipe(pipeline.coalesceStream))}}),pipeline.coalesceStream.on("data",this.trigger.bind(this,"data")),pipeline.coalesceStream.on("done",this.trigger.bind(this,"done"))},this.setBaseMediaDecodeTime=function(baseMediaDecodeTime){var pipeline=this.transmuxPipeline_;this.baseMediaDecodeTime=baseMediaDecodeTime,audioTrack&&(audioTrack.timelineStartInfo.dts=void 0,audioTrack.timelineStartInfo.pts=void 0,clearDtsInfo(audioTrack),audioTrack.timelineStartInfo.baseMediaDecodeTime=baseMediaDecodeTime,audioTrack.lastMinSegmentDts=void 0,audioTrack.nextBMDT=baseMediaDecodeTime,audioTrack.fusionDuration=0),videoTrack&&(pipeline.videoSegmentStream&&pipeline.videoSegmentStream.resetGOPS(),videoTrack.timelineStartInfo.dts=void 0,videoTrack.timelineStartInfo.pts=void 0,clearDtsInfo(videoTrack),videoTrack.timelineStartInfo.baseMediaDecodeTime=baseMediaDecodeTime,videoTrack.maxCompositionTimeOffset=0,videoTrack.lastMinSegmentDts=void 0,videoTrack.nextBMDT=baseMediaDecodeTime,videoTrack.fusionDuration=0)},this.setGapDuration=function(gapDuration){audioTrack&&this.transmuxPipeline_.audioSegmentStream.setGapDuration(gapDuration),videoTrack&&this.transmuxPipeline_.videoSegmentStream.setGapDuration(gapDuration)},this.setAudioAppendStart=function(timestamp){audioTrack&&this.transmuxPipeline_.audioSegmentStream.setAudioAppendStart(timestamp)},this.push=function(data){if(hasFlushed){var isAac=isLikelyAacData(data);isAac&&"aac"!==this.transmuxPipeline_.type?this.setupAacPipeline():isAac||"ts"===this.transmuxPipeline_.type||this.setupTsPipeline(),hasFlushed=!1}this.transmuxPipeline_.headOfPipeline.push(data)},this.flush=function(){hasFlushed=!0,this.transmuxPipeline_.headOfPipeline.flush()}},_Transmuxer.prototype=new Stream,module.exports={Transmuxer:_Transmuxer,VideoSegmentStream:_VideoSegmentStream,AudioSegmentStream:_AudioSegmentStream,AUDIO_PROPERTIES:AUDIO_PROPERTIES,VIDEO_PROPERTIES:VIDEO_PROPERTIES}},function(module,exports,__webpack_require__){(function(process){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.detectBrowser=exports.detectedBrowser=void 0;var _logger=__webpack_require__(1);function detectBrowserM(userAgentString){var browsers=[["edge",/Edge\/([0-9._]+)/],["yandexbrowser",/YaBrowser\/([0-9._]+)/],["tizen",/Tizen\s([0-9._]+)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9.]+)(:?\s|$)/],["crios",/CriOS\/([0-9.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9.]+)(?:\s|$)/],["opera",/Opera\/([0-9.]+)(?:\s|$)/],["opera",/OPR\/([0-9.]+)(:?\s|$)$/],["ie",/Trident\/7\.0.*rv:([0-9.]+)\).*Gecko$/],["ie",/MSIE\s([0-9.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9.]+)/],["android",/Android\s([0-9.]+)/],["phantom",/PhantomJS\/([0-9._]+)/],["ios",/Version\/([0-9._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9._]+).*Safari/],["electron",/Electron\s([0-9._]+)/]];return browsers.map(function(rule){if(rule[1].test(userAgentString)){var match=rule[1].exec(userAgentString),version=match&&match[1].split(/[._]/).slice(0,3);return version&&version.length<3&&Array.prototype.push.apply(version,1===version.length?[0,0]:[0]),{name:rule[0],version:version.join(".")}}}).filter(Boolean).shift()}function detectPlatformM(userAgentString){var platforms=[["windows",/Windows\sNT\s([0-9.]+)/]];return platforms.map(function(rule){if(rule[1].test(userAgentString)){var match=rule[1].exec(userAgentString),version=match&&match[1].split(/[._]/).slice(0,3);return version&&version.length<3&&Array.prototype.push.apply(version,1===version.length?[0,0]:[0]),{name:rule[0],version:version.join(".")}}}).filter(Boolean).shift()}function isNode(){try{return"node"===process.release.name}catch(e){return!1}}function detectPlatform(userAgentString){var platform="unknown";return userAgentString.indexOf("Macintosh")!==-1?platform="macintosh":userAgentString.indexOf("Windows NT")!==-1?platform="windows":userAgentString.indexOf("Android")!==-1?platform="android":userAgentString.indexOf("Tizen")!==-1?platform="tizen":userAgentString.indexOf("Linux")!==-1?platform="linux":userAgentString.indexOf("iPhone")!==-1?platform="ios":userAgentString.indexOf("iPad")!==-1&&(platform="ios"),platform}function detectPlatformVersion(platform,userAgentString){var platformVersion="unknown";if("windows"===platform){var spot=userAgentString.indexOf("Windows NT");if(spot!==-1){var platformV2=detectPlatformM(userAgentString);platformVersion=void 0!==platformV2?platformV2.version:"winxx"}else platformVersion="winxx"}return platformVersion}function detectNodePlatform(platformString){var platform="unknown";return platformString.indexOf("darwin")!==-1?platform="macintosh":platformString.indexOf("win32")!==-1?platform="windows":(_logger.logger.log("DetectBrowser: Unknown Node platform: {"+platformString+"}"),platform=platformString),platform}function detectBrowser(userAgentString){var usrAgent=userAgentString,detection={};return usrAgent||"undefined"===typeof navigator||(usrAgent=navigator.userAgent),usrAgent?(detection=detectBrowserM(usrAgent),void 0!==detection?(detection.platform=detectPlatform(usrAgent),detection.platformVersion=detectPlatformVersion(detection.platform,usrAgent)):_logger.logger.log("DetectBrowser: Unknown userAgent: {"+usrAgent+"}")):isNode()&&(detection.name="node",detection.version=process.version.slice(1),detection.platform=detectNodePlatform(process.platform),detection.platformVersion="unknown"),void 0!==detection&&void 0!==detection.version||(detection={},detection.name="unknown",detection.version="1.0",detection.platform="unknown",detection.platformVersion="unknown"),detection}var detectedBrowser=detectBrowser();exports.default=detectedBrowser,exports.detectedBrowser=detectedBrowser,exports.detectBrowser=detectBrowser}).call(exports,__webpack_require__(61))},function(module,exports,__webpack_require__){var toIObject=__webpack_require__(33),toLength=__webpack_require__(9),toAbsoluteIndex=__webpack_require__(39);module.exports=function(IS_INCLUDES){return function($this,el,fromIndex){var value,O=toIObject($this),length=toLength(O.length),index=toAbsoluteIndex(fromIndex,length);if(IS_INCLUDES&&el!=el){while(length>index)if(value=O[index++],value!=value)return!0}else for(;length>index;index++)if((IS_INCLUDES||index in O)&&O[index]===el)return IS_INCLUDES||index||0;return!IS_INCLUDES&&-1}}},function(module,exports,__webpack_require__){var speciesConstructor=__webpack_require__(172);module.exports=function(original,length){return new(speciesConstructor(original))(length)}},function(module,exports,__webpack_require__){var cof=__webpack_require__(22),TAG=__webpack_require__(7)("toStringTag"),ARG="Arguments"==cof(function(){return arguments}()),tryGet=function(it,key){try{return it[key]}catch(e){}};module.exports=function(it){var O,T,B;return void 0===it?"Undefined":null===it?"Null":"string"==typeof(T=tryGet(O=Object(it),TAG))?T:ARG?cof(O):"Object"==(B=cof(O))&&"function"==typeof O.callee?"Arguments":B}},function(module){module.exports=function(it){if(void 0==it)throw TypeError("Can't call method on  "+it);return it}},function(module,exports,__webpack_require__){var isObject=__webpack_require__(20),document=__webpack_require__(8).document,is=isObject(document)&&isObject(document.createElement);module.exports=function(it){return is?document.createElement(it):{}}},function(module,exports,__webpack_require__){var document=__webpack_require__(8).document;module.exports=document&&document.documentElement},function(module,exports,__webpack_require__){var cof=__webpack_require__(22);module.exports=Array.isArray||function(arg){return"Array"==cof(arg)}},function(module,exports,__webpack_require__){"use strict";var aFunction=__webpack_require__(15);function PromiseCapability(C){var resolve,reject;this.promise=new C(function($$resolve,$$reject){if(void 0!==resolve||void 0!==reject)throw TypeError("Bad Promise constructor");resolve=$$resolve,reject=$$reject}),this.resolve=aFunction(resolve),this.reject=aFunction(reject)}module.exports.f=function(C){return new PromiseCapability(C)}},function(module){module.exports=function(bitmap,value){return{enumerable:!(1&bitmap),configurable:!(2&bitmap),writable:!(4&bitmap),value:value}}},function(module,exports,__webpack_require__){var def=__webpack_require__(30).f,has=__webpack_require__(28),TAG=__webpack_require__(7)("toStringTag");module.exports=function(it,tag,stat){it&&!has(it=stat?it:it.prototype,TAG)&&def(it,TAG,{configurable:!0,value:tag})}},function(module,exports,__webpack_require__){var shared=__webpack_require__(92)("keys"),uid=__webpack_require__(59);module.exports=function(key){return shared[key]||(shared[key]=uid(key))}},function(module){var id=0,px=Math.random();module.exports=function(key){return"Symbol(".concat(void 0===key?"":key,")_",(++id+px).toString(36))}},function(module){function EventEmitter(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}module.exports=EventEmitter,EventEmitter.EventEmitter=EventEmitter,EventEmitter.prototype._events=void 0,EventEmitter.prototype._maxListeners=void 0,EventEmitter.defaultMaxListeners=10,EventEmitter.prototype.setMaxListeners=function(n){if(!isNumber(n)||n<0||isNaN(n))throw TypeError("n must be a positive number");return this._maxListeners=n,this},EventEmitter.prototype.emit=function(type){var er,handler,len,args,i,listeners;if(this._events||(this._events={}),"error"===type&&(!this._events.error||isObject(this._events.error)&&!this._events.error.length)){if(er=arguments[1],er instanceof Error)throw er;var err=new Error('Uncaught, unspecified "error" event. ('+er+")");throw err.context=er,err}if(handler=this._events[type],isUndefined(handler))return!1;if(isFunction(handler))switch(arguments.length){case 1:handler.call(this);break;case 2:handler.call(this,arguments[1]);break;case 3:handler.call(this,arguments[1],arguments[2]);break;default:args=Array.prototype.slice.call(arguments,1),handler.apply(this,args)}else if(isObject(handler))for(args=Array.prototype.slice.call(arguments,1),listeners=handler.slice(),len=listeners.length,i=0;i<len;i++)listeners[i].apply(this,args);return!0},EventEmitter.prototype.addListener=function(type,listener){var m;if(!isFunction(listener))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",type,isFunction(listener.listener)?listener.listener:listener),this._events[type]?isObject(this._events[type])?this._events[type].push(listener):this._events[type]=[this._events[type],listener]:this._events[type]=listener,isObject(this._events[type])&&!this._events[type].warned&&(m=isUndefined(this._maxListeners)?EventEmitter.defaultMaxListeners:this._maxListeners,m&&m>0&&this._events[type].length>m&&(this._events[type].warned=!0,void 0,"function"===typeof console.trace&&void 0)),this},EventEmitter.prototype.on=EventEmitter.prototype.addListener,EventEmitter.prototype.once=function(type,listener){if(!isFunction(listener))throw TypeError("listener must be a function");var fired=!1;function g(){this.removeListener(type,g),fired||(fired=!0,listener.apply(this,arguments))}return g.listener=listener,this.on(type,g),this},EventEmitter.prototype.removeListener=function(type,listener){var list,position,length,i;if(!isFunction(listener))throw TypeError("listener must be a function");if(!this._events||!this._events[type])return this;if(list=this._events[type],length=list.length,position=-1,list===listener||isFunction(list.listener)&&list.listener===listener)delete this._events[type],this._events.removeListener&&this.emit("removeListener",type,listener);else if(isObject(list)){for(i=length;i-- >0;)if(list[i]===listener||list[i].listener&&list[i].listener===listener){position=i;break}if(position<0)return this;1===list.length?(list.length=0,delete this._events[type]):list.splice(position,1),this._events.removeListener&&this.emit("removeListener",type,listener)}return this},EventEmitter.prototype.removeAllListeners=function(type){var key,listeners;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[type]&&delete this._events[type],this;if(0===arguments.length){for(key in this._events)"removeListener"!==key&&this.removeAllListeners(key);return this.removeAllListeners("removeListener"),this._events={},this}if(listeners=this._events[type],isFunction(listeners))this.removeListener(type,listeners);else if(listeners)while(listeners.length)this.removeListener(type,listeners[listeners.length-1]);return delete this._events[type],this},EventEmitter.prototype.listeners=function(type){var ret;return ret=this._events&&this._events[type]?isFunction(this._events[type])?[this._events[type]]:this._events[type].slice():[],ret},EventEmitter.prototype.listenerCount=function(type){if(this._events){var evlistener=this._events[type];if(isFunction(evlistener))return 1;if(evlistener)return evlistener.length}return 0},EventEmitter.listenerCount=function(emitter,type){return emitter.listenerCount(type)};function isFunction(arg){return"function"===typeof arg}function isNumber(arg){return"number"===typeof arg}function isObject(arg){return"object"===typeof arg&&null!==arg}function isUndefined(arg){return arg===void 0}},function(module){var cachedSetTimeout,cachedClearTimeout,process=module.exports={};function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}(function(){try{cachedSetTimeout="function"===typeof setTimeout?setTimeout:defaultSetTimout}catch(e){cachedSetTimeout=defaultSetTimout}try{cachedClearTimeout="function"===typeof clearTimeout?clearTimeout:defaultClearTimeout}catch(e){cachedClearTimeout=defaultClearTimeout}})();function runTimeout(fun){if(cachedSetTimeout===setTimeout)return setTimeout(fun,0);if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout)return cachedSetTimeout=setTimeout,setTimeout(fun,0);try{return cachedSetTimeout(fun,0)}catch(e){try{return cachedSetTimeout.call(null,fun,0)}catch(e){return cachedSetTimeout.call(this,fun,0)}}}function runClearTimeout(marker){if(cachedClearTimeout===clearTimeout)return clearTimeout(marker);if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout)return cachedClearTimeout=clearTimeout,clearTimeout(marker);try{return cachedClearTimeout(marker)}catch(e){try{return cachedClearTimeout.call(null,marker)}catch(e){return cachedClearTimeout.call(this,marker)}}}var currentQueue,queue=[],draining=!1,queueIndex=-1;function cleanUpNextTick(){draining&&currentQueue&&(draining=!1,currentQueue.length?queue=currentQueue.concat(queue):queueIndex=-1,queue.length&&drainQueue())}function drainQueue(){if(!draining){var timeout=runTimeout(cleanUpNextTick);draining=!0;var len=queue.length;while(len){currentQueue=queue,queue=[];while(++queueIndex<len)currentQueue&&currentQueue[queueIndex].run();queueIndex=-1,len=queue.length}currentQueue=null,draining=!1,runClearTimeout(timeout)}}process.nextTick=function(fun){var args=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)args[i-1]=arguments[i];queue.push(new Item(fun,args)),1!==queue.length||draining||runTimeout(drainQueue)};function Item(fun,array){this.fun=fun,this.array=array}Item.prototype.run=function(){this.fun.apply(null,this.array)},process.title="browser",process.browser=!0,process.env={},process.argv=[],process.version="",process.versions={};function noop(){}process.on=noop,process.addListener=noop,process.once=noop,process.off=noop,process.removeListener=noop,process.removeAllListeners=noop,process.emit=noop,process.prependListener=noop,process.prependOnceListener=noop,process.listeners=function(){return[]},process.binding=function(){throw new Error("process.binding is not supported")},process.cwd=function(){return"/"},process.chdir=function(){throw new Error("process.chdir is not supported")},process.umask=function(){return 0}},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var CencModes={CBC:"CBC",CTR:"CTR"};exports.default=CencModes,module.exports=exports["default"]},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var HlsErrorStrings={WARNING:"BamHLS issued a non-fatal warning",LOAD_FAILED:"BamHLS was not able to load the stream",FETCH_FAILED:"BamHLS was not able to fetch the variants",PLAYBACK_FAILED:"BamHLS was not able to playback the media",MEDIA_CONTROLLER_FAILED:"BamHLS was not able to wire or attach the media",MEDIA_ELEMENT_FAILED:"BamHLS experienced an error in the media element",STREAM_TIMEOUT:"BamHLS experienced unexpected stream ending",UNEXPECTED_ERROR:"BamHLS experienced an unexpected error",INTERNAL_EXCEPTION:"BamHLS experienced an internal exception"};exports.default=HlsErrorStrings,module.exports=exports["default"]},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var HlsErrors={WARNING:"WARNING",LOAD_FAILED:"LOAD_FAILED",FETCH_FAILED:"FETCH_FAILED",PLAYBACK_FAILED:"PLAYBACK_FAILED",MEDIA_CONTROLLER_FAILED:"MEDIA_CONTROLLER_FAILED",MEDIA_ELEMENT_FAILED:"MEDIA_ELEMENT_FAILED",STREAM_TIMEOUT:"STREAM_TIMEOUT",UNEXPECTED_ERROR:"UNEXPECTED_ERROR",INTERNAL_EXCEPTION:"INTERNAL_EXCEPTION"};exports.default=HlsErrors,module.exports=exports["default"]},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var HlsStates={UNLOADED:"UNLOADED",LOADING:"LOADING",LOADED:"LOADED",FETCHING:"FETCHING",PLAYBACK:"PLAYBACK"};exports.default=HlsStates,module.exports=exports["default"]},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var MediaStates={WIRING:"WIRING",WIRED:"WIRED",ATTACHING:"ATTACHING",ATTACHED:"ATTACHED",DETACHING:"DETACHING",DETACHED:"DETACHED"};exports.default=MediaStates,module.exports=exports["default"]},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var PlaybackStates={NOTREADY:"NOTREADY",PAUSED:"PAUSED",BUFFERING:"BUFFERING",PLAYING:"PLAYING",SEEKING:"SEEKING",ENDED:"ENDED"};exports.default=PlaybackStates,module.exports=exports["default"]},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_events=__webpack_require__(3),_events2=_interopRequireDefault(_events),_CryptoAesCbc=__webpack_require__(107),_CryptoAesCbc2=_interopRequireDefault(_CryptoAesCbc),_errors=__webpack_require__(4),_logger=__webpack_require__(1),_ArrayHelper=__webpack_require__(21),_ArrayHelper2=_interopRequireDefault(_ArrayHelper);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}__webpack_require__(78);var MactrixDecrypter=function(){function MactrixDecrypter(observer,config){_classCallCheck(this,MactrixDecrypter),this.observer=observer,this.config=config,this.logEnabled=!0,this.crypto=new _CryptoAesCbc2.default}return _createClass(MactrixDecrypter,[{key:"isSync",value:function(){return!1}},{key:"decrypt",value:function(data,key,iv,callback){var _this=this,keyArray=_ArrayHelper2.default.makeUint8Array(key),ivArray=_ArrayHelper2.default.makeUint8Array(iv);try{this.key!==key&&(this.key=key,this.cryptoKey=this.crypto.createKey(keyArray)),this.cryptoKey.then(function(aesKey){return _this.crypto.decrypt(aesKey,ivArray,data)}).then(function(result){callback(result)}).catch(function(err){_this.onCryptoError(err)})}catch(err){this.onCryptoError(err)}}},{key:"onCryptoError",value:function(err){_logger.logger.error("decrypting error : "+err.message),this.observer&&this.observer.trigger(_events2.default.ERROR,{type:_errors.ErrorTypes.MEDIA_ERROR,details:_errors.ErrorDetails.FRAG_DECRYPT_ERROR,fatal:!0,reason:err.message})}},{key:"destroy",value:function(){this.observer=null,this.config=null,this.crypto=null,this.cryptoKey=null,this.key=null}}]),MactrixDecrypter}();exports.default=MactrixDecrypter,module.exports=exports["default"]},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_events=__webpack_require__(3),_events2=_interopRequireDefault(_events),_muxjsInline=__webpack_require__(73),_muxjsInline2=_interopRequireDefault(_muxjsInline),_muxjsWorker=__webpack_require__(74),_muxjsWorker2=_interopRequireDefault(_muxjsWorker),_webworkify=__webpack_require__(219),_webworkify2=_interopRequireDefault(_webworkify),_webworkifyWebpack=__webpack_require__(218),_webworkifyWebpack2=_interopRequireDefault(_webworkifyWebpack),_MactrixDecrypter=__webpack_require__(68),_MactrixDecrypter2=_interopRequireDefault(_MactrixDecrypter),_logger=__webpack_require__(1),_errors=__webpack_require__(4),_events3=__webpack_require__(60),_events4=_interopRequireDefault(_events3);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var Demuxer=function(){function Demuxer(hls,id){_classCallCheck(this,Demuxer),this.hls=hls,this.id=id,this.enableMuxJs=!!hls.config.enableMuxJs,this.decryptOutsideWebworker=!!hls.config.decryptOutsideWebworker,this.decrypter=null;var observer=this.observer=new _events4.default,config=this.config=hls.config;observer.trigger=function(event){for(var _len=arguments.length,data=Array(_len>1?_len-1:0),_key=1;_key<_len;_key++)data[_key-1]=arguments[_key];observer.emit.apply(observer,[event,event].concat(data))},observer.off=function(event){for(var _len2=arguments.length,data=Array(_len2>1?_len2-1:0),_key2=1;_key2<_len2;_key2++)data[_key2-1]=arguments[_key2];observer.removeListener.apply(observer,[event].concat(data))};var forwardMessage=function(ev,data){data=data||{},data.frag=this.frag,data.id=this.id,hls.trigger(ev,data)}.bind(this);observer.on(_events2.default.FRAG_DECRYPTED,forwardMessage),observer.on(_events2.default.FRAG_PARSING_INIT_SEGMENT,forwardMessage),observer.on(_events2.default.FRAG_PARSING_DATA,forwardMessage),observer.on(_events2.default.FRAG_PARSED,forwardMessage),observer.on(_events2.default.ERROR,forwardMessage),observer.on(_events2.default.FRAG_PARSING_METADATA,forwardMessage),observer.on(_events2.default.FRAG_PARSING_USERDATA,forwardMessage),observer.on(_events2.default.INIT_PTS_FOUND,forwardMessage);var typeSupported={mp4:MediaSource.isTypeSupported("video/mp4"),mpeg:MediaSource.isTypeSupported("audio/mpeg"),mp3:MediaSource.isTypeSupported('audio/mp4; codecs="mp3"'),browChrome:hls.browChrome,
browSafari:hls.browSafari,browFirefox:hls.browFirefox,browAndroid:hls.browAndroid,browEdge:hls.browEdge,browIE:hls.browIE},vendor=navigator.vendor;if(config.enableWorker&&"undefined"!==typeof Worker){_logger.logger.log("demuxing in webworker");var w=void 0;try{w=1?this.w=(0,_webworkifyWebpack2.default)(74):this.w=(0,_webworkify2.default)(_muxjsWorker2.default),this.onwmsg=this.onWorkerMessage.bind(this),w.addEventListener("message",this.onwmsg),w.onerror=function(event){hls.trigger(_events2.default.ERROR,{type:_errors.ErrorTypes.OTHER_ERROR,details:_errors.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",err:{message:event.message+" ("+event.filename+":"+event.lineno+")"}})},w.postMessage({cmd:"init",typeSupported:typeSupported,vendor:vendor,id:id,config:JSON.stringify(config)})}catch(err){_logger.logger.error("error while initializing DemuxerWorker, fallback on DemuxerInline"),hls.trigger(_events2.default.ERROR,{type:_errors.ErrorTypes.MUX_ERROR,details:_errors.ErrorDetails.DEMUX_WORKER_ALLOC_ERROR,fatal:!1}),w&&URL.revokeObjectURL(w.objectURL),this.demuxer=new _muxjsInline2.default(observer,typeSupported,config,vendor),this.w=void 0}}else this.demuxer=new _muxjsInline2.default(observer,typeSupported,config,vendor)}return _createClass(Demuxer,[{key:"destroy",value:function(){var w=this.w;if(w)w.removeEventListener("message",this.onwmsg),w.terminate(),this.w=null;else{var demuxer=this.demuxer;demuxer&&(demuxer.destroy(),this.demuxer=null)}var observer=this.observer;observer&&(observer.removeAllListeners(),this.observer=null)}},{key:"push",value:function(data,initSegment,audioCodec,videoCodec,frag,duration,accurateTimeOffset,defaultInitPTS,deliberateGap){var w=this.w,timeOffset=isNaN(frag.startDTS)?frag.start:frag.startDTS,decryptdata=frag.decryptdata,lastFrag=this.frag,discontinuity=!(lastFrag&&frag.cc===lastFrag.cc),trackSwitch=!(lastFrag&&frag.level===lastFrag.level),nextSN=void 0,contiguous=void 0,hasBeenProcessed=!1;if(this.enableMuxJs===!0){if(lastFrag&&lastFrag.pdt&&frag.pdt){var expectedTime=lastFrag.pdt+1e3*lastFrag.manifestDuration,variance=500*lastFrag.manifestDuration;contiguous=!(frag.pdt>lastFrag.pdt-variance&&frag.pdt<lastFrag.pdt+variance)&&(!(frag.pdt>expectedTime-variance&&frag.pdt<expectedTime+variance)&&!deliberateGap)}else nextSN=lastFrag&&frag.sn===lastFrag.sn+1,contiguous=!(nextSN===!0||deliberateGap);accurateTimeOffset=frag.gap}if(this.decryptOutsideWebworker===!0&&w&&null!=decryptdata&&data.byteLength>0&&null!=decryptdata.key&&"AES-128"===decryptdata.method){var decrypter=this.decrypter;null===decrypter&&(decrypter=this.decrypter=new _MactrixDecrypter2.default(this.observer,this.config));var localthis=this,startTime=void 0;hasBeenProcessed=!0;try{startTime=performance.now()}catch(error){startTime=Date.now()}decrypter.decrypt(data,decryptdata.key.buffer,decryptdata.iv.buffer,function(decryptedData){var endTime=void 0;try{endTime=performance.now()}catch(error){endTime=Date.now()}localthis.observer.trigger(_events2.default.FRAG_DECRYPTED,{stats:{tstart:startTime,tdecrypt:endTime}}),w.postMessage({cmd:"demux",data:decryptedData,decryptdata:null,initSegment:initSegment,audioCodec:audioCodec,videoCodec:videoCodec,timeOffset:timeOffset,discontinuity:discontinuity,trackSwitch:trackSwitch,contiguous:contiguous,duration:duration,accurateTimeOffset:accurateTimeOffset,defaultInitPTS:defaultInitPTS},[data])})}if(discontinuity&&_logger.logger.log(this.id+":discontinuity detected"),trackSwitch&&_logger.logger.log(this.id+":switch detected"),this.frag=frag,!hasBeenProcessed)if(w)w.postMessage({cmd:"demux",data:data,decryptdata:decryptdata,initSegment:initSegment,audioCodec:audioCodec,videoCodec:videoCodec,timeOffset:timeOffset,discontinuity:discontinuity,trackSwitch:trackSwitch,contiguous:contiguous,duration:duration,accurateTimeOffset:accurateTimeOffset,defaultInitPTS:defaultInitPTS},[data]);else{var demuxer=this.demuxer;demuxer&&demuxer.push(data,decryptdata,initSegment,audioCodec,videoCodec,timeOffset,discontinuity,trackSwitch,contiguous,duration,accurateTimeOffset,defaultInitPTS)}}},{key:"onWorkerMessage",value:function(ev){var data=ev.data,hls=this.hls;switch(data.event){case"init":URL.revokeObjectURL(this.w.objectURL);break;case _events2.default.FRAG_PARSING_DATA:data.data.data1=new Uint8Array(data.data1),data.data2&&(data.data.data2=new Uint8Array(data.data2));default:data.data=data.data||{},data.data.frag=this.frag,data.data.id=this.id,hls.trigger(data.event,data.data)}}}]),Demuxer}();exports.default=Demuxer,module.exports=exports["default"]},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_events=__webpack_require__(3),_events2=_interopRequireDefault(_events),_eventHandler=__webpack_require__(5),_eventHandler2=_interopRequireDefault(_eventHandler),_errors=__webpack_require__(4),_dataTypes=__webpack_require__(37),_dataTypes2=_interopRequireDefault(_dataTypes);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!==typeof call&&"function"!==typeof call?self:call}function _inherits(subClass,superClass){if("function"!==typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var KeyLoader=function(_EventHandler){_inherits(KeyLoader,_EventHandler);function KeyLoader(hls){_classCallCheck(this,KeyLoader);var _this=_possibleConstructorReturn(this,(KeyLoader.__proto__||Object.getPrototypeOf(KeyLoader)).call(this,hls,_events2.default.KEY_LOADING,_events2.default.ERROR));return _this.loaders={},_this.decryptkey=null,_this.decrypturl=null,_this}return _createClass(KeyLoader,[{key:"destroy",value:function(){for(var loaderName in this.loaders){var loader=this.loaders[loaderName];loader&&loader.destroy()}this.loaders={},_eventHandler2.default.prototype.destroy.call(this)}},{key:"onError",value:function(data){if(data.fatal)for(var loaderName in this.loaders)this.loaders[loaderName]&&this.loaders[loaderName].abort()}},{key:"onKeyLoading",value:function(data){var frag=data.frag,type=frag.type,loader=this.loaders[type],decryptdata=frag.decryptdata,uri=decryptdata.uri;if(uri!==this.decrypturl||null===this.decryptkey){var config=this.hls.config;loader?(loader.abort(),frag.loader=loader):frag.loader=this.loaders[type]=new config.loader(config),this.decrypturl=uri,this.decryptkey=null;var loaderContext=void 0,loaderConfig=void 0,loaderCallbacks=void 0;loaderContext={url:uri,frag:frag,responseType:"arraybuffer",dataType:_dataTypes2.default.KEY},loaderConfig={timeout:config.fragLoadingTimeOut,maxRetry:config.fragLoadingMaxRetry,retryDelay:config.fragLoadingRetryDelay,maxRetryDelay:config.fragLoadingMaxRetryTimeout},loaderCallbacks={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)},frag.loader.load(loaderContext,loaderConfig,loaderCallbacks)}else this.decryptkey&&(decryptdata.key=this.decryptkey,this.hls.trigger(_events2.default.KEY_LOADED,{frag:frag}))}},{key:"loadsuccess",value:function(response,stats,context){var frag=context.frag;this.decryptkey=frag.decryptdata.key=new Uint8Array(response.data),frag.loader=void 0,this.hls.trigger(_events2.default.KEY_LOADED,{frag:frag})}},{key:"loaderror",value:function(response,context){var frag=context.frag,loader=frag.loader;loader&&loader.abort(),this.hls.trigger(_events2.default.ERROR,{type:_errors.ErrorTypes.NETWORK_ERROR,details:_errors.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:frag,response:response})}},{key:"loadtimeout",value:function(stats,context){var frag=context.frag,loader=frag.loader;loader&&loader.abort(),this.hls.trigger(_events2.default.ERROR,{type:_errors.ErrorTypes.NETWORK_ERROR,details:_errors.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:frag})}}]),KeyLoader}(_eventHandler2.default);exports.default=KeyLoader,module.exports=exports["default"]},function(module){"use strict";var TimeRanges={toString:function(r){for(var log="",len=r.length,i=0;i<len;i++)log+="["+r.start(i).toFixed(3)+","+r.end(i).toFixed(3)+"]";return log}};module.exports=TimeRanges},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.fixLineBreaks=void 0;var _logger=__webpack_require__(1),_vttcue=__webpack_require__(139),_vttcue2=_interopRequireDefault(_vttcue);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var StringDecoder=function(){return{decode:function(data){if(!data)return"";if("string"!==typeof data)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(data))}}};function VTTParser(){this.window=window,this.state="INITIAL",this.buffer="",this.decoder=new StringDecoder,this.regionList=[]}function parseTimeStamp(input){function computeSeconds(h,m,s,f){return 3600*(0|h)+60*(0|m)+(0|s)+(0|f)/1e3}var m=input.match(/^(\d+):(\d{2})(:\d{2})?\.(\d{3})/);return m?m[3]?computeSeconds(m[1],m[2],m[3].replace(":",""),m[4]):m[1]>59?computeSeconds(m[1],m[2],0,m[4]):computeSeconds(0,m[1],m[2],m[4]):null}function Settings(){this.values=Object.create(null)}Settings.prototype={set:function(k,v){this.get(k)||""===v||(this.values[k]=v)},get:function(k,dflt,defaultKey){return defaultKey?this.has(k)?this.values[k]:dflt[defaultKey]:this.has(k)?this.values[k]:dflt},has:function(k){return k in this.values},alt:function(k,v,a){for(var n=0;n<a.length;++n)if(v===a[n]){this.set(k,v);break}},integer:function(k,v){/^-?\d+$/.test(v)&&this.set(k,parseInt(v,10))},percent:function(k,v){var m=v.match(/^([\d]{1,3})(\.[\d]*)?%$/);if(m){var myV=parseFloat(v);if(myV>=0&&myV<=100)return this.set(k,myV),!0}return!1}};function parseOptions(input,callback,keyValueDelim,groupDelim){var groups=groupDelim?input.split(groupDelim):[input];for(var i in groups)if("string"===typeof groups[i]){var kv=groups[i].split(keyValueDelim);if(2===kv.length){var k=kv[0],v=kv[1];callback(k,v)}}}var defaults=new _vttcue2.default(0,0,0),center="middle"===defaults.align?"middle":"center";function parseCue(input,cue,regionList){var oInput=input;function consumeTimeStamp(){var ts=parseTimeStamp(input);if(null===ts)throw new Error("Malformed timestamp: "+oInput);return input=input.replace(/^[^\sa-zA-Z-]+/,""),ts}function consumeCueSettings(input,cue){var settings=new Settings;parseOptions(input,function(k,v){switch(k){case"region":for(var i=regionList.length-1;i>=0;i--)if(regionList[i].id===v){settings.set(k,regionList[i].region);break}break;case"vertical":settings.alt(k,v,["rl","lr"]);break;case"line":var vals=v.split(","),vals0=vals[0];settings.integer(k,vals0),settings.percent(k,vals0)&&settings.set("snapToLines",!1),settings.alt(k,vals0,["auto"]),2===vals.length&&settings.alt("lineAlign",vals[1],["start",center,"end"]);break;case"position":vals=v.split(","),settings.percent(k,vals[0]),2===vals.length&&settings.alt("positionAlign",vals[1],["start",center,"end","line-left","line-right","auto"]);break;case"size":settings.percent(k,v);break;case"align":settings.alt(k,v,["start",center,"end","left","right"])}},/:/,/\s/),cue.region=settings.get("region",null),cue.vertical=settings.get("vertical","");var line=settings.get("line","auto");"auto"===line&&defaults.line===-1&&(line=-1),cue.line=line,cue.lineAlign=settings.get("lineAlign","start"),cue.snapToLines=settings.get("snapToLines",!0),cue.size=settings.get("size",100),cue.align=settings.get("align",center);var position=settings.get("position","auto");"auto"===position&&50===defaults.position&&(position="start"===cue.align||"left"===cue.align?0:"end"===cue.align||"right"===cue.align?100:50),cue.position=position}function skipWhitespace(){input=input.replace(/^\s+/,"")}if(skipWhitespace(),cue.startTime=consumeTimeStamp(),skipWhitespace(),"-->"!==input.substr(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+oInput);input=input.substr(3),skipWhitespace(),cue.endTime=consumeTimeStamp(),skipWhitespace(),consumeCueSettings(input,cue)}function fixLineBreaks(input){return input.replace(/<br(?: \/)?>/gi,"\n")}VTTParser.prototype={parse:function(data){var self=this;data&&(self.buffer+=self.decoder.decode(data,{stream:!0}));function collectNextLine(){var buffer=self.buffer,pos=0;buffer=fixLineBreaks(buffer);while(pos<buffer.length&&"\r"!==buffer[pos]&&"\n"!==buffer[pos])++pos;var line=buffer.substr(0,pos);return"\r"===buffer[pos]&&++pos,"\n"===buffer[pos]&&++pos,self.buffer=buffer.substr(pos),line}function parseHeader(input){parseOptions(input,function(k,v){switch(k){case"Region":_logger.logger.log("parse region",v)}},/:/)}try{var line;if("INITIAL"===self.state){if(!/\r\n|\n/.test(self.buffer))return this;line=collectNextLine();var m=line.match(/^WEBVTT([ \t].*)?$/);if(!m||!m[0])throw new Error("Malformed WebVTT signature.");self.state="HEADER"}var alreadyCollectedLine=!1;while(self.buffer){if(!/\r\n|\n/.test(self.buffer))return this;switch(alreadyCollectedLine?alreadyCollectedLine=!1:line=collectNextLine(),self.state){case"HEADER":/:/.test(line)?parseHeader(line):line||(self.state="ID");continue;case"NOTE":line||(self.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(line)){self.state="NOTE";break}if(!line)continue;if(self.cue=new _vttcue2.default(0,0,""),self.state="CUE",line.indexOf("-->")===-1){self.cue.id=line;continue}case"CUE":try{parseCue(line,self.cue,self.regionList)}catch(e){self.cue=null,self.state="BADCUE";continue}self.state="CUETEXT";continue;case"CUETEXT":var hasSubstring=line.indexOf("-->")!==-1;if(!line||hasSubstring&&(alreadyCollectedLine=!0)){self.oncue&&self.oncue(self.cue),self.cue=null,self.state="ID";continue}self.cue.text&&(self.cue.text+="\n"),self.cue.text+=line;continue;case"BADCUE":line||(self.state="ID");continue}}}catch(e){"CUETEXT"===self.state&&self.cue&&self.oncue&&self.oncue(self.cue),self.cue=null,self.state="INITIAL"===self.state?"BADWEBVTT":"BADCUE"}return this},flush:function(){var self=this;try{if(self.buffer+=self.decoder.decode(),(self.cue||"HEADER"===self.state)&&(self.buffer+="\n\n",self.parse()),"INITIAL"===self.state)throw new Error("Malformed WebVTT signature.")}catch(e){throw e}return self.onflush&&self.onflush(),this}},exports.fixLineBreaks=fixLineBreaks,exports.default=VTTParser},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_events=__webpack_require__(3),_events2=_interopRequireDefault(_events),_MactrixDecrypter=__webpack_require__(68),_MactrixDecrypter2=_interopRequireDefault(_MactrixDecrypter),_ArrayHelper=__webpack_require__(21),_ArrayHelper2=_interopRequireDefault(_ArrayHelper),_muxjs=__webpack_require__(44),_muxjs2=_interopRequireDefault(_muxjs),_HlsUtils=__webpack_require__(6),_HlsUtils2=_interopRequireDefault(_HlsUtils);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var Fragment=function Fragment(){_classCallCheck(this,Fragment),this.segments=[],this.length=0},MuxJsInline=function(){function MuxJsInline(observer,typeSupported,config,vendor,logTube){_classCallCheck(this,MuxJsInline),this.observer=observer,this.vendor=vendor,this.typeSupported=typeSupported,this.config=config,this.videoFragment=new Fragment,this.audioFragment=new Fragment,this.combinedFragment=new Fragment,this.initPts=-1,this.remux=!1,this.resetInitSegment=!0,this.transmuxer=null,this.enableAudio=!0,this.enableVideo=!0,this.logTube=logTube}return _createClass(MuxJsInline,[{key:"destroy",value:function(){this.transmuxer=null,this.videoFragment=null,this.audioFragment=null,this.combinedFragment=null}},{key:"push",value:function(data,decryptdata,initSegment,audioCodec,videoCodec,timeOffset,discontinuity,trackSwitch,seek,duration,accurateTimeOffset,defaultInitPTS){if(data.byteLength>0&&null!=decryptdata&&null!=decryptdata.key&&"AES-128"===decryptdata.method){var decrypter=this.decrypter;null==decrypter&&(decrypter=this.decrypter=new _MactrixDecrypter2.default(this.observer,this.config));var startTime,localthis=this;try{startTime=performance.now()}catch(error){startTime=Date.now()}decrypter.decrypt(data,decryptdata.key.buffer,decryptdata.iv.buffer,function(decryptedData){var endTime;try{endTime=performance.now()}catch(error){endTime=Date.now()}localthis.observer.trigger(_events2.default.FRAG_DECRYPTED,{stats:{tstart:startTime,tdecrypt:endTime}}),localthis.pushDecrypted(_ArrayHelper2.default.makeUint8Array(decryptedData),decryptdata,new Uint8Array(initSegment),audioCodec,videoCodec,timeOffset,discontinuity,trackSwitch,seek,duration,accurateTimeOffset,defaultInitPTS)})}else this.pushDecrypted(_ArrayHelper2.default.makeUint8Array(data),decryptdata,new Uint8Array([]),audioCodec,videoCodec,timeOffset,discontinuity,trackSwitch,seek,duration,accurateTimeOffset,defaultInitPTS)}},{key:"pushDecrypted",value:function(data,decryptdata,initSegment,audioCodec,videoCodec,timeOffset,discontinuity,trackSwitch,seek,duration,gap){var transmuxer=this.transmuxer;if(!transmuxer){var localthis=this;transmuxer=new _muxjs2.default.mp4.Transmuxer({remux:this.remux,duration:duration,baseMediaDecodeTime:9e4*timeOffset,allowNegativeTFDT:!this.typeSupported.browChrome&&!_HlsUtils2.default.isTizen3(),logTube:this.logTube}),transmuxer.on("data",function(event){localthis.onData(event)}),transmuxer.on("done",function(){localthis.onDone(this.baseMediaDecodeTime)}),this.transmuxer=transmuxer}seek||transmuxer.setGapDuration(gap),(trackSwitch||discontinuity||seek)&&(this.resetInitSegment=!0,seek&&transmuxer.setBaseMediaDecodeTime(9e4*timeOffset)),transmuxer.push(data),transmuxer.flush()}},{key:"onData",value:function(event){"video"===event.type&&this.enableVideo===!0?(this.videoFragment.segments.push(event),this.videoFragment.length+=event.data.length):"audio"===event.type&&this.enableAudio===!0?(this.audioFragment.segments.push(event),this.audioFragment.length+=event.data.length):"combined"===event.type&&(this.combinedFragment.segments.push(event),this.combinedFragment.length+=event.data.length)}},{key:"doInitSegment",value:function(){var tracks={},data={tracks:tracks};this.combinedFragment.length>0&&!this.combinedFragment.segments[0].duplicate?(tracks.video={container:"video/mp4",codec:"avc1.42e00b",initSegment:this.combinedFragment.segments[0].initSegment,metadata:{width:this.combinedFragment.segments[0].info.width,height:this.combinedFragment.segments[0].info.height}},tracks.audio={container:"audio/mp4",codec:"mp4a.40.2",initSegment:null,metadata:{channelCount:this.combinedFragment.segments[0].audioInfo.channelcount}},this.resetInitSegment=!1):(this.videoFragment.length>0&&!this.videoFragment.segments[0].duplicate&&(tracks.video={container:"video/mp4",codec:"avc1.42e00b",initSegment:this.videoFragment.segments[0].initSegment,metadata:{width:this.videoFragment.segments[0].info.width,height:this.videoFragment.segments[0].info.height}},this.resetInitSegment=!1),this.audioFragment.length>0&&!this.audioFragment.segments[0].duplicate&&(tracks.audio={container:"audio/mp4",codec:"mp4a.40.2",initSegment:this.audioFragment.segments[0].initSegment,metadata:{channelCount:this.audioFragment.segments[0].info.channelcount}},this.resetInitSegment=!1)),(tracks.audio||tracks.video)&&this.observer.trigger(_events2.default.FRAG_PARSING_INIT_SEGMENT,data)}},{key:"doFrag",value:function(fragment){var startTime=fragment.info.startTime,endTime=fragment.info.startTime+fragment.info.fragmentDuration,data={data1:fragment.data,data2:null,startPTS:startTime,endPTS:endTime,startDTS:startTime,endDTS:endTime,type:fragment.type,nb:fragment.info.totalSamples,dropped:0,duplicate:fragment.duplicate,dts:fragment.timeStamp};this.observer.trigger(_events2.default.FRAG_PARSING_DATA,data)}},{key:"doMetadata",value:function(metadata){if(metadata.length>0){for(var samples=[],index=0;index<metadata.length;index++){var sample={data:null,pts:0,dts:0,len:0};sample.data=metadata[index].data,sample.pts=metadata[index].pts,sample.dts=metadata[index].dts,sample.len=metadata[index].data.length,samples.push(sample)}this.observer.trigger(_events2.default.FRAG_PARSING_METADATA,{samples:samples})}}},{key:"doCaptions",value:function(captions){captions.length>0&&this.observer.trigger(_events2.default.FRAG_PARSING_USERDATA,{samples:captions})}},{key:"deliverFragment",value:function(fragment){this.doFrag(fragment.segments[0]),this.doMetadata(fragment.segments[0].metadata),this.doCaptions(fragment.segments[0].captions),fragment.segments=[],fragment.length=0}},{key:"onDone",value:function(baseMediaDecodeTime){this.initPts!==baseMediaDecodeTime&&(this.observer.trigger(_events2.default.INIT_PTS_FOUND,{initPTS:baseMediaDecodeTime}),this.initPts=baseMediaDecodeTime),this.resetInitSegment===!0&&this.doInitSegment(),this.combinedFragment.length>0?this.deliverFragment(this.combinedFragment):(this.videoFragment.length>0&&this.deliverFragment(this.videoFragment),this.audioFragment.length>0&&this.deliverFragment(this.audioFragment)),this.observer.trigger(_events2.default.FRAG_PARSED)}}]),MuxJsInline}();exports.default=MuxJsInline,module.exports=exports["default"]},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _muxjsInline=__webpack_require__(73),_muxjsInline2=_interopRequireDefault(_muxjsInline),_events=__webpack_require__(3),_events2=_interopRequireDefault(_events),_logger=__webpack_require__(1),_events3=__webpack_require__(60),_events4=_interopRequireDefault(_events3),_logTube=__webpack_require__(167),_logTube2=_interopRequireDefault(_logTube);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var MuxJsWorker=function(self){var observer=new _events4.default;observer.trigger=function(event){for(var _len=arguments.length,data=Array(_len>1?_len-1:0),_key=1;_key<_len;_key++)data[_key-1]=arguments[_key];observer.emit.apply(observer,[event,event].concat(data))},observer.off=function(event){for(var _len2=arguments.length,data=Array(_len2>1?_len2-1:0),_key2=1;_key2<_len2;_key2++)data[_key2-1]=arguments[_key2];observer.removeListener.apply(observer,[event].concat(data))};var forwardMessage=function(ev,data){self.postMessage({event:ev,data:data})};self.addEventListener("message",function(ev){var data=ev.data;switch(data.cmd){case"init":var config=JSON.parse(data.config);self.tube.debug=config.debug,self.demuxer=new _muxjsInline2.default(observer,data.typeSupported,config,data.vendor,self.tube);try{(0,_logger.enableLogs)(config.debug===!0)}catch(err){}self.tube.log("MuxJsWorker created (Logs enabled)"),forwardMessage("init",null);break;case"demux":self.demuxer.push(data.data,data.decryptdata,data.initSegment,data.audioCodec,data.videoCodec,data.timeOffset,data.discontinuity,data.trackSwitch,data.contiguous,data.duration,data.accurateTimeOffset,data.defaultInitPTS)}}),observer.on(_events2.default.FRAG_DECRYPTED,forwardMessage),observer.on(_events2.default.FRAG_PARSING_INIT_SEGMENT,forwardMessage),observer.on(_events2.default.FRAG_PARSED,forwardMessage),observer.on(_events2.default.ERROR,forwardMessage),observer.on(_events2.default.FRAG_PARSING_METADATA,forwardMessage),observer.on(_events2.default.FRAG_PARSING_USERDATA,forwardMessage),observer.on(_events2.default.INIT_PTS_FOUND,forwardMessage),observer.on(_events2.default.LOGTUBE_LOG,forwardMessage),observer.on(_events2.default.FRAG_PARSING_DATA,function(ev,data){var transferable=[],message={event:ev,data:data};data.data1&&(message.data1=data.data1.buffer,transferable.push(data.data1.buffer),delete data.data1),data.data2&&(message.data2=data.data2.buffer,transferable.push(data.data2.buffer),delete data.data2),self.postMessage(message,transferable)}),self.tube=new _logTube2.default({debug:!0,event:_events2.default.LOGTUBE_LOG},{eventEmitter:observer})};exports.default=MuxJsWorker,module.exports=exports["default"]},function(module,exports,__webpack_require__){"use strict";var Stream=__webpack_require__(11),MAX_TS=8589934592,RO_THRESH=4294967296,handleRollover=function(value,reference){var direction=1;value>reference&&(direction=-1);while(Math.abs(reference-value)>RO_THRESH)value+=direction*MAX_TS;return value},TimestampRolloverStream=function TimestampRolloverStream(type){var lastDTS,referenceDTS;TimestampRolloverStream.prototype.init.call(this),this.type_=type,this.push=function(data){data.type===this.type_&&(void 0!==data.dts&&void 0!==data.pts&&(void 0===referenceDTS&&(referenceDTS=data.dts),data.dts=handleRollover(data.dts,referenceDTS),data.pts=handleRollover(data.pts,referenceDTS),lastDTS=data.dts),this.trigger("data",data))},this.flush=function(){referenceDTS=lastDTS,this.trigger("done")}};TimestampRolloverStream.prototype=new Stream,module.exports={TimestampRolloverStream:TimestampRolloverStream,handleRollover:handleRollover}},function(module,exports,__webpack_require__){"use strict";var _HlsUtils=__webpack_require__(6),_HlsUtils2=_interopRequireDefault(_HlsUtils);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}"use strict";var box,dinf,esds,ftyp,mdat,mfhd,minf,moof,moov,mvex,mvhd,trak,tkhd,mdia,mdhd,hdlr,sdtp,stbl,stsd,traf,trex,trun,types,MAJOR_BRAND,MINOR_VERSION,AVC1_BRAND,VIDEO_HDLR,AUDIO_HDLR,HDLR_TYPES,VMHD,SMHD,DREF,STCO,STSC,STSZ,STTS,UINT32_MAX=Math.pow(2,32)-1,ONE_SECOND_IN_TS=9e4;(function(){var i;if(types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],smhd:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],styp:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[]},"undefined"!==typeof Uint8Array){for(i in types)types.hasOwnProperty(i)&&(types[i]=[i.charCodeAt(0),i.charCodeAt(1),i.charCodeAt(2),i.charCodeAt(3)]);MAJOR_BRAND=new Uint8Array(["i".charCodeAt(0),"s".charCodeAt(0),"o".charCodeAt(0),"m".charCodeAt(0)]),AVC1_BRAND=new Uint8Array(["a".charCodeAt(0),"v".charCodeAt(0),"c".charCodeAt(0),"1".charCodeAt(0)]),MINOR_VERSION=new Uint8Array([0,0,0,1]),VIDEO_HDLR=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),AUDIO_HDLR=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),HDLR_TYPES={video:VIDEO_HDLR,audio:AUDIO_HDLR},DREF=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),STCO=new Uint8Array([0,0,0,0,0,0,0,0]),STSC=STCO,STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),STTS=STCO,VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])}})(),box=function(type){var i,result,view,payload=[],size=0;for(i=1;i<arguments.length;i++)payload.push(arguments[i]);i=payload.length;while(i--)size+=payload[i].byteLength;for(result=new Uint8Array(size+8),view=new DataView(result.buffer,result.byteOffset,result.byteLength),view.setUint32(0,result.byteLength),result.set(type,4),i=0,size=8;i<payload.length;i++)result.set(payload[i],size),size+=payload[i].byteLength;return result},dinf=function(){return box(types.dinf,box(types.dref,DREF))},esds=function(track){return box(types.esds,new Uint8Array([0,0,0,0,3,25,0,0,0,4,17,64,21,0,6,0,0,0,218,192,0,0,218,192,5,2,track.audioobjecttype<<3|track.samplingfrequencyindex>>>1,track.samplingfrequencyindex<<7|track.channelcount<<3,6,1,2]))},ftyp=function(){return box(types.ftyp,MAJOR_BRAND,MINOR_VERSION,MAJOR_BRAND,AVC1_BRAND)},hdlr=function(type){return box(types.hdlr,HDLR_TYPES[type])},mdat=function(data){return box(types.mdat,data)},mdhd=function(track){var result=new Uint8Array([0,0,0,0,0,0,0,2,0,0,0,3,0,1,95,144,track.duration>>>24&255,track.duration>>>16&255,track.duration>>>8&255,255&track.duration,85,196,0,0]);return track.samplerate&&(result[12]=track.samplerate>>>24&255,result[13]=track.samplerate>>>16&255,result[14]=track.samplerate>>>8&255,result[15]=255&track.samplerate),box(types.mdhd,result)},mdia=function(track){return box(types.mdia,mdhd(track),hdlr(track.type),minf(track))},mfhd=function(sequenceNumber){return box(types.mfhd,new Uint8Array([0,0,0,0,(4278190080&sequenceNumber)>>24,(16711680&sequenceNumber)>>16,(65280&sequenceNumber)>>8,255&sequenceNumber]))},minf=function(track){return box(types.minf,"video"===track.type?box(types.vmhd,VMHD):box(types.smhd,SMHD),dinf(),stbl(track))},moof=function(sequenceNumber,tracks){var trackFragments=[],i=tracks.length;while(i--)trackFragments[i]=traf(tracks[i]);return box.apply(null,[types.moof,mfhd(sequenceNumber)].concat(trackFragments))},moov=function(tracks){var i=tracks.length,duration=4294967295,timescale=ONE_SECOND_IN_TS,boxes=[];while(i--)tracks[i].duration/tracks[i].timescale<duration&&(duration=tracks[i].duration,timescale=tracks[i].timescale),boxes[i]=trak(tracks[i]);return box.apply(null,[types.moov,mvhd(duration,timescale)].concat(boxes).concat(mvex(tracks)))},mvex=function(tracks){var i=tracks.length,boxes=[];while(i--)boxes[i]=trex(tracks[i]);return box.apply(null,[types.mvex].concat(boxes))},mvhd=function(duration,timescale){var bytes=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,2,(4278190080&timescale)>>24,(16711680&timescale)>>16,(65280&timescale)>>8,255&timescale,(4278190080&duration)>>24,(16711680&duration)>>16,(65280&duration)>>8,255&duration,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return box(types.mvhd,bytes)},sdtp=function(track){var flags,i,samples=track.samples||[],bytes=new Uint8Array(4+samples.length);for(i=0;i<samples.length;i++)flags=samples[i].flags,bytes[i+4]=flags.dependsOn<<4|flags.isDependedOn<<2|flags.hasRedundancy;return box(types.sdtp,bytes)},stbl=function(track){return box(types.stbl,stsd(track),box(types.stts,STTS),box(types.stsc,STSC),box(types.stsz,STSZ),box(types.stco,STCO))},function(){var videoSample,audioSample;stsd=function(track){return box(types.stsd,new Uint8Array([0,0,0,0,0,0,0,1]),"video"===track.type?videoSample(track):audioSample(track))},videoSample=function(track){var i,sps=track.sps||[],pps=track.pps||[],sequenceParameterSets=[],pictureParameterSets=[];for(i=0;i<sps.length;i++)sequenceParameterSets.push((65280&sps[i].byteLength)>>>8),sequenceParameterSets.push(255&sps[i].byteLength),sequenceParameterSets=sequenceParameterSets.concat(Array.prototype.slice.call(sps[i]));for(i=0;i<pps.length;i++)pictureParameterSets.push((65280&pps[i].byteLength)>>>8),pictureParameterSets.push(255&pps[i].byteLength),
pictureParameterSets=pictureParameterSets.concat(Array.prototype.slice.call(pps[i]));return box(types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,(65280&track.width)>>8,255&track.width,(65280&track.height)>>8,255&track.height,0,72,0,0,0,72,0,0,0,0,0,0,0,1,19,118,105,100,101,111,106,115,45,99,111,110,116,114,105,98,45,104,108,115,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),box(types.avcC,new Uint8Array([1,track.profileIdc,track.profileCompatibility,track.levelIdc,255].concat([sps.length]).concat(sequenceParameterSets).concat([pps.length]).concat(pictureParameterSets))),box(types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])))},audioSample=function(track){return box(types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,(65280&track.channelcount)>>8,255&track.channelcount,(65280&track.samplesize)>>8,255&track.samplesize,0,0,0,0,(65280&track.samplerate)>>8,255&track.samplerate,0,0]),esds(track))}}(),tkhd=function(track){var result=new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,(4278190080&track.id)>>24,(16711680&track.id)>>16,(65280&track.id)>>8,255&track.id,0,0,0,0,(4278190080&track.duration)>>24,(16711680&track.duration)>>16,(65280&track.duration)>>8,255&track.duration,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,(65280&track.width)>>8,255&track.width,0,0,(65280&track.height)>>8,255&track.height,0,0]);return box(types.tkhd,result)},traf=function(track){var trackFragmentHeader,trackFragmentDecodeTime,trackFragmentRun,sampleDependencyTable,dataOffset,upperWordBaseMediaDecodeTime,lowerWordBaseMediaDecodeTime;return trackFragmentHeader=box(types.tfhd,new Uint8Array([0,0,0,58,(4278190080&track.id)>>24,(16711680&track.id)>>16,(65280&track.id)>>8,255&track.id,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0])),upperWordBaseMediaDecodeTime=Math.floor(track.baseMediaDecodeTime/(UINT32_MAX+1)),lowerWordBaseMediaDecodeTime=Math.floor(track.baseMediaDecodeTime%(UINT32_MAX+1)),trackFragmentDecodeTime=box(types.tfdt,new Uint8Array([1,0,0,0,upperWordBaseMediaDecodeTime>>>24&255,upperWordBaseMediaDecodeTime>>>16&255,upperWordBaseMediaDecodeTime>>>8&255,255&upperWordBaseMediaDecodeTime,lowerWordBaseMediaDecodeTime>>>24&255,lowerWordBaseMediaDecodeTime>>>16&255,lowerWordBaseMediaDecodeTime>>>8&255,255&lowerWordBaseMediaDecodeTime])),dataOffset=32+20+8+16+8+8,"audio"===track.type?(trackFragmentRun=trun(track,dataOffset),box(types.traf,trackFragmentHeader,trackFragmentDecodeTime,trackFragmentRun)):(sampleDependencyTable=sdtp(track),trackFragmentRun=trun(track,sampleDependencyTable.length+dataOffset),box(types.traf,trackFragmentHeader,trackFragmentDecodeTime,trackFragmentRun,sampleDependencyTable))},trak=function(track){return _HlsUtils2.default.isTizen2()?track.duration=track.duration/1e3||4294967295:track.duration=track.duration||4294967295,box(types.trak,tkhd(track),mdia(track))},trex=function(track){var result=new Uint8Array([0,0,0,0,(4278190080&track.id)>>24,(16711680&track.id)>>16,(65280&track.id)>>8,255&track.id,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return"video"!==track.type&&(result[result.length-1]=0),box(types.trex,result)},function(){var audioTrun,videoTrun,trunHeader;trunHeader=function(samples,offset){var durationPresent=0,sizePresent=0,flagsPresent=0,compositionTimeOffset=0;return samples.length&&(void 0!==samples[0].duration&&(durationPresent=1),void 0!==samples[0].size&&(sizePresent=2),void 0!==samples[0].flags&&(flagsPresent=4),void 0!==samples[0].compositionTimeOffset&&(compositionTimeOffset=8)),[0,0,durationPresent|sizePresent|flagsPresent|compositionTimeOffset,1,(4278190080&samples.length)>>>24,(16711680&samples.length)>>>16,(65280&samples.length)>>>8,255&samples.length,(4278190080&offset)>>>24,(16711680&offset)>>>16,(65280&offset)>>>8,255&offset]},videoTrun=function(track,offset){var bytes,samples,sample,i;for(samples=track.samples||[],offset+=8+12+16*samples.length,bytes=trunHeader(samples,offset),i=0;i<samples.length;i++)sample=samples[i],bytes=bytes.concat([(4278190080&sample.duration)>>>24,(16711680&sample.duration)>>>16,(65280&sample.duration)>>>8,255&sample.duration,(4278190080&sample.size)>>>24,(16711680&sample.size)>>>16,(65280&sample.size)>>>8,255&sample.size,sample.flags.isLeading<<2|sample.flags.dependsOn,sample.flags.isDependedOn<<6|sample.flags.hasRedundancy<<4|sample.flags.paddingValue<<1|sample.flags.isNonSyncSample,sample.flags.degradationPriority&240<<8,15&sample.flags.degradationPriority,(4278190080&sample.compositionTimeOffset)>>>24,(16711680&sample.compositionTimeOffset)>>>16,(65280&sample.compositionTimeOffset)>>>8,255&sample.compositionTimeOffset]);return box(types.trun,new Uint8Array(bytes))},audioTrun=function(track,offset){var bytes,samples,sample,i;for(samples=track.samples||[],offset+=8+12+8*samples.length,bytes=trunHeader(samples,offset),i=0;i<samples.length;i++)sample=samples[i],bytes=bytes.concat([(4278190080&sample.duration)>>>24,(16711680&sample.duration)>>>16,(65280&sample.duration)>>>8,255&sample.duration,(4278190080&sample.size)>>>24,(16711680&sample.size)>>>16,(65280&sample.size)>>>8,255&sample.size]);return box(types.trun,new Uint8Array(bytes))},trun=function(track,offset){return"audio"===track.type?audioTrun(track,offset):videoTrun(track,offset)}}(),module.exports={ftyp:ftyp,mdat:mdat,moof:moof,moov:moov,initSegment:function(tracks){var result,fileType=ftyp(),movie=moov(tracks);return result=new Uint8Array(fileType.byteLength+movie.byteLength),result.set(fileType),result.set(movie,fileType.byteLength),result}}},function(module,exports,__webpack_require__){__webpack_require__(97),__webpack_require__(195),__webpack_require__(193),__webpack_require__(199),__webpack_require__(196),__webpack_require__(202),__webpack_require__(204),__webpack_require__(192),__webpack_require__(198),__webpack_require__(189),__webpack_require__(203),__webpack_require__(187),__webpack_require__(201),__webpack_require__(200),__webpack_require__(194),__webpack_require__(197),__webpack_require__(186),__webpack_require__(188),__webpack_require__(191),__webpack_require__(190),__webpack_require__(205),__webpack_require__(96),__webpack_require__(210),__webpack_require__(208),__webpack_require__(209),module.exports=__webpack_require__(18).Array},function(module,exports,__webpack_require__){__webpack_require__(206),__webpack_require__(97),__webpack_require__(213),__webpack_require__(207),__webpack_require__(211),__webpack_require__(212),module.exports=__webpack_require__(18).Promise},function(module,exports,__webpack_require__){var aFunction=__webpack_require__(15),toObject=__webpack_require__(12),IObject=__webpack_require__(38),toLength=__webpack_require__(9);module.exports=function(that,callbackfn,aLen,memo,isRight){aFunction(callbackfn);var O=toObject(that),self=IObject(O),length=toLength(O.length),index=isRight?length-1:0,i=isRight?-1:1;if(aLen<2)for(;;){if(index in self){memo=self[index],index+=i;break}if(index+=i,isRight?index<0:length<=index)throw TypeError("Reduce of empty array with no initial value")}for(;isRight?index>=0:length>index;index+=i)index in self&&(memo=callbackfn(memo,self[index],index,O));return memo}},function(module,exports,__webpack_require__){"use strict";var $defineProperty=__webpack_require__(30),createDesc=__webpack_require__(56);module.exports=function(object,index,value){index in object?$defineProperty.f(object,index,createDesc(0,value)):object[index]=value}},function(module){module.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(module,exports,__webpack_require__){"use strict";var isArray=__webpack_require__(54),isObject=__webpack_require__(20),toLength=__webpack_require__(9),ctx=__webpack_require__(19),IS_CONCAT_SPREADABLE=__webpack_require__(7)("isConcatSpreadable");function flattenIntoArray(target,original,source,sourceLen,start,depth,mapper,thisArg){var element,spreadable,targetIndex=start,sourceIndex=0,mapFn=!!mapper&&ctx(mapper,thisArg,3);while(sourceIndex<sourceLen){if(sourceIndex in source){if(element=mapFn?mapFn(source[sourceIndex],sourceIndex,original):source[sourceIndex],spreadable=!1,isObject(element)&&(spreadable=element[IS_CONCAT_SPREADABLE],spreadable=void 0!==spreadable?!!spreadable:isArray(element)),spreadable&&depth>0)targetIndex=flattenIntoArray(target,original,element,toLength(element.length),targetIndex,depth-1)-1;else{if(targetIndex>=9007199254740991)throw TypeError();target[targetIndex]=element}targetIndex++}sourceIndex++}return targetIndex}module.exports=flattenIntoArray},function(module,exports,__webpack_require__){var Iterators=__webpack_require__(29),ITERATOR=__webpack_require__(7)("iterator"),ArrayProto=Array.prototype;module.exports=function(it){return void 0!==it&&(Iterators.Array===it||ArrayProto[ITERATOR]===it)}},function(module,exports,__webpack_require__){var anObject=__webpack_require__(16);module.exports=function(iterator,fn,value,entries){try{return entries?fn(anObject(value)[0],value[1]):fn(value)}catch(e){var ret=iterator["return"];throw void 0!==ret&&anObject(ret.call(iterator)),e}}},function(module,exports,__webpack_require__){"use strict";var LIBRARY=__webpack_require__(87),$export=__webpack_require__(2),redefine=__webpack_require__(31),hide=__webpack_require__(24),has=__webpack_require__(28),Iterators=__webpack_require__(29),$iterCreate=__webpack_require__(176),setToStringTag=__webpack_require__(57),getPrototypeOf=__webpack_require__(181),ITERATOR=__webpack_require__(7)("iterator"),BUGGY=!([].keys&&"next"in[].keys()),FF_ITERATOR="@@iterator",KEYS="keys",VALUES="values",returnThis=function(){return this};module.exports=function(Base,NAME,Constructor,next,DEFAULT,IS_SET,FORCED){$iterCreate(Constructor,NAME,next);var methods,key,IteratorPrototype,getMethod=function(kind){if(!BUGGY&&kind in proto)return proto[kind];switch(kind){case KEYS:return function(){return new Constructor(this,kind)};case VALUES:return function(){return new Constructor(this,kind)}}return function(){return new Constructor(this,kind)}},TAG=NAME+" Iterator",DEF_VALUES=DEFAULT==VALUES,VALUES_BUG=!1,proto=Base.prototype,$native=proto[ITERATOR]||proto[FF_ITERATOR]||DEFAULT&&proto[DEFAULT],$default=!BUGGY&&$native||getMethod(DEFAULT),$entries=DEFAULT?DEF_VALUES?getMethod("entries"):$default:void 0,$anyNative="Array"==NAME?proto.entries||$native:$native;if($anyNative&&(IteratorPrototype=getPrototypeOf($anyNative.call(new Base)),IteratorPrototype!==Object.prototype&&IteratorPrototype.next&&(setToStringTag(IteratorPrototype,TAG,!0),LIBRARY||has(IteratorPrototype,ITERATOR)||hide(IteratorPrototype,ITERATOR,returnThis))),DEF_VALUES&&$native&&$native.name!==VALUES&&(VALUES_BUG=!0,$default=function(){return $native.call(this)}),LIBRARY&&!FORCED||!BUGGY&&!VALUES_BUG&&proto[ITERATOR]||hide(proto,ITERATOR,$default),Iterators[NAME]=$default,Iterators[TAG]=returnThis,DEFAULT)if(methods={values:DEF_VALUES?$default:getMethod(VALUES),keys:IS_SET?$default:getMethod(KEYS),entries:$entries},FORCED)for(key in methods)key in proto||redefine(proto,key,methods[key]);else $export($export.P+$export.F*(BUGGY||VALUES_BUG),NAME,methods);return methods}},function(module,exports,__webpack_require__){var ITERATOR=__webpack_require__(7)("iterator"),SAFE_CLOSING=!1;try{var riter=[7][ITERATOR]();riter["return"]=function(){SAFE_CLOSING=!0},Array.from(riter,function(){throw 2})}catch(e){}module.exports=function(exec,skipClosing){if(!skipClosing&&!SAFE_CLOSING)return!1;var safe=!1;try{var arr=[7],iter=arr[ITERATOR]();iter.next=function(){return{done:safe=!0}},arr[ITERATOR]=function(){return iter},exec(arr)}catch(e){}return safe}},function(module){module.exports=!1},function(module,exports,__webpack_require__){var $keys=__webpack_require__(182),enumBugKeys=__webpack_require__(81);module.exports=Object.keys||function(O){return $keys(O,enumBugKeys)}},function(module){module.exports=function(exec){try{return{e:!1,v:exec()}}catch(e){return{e:!0,v:e}}}},function(module,exports,__webpack_require__){var anObject=__webpack_require__(16),isObject=__webpack_require__(20),newPromiseCapability=__webpack_require__(55);module.exports=function(C,x){if(anObject(C),isObject(x)&&x.constructor===C)return x;var promiseCapability=newPromiseCapability.f(C),resolve=promiseCapability.resolve;return resolve(x),promiseCapability.promise}},function(module,exports,__webpack_require__){"use strict";var global=__webpack_require__(8),dP=__webpack_require__(30),DESCRIPTORS=__webpack_require__(27),SPECIES=__webpack_require__(7)("species");module.exports=function(KEY){var C=global[KEY];DESCRIPTORS&&C&&!C[SPECIES]&&dP.f(C,SPECIES,{configurable:!0,get:function(){return this}})}},function(module,exports,__webpack_require__){var global=__webpack_require__(8),SHARED="__core-js_shared__",store=global[SHARED]||(global[SHARED]={});module.exports=function(key){return store[key]||(store[key]={})}},function(module,exports,__webpack_require__){var anObject=__webpack_require__(16),aFunction=__webpack_require__(15),SPECIES=__webpack_require__(7)("species");module.exports=function(O,D){var S,C=anObject(O).constructor;return void 0===C||void 0==(S=anObject(C)[SPECIES])?D:aFunction(S)}},function(module,exports,__webpack_require__){var defer,channel,port,ctx=__webpack_require__(19),invoke=__webpack_require__(175),html=__webpack_require__(53),cel=__webpack_require__(52),global=__webpack_require__(8),process=global.process,setTask=global.setImmediate,clearTask=global.clearImmediate,MessageChannel=global.MessageChannel,Dispatch=global.Dispatch,counter=0,queue={},ONREADYSTATECHANGE="onreadystatechange",run=function(){var id=+this;if(queue.hasOwnProperty(id)){var fn=queue[id];delete queue[id],fn()}},listener=function(event){run.call(event.data)};setTask&&clearTask||(setTask=function(fn){var args=[],i=1;while(arguments.length>i)args.push(arguments[i++]);return queue[++counter]=function(){invoke("function"==typeof fn?fn:Function(fn),args)},defer(counter),counter},clearTask=function(id){delete queue[id]},"process"==__webpack_require__(22)(process)?defer=function(id){process.nextTick(ctx(run,id,1))}:Dispatch&&Dispatch.now?defer=function(id){Dispatch.now(ctx(run,id,1))}:MessageChannel?(channel=new MessageChannel,port=channel.port2,channel.port1.onmessage=listener,defer=ctx(port.postMessage,port,1)):global.addEventListener&&"function"==typeof postMessage&&!global.importScripts?(defer=function(id){global.postMessage(id+"","*")},global.addEventListener("message",listener,!1)):defer=ONREADYSTATECHANGE in cel("script")?function(id){html.appendChild(cel("script"))[ONREADYSTATECHANGE]=function(){html.removeChild(this),run.call(id)}}:function(id){setTimeout(ctx(run,id,1),0)}),module.exports={set:setTask,clear:clearTask}},function(module,exports,__webpack_require__){var classof=__webpack_require__(50),ITERATOR=__webpack_require__(7)("iterator"),Iterators=__webpack_require__(29);module.exports=__webpack_require__(18).getIteratorMethod=function(it){if(void 0!=it)return it[ITERATOR]||it["@@iterator"]||Iterators[classof(it)]}},function(module,exports,__webpack_require__){"use strict";var addToUnscopables=__webpack_require__(13),step=__webpack_require__(177),Iterators=__webpack_require__(29),toIObject=__webpack_require__(33);module.exports=__webpack_require__(85)(Array,"Array",function(iterated,kind){this._t=toIObject(iterated),this._i=0,this._k=kind},function(){var O=this._t,kind=this._k,index=this._i++;return!O||index>=O.length?(this._t=void 0,step(1)):"keys"==kind?step(0,index):"values"==kind?step(0,O[index]):step(0,[index,O[index]])},"values"),Iterators.Arguments=Iterators.Array,addToUnscopables("keys"),addToUnscopables("values"),addToUnscopables("entries")},function(module,exports,__webpack_require__){"use strict";var $at=__webpack_require__(184)(!0);__webpack_require__(85)(String,"String",function(iterated){this._t=String(iterated),this._i=0},function(){var point,O=this._t,index=this._i;return index>=O.length?{value:void 0,done:!0}:(point=$at(O,index),this._i+=point.length,{value:point,done:!1})})},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_RESULT__;(function(global,module){(function(){var undefined,VERSION="4.17.5",LARGE_ARRAY_SIZE=200,CORE_ERROR_TEXT="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",FUNC_ERROR_TEXT="Expected a function",HASH_UNDEFINED="__lodash_hash_undefined__",MAX_MEMOIZE_SIZE=500,PLACEHOLDER="__lodash_placeholder__",CLONE_DEEP_FLAG=1,CLONE_FLAT_FLAG=2,CLONE_SYMBOLS_FLAG=4,COMPARE_PARTIAL_FLAG=1,COMPARE_UNORDERED_FLAG=2,WRAP_BIND_FLAG=1,WRAP_BIND_KEY_FLAG=2,WRAP_CURRY_BOUND_FLAG=4,WRAP_CURRY_FLAG=8,WRAP_CURRY_RIGHT_FLAG=16,WRAP_PARTIAL_FLAG=32,WRAP_PARTIAL_RIGHT_FLAG=64,WRAP_ARY_FLAG=128,WRAP_REARG_FLAG=256,WRAP_FLIP_FLAG=512,DEFAULT_TRUNC_LENGTH=30,DEFAULT_TRUNC_OMISSION="...",HOT_COUNT=800,HOT_SPAN=16,LAZY_FILTER_FLAG=1,LAZY_MAP_FLAG=2,LAZY_WHILE_FLAG=3,INFINITY=1/0,MAX_SAFE_INTEGER=9007199254740991,MAX_INTEGER=1.7976931348623157e308,NAN=0/0,MAX_ARRAY_LENGTH=4294967295,MAX_ARRAY_INDEX=MAX_ARRAY_LENGTH-1,HALF_MAX_ARRAY_LENGTH=MAX_ARRAY_LENGTH>>>1,wrapFlags=[["ary",WRAP_ARY_FLAG],["bind",WRAP_BIND_FLAG],["bindKey",WRAP_BIND_KEY_FLAG],["curry",WRAP_CURRY_FLAG],["curryRight",WRAP_CURRY_RIGHT_FLAG],["flip",WRAP_FLIP_FLAG],["partial",WRAP_PARTIAL_FLAG],["partialRight",WRAP_PARTIAL_RIGHT_FLAG],["rearg",WRAP_REARG_FLAG]],argsTag="[object Arguments]",arrayTag="[object Array]",asyncTag="[object AsyncFunction]",boolTag="[object Boolean]",dateTag="[object Date]",domExcTag="[object DOMException]",errorTag="[object Error]",funcTag="[object Function]",genTag="[object GeneratorFunction]",mapTag="[object Map]",numberTag="[object Number]",nullTag="[object Null]",objectTag="[object Object]",promiseTag="[object Promise]",proxyTag="[object Proxy]",regexpTag="[object RegExp]",setTag="[object Set]",stringTag="[object String]",symbolTag="[object Symbol]",undefinedTag="[object Undefined]",weakMapTag="[object WeakMap]",weakSetTag="[object WeakSet]",arrayBufferTag="[object ArrayBuffer]",dataViewTag="[object DataView]",float32Tag="[object Float32Array]",float64Tag="[object Float64Array]",int8Tag="[object Int8Array]",int16Tag="[object Int16Array]",int32Tag="[object Int32Array]",uint8Tag="[object Uint8Array]",uint8ClampedTag="[object Uint8ClampedArray]",uint16Tag="[object Uint16Array]",uint32Tag="[object Uint32Array]",reEmptyStringLeading=/\b__p \+= '';/g,reEmptyStringMiddle=/\b(__p \+=) '' \+/g,reEmptyStringTrailing=/(__e\(.*?\)|\b__t\)) \+\n'';/g,reEscapedHtml=/&(?:amp|lt|gt|quot|#39);/g,reUnescapedHtml=/[&<>"']/g,reHasEscapedHtml=RegExp(reEscapedHtml.source),reHasUnescapedHtml=RegExp(reUnescapedHtml.source),reEscape=/<%-([\s\S]+?)%>/g,reEvaluate=/<%([\s\S]+?)%>/g,reInterpolate=/<%=([\s\S]+?)%>/g,reIsDeepProp=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,reIsPlainProp=/^\w*$/,rePropName=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,reRegExpChar=/[\\^$.*+?()[\]{}|]/g,reHasRegExpChar=RegExp(reRegExpChar.source),reTrim=/^\s+|\s+$/g,reTrimStart=/^\s+/,reTrimEnd=/\s+$/,reWrapComment=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,reWrapDetails=/\{\n\/\* \[wrapped with (.+)\] \*/,reSplitDetails=/,? & /,reAsciiWord=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,reEscapeChar=/\\(\\)?/g,reEsTemplate=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,reFlags=/\w*$/,reIsBadHex=/^[-+]0x[0-9a-f]+$/i,reIsBinary=/^0b[01]+$/i,reIsHostCtor=/^\[object .+?Constructor\]$/,reIsOctal=/^0o[0-7]+$/i,reIsUint=/^(?:0|[1-9]\d*)$/,reLatin=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,reNoMatch=/($^)/,reUnescapedString=/['\n\r\u2028\u2029\\]/g,rsAstralRange="\\ud800-\\udfff",rsComboMarksRange="\\u0300-\\u036f",reComboHalfMarksRange="\\ufe20-\\ufe2f",rsComboSymbolsRange="\\u20d0-\\u20ff",rsComboRange=rsComboMarksRange+reComboHalfMarksRange+rsComboSymbolsRange,rsDingbatRange="\\u2700-\\u27bf",rsLowerRange="a-z\\xdf-\\xf6\\xf8-\\xff",rsMathOpRange="\\xac\\xb1\\xd7\\xf7",rsNonCharRange="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",rsPunctuationRange="\\u2000-\\u206f",rsSpaceRange=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",rsUpperRange="A-Z\\xc0-\\xd6\\xd8-\\xde",rsVarRange="\\ufe0e\\ufe0f",rsBreakRange=rsMathOpRange+rsNonCharRange+rsPunctuationRange+rsSpaceRange,rsApos="[']",rsAstral="["+rsAstralRange+"]",rsBreak="["+rsBreakRange+"]",rsCombo="["+rsComboRange+"]",rsDigits="\\d+",rsDingbat="["+rsDingbatRange+"]",rsLower="["+rsLowerRange+"]",rsMisc="[^"+rsAstralRange+rsBreakRange+rsDigits+rsDingbatRange+rsLowerRange+rsUpperRange+"]",rsFitz="\\ud83c[\\udffb-\\udfff]",rsModifier="(?:"+rsCombo+"|"+rsFitz+")",rsNonAstral="[^"+rsAstralRange+"]",rsRegional="(?:\\ud83c[\\udde6-\\uddff]){2}",rsSurrPair="[\\ud800-\\udbff][\\udc00-\\udfff]",rsUpper="["+rsUpperRange+"]",rsZWJ="\\u200d",rsMiscLower="(?:"+rsLower+"|"+rsMisc+")",rsMiscUpper="(?:"+rsUpper+"|"+rsMisc+")",rsOptContrLower="(?:"+rsApos+"(?:d|ll|m|re|s|t|ve))?",rsOptContrUpper="(?:"+rsApos+"(?:D|LL|M|RE|S|T|VE))?",reOptMod=rsModifier+"?",rsOptVar="["+rsVarRange+"]?",rsOptJoin="(?:"+rsZWJ+"(?:"+[rsNonAstral,rsRegional,rsSurrPair].join("|")+")"+rsOptVar+reOptMod+")*",rsOrdLower="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",rsOrdUpper="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",rsSeq=rsOptVar+reOptMod+rsOptJoin,rsEmoji="(?:"+[rsDingbat,rsRegional,rsSurrPair].join("|")+")"+rsSeq,rsSymbol="(?:"+[rsNonAstral+rsCombo+"?",rsCombo,rsRegional,rsSurrPair,rsAstral].join("|")+")",reApos=RegExp(rsApos,"g"),reComboMark=RegExp(rsCombo,"g"),reUnicode=RegExp(rsFitz+"(?="+rsFitz+")|"+rsSymbol+rsSeq,"g"),reUnicodeWord=RegExp([rsUpper+"?"+rsLower+"+"+rsOptContrLower+"(?="+[rsBreak,rsUpper,"$"].join("|")+")",rsMiscUpper+"+"+rsOptContrUpper+"(?="+[rsBreak,rsUpper+rsMiscLower,"$"].join("|")+")",rsUpper+"?"+rsMiscLower+"+"+rsOptContrLower,rsUpper+"+"+rsOptContrUpper,rsOrdUpper,rsOrdLower,rsDigits,rsEmoji].join("|"),"g"),reHasUnicode=RegExp("["+rsZWJ+rsAstralRange+rsComboRange+rsVarRange+"]"),reHasUnicodeWord=/[a-z][A-Z]|[A-Z]{2,}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,contextProps=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],templateCounter=-1,typedArrayTags={};typedArrayTags[float32Tag]=typedArrayTags[float64Tag]=typedArrayTags[int8Tag]=typedArrayTags[int16Tag]=typedArrayTags[int32Tag]=typedArrayTags[uint8Tag]=typedArrayTags[uint8ClampedTag]=typedArrayTags[uint16Tag]=typedArrayTags[uint32Tag]=!0,typedArrayTags[argsTag]=typedArrayTags[arrayTag]=typedArrayTags[arrayBufferTag]=typedArrayTags[boolTag]=typedArrayTags[dataViewTag]=typedArrayTags[dateTag]=typedArrayTags[errorTag]=typedArrayTags[funcTag]=typedArrayTags[mapTag]=typedArrayTags[numberTag]=typedArrayTags[objectTag]=typedArrayTags[regexpTag]=typedArrayTags[setTag]=typedArrayTags[stringTag]=typedArrayTags[weakMapTag]=!1;var cloneableTags={};cloneableTags[argsTag]=cloneableTags[arrayTag]=cloneableTags[arrayBufferTag]=cloneableTags[dataViewTag]=cloneableTags[boolTag]=cloneableTags[dateTag]=cloneableTags[float32Tag]=cloneableTags[float64Tag]=cloneableTags[int8Tag]=cloneableTags[int16Tag]=cloneableTags[int32Tag]=cloneableTags[mapTag]=cloneableTags[numberTag]=cloneableTags[objectTag]=cloneableTags[regexpTag]=cloneableTags[setTag]=cloneableTags[stringTag]=cloneableTags[symbolTag]=cloneableTags[uint8Tag]=cloneableTags[uint8ClampedTag]=cloneableTags[uint16Tag]=cloneableTags[uint32Tag]=!0,cloneableTags[errorTag]=cloneableTags[funcTag]=cloneableTags[weakMapTag]=!1;var deburredLetters={"":"A","":"A","":"A","":"A","":"A","":"A","":"a","":"a","":"a","":"a","":"a","":"a","":"C","":"c","":"D","":"d","":"E","":"E","":"E","":"E","":"e","":"e","":"e","":"e","":"I","":"I","":"I","":"I","":"i","":"i","":"i","":"i","":"N","":"n","":"O","":"O","":"O","":"O","":"O","":"O","":"o","":"o","":"o","":"o","":"o","":"o","":"U","":"U","":"U","":"U","":"u","":"u","":"u","":"u","":"Y","":"y","":"y","":"Ae","":"ae","":"Th","":"th","":"ss","":"A","":"A","":"A","":"a","":"a","":"a","":"C","":"C","":"C","":"C","":"c","":"c","":"c","":"c","":"D","":"D","":"d","":"d","":"E","":"E","":"E","":"E","":"E","":"e","":"e","":"e","":"e","":"e","":"G","":"G","":"G","":"G","":"g","":"g","":"g","":"g","":"H","":"H","":"h","":"h","":"I","":"I","":"I","":"I","":"I","":"i","":"i","":"i","":"i","":"i","":"J","":"j","":"K","":"k","":"k","":"L","":"L","":"L","":"L","":"L","":"l","":"l","":"l","":"l","":"l","":"N","":"N","":"N","":"N","":"n","":"n","":"n","":"n","":"O","":"O","":"O","":"o","":"o","":"o","":"R","":"R","":"R","":"r","":"r","":"r","":"S","":"S","":"S","":"S","":"s","":"s","":"s","":"s","":"T","":"T","":"T","":"t","":"t","":"t","":"U","":"U","":"U","":"U","":"U","":"U","":"u","":"u","":"u","":"u","":"u","":"u","":"W","":"w","":"Y","":"y","":"Y","":"Z","":"Z","":"Z","":"z","":"z","":"z","":"IJ","":"ij","":"Oe","":"oe","":"'n","":"s"},htmlEscapes={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},htmlUnescapes={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},stringEscapes={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},freeParseFloat=parseFloat,freeParseInt=parseInt,freeGlobal="object"==typeof global&&global&&global.Object===Object&&global,freeSelf="object"==typeof self&&self&&self.Object===Object&&self,root=freeGlobal||freeSelf||Function("return this")(),freeExports="object"==typeof exports&&exports&&!exports.nodeType&&exports,freeModule=freeExports&&"object"==typeof module&&module&&!module.nodeType&&module,moduleExports=freeModule&&freeModule.exports===freeExports,freeProcess=moduleExports&&freeGlobal.process,nodeUtil=function(){try{return freeProcess&&freeProcess.binding&&freeProcess.binding("util")}catch(e){}}(),nodeIsArrayBuffer=nodeUtil&&nodeUtil.isArrayBuffer,nodeIsDate=nodeUtil&&nodeUtil.isDate,nodeIsMap=nodeUtil&&nodeUtil.isMap,nodeIsRegExp=nodeUtil&&nodeUtil.isRegExp,nodeIsSet=nodeUtil&&nodeUtil.isSet,nodeIsTypedArray=nodeUtil&&nodeUtil.isTypedArray;function apply(func,thisArg,args){switch(args.length){case 0:return func.call(thisArg);case 1:return func.call(thisArg,args[0]);case 2:return func.call(thisArg,args[0],args[1]);case 3:return func.call(thisArg,args[0],args[1],args[2])}return func.apply(thisArg,args)}function arrayAggregator(array,setter,iteratee,accumulator){var index=-1,length=null==array?0:array.length;while(++index<length){var value=array[index];setter(accumulator,value,iteratee(value),array)}return accumulator}function arrayEach(array,iteratee){var index=-1,length=null==array?0:array.length;while(++index<length)if(iteratee(array[index],index,array)===!1)break;return array}function arrayEachRight(array,iteratee){var length=null==array?0:array.length;while(length--)if(iteratee(array[length],length,array)===!1)break;return array}function arrayEvery(array,predicate){var index=-1,length=null==array?0:array.length;while(++index<length)if(!predicate(array[index],index,array))return!1;return!0}function arrayFilter(array,predicate){var index=-1,length=null==array?0:array.length,resIndex=0,result=[];while(++index<length){var value=array[index];predicate(value,index,array)&&(result[resIndex++]=value)}return result}function arrayIncludes(array,value){var length=null==array?0:array.length;return!!length&&baseIndexOf(array,value,0)>-1}function arrayIncludesWith(array,value,comparator){var index=-1,length=null==array?0:array.length;while(++index<length)if(comparator(value,array[index]))return!0;return!1}function arrayMap(array,iteratee){var index=-1,length=null==array?0:array.length,result=Array(length);while(++index<length)result[index]=iteratee(array[index],index,array);return result}function arrayPush(array,values){var index=-1,length=values.length,offset=array.length;while(++index<length)array[offset+index]=values[index];return array}function arrayReduce(array,iteratee,accumulator,initAccum){var index=-1,length=null==array?0:array.length;initAccum&&length&&(accumulator=array[++index]);while(++index<length)accumulator=iteratee(accumulator,array[index],index,array);return accumulator}function arrayReduceRight(array,iteratee,accumulator,initAccum){var length=null==array?0:array.length;initAccum&&length&&(accumulator=array[--length]);while(length--)accumulator=iteratee(accumulator,array[length],length,array);return accumulator}function arraySome(array,predicate){var index=-1,length=null==array?0:array.length;while(++index<length)if(predicate(array[index],index,array))return!0;return!1}var asciiSize=baseProperty("length");function asciiToArray(string){return string.split("")}function asciiWords(string){return string.match(reAsciiWord)||[]}function baseFindKey(collection,predicate,eachFunc){var result;return eachFunc(collection,function(value,key,collection){if(predicate(value,key,collection))return result=key,!1}),result}function baseFindIndex(array,predicate,fromIndex,fromRight){var length=array.length,index=fromIndex+(fromRight?1:-1);while(fromRight?index--:++index<length)if(predicate(array[index],index,array))return index;return-1}function baseIndexOf(array,value,fromIndex){return value===value?strictIndexOf(array,value,fromIndex):baseFindIndex(array,baseIsNaN,fromIndex)}function baseIndexOfWith(array,value,fromIndex,comparator){var index=fromIndex-1,length=array.length;while(++index<length)if(comparator(array[index],value))return index;return-1}function baseIsNaN(value){return value!==value}function baseMean(array,iteratee){var length=null==array?0:array.length;return length?baseSum(array,iteratee)/length:NAN}function baseProperty(key){return function(object){return null==object?undefined:object[key]}}function basePropertyOf(object){return function(key){return null==object?undefined:object[key]}}function baseReduce(collection,iteratee,accumulator,initAccum,eachFunc){return eachFunc(collection,function(value,index,collection){accumulator=initAccum?(initAccum=!1,value):iteratee(accumulator,value,index,collection)}),accumulator}function baseSortBy(array,comparer){var length=array.length;array.sort(comparer);while(length--)array[length]=array[length].value;return array}function baseSum(array,iteratee){var result,index=-1,length=array.length;while(++index<length){var current=iteratee(array[index]);current!==undefined&&(result=result===undefined?current:result+current)}return result}function baseTimes(n,iteratee){var index=-1,result=Array(n);while(++index<n)result[index]=iteratee(index);return result}function baseToPairs(object,props){return arrayMap(props,function(key){return[key,object[key]]})}function baseUnary(func){return function(value){return func(value)}}function baseValues(object,props){return arrayMap(props,function(key){return object[key]})}function cacheHas(cache,key){return cache.has(key)}function charsStartIndex(strSymbols,chrSymbols){var index=-1,length=strSymbols.length;while(++index<length&&baseIndexOf(chrSymbols,strSymbols[index],0)>-1);return index}function charsEndIndex(strSymbols,chrSymbols){var index=strSymbols.length;while(index--&&baseIndexOf(chrSymbols,strSymbols[index],0)>-1);return index}function countHolders(array,placeholder){var length=array.length,result=0;while(length--)array[length]===placeholder&&++result;return result}var deburrLetter=basePropertyOf(deburredLetters),escapeHtmlChar=basePropertyOf(htmlEscapes);function escapeStringChar(chr){return"\\"+stringEscapes[chr]}function getValue(object,key){return null==object?undefined:object[key]}function hasUnicode(string){return reHasUnicode.test(string)}function hasUnicodeWord(string){return reHasUnicodeWord.test(string)}function iteratorToArray(iterator){var data,result=[];while(!(data=iterator.next()).done)result.push(data.value);
return result}function mapToArray(map){var index=-1,result=Array(map.size);return map.forEach(function(value,key){result[++index]=[key,value]}),result}function overArg(func,transform){return function(arg){return func(transform(arg))}}function replaceHolders(array,placeholder){var index=-1,length=array.length,resIndex=0,result=[];while(++index<length){var value=array[index];value!==placeholder&&value!==PLACEHOLDER||(array[index]=PLACEHOLDER,result[resIndex++]=index)}return result}function safeGet(object,key){return"__proto__"==key?undefined:object[key]}function setToArray(set){var index=-1,result=Array(set.size);return set.forEach(function(value){result[++index]=value}),result}function setToPairs(set){var index=-1,result=Array(set.size);return set.forEach(function(value){result[++index]=[value,value]}),result}function strictIndexOf(array,value,fromIndex){var index=fromIndex-1,length=array.length;while(++index<length)if(array[index]===value)return index;return-1}function strictLastIndexOf(array,value,fromIndex){var index=fromIndex+1;while(index--)if(array[index]===value)return index;return index}function stringSize(string){return hasUnicode(string)?unicodeSize(string):asciiSize(string)}function stringToArray(string){return hasUnicode(string)?unicodeToArray(string):asciiToArray(string)}var unescapeHtmlChar=basePropertyOf(htmlUnescapes);function unicodeSize(string){var result=reUnicode.lastIndex=0;while(reUnicode.test(string))++result;return result}function unicodeToArray(string){return string.match(reUnicode)||[]}function unicodeWords(string){return string.match(reUnicodeWord)||[]}var runInContext=function runInContext(context){context=null==context?root:_.defaults(root.Object(),context,_.pick(root,contextProps));var Array=context.Array,Date=context.Date,Error=context.Error,Function=context.Function,Math=context.Math,Object=context.Object,RegExp=context.RegExp,String=context.String,TypeError=context.TypeError,arrayProto=Array.prototype,funcProto=Function.prototype,objectProto=Object.prototype,coreJsData=context["__core-js_shared__"],funcToString=funcProto.toString,hasOwnProperty=objectProto.hasOwnProperty,idCounter=0,maskSrcKey=function(){var uid=/[^.]+$/.exec(coreJsData&&coreJsData.keys&&coreJsData.keys.IE_PROTO||"");return uid?"Symbol(src)_1."+uid:""}(),nativeObjectToString=objectProto.toString,objectCtorString=funcToString.call(Object),oldDash=root._,reIsNative=RegExp("^"+funcToString.call(hasOwnProperty).replace(reRegExpChar,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Buffer=moduleExports?context.Buffer:undefined,Symbol=context.Symbol,Uint8Array=context.Uint8Array,allocUnsafe=Buffer?Buffer.allocUnsafe:undefined,getPrototype=overArg(Object.getPrototypeOf,Object),objectCreate=Object.create,propertyIsEnumerable=objectProto.propertyIsEnumerable,splice=arrayProto.splice,spreadableSymbol=Symbol?Symbol.isConcatSpreadable:undefined,symIterator=Symbol?Symbol.iterator:undefined,symToStringTag=Symbol?Symbol.toStringTag:undefined,defineProperty=function(){try{var func=getNative(Object,"defineProperty");return func({},"",{}),func}catch(e){}}(),ctxClearTimeout=context.clearTimeout!==root.clearTimeout&&context.clearTimeout,ctxNow=Date&&Date.now!==root.Date.now&&Date.now,ctxSetTimeout=context.setTimeout!==root.setTimeout&&context.setTimeout,nativeCeil=Math.ceil,nativeFloor=Math.floor,nativeGetSymbols=Object.getOwnPropertySymbols,nativeIsBuffer=Buffer?Buffer.isBuffer:undefined,nativeIsFinite=context.isFinite,nativeJoin=arrayProto.join,nativeKeys=overArg(Object.keys,Object),nativeMax=Math.max,nativeMin=Math.min,nativeNow=Date.now,nativeParseInt=context.parseInt,nativeRandom=Math.random,nativeReverse=arrayProto.reverse,DataView=getNative(context,"DataView"),Map=getNative(context,"Map"),Promise=getNative(context,"Promise"),Set=getNative(context,"Set"),WeakMap=getNative(context,"WeakMap"),nativeCreate=getNative(Object,"create"),metaMap=WeakMap&&new WeakMap,realNames={},dataViewCtorString=toSource(DataView),mapCtorString=toSource(Map),promiseCtorString=toSource(Promise),setCtorString=toSource(Set),weakMapCtorString=toSource(WeakMap),symbolProto=Symbol?Symbol.prototype:undefined,symbolValueOf=symbolProto?symbolProto.valueOf:undefined,symbolToString=symbolProto?symbolProto.toString:undefined;function lodash(value){if(isObjectLike(value)&&!isArray(value)&&!(value instanceof LazyWrapper)){if(value instanceof LodashWrapper)return value;if(hasOwnProperty.call(value,"__wrapped__"))return wrapperClone(value)}return new LodashWrapper(value)}var baseCreate=function(){function object(){}return function(proto){if(!isObject(proto))return{};if(objectCreate)return objectCreate(proto);object.prototype=proto;var result=new object;return object.prototype=undefined,result}}();function baseLodash(){}function LodashWrapper(value,chainAll){this.__wrapped__=value,this.__actions__=[],this.__chain__=!!chainAll,this.__index__=0,this.__values__=undefined}lodash.templateSettings={escape:reEscape,evaluate:reEvaluate,interpolate:reInterpolate,variable:"",imports:{_:lodash}},lodash.prototype=baseLodash.prototype,lodash.prototype.constructor=lodash,LodashWrapper.prototype=baseCreate(baseLodash.prototype),LodashWrapper.prototype.constructor=LodashWrapper;function LazyWrapper(value){this.__wrapped__=value,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=MAX_ARRAY_LENGTH,this.__views__=[]}function lazyClone(){var result=new LazyWrapper(this.__wrapped__);return result.__actions__=copyArray(this.__actions__),result.__dir__=this.__dir__,result.__filtered__=this.__filtered__,result.__iteratees__=copyArray(this.__iteratees__),result.__takeCount__=this.__takeCount__,result.__views__=copyArray(this.__views__),result}function lazyReverse(){if(this.__filtered__){var result=new LazyWrapper(this);result.__dir__=-1,result.__filtered__=!0}else result=this.clone(),result.__dir__*=-1;return result}function lazyValue(){var array=this.__wrapped__.value(),dir=this.__dir__,isArr=isArray(array),isRight=dir<0,arrLength=isArr?array.length:0,view=getView(0,arrLength,this.__views__),start=view.start,end=view.end,length=end-start,index=isRight?end:start-1,iteratees=this.__iteratees__,iterLength=iteratees.length,resIndex=0,takeCount=nativeMin(length,this.__takeCount__);if(!isArr||!isRight&&arrLength==length&&takeCount==length)return baseWrapperValue(array,this.__actions__);var result=[];outer:while(length--&&resIndex<takeCount){index+=dir;var iterIndex=-1,value=array[index];while(++iterIndex<iterLength){var data=iteratees[iterIndex],iteratee=data.iteratee,type=data.type,computed=iteratee(value);if(type==LAZY_MAP_FLAG)value=computed;else if(!computed){if(type==LAZY_FILTER_FLAG)continue outer;break outer}}result[resIndex++]=value}return result}LazyWrapper.prototype=baseCreate(baseLodash.prototype),LazyWrapper.prototype.constructor=LazyWrapper;function Hash(entries){var index=-1,length=null==entries?0:entries.length;this.clear();while(++index<length){var entry=entries[index];this.set(entry[0],entry[1])}}function hashClear(){this.__data__=nativeCreate?nativeCreate(null):{},this.size=0}function hashDelete(key){var result=this.has(key)&&delete this.__data__[key];return this.size-=result?1:0,result}function hashGet(key){var data=this.__data__;if(nativeCreate){var result=data[key];return result===HASH_UNDEFINED?undefined:result}return hasOwnProperty.call(data,key)?data[key]:undefined}function hashHas(key){var data=this.__data__;return nativeCreate?data[key]!==undefined:hasOwnProperty.call(data,key)}function hashSet(key,value){var data=this.__data__;return this.size+=this.has(key)?0:1,data[key]=nativeCreate&&value===undefined?HASH_UNDEFINED:value,this}Hash.prototype.clear=hashClear,Hash.prototype["delete"]=hashDelete,Hash.prototype.get=hashGet,Hash.prototype.has=hashHas,Hash.prototype.set=hashSet;function ListCache(entries){var index=-1,length=null==entries?0:entries.length;this.clear();while(++index<length){var entry=entries[index];this.set(entry[0],entry[1])}}function listCacheClear(){this.__data__=[],this.size=0}function listCacheDelete(key){var data=this.__data__,index=assocIndexOf(data,key);if(index<0)return!1;var lastIndex=data.length-1;return index==lastIndex?data.pop():splice.call(data,index,1),--this.size,!0}function listCacheGet(key){var data=this.__data__,index=assocIndexOf(data,key);return index<0?undefined:data[index][1]}function listCacheHas(key){return assocIndexOf(this.__data__,key)>-1}function listCacheSet(key,value){var data=this.__data__,index=assocIndexOf(data,key);return index<0?(++this.size,data.push([key,value])):data[index][1]=value,this}ListCache.prototype.clear=listCacheClear,ListCache.prototype["delete"]=listCacheDelete,ListCache.prototype.get=listCacheGet,ListCache.prototype.has=listCacheHas,ListCache.prototype.set=listCacheSet;function MapCache(entries){var index=-1,length=null==entries?0:entries.length;this.clear();while(++index<length){var entry=entries[index];this.set(entry[0],entry[1])}}function mapCacheClear(){this.size=0,this.__data__={hash:new Hash,map:new(Map||ListCache),string:new Hash}}function mapCacheDelete(key){var result=getMapData(this,key)["delete"](key);return this.size-=result?1:0,result}function mapCacheGet(key){return getMapData(this,key).get(key)}function mapCacheHas(key){return getMapData(this,key).has(key)}function mapCacheSet(key,value){var data=getMapData(this,key),size=data.size;return data.set(key,value),this.size+=data.size==size?0:1,this}MapCache.prototype.clear=mapCacheClear,MapCache.prototype["delete"]=mapCacheDelete,MapCache.prototype.get=mapCacheGet,MapCache.prototype.has=mapCacheHas,MapCache.prototype.set=mapCacheSet;function SetCache(values){var index=-1,length=null==values?0:values.length;this.__data__=new MapCache;while(++index<length)this.add(values[index])}function setCacheAdd(value){return this.__data__.set(value,HASH_UNDEFINED),this}function setCacheHas(value){return this.__data__.has(value)}SetCache.prototype.add=SetCache.prototype.push=setCacheAdd,SetCache.prototype.has=setCacheHas;function Stack(entries){var data=this.__data__=new ListCache(entries);this.size=data.size}function stackClear(){this.__data__=new ListCache,this.size=0}function stackDelete(key){var data=this.__data__,result=data["delete"](key);return this.size=data.size,result}function stackGet(key){return this.__data__.get(key)}function stackHas(key){return this.__data__.has(key)}function stackSet(key,value){var data=this.__data__;if(data instanceof ListCache){var pairs=data.__data__;if(!Map||pairs.length<LARGE_ARRAY_SIZE-1)return pairs.push([key,value]),this.size=++data.size,this;data=this.__data__=new MapCache(pairs)}return data.set(key,value),this.size=data.size,this}Stack.prototype.clear=stackClear,Stack.prototype["delete"]=stackDelete,Stack.prototype.get=stackGet,Stack.prototype.has=stackHas,Stack.prototype.set=stackSet;function arrayLikeKeys(value,inherited){var isArr=isArray(value),isArg=!isArr&&isArguments(value),isBuff=!isArr&&!isArg&&isBuffer(value),isType=!isArr&&!isArg&&!isBuff&&isTypedArray(value),skipIndexes=isArr||isArg||isBuff||isType,result=skipIndexes?baseTimes(value.length,String):[],length=result.length;for(var key in value)!inherited&&!hasOwnProperty.call(value,key)||skipIndexes&&("length"==key||isBuff&&("offset"==key||"parent"==key)||isType&&("buffer"==key||"byteLength"==key||"byteOffset"==key)||isIndex(key,length))||result.push(key);return result}function arraySample(array){var length=array.length;return length?array[baseRandom(0,length-1)]:undefined}function arraySampleSize(array,n){return shuffleSelf(copyArray(array),baseClamp(n,0,array.length))}function arrayShuffle(array){return shuffleSelf(copyArray(array))}function assignMergeValue(object,key,value){(value===undefined||eq(object[key],value))&&(value!==undefined||key in object)||baseAssignValue(object,key,value)}function assignValue(object,key,value){var objValue=object[key];hasOwnProperty.call(object,key)&&eq(objValue,value)&&(value!==undefined||key in object)||baseAssignValue(object,key,value)}function assocIndexOf(array,key){var length=array.length;while(length--)if(eq(array[length][0],key))return length;return-1}function baseAggregator(collection,setter,iteratee,accumulator){return baseEach(collection,function(value,key,collection){setter(accumulator,value,iteratee(value),collection)}),accumulator}function baseAssign(object,source){return object&&copyObject(source,keys(source),object)}function baseAssignIn(object,source){return object&&copyObject(source,keysIn(source),object)}function baseAssignValue(object,key,value){"__proto__"==key&&defineProperty?defineProperty(object,key,{configurable:!0,enumerable:!0,value:value,writable:!0}):object[key]=value}function baseAt(object,paths){var index=-1,length=paths.length,result=Array(length),skip=null==object;while(++index<length)result[index]=skip?undefined:get(object,paths[index]);return result}function baseClamp(number,lower,upper){return number===number&&(upper!==undefined&&(number=number<=upper?number:upper),lower!==undefined&&(number=number>=lower?number:lower)),number}function baseClone(value,bitmask,customizer,key,object,stack){var result,isDeep=bitmask&CLONE_DEEP_FLAG,isFlat=bitmask&CLONE_FLAT_FLAG,isFull=bitmask&CLONE_SYMBOLS_FLAG;if(customizer&&(result=object?customizer(value,key,object,stack):customizer(value)),result!==undefined)return result;if(!isObject(value))return value;var isArr=isArray(value);if(isArr){if(result=initCloneArray(value),!isDeep)return copyArray(value,result)}else{var tag=getTag(value),isFunc=tag==funcTag||tag==genTag;if(isBuffer(value))return cloneBuffer(value,isDeep);if(tag==objectTag||tag==argsTag||isFunc&&!object){if(result=isFlat||isFunc?{}:initCloneObject(value),!isDeep)return isFlat?copySymbolsIn(value,baseAssignIn(result,value)):copySymbols(value,baseAssign(result,value))}else{if(!cloneableTags[tag])return object?value:{};result=initCloneByTag(value,tag,isDeep)}}stack||(stack=new Stack);var stacked=stack.get(value);if(stacked)return stacked;if(stack.set(value,result),isSet(value))return value.forEach(function(subValue){result.add(baseClone(subValue,bitmask,customizer,subValue,value,stack))}),result;if(isMap(value))return value.forEach(function(subValue,key){result.set(key,baseClone(subValue,bitmask,customizer,key,value,stack))}),result;var keysFunc=isFull?isFlat?getAllKeysIn:getAllKeys:isFlat?keysIn:keys,props=isArr?undefined:keysFunc(value);return arrayEach(props||value,function(subValue,key){props&&(key=subValue,subValue=value[key]),assignValue(result,key,baseClone(subValue,bitmask,customizer,key,value,stack))}),result}function baseConforms(source){var props=keys(source);return function(object){return baseConformsTo(object,source,props)}}function baseConformsTo(object,source,props){var length=props.length;if(null==object)return!length;object=Object(object);while(length--){var key=props[length],predicate=source[key],value=object[key];if(value===undefined&&!(key in object)||!predicate(value))return!1}return!0}function baseDelay(func,wait,args){if("function"!=typeof func)throw new TypeError(FUNC_ERROR_TEXT);return setTimeout(function(){func.apply(undefined,args)},wait)}function baseDifference(array,values,iteratee,comparator){var index=-1,includes=arrayIncludes,isCommon=!0,length=array.length,result=[],valuesLength=values.length;if(!length)return result;iteratee&&(values=arrayMap(values,baseUnary(iteratee))),comparator?(includes=arrayIncludesWith,isCommon=!1):values.length>=LARGE_ARRAY_SIZE&&(includes=cacheHas,isCommon=!1,values=new SetCache(values));outer:while(++index<length){var value=array[index],computed=null==iteratee?value:iteratee(value);if(value=comparator||0!==value?value:0,isCommon&&computed===computed){var valuesIndex=valuesLength;while(valuesIndex--)if(values[valuesIndex]===computed)continue outer;result.push(value)}else includes(values,computed,comparator)||result.push(value)}return result}var baseEach=createBaseEach(baseForOwn),baseEachRight=createBaseEach(baseForOwnRight,!0);function baseEvery(collection,predicate){var result=!0;return baseEach(collection,function(value,index,collection){return result=!!predicate(value,index,collection),result}),result}function baseExtremum(array,iteratee,comparator){var index=-1,length=array.length;while(++index<length){var value=array[index],current=iteratee(value);if(null!=current&&(computed===undefined?current===current&&!isSymbol(current):comparator(current,computed)))var computed=current,result=value}return result}function baseFill(array,value,start,end){var length=array.length;start=toInteger(start),start<0&&(start=-start>length?0:length+start),end=end===undefined||end>length?length:toInteger(end),end<0&&(end+=length),end=start>end?0:toLength(end);while(start<end)array[start++]=value;return array}function baseFilter(collection,predicate){var result=[];return baseEach(collection,function(value,index,collection){predicate(value,index,collection)&&result.push(value)}),result}function baseFlatten(array,depth,predicate,isStrict,result){var index=-1,length=array.length;predicate||(predicate=isFlattenable),result||(result=[]);while(++index<length){var value=array[index];depth>0&&predicate(value)?depth>1?baseFlatten(value,depth-1,predicate,isStrict,result):arrayPush(result,value):isStrict||(result[result.length]=value)}return result}var baseFor=createBaseFor(),baseForRight=createBaseFor(!0);function baseForOwn(object,iteratee){return object&&baseFor(object,iteratee,keys)}function baseForOwnRight(object,iteratee){return object&&baseForRight(object,iteratee,keys)}function baseFunctions(object,props){return arrayFilter(props,function(key){return isFunction(object[key])})}function baseGet(object,path){path=castPath(path,object);var index=0,length=path.length;while(null!=object&&index<length)object=object[toKey(path[index++])];return index&&index==length?object:undefined}function baseGetAllKeys(object,keysFunc,symbolsFunc){var result=keysFunc(object);return isArray(object)?result:arrayPush(result,symbolsFunc(object))}function baseGetTag(value){return null==value?value===undefined?undefinedTag:nullTag:symToStringTag&&symToStringTag in Object(value)?getRawTag(value):objectToString(value)}function baseGt(value,other){return value>other}function baseHas(object,key){return null!=object&&hasOwnProperty.call(object,key)}function baseHasIn(object,key){return null!=object&&key in Object(object)}function baseInRange(number,start,end){return number>=nativeMin(start,end)&&number<nativeMax(start,end)}function baseIntersection(arrays,iteratee,comparator){var includes=comparator?arrayIncludesWith:arrayIncludes,length=arrays[0].length,othLength=arrays.length,othIndex=othLength,caches=Array(othLength),maxLength=1/0,result=[];while(othIndex--){var array=arrays[othIndex];othIndex&&iteratee&&(array=arrayMap(array,baseUnary(iteratee))),maxLength=nativeMin(array.length,maxLength),caches[othIndex]=!comparator&&(iteratee||length>=120&&array.length>=120)?new SetCache(othIndex&&array):undefined}array=arrays[0];var index=-1,seen=caches[0];outer:while(++index<length&&result.length<maxLength){var value=array[index],computed=iteratee?iteratee(value):value;if(value=comparator||0!==value?value:0,!(seen?cacheHas(seen,computed):includes(result,computed,comparator))){othIndex=othLength;while(--othIndex){var cache=caches[othIndex];if(!(cache?cacheHas(cache,computed):includes(arrays[othIndex],computed,comparator)))continue outer}seen&&seen.push(computed),result.push(value)}}return result}function baseInverter(object,setter,iteratee,accumulator){return baseForOwn(object,function(value,key,object){setter(accumulator,iteratee(value),key,object)}),accumulator}function baseInvoke(object,path,args){path=castPath(path,object),object=parent(object,path);var func=null==object?object:object[toKey(last(path))];return null==func?undefined:apply(func,object,args)}function baseIsArguments(value){return isObjectLike(value)&&baseGetTag(value)==argsTag}function baseIsArrayBuffer(value){return isObjectLike(value)&&baseGetTag(value)==arrayBufferTag}function baseIsDate(value){return isObjectLike(value)&&baseGetTag(value)==dateTag}function baseIsEqual(value,other,bitmask,customizer,stack){return value===other||(null==value||null==other||!isObjectLike(value)&&!isObjectLike(other)?value!==value&&other!==other:baseIsEqualDeep(value,other,bitmask,customizer,baseIsEqual,stack))}function baseIsEqualDeep(object,other,bitmask,customizer,equalFunc,stack){var objIsArr=isArray(object),othIsArr=isArray(other),objTag=objIsArr?arrayTag:getTag(object),othTag=othIsArr?arrayTag:getTag(other);objTag=objTag==argsTag?objectTag:objTag,othTag=othTag==argsTag?objectTag:othTag;var objIsObj=objTag==objectTag,othIsObj=othTag==objectTag,isSameTag=objTag==othTag;if(isSameTag&&isBuffer(object)){if(!isBuffer(other))return!1;objIsArr=!0,objIsObj=!1}if(isSameTag&&!objIsObj)return stack||(stack=new Stack),objIsArr||isTypedArray(object)?equalArrays(object,other,bitmask,customizer,equalFunc,stack):equalByTag(object,other,objTag,bitmask,customizer,equalFunc,stack);if(!(bitmask&COMPARE_PARTIAL_FLAG)){var objIsWrapped=objIsObj&&hasOwnProperty.call(object,"__wrapped__"),othIsWrapped=othIsObj&&hasOwnProperty.call(other,"__wrapped__");if(objIsWrapped||othIsWrapped){var objUnwrapped=objIsWrapped?object.value():object,othUnwrapped=othIsWrapped?other.value():other;return stack||(stack=new Stack),equalFunc(objUnwrapped,othUnwrapped,bitmask,customizer,stack)}}return!!isSameTag&&(stack||(stack=new Stack),equalObjects(object,other,bitmask,customizer,equalFunc,stack))}function baseIsMap(value){return isObjectLike(value)&&getTag(value)==mapTag}function baseIsMatch(object,source,matchData,customizer){var index=matchData.length,length=index,noCustomizer=!customizer;if(null==object)return!length;object=Object(object);while(index--){var data=matchData[index];if(noCustomizer&&data[2]?data[1]!==object[data[0]]:!(data[0]in object))return!1}while(++index<length){data=matchData[index];var key=data[0],objValue=object[key],srcValue=data[1];if(noCustomizer&&data[2]){if(objValue===undefined&&!(key in object))return!1}else{var stack=new Stack;if(customizer)var result=customizer(objValue,srcValue,key,object,source,stack);if(!(result===undefined?baseIsEqual(srcValue,objValue,COMPARE_PARTIAL_FLAG|COMPARE_UNORDERED_FLAG,customizer,stack):result))return!1}}return!0}function baseIsNative(value){if(!isObject(value)||isMasked(value))return!1;var pattern=isFunction(value)?reIsNative:reIsHostCtor;return pattern.test(toSource(value))}function baseIsRegExp(value){return isObjectLike(value)&&baseGetTag(value)==regexpTag}function baseIsSet(value){return isObjectLike(value)&&getTag(value)==setTag}function baseIsTypedArray(value){return isObjectLike(value)&&isLength(value.length)&&!!typedArrayTags[baseGetTag(value)]}function baseIteratee(value){return"function"==typeof value?value:null==value?identity:"object"==typeof value?isArray(value)?baseMatchesProperty(value[0],value[1]):baseMatches(value):property(value)}function baseKeys(object){if(!isPrototype(object))return nativeKeys(object);var result=[];for(var key in Object(object))hasOwnProperty.call(object,key)&&"constructor"!=key&&result.push(key);return result}function baseKeysIn(object){if(!isObject(object))return nativeKeysIn(object);var isProto=isPrototype(object),result=[];for(var key in object)("constructor"!=key||!isProto&&hasOwnProperty.call(object,key))&&result.push(key);return result}function baseLt(value,other){return value<other}function baseMap(collection,iteratee){var index=-1,result=isArrayLike(collection)?Array(collection.length):[];return baseEach(collection,function(value,key,collection){result[++index]=iteratee(value,key,collection)}),result}function baseMatches(source){var matchData=getMatchData(source);return 1==matchData.length&&matchData[0][2]?matchesStrictComparable(matchData[0][0],matchData[0][1]):function(object){return object===source||baseIsMatch(object,source,matchData)}}function baseMatchesProperty(path,srcValue){return isKey(path)&&isStrictComparable(srcValue)?matchesStrictComparable(toKey(path),srcValue):function(object){var objValue=get(object,path);return objValue===undefined&&objValue===srcValue?hasIn(object,path):baseIsEqual(srcValue,objValue,COMPARE_PARTIAL_FLAG|COMPARE_UNORDERED_FLAG)}}function baseMerge(object,source,srcIndex,customizer,stack){object!==source&&baseFor(source,function(srcValue,key){if(isObject(srcValue))stack||(stack=new Stack),baseMergeDeep(object,source,key,srcIndex,baseMerge,customizer,stack);else{var newValue=customizer?customizer(safeGet(object,key),srcValue,key+"",object,source,stack):undefined;newValue===undefined&&(newValue=srcValue),assignMergeValue(object,key,newValue)}},keysIn)}function baseMergeDeep(object,source,key,srcIndex,mergeFunc,customizer,stack){var objValue=safeGet(object,key),srcValue=safeGet(source,key),stacked=stack.get(srcValue);if(stacked)return assignMergeValue(object,key,stacked),void 0;var newValue=customizer?customizer(objValue,srcValue,key+"",object,source,stack):undefined,isCommon=newValue===undefined;if(isCommon){var isArr=isArray(srcValue),isBuff=!isArr&&isBuffer(srcValue),isTyped=!isArr&&!isBuff&&isTypedArray(srcValue);newValue=srcValue,isArr||isBuff||isTyped?isArray(objValue)?newValue=objValue:isArrayLikeObject(objValue)?newValue=copyArray(objValue):isBuff?(isCommon=!1,newValue=cloneBuffer(srcValue,!0)):isTyped?(isCommon=!1,newValue=cloneTypedArray(srcValue,!0)):newValue=[]:isPlainObject(srcValue)||isArguments(srcValue)?(newValue=objValue,isArguments(objValue)?newValue=toPlainObject(objValue):(!isObject(objValue)||srcIndex&&isFunction(objValue))&&(newValue=initCloneObject(srcValue))):isCommon=!1}isCommon&&(stack.set(srcValue,newValue),mergeFunc(newValue,srcValue,srcIndex,customizer,stack),stack["delete"](srcValue)),assignMergeValue(object,key,newValue)}function baseNth(array,n){var length=array.length;if(length)return n+=n<0?length:0,isIndex(n,length)?array[n]:undefined}function baseOrderBy(collection,iteratees,orders){var index=-1;iteratees=arrayMap(iteratees.length?iteratees:[identity],baseUnary(getIteratee()));var result=baseMap(collection,function(value){var criteria=arrayMap(iteratees,function(iteratee){return iteratee(value)});return{criteria:criteria,index:++index,value:value}});return baseSortBy(result,function(object,other){return compareMultiple(object,other,orders)})}function basePick(object,paths){return basePickBy(object,paths,function(value,path){return hasIn(object,path)})}function basePickBy(object,paths,predicate){var index=-1,length=paths.length,result={};while(++index<length){var path=paths[index],value=baseGet(object,path);predicate(value,path)&&baseSet(result,castPath(path,object),value)}return result}function basePropertyDeep(path){return function(object){return baseGet(object,path)}}function basePullAll(array,values,iteratee,comparator){var indexOf=comparator?baseIndexOfWith:baseIndexOf,index=-1,length=values.length,seen=array;array===values&&(values=copyArray(values)),iteratee&&(seen=arrayMap(array,baseUnary(iteratee)));while(++index<length){var fromIndex=0,value=values[index],computed=iteratee?iteratee(value):value;while((fromIndex=indexOf(seen,computed,fromIndex,comparator))>-1)seen!==array&&splice.call(seen,fromIndex,1),splice.call(array,fromIndex,1)}return array}function basePullAt(array,indexes){var length=array?indexes.length:0,lastIndex=length-1;while(length--){var index=indexes[length];if(length==lastIndex||index!==previous){var previous=index;isIndex(index)?splice.call(array,index,1):baseUnset(array,index)}}return array}function baseRandom(lower,upper){return lower+nativeFloor(nativeRandom()*(upper-lower+1))}function baseRange(start,end,step,fromRight){var index=-1,length=nativeMax(nativeCeil((end-start)/(step||1)),0),result=Array(length);while(length--)result[fromRight?length:++index]=start,start+=step;return result}function baseRepeat(string,n){var result="";if(!string||n<1||n>MAX_SAFE_INTEGER)return result;do n%2&&(result+=string),n=nativeFloor(n/2),n&&(string+=string);while(n);return result}function baseRest(func,start){return setToString(overRest(func,start,identity),func+"")}function baseSample(collection){return arraySample(values(collection))}function baseSampleSize(collection,n){var array=values(collection);return shuffleSelf(array,baseClamp(n,0,array.length))}function baseSet(object,path,value,customizer){if(!isObject(object))return object;path=castPath(path,object);var index=-1,length=path.length,lastIndex=length-1,nested=object;while(null!=nested&&++index<length){var key=toKey(path[index]),newValue=value;if(index!=lastIndex){var objValue=nested[key];newValue=customizer?customizer(objValue,key,nested):undefined,newValue===undefined&&(newValue=isObject(objValue)?objValue:isIndex(path[index+1])?[]:{})}assignValue(nested,key,newValue),nested=nested[key]}return object}var baseSetData=metaMap?function(func,data){return metaMap.set(func,data),func}:identity,baseSetToString=defineProperty?function(func,string){return defineProperty(func,"toString",{configurable:!0,enumerable:!1,value:constant(string),writable:!0})}:identity;function baseShuffle(collection){return shuffleSelf(values(collection))}function baseSlice(array,start,end){var index=-1,length=array.length;start<0&&(start=-start>length?0:length+start),end=end>length?length:end,end<0&&(end+=length),length=start>end?0:end-start>>>0,start>>>=0;var result=Array(length);while(++index<length)result[index]=array[index+start];return result}function baseSome(collection,predicate){var result;return baseEach(collection,function(value,index,collection){return result=predicate(value,index,collection),!result}),!!result}function baseSortedIndex(array,value,retHighest){var low=0,high=null==array?low:array.length;if("number"==typeof value&&value===value&&high<=HALF_MAX_ARRAY_LENGTH){while(low<high){var mid=low+high>>>1,computed=array[mid];null!==computed&&!isSymbol(computed)&&(retHighest?computed<=value:computed<value)?low=mid+1:high=mid}return high}return baseSortedIndexBy(array,value,identity,retHighest)}function baseSortedIndexBy(array,value,iteratee,retHighest){value=iteratee(value);var low=0,high=null==array?0:array.length,valIsNaN=value!==value,valIsNull=null===value,valIsSymbol=isSymbol(value),valIsUndefined=value===undefined;while(low<high){var mid=nativeFloor((low+high)/2),computed=iteratee(array[mid]),othIsDefined=computed!==undefined,othIsNull=null===computed,othIsReflexive=computed===computed,othIsSymbol=isSymbol(computed);if(valIsNaN)var setLow=retHighest||othIsReflexive;else setLow=valIsUndefined?othIsReflexive&&(retHighest||othIsDefined):valIsNull?othIsReflexive&&othIsDefined&&(retHighest||!othIsNull):valIsSymbol?othIsReflexive&&othIsDefined&&!othIsNull&&(retHighest||!othIsSymbol):!othIsNull&&!othIsSymbol&&(retHighest?computed<=value:computed<value);setLow?low=mid+1:high=mid}return nativeMin(high,MAX_ARRAY_INDEX)}function baseSortedUniq(array,iteratee){var index=-1,length=array.length,resIndex=0,result=[];while(++index<length){var value=array[index],computed=iteratee?iteratee(value):value;if(!index||!eq(computed,seen)){var seen=computed;result[resIndex++]=0===value?0:value}}return result}function baseToNumber(value){return"number"==typeof value?value:isSymbol(value)?NAN:+value}function baseToString(value){if("string"==typeof value)return value;if(isArray(value))return arrayMap(value,baseToString)+"";if(isSymbol(value))return symbolToString?symbolToString.call(value):"";var result=value+"";return"0"==result&&1/value==-INFINITY?"-0":result}function baseUniq(array,iteratee,comparator){var index=-1,includes=arrayIncludes,length=array.length,isCommon=!0,result=[],seen=result;if(comparator)isCommon=!1,includes=arrayIncludesWith;else if(length>=LARGE_ARRAY_SIZE){var set=iteratee?null:createSet(array);if(set)return setToArray(set);isCommon=!1,includes=cacheHas,seen=new SetCache}else seen=iteratee?[]:result;outer:while(++index<length){var value=array[index],computed=iteratee?iteratee(value):value;if(value=comparator||0!==value?value:0,isCommon&&computed===computed){
var seenIndex=seen.length;while(seenIndex--)if(seen[seenIndex]===computed)continue outer;iteratee&&seen.push(computed),result.push(value)}else includes(seen,computed,comparator)||(seen!==result&&seen.push(computed),result.push(value))}return result}function baseUnset(object,path){return path=castPath(path,object),object=parent(object,path),null==object||delete object[toKey(last(path))]}function baseUpdate(object,path,updater,customizer){return baseSet(object,path,updater(baseGet(object,path)),customizer)}function baseWhile(array,predicate,isDrop,fromRight){var length=array.length,index=fromRight?length:-1;while((fromRight?index--:++index<length)&&predicate(array[index],index,array));return isDrop?baseSlice(array,fromRight?0:index,fromRight?index+1:length):baseSlice(array,fromRight?index+1:0,fromRight?length:index)}function baseWrapperValue(value,actions){var result=value;return result instanceof LazyWrapper&&(result=result.value()),arrayReduce(actions,function(result,action){return action.func.apply(action.thisArg,arrayPush([result],action.args))},result)}function baseXor(arrays,iteratee,comparator){var length=arrays.length;if(length<2)return length?baseUniq(arrays[0]):[];var index=-1,result=Array(length);while(++index<length){var array=arrays[index],othIndex=-1;while(++othIndex<length)othIndex!=index&&(result[index]=baseDifference(result[index]||array,arrays[othIndex],iteratee,comparator))}return baseUniq(baseFlatten(result,1),iteratee,comparator)}function baseZipObject(props,values,assignFunc){var index=-1,length=props.length,valsLength=values.length,result={};while(++index<length){var value=index<valsLength?values[index]:undefined;assignFunc(result,props[index],value)}return result}function castArrayLikeObject(value){return isArrayLikeObject(value)?value:[]}function castFunction(value){return"function"==typeof value?value:identity}function castPath(value,object){return isArray(value)?value:isKey(value,object)?[value]:stringToPath(toString(value))}var castRest=baseRest;function castSlice(array,start,end){var length=array.length;return end=end===undefined?length:end,!start&&end>=length?array:baseSlice(array,start,end)}var clearTimeout=ctxClearTimeout||function(id){return root.clearTimeout(id)};function cloneBuffer(buffer,isDeep){if(isDeep)return buffer.slice();var length=buffer.length,result=allocUnsafe?allocUnsafe(length):new buffer.constructor(length);return buffer.copy(result),result}function cloneArrayBuffer(arrayBuffer){var result=new arrayBuffer.constructor(arrayBuffer.byteLength);return new Uint8Array(result).set(new Uint8Array(arrayBuffer)),result}function cloneDataView(dataView,isDeep){var buffer=isDeep?cloneArrayBuffer(dataView.buffer):dataView.buffer;return new dataView.constructor(buffer,dataView.byteOffset,dataView.byteLength)}function cloneRegExp(regexp){var result=new regexp.constructor(regexp.source,reFlags.exec(regexp));return result.lastIndex=regexp.lastIndex,result}function cloneSymbol(symbol){return symbolValueOf?Object(symbolValueOf.call(symbol)):{}}function cloneTypedArray(typedArray,isDeep){var buffer=isDeep?cloneArrayBuffer(typedArray.buffer):typedArray.buffer;return new typedArray.constructor(buffer,typedArray.byteOffset,typedArray.length)}function compareAscending(value,other){if(value!==other){var valIsDefined=value!==undefined,valIsNull=null===value,valIsReflexive=value===value,valIsSymbol=isSymbol(value),othIsDefined=other!==undefined,othIsNull=null===other,othIsReflexive=other===other,othIsSymbol=isSymbol(other);if(!othIsNull&&!othIsSymbol&&!valIsSymbol&&value>other||valIsSymbol&&othIsDefined&&othIsReflexive&&!othIsNull&&!othIsSymbol||valIsNull&&othIsDefined&&othIsReflexive||!valIsDefined&&othIsReflexive||!valIsReflexive)return 1;if(!valIsNull&&!valIsSymbol&&!othIsSymbol&&value<other||othIsSymbol&&valIsDefined&&valIsReflexive&&!valIsNull&&!valIsSymbol||othIsNull&&valIsDefined&&valIsReflexive||!othIsDefined&&valIsReflexive||!othIsReflexive)return-1}return 0}function compareMultiple(object,other,orders){var index=-1,objCriteria=object.criteria,othCriteria=other.criteria,length=objCriteria.length,ordersLength=orders.length;while(++index<length){var result=compareAscending(objCriteria[index],othCriteria[index]);if(result){if(index>=ordersLength)return result;var order=orders[index];return result*("desc"==order?-1:1)}}return object.index-other.index}function composeArgs(args,partials,holders,isCurried){var argsIndex=-1,argsLength=args.length,holdersLength=holders.length,leftIndex=-1,leftLength=partials.length,rangeLength=nativeMax(argsLength-holdersLength,0),result=Array(leftLength+rangeLength),isUncurried=!isCurried;while(++leftIndex<leftLength)result[leftIndex]=partials[leftIndex];while(++argsIndex<holdersLength)(isUncurried||argsIndex<argsLength)&&(result[holders[argsIndex]]=args[argsIndex]);while(rangeLength--)result[leftIndex++]=args[argsIndex++];return result}function composeArgsRight(args,partials,holders,isCurried){var argsIndex=-1,argsLength=args.length,holdersIndex=-1,holdersLength=holders.length,rightIndex=-1,rightLength=partials.length,rangeLength=nativeMax(argsLength-holdersLength,0),result=Array(rangeLength+rightLength),isUncurried=!isCurried;while(++argsIndex<rangeLength)result[argsIndex]=args[argsIndex];var offset=argsIndex;while(++rightIndex<rightLength)result[offset+rightIndex]=partials[rightIndex];while(++holdersIndex<holdersLength)(isUncurried||argsIndex<argsLength)&&(result[offset+holders[holdersIndex]]=args[argsIndex++]);return result}function copyArray(source,array){var index=-1,length=source.length;array||(array=Array(length));while(++index<length)array[index]=source[index];return array}function copyObject(source,props,object,customizer){var isNew=!object;object||(object={});var index=-1,length=props.length;while(++index<length){var key=props[index],newValue=customizer?customizer(object[key],source[key],key,object,source):undefined;newValue===undefined&&(newValue=source[key]),isNew?baseAssignValue(object,key,newValue):assignValue(object,key,newValue)}return object}function copySymbols(source,object){return copyObject(source,getSymbols(source),object)}function copySymbolsIn(source,object){return copyObject(source,getSymbolsIn(source),object)}function createAggregator(setter,initializer){return function(collection,iteratee){var func=isArray(collection)?arrayAggregator:baseAggregator,accumulator=initializer?initializer():{};return func(collection,setter,getIteratee(iteratee,2),accumulator)}}function createAssigner(assigner){return baseRest(function(object,sources){var index=-1,length=sources.length,customizer=length>1?sources[length-1]:undefined,guard=length>2?sources[2]:undefined;customizer=assigner.length>3&&"function"==typeof customizer?(length--,customizer):undefined,guard&&isIterateeCall(sources[0],sources[1],guard)&&(customizer=length<3?undefined:customizer,length=1),object=Object(object);while(++index<length){var source=sources[index];source&&assigner(object,source,index,customizer)}return object})}function createBaseEach(eachFunc,fromRight){return function(collection,iteratee){if(null==collection)return collection;if(!isArrayLike(collection))return eachFunc(collection,iteratee);var length=collection.length,index=fromRight?length:-1,iterable=Object(collection);while(fromRight?index--:++index<length)if(iteratee(iterable[index],index,iterable)===!1)break;return collection}}function createBaseFor(fromRight){return function(object,iteratee,keysFunc){var index=-1,iterable=Object(object),props=keysFunc(object),length=props.length;while(length--){var key=props[fromRight?length:++index];if(iteratee(iterable[key],key,iterable)===!1)break}return object}}function createBind(func,bitmask,thisArg){var isBind=bitmask&WRAP_BIND_FLAG,Ctor=createCtor(func);function wrapper(){var fn=this&&this!==root&&this instanceof wrapper?Ctor:func;return fn.apply(isBind?thisArg:this,arguments)}return wrapper}function createCaseFirst(methodName){return function(string){string=toString(string);var strSymbols=hasUnicode(string)?stringToArray(string):undefined,chr=strSymbols?strSymbols[0]:string.charAt(0),trailing=strSymbols?castSlice(strSymbols,1).join(""):string.slice(1);return chr[methodName]()+trailing}}function createCompounder(callback){return function(string){return arrayReduce(words(deburr(string).replace(reApos,"")),callback,"")}}function createCtor(Ctor){return function(){var args=arguments;switch(args.length){case 0:return new Ctor;case 1:return new Ctor(args[0]);case 2:return new Ctor(args[0],args[1]);case 3:return new Ctor(args[0],args[1],args[2]);case 4:return new Ctor(args[0],args[1],args[2],args[3]);case 5:return new Ctor(args[0],args[1],args[2],args[3],args[4]);case 6:return new Ctor(args[0],args[1],args[2],args[3],args[4],args[5]);case 7:return new Ctor(args[0],args[1],args[2],args[3],args[4],args[5],args[6])}var thisBinding=baseCreate(Ctor.prototype),result=Ctor.apply(thisBinding,args);return isObject(result)?result:thisBinding}}function createCurry(func,bitmask,arity){var Ctor=createCtor(func);function wrapper(){var length=arguments.length,args=Array(length),index=length,placeholder=getHolder(wrapper);while(index--)args[index]=arguments[index];var holders=length<3&&args[0]!==placeholder&&args[length-1]!==placeholder?[]:replaceHolders(args,placeholder);if(length-=holders.length,length<arity)return createRecurry(func,bitmask,createHybrid,wrapper.placeholder,undefined,args,holders,undefined,undefined,arity-length);var fn=this&&this!==root&&this instanceof wrapper?Ctor:func;return apply(fn,this,args)}return wrapper}function createFind(findIndexFunc){return function(collection,predicate,fromIndex){var iterable=Object(collection);if(!isArrayLike(collection)){var iteratee=getIteratee(predicate,3);collection=keys(collection),predicate=function(key){return iteratee(iterable[key],key,iterable)}}var index=findIndexFunc(collection,predicate,fromIndex);return index>-1?iterable[iteratee?collection[index]:index]:undefined}}function createFlow(fromRight){return flatRest(function(funcs){var length=funcs.length,index=length,prereq=LodashWrapper.prototype.thru;fromRight&&funcs.reverse();while(index--){var func=funcs[index];if("function"!=typeof func)throw new TypeError(FUNC_ERROR_TEXT);if(prereq&&!wrapper&&"wrapper"==getFuncName(func))var wrapper=new LodashWrapper([],!0)}index=wrapper?index:length;while(++index<length){func=funcs[index];var funcName=getFuncName(func),data="wrapper"==funcName?getData(func):undefined;wrapper=data&&isLaziable(data[0])&&data[1]==(WRAP_ARY_FLAG|WRAP_CURRY_FLAG|WRAP_PARTIAL_FLAG|WRAP_REARG_FLAG)&&!data[4].length&&1==data[9]?wrapper[getFuncName(data[0])].apply(wrapper,data[3]):1==func.length&&isLaziable(func)?wrapper[funcName]():wrapper.thru(func)}return function(){var args=arguments,value=args[0];if(wrapper&&1==args.length&&isArray(value))return wrapper.plant(value).value();var index=0,result=length?funcs[index].apply(this,args):value;while(++index<length)result=funcs[index].call(this,result);return result}})}function createHybrid(func,bitmask,thisArg,partials,holders,partialsRight,holdersRight,argPos,ary,arity){var isAry=bitmask&WRAP_ARY_FLAG,isBind=bitmask&WRAP_BIND_FLAG,isBindKey=bitmask&WRAP_BIND_KEY_FLAG,isCurried=bitmask&(WRAP_CURRY_FLAG|WRAP_CURRY_RIGHT_FLAG),isFlip=bitmask&WRAP_FLIP_FLAG,Ctor=isBindKey?undefined:createCtor(func);function wrapper(){var length=arguments.length,args=Array(length),index=length;while(index--)args[index]=arguments[index];if(isCurried)var placeholder=getHolder(wrapper),holdersCount=countHolders(args,placeholder);if(partials&&(args=composeArgs(args,partials,holders,isCurried)),partialsRight&&(args=composeArgsRight(args,partialsRight,holdersRight,isCurried)),length-=holdersCount,isCurried&&length<arity){var newHolders=replaceHolders(args,placeholder);return createRecurry(func,bitmask,createHybrid,wrapper.placeholder,thisArg,args,newHolders,argPos,ary,arity-length)}var thisBinding=isBind?thisArg:this,fn=isBindKey?thisBinding[func]:func;return length=args.length,argPos?args=reorder(args,argPos):isFlip&&length>1&&args.reverse(),isAry&&ary<length&&(args.length=ary),this&&this!==root&&this instanceof wrapper&&(fn=Ctor||createCtor(fn)),fn.apply(thisBinding,args)}return wrapper}function createInverter(setter,toIteratee){return function(object,iteratee){return baseInverter(object,setter,toIteratee(iteratee),{})}}function createMathOperation(operator,defaultValue){return function(value,other){var result;if(value===undefined&&other===undefined)return defaultValue;if(value!==undefined&&(result=value),other!==undefined){if(result===undefined)return other;"string"==typeof value||"string"==typeof other?(value=baseToString(value),other=baseToString(other)):(value=baseToNumber(value),other=baseToNumber(other)),result=operator(value,other)}return result}}function createOver(arrayFunc){return flatRest(function(iteratees){return iteratees=arrayMap(iteratees,baseUnary(getIteratee())),baseRest(function(args){var thisArg=this;return arrayFunc(iteratees,function(iteratee){return apply(iteratee,thisArg,args)})})})}function createPadding(length,chars){chars=chars===undefined?" ":baseToString(chars);var charsLength=chars.length;if(charsLength<2)return charsLength?baseRepeat(chars,length):chars;var result=baseRepeat(chars,nativeCeil(length/stringSize(chars)));return hasUnicode(chars)?castSlice(stringToArray(result),0,length).join(""):result.slice(0,length)}function createPartial(func,bitmask,thisArg,partials){var isBind=bitmask&WRAP_BIND_FLAG,Ctor=createCtor(func);function wrapper(){var argsIndex=-1,argsLength=arguments.length,leftIndex=-1,leftLength=partials.length,args=Array(leftLength+argsLength),fn=this&&this!==root&&this instanceof wrapper?Ctor:func;while(++leftIndex<leftLength)args[leftIndex]=partials[leftIndex];while(argsLength--)args[leftIndex++]=arguments[++argsIndex];return apply(fn,isBind?thisArg:this,args)}return wrapper}function createRange(fromRight){return function(start,end,step){return step&&"number"!=typeof step&&isIterateeCall(start,end,step)&&(end=step=undefined),start=toFinite(start),end===undefined?(end=start,start=0):end=toFinite(end),step=step===undefined?start<end?1:-1:toFinite(step),baseRange(start,end,step,fromRight)}}function createRelationalOperation(operator){return function(value,other){return"string"==typeof value&&"string"==typeof other||(value=toNumber(value),other=toNumber(other)),operator(value,other)}}function createRecurry(func,bitmask,wrapFunc,placeholder,thisArg,partials,holders,argPos,ary,arity){var isCurry=bitmask&WRAP_CURRY_FLAG,newHolders=isCurry?holders:undefined,newHoldersRight=isCurry?undefined:holders,newPartials=isCurry?partials:undefined,newPartialsRight=isCurry?undefined:partials;bitmask|=isCurry?WRAP_PARTIAL_FLAG:WRAP_PARTIAL_RIGHT_FLAG,bitmask&=~(isCurry?WRAP_PARTIAL_RIGHT_FLAG:WRAP_PARTIAL_FLAG),bitmask&WRAP_CURRY_BOUND_FLAG||(bitmask&=~(WRAP_BIND_FLAG|WRAP_BIND_KEY_FLAG));var newData=[func,bitmask,thisArg,newPartials,newHolders,newPartialsRight,newHoldersRight,argPos,ary,arity],result=wrapFunc.apply(undefined,newData);return isLaziable(func)&&setData(result,newData),result.placeholder=placeholder,setWrapToString(result,func,bitmask)}function createRound(methodName){var func=Math[methodName];return function(number,precision){if(number=toNumber(number),precision=null==precision?0:nativeMin(toInteger(precision),292),precision){var pair=(toString(number)+"e").split("e"),value=func(pair[0]+"e"+(+pair[1]+precision));return pair=(toString(value)+"e").split("e"),+(pair[0]+"e"+(+pair[1]-precision))}return func(number)}}var createSet=Set&&1/setToArray(new Set([,-0]))[1]==INFINITY?function(values){return new Set(values)}:noop;function createToPairs(keysFunc){return function(object){var tag=getTag(object);return tag==mapTag?mapToArray(object):tag==setTag?setToPairs(object):baseToPairs(object,keysFunc(object))}}function createWrap(func,bitmask,thisArg,partials,holders,argPos,ary,arity){var isBindKey=bitmask&WRAP_BIND_KEY_FLAG;if(!isBindKey&&"function"!=typeof func)throw new TypeError(FUNC_ERROR_TEXT);var length=partials?partials.length:0;if(length||(bitmask&=~(WRAP_PARTIAL_FLAG|WRAP_PARTIAL_RIGHT_FLAG),partials=holders=undefined),ary=ary===undefined?ary:nativeMax(toInteger(ary),0),arity=arity===undefined?arity:toInteger(arity),length-=holders?holders.length:0,bitmask&WRAP_PARTIAL_RIGHT_FLAG){var partialsRight=partials,holdersRight=holders;partials=holders=undefined}var data=isBindKey?undefined:getData(func),newData=[func,bitmask,thisArg,partials,holders,partialsRight,holdersRight,argPos,ary,arity];if(data&&mergeData(newData,data),func=newData[0],bitmask=newData[1],thisArg=newData[2],partials=newData[3],holders=newData[4],arity=newData[9]=newData[9]===undefined?isBindKey?0:func.length:nativeMax(newData[9]-length,0),!arity&&bitmask&(WRAP_CURRY_FLAG|WRAP_CURRY_RIGHT_FLAG)&&(bitmask&=~(WRAP_CURRY_FLAG|WRAP_CURRY_RIGHT_FLAG)),bitmask&&bitmask!=WRAP_BIND_FLAG)result=bitmask==WRAP_CURRY_FLAG||bitmask==WRAP_CURRY_RIGHT_FLAG?createCurry(func,bitmask,arity):bitmask!=WRAP_PARTIAL_FLAG&&bitmask!=(WRAP_BIND_FLAG|WRAP_PARTIAL_FLAG)||holders.length?createHybrid.apply(undefined,newData):createPartial(func,bitmask,thisArg,partials);else var result=createBind(func,bitmask,thisArg);var setter=data?baseSetData:setData;return setWrapToString(setter(result,newData),func,bitmask)}function customDefaultsAssignIn(objValue,srcValue,key,object){return objValue===undefined||eq(objValue,objectProto[key])&&!hasOwnProperty.call(object,key)?srcValue:objValue}function customDefaultsMerge(objValue,srcValue,key,object,source,stack){return isObject(objValue)&&isObject(srcValue)&&(stack.set(srcValue,objValue),baseMerge(objValue,srcValue,undefined,customDefaultsMerge,stack),stack["delete"](srcValue)),objValue}function customOmitClone(value){return isPlainObject(value)?undefined:value}function equalArrays(array,other,bitmask,customizer,equalFunc,stack){var isPartial=bitmask&COMPARE_PARTIAL_FLAG,arrLength=array.length,othLength=other.length;if(arrLength!=othLength&&!(isPartial&&othLength>arrLength))return!1;var stacked=stack.get(array);if(stacked&&stack.get(other))return stacked==other;var index=-1,result=!0,seen=bitmask&COMPARE_UNORDERED_FLAG?new SetCache:undefined;stack.set(array,other),stack.set(other,array);while(++index<arrLength){var arrValue=array[index],othValue=other[index];if(customizer)var compared=isPartial?customizer(othValue,arrValue,index,other,array,stack):customizer(arrValue,othValue,index,array,other,stack);if(compared!==undefined){if(compared)continue;result=!1;break}if(seen){if(!arraySome(other,function(othValue,othIndex){if(!cacheHas(seen,othIndex)&&(arrValue===othValue||equalFunc(arrValue,othValue,bitmask,customizer,stack)))return seen.push(othIndex)})){result=!1;break}}else if(arrValue!==othValue&&!equalFunc(arrValue,othValue,bitmask,customizer,stack)){result=!1;break}}return stack["delete"](array),stack["delete"](other),result}function equalByTag(object,other,tag,bitmask,customizer,equalFunc,stack){switch(tag){case dataViewTag:if(object.byteLength!=other.byteLength||object.byteOffset!=other.byteOffset)return!1;object=object.buffer,other=other.buffer;case arrayBufferTag:return!(object.byteLength!=other.byteLength||!equalFunc(new Uint8Array(object),new Uint8Array(other)));case boolTag:case dateTag:case numberTag:return eq(+object,+other);case errorTag:return object.name==other.name&&object.message==other.message;case regexpTag:case stringTag:return object==other+"";case mapTag:var convert=mapToArray;case setTag:var isPartial=bitmask&COMPARE_PARTIAL_FLAG;if(convert||(convert=setToArray),object.size!=other.size&&!isPartial)return!1;var stacked=stack.get(object);if(stacked)return stacked==other;bitmask|=COMPARE_UNORDERED_FLAG,stack.set(object,other);var result=equalArrays(convert(object),convert(other),bitmask,customizer,equalFunc,stack);return stack["delete"](object),result;case symbolTag:if(symbolValueOf)return symbolValueOf.call(object)==symbolValueOf.call(other)}return!1}function equalObjects(object,other,bitmask,customizer,equalFunc,stack){var isPartial=bitmask&COMPARE_PARTIAL_FLAG,objProps=getAllKeys(object),objLength=objProps.length,othProps=getAllKeys(other),othLength=othProps.length;if(objLength!=othLength&&!isPartial)return!1;var index=objLength;while(index--){var key=objProps[index];if(!(isPartial?key in other:hasOwnProperty.call(other,key)))return!1}var stacked=stack.get(object);if(stacked&&stack.get(other))return stacked==other;var result=!0;stack.set(object,other),stack.set(other,object);var skipCtor=isPartial;while(++index<objLength){key=objProps[index];var objValue=object[key],othValue=other[key];if(customizer)var compared=isPartial?customizer(othValue,objValue,key,other,object,stack):customizer(objValue,othValue,key,object,other,stack);if(!(compared===undefined?objValue===othValue||equalFunc(objValue,othValue,bitmask,customizer,stack):compared)){result=!1;break}skipCtor||(skipCtor="constructor"==key)}if(result&&!skipCtor){var objCtor=object.constructor,othCtor=other.constructor;objCtor!=othCtor&&"constructor"in object&&"constructor"in other&&!("function"==typeof objCtor&&objCtor instanceof objCtor&&"function"==typeof othCtor&&othCtor instanceof othCtor)&&(result=!1)}return stack["delete"](object),stack["delete"](other),result}function flatRest(func){return setToString(overRest(func,undefined,flatten),func+"")}function getAllKeys(object){return baseGetAllKeys(object,keys,getSymbols)}function getAllKeysIn(object){return baseGetAllKeys(object,keysIn,getSymbolsIn)}var getData=metaMap?function(func){return metaMap.get(func)}:noop;function getFuncName(func){var result=func.name+"",array=realNames[result],length=hasOwnProperty.call(realNames,result)?array.length:0;while(length--){var data=array[length],otherFunc=data.func;if(null==otherFunc||otherFunc==func)return data.name}return result}function getHolder(func){var object=hasOwnProperty.call(lodash,"placeholder")?lodash:func;return object.placeholder}function getIteratee(){var result=lodash.iteratee||iteratee;return result=result===iteratee?baseIteratee:result,arguments.length?result(arguments[0],arguments[1]):result}function getMapData(map,key){var data=map.__data__;return isKeyable(key)?data["string"==typeof key?"string":"hash"]:data.map}function getMatchData(object){var result=keys(object),length=result.length;while(length--){var key=result[length],value=object[key];result[length]=[key,value,isStrictComparable(value)]}return result}function getNative(object,key){var value=getValue(object,key);return baseIsNative(value)?value:undefined}function getRawTag(value){var isOwn=hasOwnProperty.call(value,symToStringTag),tag=value[symToStringTag];try{value[symToStringTag]=undefined;var unmasked=!0}catch(e){}var result=nativeObjectToString.call(value);return unmasked&&(isOwn?value[symToStringTag]=tag:delete value[symToStringTag]),result}var getSymbols=nativeGetSymbols?function(object){return null==object?[]:(object=Object(object),arrayFilter(nativeGetSymbols(object),function(symbol){return propertyIsEnumerable.call(object,symbol)}))}:stubArray,getSymbolsIn=nativeGetSymbols?function(object){var result=[];while(object)arrayPush(result,getSymbols(object)),object=getPrototype(object);return result}:stubArray,getTag=baseGetTag;(DataView&&getTag(new DataView(new ArrayBuffer(1)))!=dataViewTag||Map&&getTag(new Map)!=mapTag||Promise&&getTag(Promise.resolve())!=promiseTag||Set&&getTag(new Set)!=setTag||WeakMap&&getTag(new WeakMap)!=weakMapTag)&&(getTag=function(value){var result=baseGetTag(value),Ctor=result==objectTag?value.constructor:undefined,ctorString=Ctor?toSource(Ctor):"";if(ctorString)switch(ctorString){case dataViewCtorString:return dataViewTag;case mapCtorString:return mapTag;case promiseCtorString:return promiseTag;case setCtorString:return setTag;case weakMapCtorString:return weakMapTag}return result});function getView(start,end,transforms){var index=-1,length=transforms.length;while(++index<length){var data=transforms[index],size=data.size;switch(data.type){case"drop":start+=size;break;case"dropRight":end-=size;break;case"take":end=nativeMin(end,start+size);break;case"takeRight":start=nativeMax(start,end-size)}}return{start:start,end:end}}function getWrapDetails(source){var match=source.match(reWrapDetails);return match?match[1].split(reSplitDetails):[]}function hasPath(object,path,hasFunc){path=castPath(path,object);var index=-1,length=path.length,result=!1;while(++index<length){var key=toKey(path[index]);if(!(result=null!=object&&hasFunc(object,key)))break;object=object[key]}return result||++index!=length?result:(length=null==object?0:object.length,!!length&&isLength(length)&&isIndex(key,length)&&(isArray(object)||isArguments(object)))}function initCloneArray(array){var length=array.length,result=new array.constructor(length);return length&&"string"==typeof array[0]&&hasOwnProperty.call(array,"index")&&(result.index=array.index,result.input=array.input),result}function initCloneObject(object){return"function"!=typeof object.constructor||isPrototype(object)?{}:baseCreate(getPrototype(object))}function initCloneByTag(object,tag,isDeep){var Ctor=object.constructor;switch(tag){case arrayBufferTag:return cloneArrayBuffer(object);case boolTag:case dateTag:return new Ctor(+object);case dataViewTag:return cloneDataView(object,isDeep);case float32Tag:case float64Tag:case int8Tag:case int16Tag:case int32Tag:case uint8Tag:case uint8ClampedTag:case uint16Tag:case uint32Tag:return cloneTypedArray(object,isDeep);case mapTag:return new Ctor;case numberTag:case stringTag:return new Ctor(object);case regexpTag:return cloneRegExp(object);case setTag:return new Ctor;case symbolTag:return cloneSymbol(object)}}function insertWrapDetails(source,details){var length=details.length;if(!length)return source;var lastIndex=length-1;return details[lastIndex]=(length>1?"& ":"")+details[lastIndex],details=details.join(length>2?", ":" "),source.replace(reWrapComment,"{\n/* [wrapped with "+details+"] */\n")}function isFlattenable(value){return isArray(value)||isArguments(value)||!!(spreadableSymbol&&value&&value[spreadableSymbol])}function isIndex(value,length){var type=typeof value;return length=null==length?MAX_SAFE_INTEGER:length,!!length&&("number"==type||"symbol"!=type&&reIsUint.test(value))&&value>-1&&value%1==0&&value<length}function isIterateeCall(value,index,object){if(!isObject(object))return!1;var type=typeof index;return!!("number"==type?isArrayLike(object)&&isIndex(index,object.length):"string"==type&&index in object)&&eq(object[index],value)}function isKey(value,object){if(isArray(value))return!1;var type=typeof value;return!("number"!=type&&"symbol"!=type&&"boolean"!=type&&null!=value&&!isSymbol(value))||(reIsPlainProp.test(value)||!reIsDeepProp.test(value)||null!=object&&value in Object(object))}function isKeyable(value){var type=typeof value;return"string"==type||"number"==type||"symbol"==type||"boolean"==type?"__proto__"!==value:null===value}function isLaziable(func){var funcName=getFuncName(func),other=lodash[funcName];if("function"!=typeof other||!(funcName in LazyWrapper.prototype))return!1;if(func===other)return!0;var data=getData(other);return!!data&&func===data[0]}function isMasked(func){return!!maskSrcKey&&maskSrcKey in func}var isMaskable=coreJsData?isFunction:stubFalse;function isPrototype(value){var Ctor=value&&value.constructor,proto="function"==typeof Ctor&&Ctor.prototype||objectProto;return value===proto}function isStrictComparable(value){return value===value&&!isObject(value)}function matchesStrictComparable(key,srcValue){return function(object){return null!=object&&(object[key]===srcValue&&(srcValue!==undefined||key in Object(object)))}}function memoizeCapped(func){var result=memoize(func,function(key){return cache.size===MAX_MEMOIZE_SIZE&&cache.clear(),key}),cache=result.cache;return result}function mergeData(data,source){var bitmask=data[1],srcBitmask=source[1],newBitmask=bitmask|srcBitmask,isCommon=newBitmask<(WRAP_BIND_FLAG|WRAP_BIND_KEY_FLAG|WRAP_ARY_FLAG),isCombo=srcBitmask==WRAP_ARY_FLAG&&bitmask==WRAP_CURRY_FLAG||srcBitmask==WRAP_ARY_FLAG&&bitmask==WRAP_REARG_FLAG&&data[7].length<=source[8]||srcBitmask==(WRAP_ARY_FLAG|WRAP_REARG_FLAG)&&source[7].length<=source[8]&&bitmask==WRAP_CURRY_FLAG;if(!isCommon&&!isCombo)return data;srcBitmask&WRAP_BIND_FLAG&&(data[2]=source[2],newBitmask|=bitmask&WRAP_BIND_FLAG?0:WRAP_CURRY_BOUND_FLAG);var value=source[3];if(value){var partials=data[3];data[3]=partials?composeArgs(partials,value,source[4]):value,data[4]=partials?replaceHolders(data[3],PLACEHOLDER):source[4]}return value=source[5],value&&(partials=data[5],data[5]=partials?composeArgsRight(partials,value,source[6]):value,data[6]=partials?replaceHolders(data[5],PLACEHOLDER):source[6]),value=source[7],value&&(data[7]=value),srcBitmask&WRAP_ARY_FLAG&&(data[8]=null==data[8]?source[8]:nativeMin(data[8],source[8])),null==data[9]&&(data[9]=source[9]),data[0]=source[0],data[1]=newBitmask,data}function nativeKeysIn(object){var result=[];if(null!=object)for(var key in Object(object))result.push(key);return result}function objectToString(value){return nativeObjectToString.call(value)}function overRest(func,start,transform){return start=nativeMax(start===undefined?func.length-1:start,0),function(){var args=arguments,index=-1,length=nativeMax(args.length-start,0),array=Array(length);while(++index<length)array[index]=args[start+index];index=-1;var otherArgs=Array(start+1);while(++index<start)otherArgs[index]=args[index];return otherArgs[start]=transform(array),apply(func,this,otherArgs)}}function parent(object,path){return path.length<2?object:baseGet(object,baseSlice(path,0,-1))}function reorder(array,indexes){var arrLength=array.length,length=nativeMin(indexes.length,arrLength),oldArray=copyArray(array);while(length--){var index=indexes[length];array[length]=isIndex(index,arrLength)?oldArray[index]:undefined}return array}var setData=shortOut(baseSetData),setTimeout=ctxSetTimeout||function(func,wait){return root.setTimeout(func,wait)},setToString=shortOut(baseSetToString);function setWrapToString(wrapper,reference,bitmask){var source=reference+"";return setToString(wrapper,insertWrapDetails(source,updateWrapDetails(getWrapDetails(source),bitmask)))}function shortOut(func){var count=0,lastCalled=0;return function(){var stamp=nativeNow(),remaining=HOT_SPAN-(stamp-lastCalled);if(lastCalled=stamp,remaining>0){if(++count>=HOT_COUNT)return arguments[0]}else count=0;return func.apply(undefined,arguments)}}function shuffleSelf(array,size){var index=-1,length=array.length,lastIndex=length-1;size=size===undefined?length:size;while(++index<size){var rand=baseRandom(index,lastIndex),value=array[rand];array[rand]=array[index],array[index]=value}return array.length=size,array}var stringToPath=memoizeCapped(function(string){var result=[];return 46===string.charCodeAt(0)&&result.push(""),string.replace(rePropName,function(match,number,quote,subString){result.push(quote?subString.replace(reEscapeChar,"$1"):number||match)}),result});function toKey(value){if("string"==typeof value||isSymbol(value))return value;var result=value+"";return"0"==result&&1/value==-INFINITY?"-0":result}function toSource(func){if(null!=func){try{return funcToString.call(func)}catch(e){}try{return func+""}catch(e){}}return""}function updateWrapDetails(details,bitmask){return arrayEach(wrapFlags,function(pair){var value="_."+pair[0];bitmask&pair[1]&&!arrayIncludes(details,value)&&details.push(value)}),details.sort()}function wrapperClone(wrapper){if(wrapper instanceof LazyWrapper)return wrapper.clone();var result=new LodashWrapper(wrapper.__wrapped__,wrapper.__chain__);return result.__actions__=copyArray(wrapper.__actions__),result.__index__=wrapper.__index__,result.__values__=wrapper.__values__,result}function chunk(array,size,guard){size=(guard?isIterateeCall(array,size,guard):size===undefined)?1:nativeMax(toInteger(size),0);var length=null==array?0:array.length;if(!length||size<1)return[];var index=0,resIndex=0,result=Array(nativeCeil(length/size));while(index<length)result[resIndex++]=baseSlice(array,index,index+=size);
return result}function compact(array){var index=-1,length=null==array?0:array.length,resIndex=0,result=[];while(++index<length){var value=array[index];value&&(result[resIndex++]=value)}return result}function concat(){var length=arguments.length;if(!length)return[];var args=Array(length-1),array=arguments[0],index=length;while(index--)args[index-1]=arguments[index];return arrayPush(isArray(array)?copyArray(array):[array],baseFlatten(args,1))}var difference=baseRest(function(array,values){return isArrayLikeObject(array)?baseDifference(array,baseFlatten(values,1,isArrayLikeObject,!0)):[]}),differenceBy=baseRest(function(array,values){var iteratee=last(values);return isArrayLikeObject(iteratee)&&(iteratee=undefined),isArrayLikeObject(array)?baseDifference(array,baseFlatten(values,1,isArrayLikeObject,!0),getIteratee(iteratee,2)):[]}),differenceWith=baseRest(function(array,values){var comparator=last(values);return isArrayLikeObject(comparator)&&(comparator=undefined),isArrayLikeObject(array)?baseDifference(array,baseFlatten(values,1,isArrayLikeObject,!0),undefined,comparator):[]});function drop(array,n,guard){var length=null==array?0:array.length;return length?(n=guard||n===undefined?1:toInteger(n),baseSlice(array,n<0?0:n,length)):[]}function dropRight(array,n,guard){var length=null==array?0:array.length;return length?(n=guard||n===undefined?1:toInteger(n),n=length-n,baseSlice(array,0,n<0?0:n)):[]}function dropRightWhile(array,predicate){return array&&array.length?baseWhile(array,getIteratee(predicate,3),!0,!0):[]}function dropWhile(array,predicate){return array&&array.length?baseWhile(array,getIteratee(predicate,3),!0):[]}function fill(array,value,start,end){var length=null==array?0:array.length;return length?(start&&"number"!=typeof start&&isIterateeCall(array,value,start)&&(start=0,end=length),baseFill(array,value,start,end)):[]}function findIndex(array,predicate,fromIndex){var length=null==array?0:array.length;if(!length)return-1;var index=null==fromIndex?0:toInteger(fromIndex);return index<0&&(index=nativeMax(length+index,0)),baseFindIndex(array,getIteratee(predicate,3),index)}function findLastIndex(array,predicate,fromIndex){var length=null==array?0:array.length;if(!length)return-1;var index=length-1;return fromIndex!==undefined&&(index=toInteger(fromIndex),index=fromIndex<0?nativeMax(length+index,0):nativeMin(index,length-1)),baseFindIndex(array,getIteratee(predicate,3),index,!0)}function flatten(array){var length=null==array?0:array.length;return length?baseFlatten(array,1):[]}function flattenDeep(array){var length=null==array?0:array.length;return length?baseFlatten(array,INFINITY):[]}function flattenDepth(array,depth){var length=null==array?0:array.length;return length?(depth=depth===undefined?1:toInteger(depth),baseFlatten(array,depth)):[]}function fromPairs(pairs){var index=-1,length=null==pairs?0:pairs.length,result={};while(++index<length){var pair=pairs[index];result[pair[0]]=pair[1]}return result}function head(array){return array&&array.length?array[0]:undefined}function indexOf(array,value,fromIndex){var length=null==array?0:array.length;if(!length)return-1;var index=null==fromIndex?0:toInteger(fromIndex);return index<0&&(index=nativeMax(length+index,0)),baseIndexOf(array,value,index)}function initial(array){var length=null==array?0:array.length;return length?baseSlice(array,0,-1):[]}var intersection=baseRest(function(arrays){var mapped=arrayMap(arrays,castArrayLikeObject);return mapped.length&&mapped[0]===arrays[0]?baseIntersection(mapped):[]}),intersectionBy=baseRest(function(arrays){var iteratee=last(arrays),mapped=arrayMap(arrays,castArrayLikeObject);return iteratee===last(mapped)?iteratee=undefined:mapped.pop(),mapped.length&&mapped[0]===arrays[0]?baseIntersection(mapped,getIteratee(iteratee,2)):[]}),intersectionWith=baseRest(function(arrays){var comparator=last(arrays),mapped=arrayMap(arrays,castArrayLikeObject);return comparator="function"==typeof comparator?comparator:undefined,comparator&&mapped.pop(),mapped.length&&mapped[0]===arrays[0]?baseIntersection(mapped,undefined,comparator):[]});function join(array,separator){return null==array?"":nativeJoin.call(array,separator)}function last(array){var length=null==array?0:array.length;return length?array[length-1]:undefined}function lastIndexOf(array,value,fromIndex){var length=null==array?0:array.length;if(!length)return-1;var index=length;return fromIndex!==undefined&&(index=toInteger(fromIndex),index=index<0?nativeMax(length+index,0):nativeMin(index,length-1)),value===value?strictLastIndexOf(array,value,index):baseFindIndex(array,baseIsNaN,index,!0)}function nth(array,n){return array&&array.length?baseNth(array,toInteger(n)):undefined}var pull=baseRest(pullAll);function pullAll(array,values){return array&&array.length&&values&&values.length?basePullAll(array,values):array}function pullAllBy(array,values,iteratee){return array&&array.length&&values&&values.length?basePullAll(array,values,getIteratee(iteratee,2)):array}function pullAllWith(array,values,comparator){return array&&array.length&&values&&values.length?basePullAll(array,values,undefined,comparator):array}var pullAt=flatRest(function(array,indexes){var length=null==array?0:array.length,result=baseAt(array,indexes);return basePullAt(array,arrayMap(indexes,function(index){return isIndex(index,length)?+index:index}).sort(compareAscending)),result});function remove(array,predicate){var result=[];if(!array||!array.length)return result;var index=-1,indexes=[],length=array.length;predicate=getIteratee(predicate,3);while(++index<length){var value=array[index];predicate(value,index,array)&&(result.push(value),indexes.push(index))}return basePullAt(array,indexes),result}function reverse(array){return null==array?array:nativeReverse.call(array)}function slice(array,start,end){var length=null==array?0:array.length;return length?(end&&"number"!=typeof end&&isIterateeCall(array,start,end)?(start=0,end=length):(start=null==start?0:toInteger(start),end=end===undefined?length:toInteger(end)),baseSlice(array,start,end)):[]}function sortedIndex(array,value){return baseSortedIndex(array,value)}function sortedIndexBy(array,value,iteratee){return baseSortedIndexBy(array,value,getIteratee(iteratee,2))}function sortedIndexOf(array,value){var length=null==array?0:array.length;if(length){var index=baseSortedIndex(array,value);if(index<length&&eq(array[index],value))return index}return-1}function sortedLastIndex(array,value){return baseSortedIndex(array,value,!0)}function sortedLastIndexBy(array,value,iteratee){return baseSortedIndexBy(array,value,getIteratee(iteratee,2),!0)}function sortedLastIndexOf(array,value){var length=null==array?0:array.length;if(length){var index=baseSortedIndex(array,value,!0)-1;if(eq(array[index],value))return index}return-1}function sortedUniq(array){return array&&array.length?baseSortedUniq(array):[]}function sortedUniqBy(array,iteratee){return array&&array.length?baseSortedUniq(array,getIteratee(iteratee,2)):[]}function tail(array){var length=null==array?0:array.length;return length?baseSlice(array,1,length):[]}function take(array,n,guard){return array&&array.length?(n=guard||n===undefined?1:toInteger(n),baseSlice(array,0,n<0?0:n)):[]}function takeRight(array,n,guard){var length=null==array?0:array.length;return length?(n=guard||n===undefined?1:toInteger(n),n=length-n,baseSlice(array,n<0?0:n,length)):[]}function takeRightWhile(array,predicate){return array&&array.length?baseWhile(array,getIteratee(predicate,3),!1,!0):[]}function takeWhile(array,predicate){return array&&array.length?baseWhile(array,getIteratee(predicate,3)):[]}var union=baseRest(function(arrays){return baseUniq(baseFlatten(arrays,1,isArrayLikeObject,!0))}),unionBy=baseRest(function(arrays){var iteratee=last(arrays);return isArrayLikeObject(iteratee)&&(iteratee=undefined),baseUniq(baseFlatten(arrays,1,isArrayLikeObject,!0),getIteratee(iteratee,2))}),unionWith=baseRest(function(arrays){var comparator=last(arrays);return comparator="function"==typeof comparator?comparator:undefined,baseUniq(baseFlatten(arrays,1,isArrayLikeObject,!0),undefined,comparator)});function uniq(array){return array&&array.length?baseUniq(array):[]}function uniqBy(array,iteratee){return array&&array.length?baseUniq(array,getIteratee(iteratee,2)):[]}function uniqWith(array,comparator){return comparator="function"==typeof comparator?comparator:undefined,array&&array.length?baseUniq(array,undefined,comparator):[]}function unzip(array){if(!array||!array.length)return[];var length=0;return array=arrayFilter(array,function(group){if(isArrayLikeObject(group))return length=nativeMax(group.length,length),!0}),baseTimes(length,function(index){return arrayMap(array,baseProperty(index))})}function unzipWith(array,iteratee){if(!array||!array.length)return[];var result=unzip(array);return null==iteratee?result:arrayMap(result,function(group){return apply(iteratee,undefined,group)})}var without=baseRest(function(array,values){return isArrayLikeObject(array)?baseDifference(array,values):[]}),xor=baseRest(function(arrays){return baseXor(arrayFilter(arrays,isArrayLikeObject))}),xorBy=baseRest(function(arrays){var iteratee=last(arrays);return isArrayLikeObject(iteratee)&&(iteratee=undefined),baseXor(arrayFilter(arrays,isArrayLikeObject),getIteratee(iteratee,2))}),xorWith=baseRest(function(arrays){var comparator=last(arrays);return comparator="function"==typeof comparator?comparator:undefined,baseXor(arrayFilter(arrays,isArrayLikeObject),undefined,comparator)}),zip=baseRest(unzip);function zipObject(props,values){return baseZipObject(props||[],values||[],assignValue)}function zipObjectDeep(props,values){return baseZipObject(props||[],values||[],baseSet)}var zipWith=baseRest(function(arrays){var length=arrays.length,iteratee=length>1?arrays[length-1]:undefined;return iteratee="function"==typeof iteratee?(arrays.pop(),iteratee):undefined,unzipWith(arrays,iteratee)});function chain(value){var result=lodash(value);return result.__chain__=!0,result}function tap(value,interceptor){return interceptor(value),value}function thru(value,interceptor){return interceptor(value)}var wrapperAt=flatRest(function(paths){var length=paths.length,start=length?paths[0]:0,value=this.__wrapped__,interceptor=function(object){return baseAt(object,paths)};return!(length>1||this.__actions__.length)&&value instanceof LazyWrapper&&isIndex(start)?(value=value.slice(start,+start+(length?1:0)),value.__actions__.push({func:thru,args:[interceptor],thisArg:undefined}),new LodashWrapper(value,this.__chain__).thru(function(array){return length&&!array.length&&array.push(undefined),array})):this.thru(interceptor)});function wrapperChain(){return chain(this)}function wrapperCommit(){return new LodashWrapper(this.value(),this.__chain__)}function wrapperNext(){this.__values__===undefined&&(this.__values__=toArray(this.value()));var done=this.__index__>=this.__values__.length,value=done?undefined:this.__values__[this.__index__++];return{done:done,value:value}}function wrapperToIterator(){return this}function wrapperPlant(value){var result,parent=this;while(parent instanceof baseLodash){var clone=wrapperClone(parent);clone.__index__=0,clone.__values__=undefined,result?previous.__wrapped__=clone:result=clone;var previous=clone;parent=parent.__wrapped__}return previous.__wrapped__=value,result}function wrapperReverse(){var value=this.__wrapped__;if(value instanceof LazyWrapper){var wrapped=value;return this.__actions__.length&&(wrapped=new LazyWrapper(this)),wrapped=wrapped.reverse(),wrapped.__actions__.push({func:thru,args:[reverse],thisArg:undefined}),new LodashWrapper(wrapped,this.__chain__)}return this.thru(reverse)}function wrapperValue(){return baseWrapperValue(this.__wrapped__,this.__actions__)}var countBy=createAggregator(function(result,value,key){hasOwnProperty.call(result,key)?++result[key]:baseAssignValue(result,key,1)});function every(collection,predicate,guard){var func=isArray(collection)?arrayEvery:baseEvery;return guard&&isIterateeCall(collection,predicate,guard)&&(predicate=undefined),func(collection,getIteratee(predicate,3))}function filter(collection,predicate){var func=isArray(collection)?arrayFilter:baseFilter;return func(collection,getIteratee(predicate,3))}var find=createFind(findIndex),findLast=createFind(findLastIndex);function flatMap(collection,iteratee){return baseFlatten(map(collection,iteratee),1)}function flatMapDeep(collection,iteratee){return baseFlatten(map(collection,iteratee),INFINITY)}function flatMapDepth(collection,iteratee,depth){return depth=depth===undefined?1:toInteger(depth),baseFlatten(map(collection,iteratee),depth)}function forEach(collection,iteratee){var func=isArray(collection)?arrayEach:baseEach;return func(collection,getIteratee(iteratee,3))}function forEachRight(collection,iteratee){var func=isArray(collection)?arrayEachRight:baseEachRight;return func(collection,getIteratee(iteratee,3))}var groupBy=createAggregator(function(result,value,key){hasOwnProperty.call(result,key)?result[key].push(value):baseAssignValue(result,key,[value])});function includes(collection,value,fromIndex,guard){collection=isArrayLike(collection)?collection:values(collection),fromIndex=fromIndex&&!guard?toInteger(fromIndex):0;var length=collection.length;return fromIndex<0&&(fromIndex=nativeMax(length+fromIndex,0)),isString(collection)?fromIndex<=length&&collection.indexOf(value,fromIndex)>-1:!!length&&baseIndexOf(collection,value,fromIndex)>-1}var invokeMap=baseRest(function(collection,path,args){var index=-1,isFunc="function"==typeof path,result=isArrayLike(collection)?Array(collection.length):[];return baseEach(collection,function(value){result[++index]=isFunc?apply(path,value,args):baseInvoke(value,path,args)}),result}),keyBy=createAggregator(function(result,value,key){baseAssignValue(result,key,value)});function map(collection,iteratee){var func=isArray(collection)?arrayMap:baseMap;return func(collection,getIteratee(iteratee,3))}function orderBy(collection,iteratees,orders,guard){return null==collection?[]:(isArray(iteratees)||(iteratees=null==iteratees?[]:[iteratees]),orders=guard?undefined:orders,isArray(orders)||(orders=null==orders?[]:[orders]),baseOrderBy(collection,iteratees,orders))}var partition=createAggregator(function(result,value,key){result[key?0:1].push(value)},function(){return[[],[]]});function reduce(collection,iteratee,accumulator){var func=isArray(collection)?arrayReduce:baseReduce,initAccum=arguments.length<3;return func(collection,getIteratee(iteratee,4),accumulator,initAccum,baseEach)}function reduceRight(collection,iteratee,accumulator){var func=isArray(collection)?arrayReduceRight:baseReduce,initAccum=arguments.length<3;return func(collection,getIteratee(iteratee,4),accumulator,initAccum,baseEachRight)}function reject(collection,predicate){var func=isArray(collection)?arrayFilter:baseFilter;return func(collection,negate(getIteratee(predicate,3)))}function sample(collection){var func=isArray(collection)?arraySample:baseSample;return func(collection)}function sampleSize(collection,n,guard){n=(guard?isIterateeCall(collection,n,guard):n===undefined)?1:toInteger(n);var func=isArray(collection)?arraySampleSize:baseSampleSize;return func(collection,n)}function shuffle(collection){var func=isArray(collection)?arrayShuffle:baseShuffle;return func(collection)}function size(collection){if(null==collection)return 0;if(isArrayLike(collection))return isString(collection)?stringSize(collection):collection.length;var tag=getTag(collection);return tag==mapTag||tag==setTag?collection.size:baseKeys(collection).length}function some(collection,predicate,guard){var func=isArray(collection)?arraySome:baseSome;return guard&&isIterateeCall(collection,predicate,guard)&&(predicate=undefined),func(collection,getIteratee(predicate,3))}var sortBy=baseRest(function(collection,iteratees){if(null==collection)return[];var length=iteratees.length;return length>1&&isIterateeCall(collection,iteratees[0],iteratees[1])?iteratees=[]:length>2&&isIterateeCall(iteratees[0],iteratees[1],iteratees[2])&&(iteratees=[iteratees[0]]),baseOrderBy(collection,baseFlatten(iteratees,1),[])}),now=ctxNow||function(){return root.Date.now()};function after(n,func){if("function"!=typeof func)throw new TypeError(FUNC_ERROR_TEXT);return n=toInteger(n),function(){if(--n<1)return func.apply(this,arguments)}}function ary(func,n,guard){return n=guard?undefined:n,n=func&&null==n?func.length:n,createWrap(func,WRAP_ARY_FLAG,undefined,undefined,undefined,undefined,n)}function before(n,func){var result;if("function"!=typeof func)throw new TypeError(FUNC_ERROR_TEXT);return n=toInteger(n),function(){return--n>0&&(result=func.apply(this,arguments)),n<=1&&(func=undefined),result}}var bind=baseRest(function(func,thisArg,partials){var bitmask=WRAP_BIND_FLAG;if(partials.length){var holders=replaceHolders(partials,getHolder(bind));bitmask|=WRAP_PARTIAL_FLAG}return createWrap(func,bitmask,thisArg,partials,holders)}),bindKey=baseRest(function(object,key,partials){var bitmask=WRAP_BIND_FLAG|WRAP_BIND_KEY_FLAG;if(partials.length){var holders=replaceHolders(partials,getHolder(bindKey));bitmask|=WRAP_PARTIAL_FLAG}return createWrap(key,bitmask,object,partials,holders)});function curry(func,arity,guard){arity=guard?undefined:arity;var result=createWrap(func,WRAP_CURRY_FLAG,undefined,undefined,undefined,undefined,undefined,arity);return result.placeholder=curry.placeholder,result}function curryRight(func,arity,guard){arity=guard?undefined:arity;var result=createWrap(func,WRAP_CURRY_RIGHT_FLAG,undefined,undefined,undefined,undefined,undefined,arity);return result.placeholder=curryRight.placeholder,result}function debounce(func,wait,options){var lastArgs,lastThis,maxWait,result,timerId,lastCallTime,lastInvokeTime=0,leading=!1,maxing=!1,trailing=!0;if("function"!=typeof func)throw new TypeError(FUNC_ERROR_TEXT);wait=toNumber(wait)||0,isObject(options)&&(leading=!!options.leading,maxing="maxWait"in options,maxWait=maxing?nativeMax(toNumber(options.maxWait)||0,wait):maxWait,trailing="trailing"in options?!!options.trailing:trailing);function invokeFunc(time){var args=lastArgs,thisArg=lastThis;return lastArgs=lastThis=undefined,lastInvokeTime=time,result=func.apply(thisArg,args),result}function leadingEdge(time){return lastInvokeTime=time,timerId=setTimeout(timerExpired,wait),leading?invokeFunc(time):result}function remainingWait(time){var timeSinceLastCall=time-lastCallTime,timeSinceLastInvoke=time-lastInvokeTime,timeWaiting=wait-timeSinceLastCall;return maxing?nativeMin(timeWaiting,maxWait-timeSinceLastInvoke):timeWaiting}function shouldInvoke(time){var timeSinceLastCall=time-lastCallTime,timeSinceLastInvoke=time-lastInvokeTime;return lastCallTime===undefined||timeSinceLastCall>=wait||timeSinceLastCall<0||maxing&&timeSinceLastInvoke>=maxWait}function timerExpired(){var time=now();return shouldInvoke(time)?trailingEdge(time):(timerId=setTimeout(timerExpired,remainingWait(time)),void 0)}function trailingEdge(time){return timerId=undefined,trailing&&lastArgs?invokeFunc(time):(lastArgs=lastThis=undefined,result)}function cancel(){timerId!==undefined&&clearTimeout(timerId),lastInvokeTime=0,lastArgs=lastCallTime=lastThis=timerId=undefined}function flush(){return timerId===undefined?result:trailingEdge(now())}function debounced(){var time=now(),isInvoking=shouldInvoke(time);if(lastArgs=arguments,lastThis=this,lastCallTime=time,isInvoking){if(timerId===undefined)return leadingEdge(lastCallTime);if(maxing)return timerId=setTimeout(timerExpired,wait),invokeFunc(lastCallTime)}return timerId===undefined&&(timerId=setTimeout(timerExpired,wait)),result}return debounced.cancel=cancel,debounced.flush=flush,debounced}var defer=baseRest(function(func,args){return baseDelay(func,1,args)}),delay=baseRest(function(func,wait,args){return baseDelay(func,toNumber(wait)||0,args)});function flip(func){return createWrap(func,WRAP_FLIP_FLAG)}function memoize(func,resolver){if("function"!=typeof func||null!=resolver&&"function"!=typeof resolver)throw new TypeError(FUNC_ERROR_TEXT);var memoized=function(){var args=arguments,key=resolver?resolver.apply(this,args):args[0],cache=memoized.cache;if(cache.has(key))return cache.get(key);var result=func.apply(this,args);return memoized.cache=cache.set(key,result)||cache,result};return memoized.cache=new(memoize.Cache||MapCache),memoized}memoize.Cache=MapCache;function negate(predicate){if("function"!=typeof predicate)throw new TypeError(FUNC_ERROR_TEXT);return function(){var args=arguments;switch(args.length){case 0:return!predicate.call(this);case 1:return!predicate.call(this,args[0]);case 2:return!predicate.call(this,args[0],args[1]);case 3:return!predicate.call(this,args[0],args[1],args[2])}return!predicate.apply(this,args)}}function once(func){return before(2,func)}var overArgs=castRest(function(func,transforms){transforms=1==transforms.length&&isArray(transforms[0])?arrayMap(transforms[0],baseUnary(getIteratee())):arrayMap(baseFlatten(transforms,1),baseUnary(getIteratee()));var funcsLength=transforms.length;return baseRest(function(args){var index=-1,length=nativeMin(args.length,funcsLength);while(++index<length)args[index]=transforms[index].call(this,args[index]);return apply(func,this,args)})}),partial=baseRest(function(func,partials){var holders=replaceHolders(partials,getHolder(partial));return createWrap(func,WRAP_PARTIAL_FLAG,undefined,partials,holders)}),partialRight=baseRest(function(func,partials){var holders=replaceHolders(partials,getHolder(partialRight));return createWrap(func,WRAP_PARTIAL_RIGHT_FLAG,undefined,partials,holders)}),rearg=flatRest(function(func,indexes){return createWrap(func,WRAP_REARG_FLAG,undefined,undefined,undefined,indexes)});function rest(func,start){if("function"!=typeof func)throw new TypeError(FUNC_ERROR_TEXT);return start=start===undefined?start:toInteger(start),baseRest(func,start)}function spread(func,start){if("function"!=typeof func)throw new TypeError(FUNC_ERROR_TEXT);return start=null==start?0:nativeMax(toInteger(start),0),baseRest(function(args){var array=args[start],otherArgs=castSlice(args,0,start);return array&&arrayPush(otherArgs,array),apply(func,this,otherArgs)})}function throttle(func,wait,options){var leading=!0,trailing=!0;if("function"!=typeof func)throw new TypeError(FUNC_ERROR_TEXT);return isObject(options)&&(leading="leading"in options?!!options.leading:leading,trailing="trailing"in options?!!options.trailing:trailing),debounce(func,wait,{leading:leading,maxWait:wait,trailing:trailing})}function unary(func){return ary(func,1)}function wrap(value,wrapper){return partial(castFunction(wrapper),value)}function castArray(){if(!arguments.length)return[];var value=arguments[0];return isArray(value)?value:[value]}function clone(value){return baseClone(value,CLONE_SYMBOLS_FLAG)}function cloneWith(value,customizer){return customizer="function"==typeof customizer?customizer:undefined,baseClone(value,CLONE_SYMBOLS_FLAG,customizer)}function cloneDeep(value){return baseClone(value,CLONE_DEEP_FLAG|CLONE_SYMBOLS_FLAG)}function cloneDeepWith(value,customizer){return customizer="function"==typeof customizer?customizer:undefined,baseClone(value,CLONE_DEEP_FLAG|CLONE_SYMBOLS_FLAG,customizer)}function conformsTo(object,source){return null==source||baseConformsTo(object,source,keys(source))}function eq(value,other){return value===other||value!==value&&other!==other}var gt=createRelationalOperation(baseGt),gte=createRelationalOperation(function(value,other){return value>=other}),isArguments=baseIsArguments(function(){return arguments}())?baseIsArguments:function(value){return isObjectLike(value)&&hasOwnProperty.call(value,"callee")&&!propertyIsEnumerable.call(value,"callee")},isArray=Array.isArray,isArrayBuffer=nodeIsArrayBuffer?baseUnary(nodeIsArrayBuffer):baseIsArrayBuffer;function isArrayLike(value){return null!=value&&isLength(value.length)&&!isFunction(value)}function isArrayLikeObject(value){return isObjectLike(value)&&isArrayLike(value)}function isBoolean(value){return value===!0||value===!1||isObjectLike(value)&&baseGetTag(value)==boolTag}var isBuffer=nativeIsBuffer||stubFalse,isDate=nodeIsDate?baseUnary(nodeIsDate):baseIsDate;function isElement(value){return isObjectLike(value)&&1===value.nodeType&&!isPlainObject(value)}function isEmpty(value){if(null==value)return!0;if(isArrayLike(value)&&(isArray(value)||"string"==typeof value||"function"==typeof value.splice||isBuffer(value)||isTypedArray(value)||isArguments(value)))return!value.length;var tag=getTag(value);if(tag==mapTag||tag==setTag)return!value.size;if(isPrototype(value))return!baseKeys(value).length;for(var key in value)if(hasOwnProperty.call(value,key))return!1;return!0}function isEqual(value,other){return baseIsEqual(value,other)}function isEqualWith(value,other,customizer){customizer="function"==typeof customizer?customizer:undefined;var result=customizer?customizer(value,other):undefined;return result===undefined?baseIsEqual(value,other,undefined,customizer):!!result}function isError(value){if(!isObjectLike(value))return!1;var tag=baseGetTag(value);return tag==errorTag||tag==domExcTag||"string"==typeof value.message&&"string"==typeof value.name&&!isPlainObject(value)}function isFinite(value){return"number"==typeof value&&nativeIsFinite(value)}function isFunction(value){if(!isObject(value))return!1;var tag=baseGetTag(value);return tag==funcTag||tag==genTag||tag==asyncTag||tag==proxyTag}function isInteger(value){return"number"==typeof value&&value==toInteger(value)}function isLength(value){return"number"==typeof value&&value>-1&&value%1==0&&value<=MAX_SAFE_INTEGER}function isObject(value){var type=typeof value;return null!=value&&("object"==type||"function"==type)}function isObjectLike(value){return null!=value&&"object"==typeof value}var isMap=nodeIsMap?baseUnary(nodeIsMap):baseIsMap;function isMatch(object,source){return object===source||baseIsMatch(object,source,getMatchData(source))}function isMatchWith(object,source,customizer){return customizer="function"==typeof customizer?customizer:undefined,baseIsMatch(object,source,getMatchData(source),customizer)}function isNaN(value){return isNumber(value)&&value!=+value}function isNative(value){if(isMaskable(value))throw new Error(CORE_ERROR_TEXT);return baseIsNative(value)}function isNull(value){return null===value}function isNil(value){return null==value}function isNumber(value){return"number"==typeof value||isObjectLike(value)&&baseGetTag(value)==numberTag}function isPlainObject(value){if(!isObjectLike(value)||baseGetTag(value)!=objectTag)return!1;var proto=getPrototype(value);if(null===proto)return!0;var Ctor=hasOwnProperty.call(proto,"constructor")&&proto.constructor;return"function"==typeof Ctor&&Ctor instanceof Ctor&&funcToString.call(Ctor)==objectCtorString}var isRegExp=nodeIsRegExp?baseUnary(nodeIsRegExp):baseIsRegExp;function isSafeInteger(value){return isInteger(value)&&value>=-MAX_SAFE_INTEGER&&value<=MAX_SAFE_INTEGER}var isSet=nodeIsSet?baseUnary(nodeIsSet):baseIsSet;function isString(value){return"string"==typeof value||!isArray(value)&&isObjectLike(value)&&baseGetTag(value)==stringTag}function isSymbol(value){return"symbol"==typeof value||isObjectLike(value)&&baseGetTag(value)==symbolTag}var isTypedArray=nodeIsTypedArray?baseUnary(nodeIsTypedArray):baseIsTypedArray;function isUndefined(value){return value===undefined}function isWeakMap(value){return isObjectLike(value)&&getTag(value)==weakMapTag}function isWeakSet(value){return isObjectLike(value)&&baseGetTag(value)==weakSetTag}var lt=createRelationalOperation(baseLt),lte=createRelationalOperation(function(value,other){return value<=other});function toArray(value){if(!value)return[];if(isArrayLike(value))return isString(value)?stringToArray(value):copyArray(value);if(symIterator&&value[symIterator])return iteratorToArray(value[symIterator]());var tag=getTag(value),func=tag==mapTag?mapToArray:tag==setTag?setToArray:values;return func(value)}function toFinite(value){if(!value)return 0===value?value:0;if(value=toNumber(value),value===INFINITY||value===-INFINITY){var sign=value<0?-1:1;return sign*MAX_INTEGER}return value===value?value:0}function toInteger(value){var result=toFinite(value),remainder=result%1;return result===result?remainder?result-remainder:result:0}function toLength(value){return value?baseClamp(toInteger(value),0,MAX_ARRAY_LENGTH):0}function toNumber(value){if("number"==typeof value)return value;if(isSymbol(value))return NAN;if(isObject(value)){var other="function"==typeof value.valueOf?value.valueOf():value;value=isObject(other)?other+"":other}if("string"!=typeof value)return 0===value?value:+value;value=value.replace(reTrim,"");var isBinary=reIsBinary.test(value);return isBinary||reIsOctal.test(value)?freeParseInt(value.slice(2),isBinary?2:8):reIsBadHex.test(value)?NAN:+value}function toPlainObject(value){return copyObject(value,keysIn(value))}function toSafeInteger(value){return value?baseClamp(toInteger(value),-MAX_SAFE_INTEGER,MAX_SAFE_INTEGER):0===value?value:0}function toString(value){return null==value?"":baseToString(value)}var assign=createAssigner(function(object,source){if(isPrototype(source)||isArrayLike(source))return copyObject(source,keys(source),object),void 0;for(var key in source)hasOwnProperty.call(source,key)&&assignValue(object,key,source[key])}),assignIn=createAssigner(function(object,source){copyObject(source,keysIn(source),object)}),assignInWith=createAssigner(function(object,source,srcIndex,customizer){copyObject(source,keysIn(source),object,customizer)}),assignWith=createAssigner(function(object,source,srcIndex,customizer){copyObject(source,keys(source),object,customizer)}),at=flatRest(baseAt);function create(prototype,properties){var result=baseCreate(prototype);return null==properties?result:baseAssign(result,properties)}var defaults=baseRest(function(object,sources){object=Object(object);var index=-1,length=sources.length,guard=length>2?sources[2]:undefined;guard&&isIterateeCall(sources[0],sources[1],guard)&&(length=1);while(++index<length){var source=sources[index],props=keysIn(source),propsIndex=-1,propsLength=props.length;while(++propsIndex<propsLength){var key=props[propsIndex],value=object[key];(value===undefined||eq(value,objectProto[key])&&!hasOwnProperty.call(object,key))&&(object[key]=source[key])}}return object}),defaultsDeep=baseRest(function(args){return args.push(undefined,customDefaultsMerge),apply(mergeWith,undefined,args)});function findKey(object,predicate){return baseFindKey(object,getIteratee(predicate,3),baseForOwn)}function findLastKey(object,predicate){return baseFindKey(object,getIteratee(predicate,3),baseForOwnRight)}function forIn(object,iteratee){return null==object?object:baseFor(object,getIteratee(iteratee,3),keysIn)}function forInRight(object,iteratee){return null==object?object:baseForRight(object,getIteratee(iteratee,3),keysIn)}function forOwn(object,iteratee){return object&&baseForOwn(object,getIteratee(iteratee,3))}function forOwnRight(object,iteratee){return object&&baseForOwnRight(object,getIteratee(iteratee,3))}function functions(object){return null==object?[]:baseFunctions(object,keys(object))}function functionsIn(object){return null==object?[]:baseFunctions(object,keysIn(object))}function get(object,path,defaultValue){var result=null==object?undefined:baseGet(object,path);return result===undefined?defaultValue:result}function has(object,path){return null!=object&&hasPath(object,path,baseHas)}function hasIn(object,path){return null!=object&&hasPath(object,path,baseHasIn)}var invert=createInverter(function(result,value,key){null!=value&&"function"!=typeof value.toString&&(value=nativeObjectToString.call(value)),result[value]=key},constant(identity)),invertBy=createInverter(function(result,value,key){null!=value&&"function"!=typeof value.toString&&(value=nativeObjectToString.call(value)),hasOwnProperty.call(result,value)?result[value].push(key):result[value]=[key]},getIteratee),invoke=baseRest(baseInvoke);function keys(object){return isArrayLike(object)?arrayLikeKeys(object):baseKeys(object)}function keysIn(object){
return isArrayLike(object)?arrayLikeKeys(object,!0):baseKeysIn(object)}function mapKeys(object,iteratee){var result={};return iteratee=getIteratee(iteratee,3),baseForOwn(object,function(value,key,object){baseAssignValue(result,iteratee(value,key,object),value)}),result}function mapValues(object,iteratee){var result={};return iteratee=getIteratee(iteratee,3),baseForOwn(object,function(value,key,object){baseAssignValue(result,key,iteratee(value,key,object))}),result}var merge=createAssigner(function(object,source,srcIndex){baseMerge(object,source,srcIndex)}),mergeWith=createAssigner(function(object,source,srcIndex,customizer){baseMerge(object,source,srcIndex,customizer)}),omit=flatRest(function(object,paths){var result={};if(null==object)return result;var isDeep=!1;paths=arrayMap(paths,function(path){return path=castPath(path,object),isDeep||(isDeep=path.length>1),path}),copyObject(object,getAllKeysIn(object),result),isDeep&&(result=baseClone(result,CLONE_DEEP_FLAG|CLONE_FLAT_FLAG|CLONE_SYMBOLS_FLAG,customOmitClone));var length=paths.length;while(length--)baseUnset(result,paths[length]);return result});function omitBy(object,predicate){return pickBy(object,negate(getIteratee(predicate)))}var pick=flatRest(function(object,paths){return null==object?{}:basePick(object,paths)});function pickBy(object,predicate){if(null==object)return{};var props=arrayMap(getAllKeysIn(object),function(prop){return[prop]});return predicate=getIteratee(predicate),basePickBy(object,props,function(value,path){return predicate(value,path[0])})}function result(object,path,defaultValue){path=castPath(path,object);var index=-1,length=path.length;length||(length=1,object=undefined);while(++index<length){var value=null==object?undefined:object[toKey(path[index])];value===undefined&&(index=length,value=defaultValue),object=isFunction(value)?value.call(object):value}return object}function set(object,path,value){return null==object?object:baseSet(object,path,value)}function setWith(object,path,value,customizer){return customizer="function"==typeof customizer?customizer:undefined,null==object?object:baseSet(object,path,value,customizer)}var toPairs=createToPairs(keys),toPairsIn=createToPairs(keysIn);function transform(object,iteratee,accumulator){var isArr=isArray(object),isArrLike=isArr||isBuffer(object)||isTypedArray(object);if(iteratee=getIteratee(iteratee,4),null==accumulator){var Ctor=object&&object.constructor;accumulator=isArrLike?isArr?new Ctor:[]:isObject(object)&&isFunction(Ctor)?baseCreate(getPrototype(object)):{}}return(isArrLike?arrayEach:baseForOwn)(object,function(value,index,object){return iteratee(accumulator,value,index,object)}),accumulator}function unset(object,path){return null==object||baseUnset(object,path)}function update(object,path,updater){return null==object?object:baseUpdate(object,path,castFunction(updater))}function updateWith(object,path,updater,customizer){return customizer="function"==typeof customizer?customizer:undefined,null==object?object:baseUpdate(object,path,castFunction(updater),customizer)}function values(object){return null==object?[]:baseValues(object,keys(object))}function valuesIn(object){return null==object?[]:baseValues(object,keysIn(object))}function clamp(number,lower,upper){return upper===undefined&&(upper=lower,lower=undefined),upper!==undefined&&(upper=toNumber(upper),upper=upper===upper?upper:0),lower!==undefined&&(lower=toNumber(lower),lower=lower===lower?lower:0),baseClamp(toNumber(number),lower,upper)}function inRange(number,start,end){return start=toFinite(start),end===undefined?(end=start,start=0):end=toFinite(end),number=toNumber(number),baseInRange(number,start,end)}function random(lower,upper,floating){if(floating&&"boolean"!=typeof floating&&isIterateeCall(lower,upper,floating)&&(upper=floating=undefined),floating===undefined&&("boolean"==typeof upper?(floating=upper,upper=undefined):"boolean"==typeof lower&&(floating=lower,lower=undefined)),lower===undefined&&upper===undefined?(lower=0,upper=1):(lower=toFinite(lower),upper===undefined?(upper=lower,lower=0):upper=toFinite(upper)),lower>upper){var temp=lower;lower=upper,upper=temp}if(floating||lower%1||upper%1){var rand=nativeRandom();return nativeMin(lower+rand*(upper-lower+freeParseFloat("1e-"+((rand+"").length-1))),upper)}return baseRandom(lower,upper)}var camelCase=createCompounder(function(result,word,index){return word=word.toLowerCase(),result+(index?capitalize(word):word)});function capitalize(string){return upperFirst(toString(string).toLowerCase())}function deburr(string){return string=toString(string),string&&string.replace(reLatin,deburrLetter).replace(reComboMark,"")}function endsWith(string,target,position){string=toString(string),target=baseToString(target);var length=string.length;position=position===undefined?length:baseClamp(toInteger(position),0,length);var end=position;return position-=target.length,position>=0&&string.slice(position,end)==target}function escape(string){return string=toString(string),string&&reHasUnescapedHtml.test(string)?string.replace(reUnescapedHtml,escapeHtmlChar):string}function escapeRegExp(string){return string=toString(string),string&&reHasRegExpChar.test(string)?string.replace(reRegExpChar,"\\$&"):string}var kebabCase=createCompounder(function(result,word,index){return result+(index?"-":"")+word.toLowerCase()}),lowerCase=createCompounder(function(result,word,index){return result+(index?" ":"")+word.toLowerCase()}),lowerFirst=createCaseFirst("toLowerCase");function pad(string,length,chars){string=toString(string),length=toInteger(length);var strLength=length?stringSize(string):0;if(!length||strLength>=length)return string;var mid=(length-strLength)/2;return createPadding(nativeFloor(mid),chars)+string+createPadding(nativeCeil(mid),chars)}function padEnd(string,length,chars){string=toString(string),length=toInteger(length);var strLength=length?stringSize(string):0;return length&&strLength<length?string+createPadding(length-strLength,chars):string}function padStart(string,length,chars){string=toString(string),length=toInteger(length);var strLength=length?stringSize(string):0;return length&&strLength<length?createPadding(length-strLength,chars)+string:string}function parseInt(string,radix,guard){return guard||null==radix?radix=0:radix&&(radix=+radix),nativeParseInt(toString(string).replace(reTrimStart,""),radix||0)}function repeat(string,n,guard){return n=(guard?isIterateeCall(string,n,guard):n===undefined)?1:toInteger(n),baseRepeat(toString(string),n)}function replace(){var args=arguments,string=toString(args[0]);return args.length<3?string:string.replace(args[1],args[2])}var snakeCase=createCompounder(function(result,word,index){return result+(index?"_":"")+word.toLowerCase()});function split(string,separator,limit){return limit&&"number"!=typeof limit&&isIterateeCall(string,separator,limit)&&(separator=limit=undefined),limit=limit===undefined?MAX_ARRAY_LENGTH:limit>>>0,limit?(string=toString(string),string&&("string"==typeof separator||null!=separator&&!isRegExp(separator))&&(separator=baseToString(separator),!separator&&hasUnicode(string))?castSlice(stringToArray(string),0,limit):string.split(separator,limit)):[]}var startCase=createCompounder(function(result,word,index){return result+(index?" ":"")+upperFirst(word)});function startsWith(string,target,position){return string=toString(string),position=null==position?0:baseClamp(toInteger(position),0,string.length),target=baseToString(target),string.slice(position,position+target.length)==target}function template(string,options,guard){var settings=lodash.templateSettings;guard&&isIterateeCall(string,options,guard)&&(options=undefined),string=toString(string),options=assignInWith({},options,settings,customDefaultsAssignIn);var isEscaping,isEvaluating,imports=assignInWith({},options.imports,settings.imports,customDefaultsAssignIn),importsKeys=keys(imports),importsValues=baseValues(imports,importsKeys),index=0,interpolate=options.interpolate||reNoMatch,source="__p += '",reDelimiters=RegExp((options.escape||reNoMatch).source+"|"+interpolate.source+"|"+(interpolate===reInterpolate?reEsTemplate:reNoMatch).source+"|"+(options.evaluate||reNoMatch).source+"|$","g"),sourceURL="//# sourceURL="+("sourceURL"in options?options.sourceURL:"lodash.templateSources["+ ++templateCounter+"]")+"\n";string.replace(reDelimiters,function(match,escapeValue,interpolateValue,esTemplateValue,evaluateValue,offset){return interpolateValue||(interpolateValue=esTemplateValue),source+=string.slice(index,offset).replace(reUnescapedString,escapeStringChar),escapeValue&&(isEscaping=!0,source+="' +\n__e("+escapeValue+") +\n'"),evaluateValue&&(isEvaluating=!0,source+="';\n"+evaluateValue+";\n__p += '"),interpolateValue&&(source+="' +\n((__t = ("+interpolateValue+")) == null ? '' : __t) +\n'"),index=offset+match.length,match}),source+="';\n";var variable=options.variable;variable||(source="with (obj) {\n"+source+"\n}\n"),source=(isEvaluating?source.replace(reEmptyStringLeading,""):source).replace(reEmptyStringMiddle,"$1").replace(reEmptyStringTrailing,"$1;"),source="function("+(variable||"obj")+") {\n"+(variable?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(isEscaping?", __e = _.escape":"")+(isEvaluating?", __j = Array.prototype.join;\n"+"function print() { __p += __j.call(arguments, '') }\n":";\n")+source+"return __p\n}";var result=attempt(function(){return Function(importsKeys,sourceURL+"return "+source).apply(undefined,importsValues)});if(result.source=source,isError(result))throw result;return result}function toLower(value){return toString(value).toLowerCase()}function toUpper(value){return toString(value).toUpperCase()}function trim(string,chars,guard){if(string=toString(string),string&&(guard||chars===undefined))return string.replace(reTrim,"");if(!string||!(chars=baseToString(chars)))return string;var strSymbols=stringToArray(string),chrSymbols=stringToArray(chars),start=charsStartIndex(strSymbols,chrSymbols),end=charsEndIndex(strSymbols,chrSymbols)+1;return castSlice(strSymbols,start,end).join("")}function trimEnd(string,chars,guard){if(string=toString(string),string&&(guard||chars===undefined))return string.replace(reTrimEnd,"");if(!string||!(chars=baseToString(chars)))return string;var strSymbols=stringToArray(string),end=charsEndIndex(strSymbols,stringToArray(chars))+1;return castSlice(strSymbols,0,end).join("")}function trimStart(string,chars,guard){if(string=toString(string),string&&(guard||chars===undefined))return string.replace(reTrimStart,"");if(!string||!(chars=baseToString(chars)))return string;var strSymbols=stringToArray(string),start=charsStartIndex(strSymbols,stringToArray(chars));return castSlice(strSymbols,start).join("")}function truncate(string,options){var length=DEFAULT_TRUNC_LENGTH,omission=DEFAULT_TRUNC_OMISSION;if(isObject(options)){var separator="separator"in options?options.separator:separator;length="length"in options?toInteger(options.length):length,omission="omission"in options?baseToString(options.omission):omission}string=toString(string);var strLength=string.length;if(hasUnicode(string)){var strSymbols=stringToArray(string);strLength=strSymbols.length}if(length>=strLength)return string;var end=length-stringSize(omission);if(end<1)return omission;var result=strSymbols?castSlice(strSymbols,0,end).join(""):string.slice(0,end);if(separator===undefined)return result+omission;if(strSymbols&&(end+=result.length-end),isRegExp(separator)){if(string.slice(end).search(separator)){var match,substring=result;separator.global||(separator=RegExp(separator.source,toString(reFlags.exec(separator))+"g")),separator.lastIndex=0;while(match=separator.exec(substring))var newEnd=match.index;result=result.slice(0,newEnd===undefined?end:newEnd)}}else if(string.indexOf(baseToString(separator),end)!=end){var index=result.lastIndexOf(separator);index>-1&&(result=result.slice(0,index))}return result+omission}function unescape(string){return string=toString(string),string&&reHasEscapedHtml.test(string)?string.replace(reEscapedHtml,unescapeHtmlChar):string}var upperCase=createCompounder(function(result,word,index){return result+(index?" ":"")+word.toUpperCase()}),upperFirst=createCaseFirst("toUpperCase");function words(string,pattern,guard){return string=toString(string),pattern=guard?undefined:pattern,pattern===undefined?hasUnicodeWord(string)?unicodeWords(string):asciiWords(string):string.match(pattern)||[]}var attempt=baseRest(function(func,args){try{return apply(func,undefined,args)}catch(e){return isError(e)?e:new Error(e)}}),bindAll=flatRest(function(object,methodNames){return arrayEach(methodNames,function(key){key=toKey(key),baseAssignValue(object,key,bind(object[key],object))}),object});function cond(pairs){var length=null==pairs?0:pairs.length,toIteratee=getIteratee();return pairs=length?arrayMap(pairs,function(pair){if("function"!=typeof pair[1])throw new TypeError(FUNC_ERROR_TEXT);return[toIteratee(pair[0]),pair[1]]}):[],baseRest(function(args){var index=-1;while(++index<length){var pair=pairs[index];if(apply(pair[0],this,args))return apply(pair[1],this,args)}})}function conforms(source){return baseConforms(baseClone(source,CLONE_DEEP_FLAG))}function constant(value){return function(){return value}}function defaultTo(value,defaultValue){return null==value||value!==value?defaultValue:value}var flow=createFlow(),flowRight=createFlow(!0);function identity(value){return value}function iteratee(func){return baseIteratee("function"==typeof func?func:baseClone(func,CLONE_DEEP_FLAG))}function matches(source){return baseMatches(baseClone(source,CLONE_DEEP_FLAG))}function matchesProperty(path,srcValue){return baseMatchesProperty(path,baseClone(srcValue,CLONE_DEEP_FLAG))}var method=baseRest(function(path,args){return function(object){return baseInvoke(object,path,args)}}),methodOf=baseRest(function(object,args){return function(path){return baseInvoke(object,path,args)}});function mixin(object,source,options){var props=keys(source),methodNames=baseFunctions(source,props);null!=options||isObject(source)&&(methodNames.length||!props.length)||(options=source,source=object,object=this,methodNames=baseFunctions(source,keys(source)));var chain=!(isObject(options)&&"chain"in options)||!!options.chain,isFunc=isFunction(object);return arrayEach(methodNames,function(methodName){var func=source[methodName];object[methodName]=func,isFunc&&(object.prototype[methodName]=function(){var chainAll=this.__chain__;if(chain||chainAll){var result=object(this.__wrapped__),actions=result.__actions__=copyArray(this.__actions__);return actions.push({func:func,args:arguments,thisArg:object}),result.__chain__=chainAll,result}return func.apply(object,arrayPush([this.value()],arguments))})}),object}function noConflict(){return root._===this&&(root._=oldDash),this}function noop(){}function nthArg(n){return n=toInteger(n),baseRest(function(args){return baseNth(args,n)})}var over=createOver(arrayMap),overEvery=createOver(arrayEvery),overSome=createOver(arraySome);function property(path){return isKey(path)?baseProperty(toKey(path)):basePropertyDeep(path)}function propertyOf(object){return function(path){return null==object?undefined:baseGet(object,path)}}var range=createRange(),rangeRight=createRange(!0);function stubArray(){return[]}function stubFalse(){return!1}function stubObject(){return{}}function stubString(){return""}function stubTrue(){return!0}function times(n,iteratee){if(n=toInteger(n),n<1||n>MAX_SAFE_INTEGER)return[];var index=MAX_ARRAY_LENGTH,length=nativeMin(n,MAX_ARRAY_LENGTH);iteratee=getIteratee(iteratee),n-=MAX_ARRAY_LENGTH;var result=baseTimes(length,iteratee);while(++index<n)iteratee(index);return result}function toPath(value){return isArray(value)?arrayMap(value,toKey):isSymbol(value)?[value]:copyArray(stringToPath(toString(value)))}function uniqueId(prefix){var id=++idCounter;return toString(prefix)+id}var add=createMathOperation(function(augend,addend){return augend+addend},0),ceil=createRound("ceil"),divide=createMathOperation(function(dividend,divisor){return dividend/divisor},1),floor=createRound("floor");function max(array){return array&&array.length?baseExtremum(array,identity,baseGt):undefined}function maxBy(array,iteratee){return array&&array.length?baseExtremum(array,getIteratee(iteratee,2),baseGt):undefined}function mean(array){return baseMean(array,identity)}function meanBy(array,iteratee){return baseMean(array,getIteratee(iteratee,2))}function min(array){return array&&array.length?baseExtremum(array,identity,baseLt):undefined}function minBy(array,iteratee){return array&&array.length?baseExtremum(array,getIteratee(iteratee,2),baseLt):undefined}var multiply=createMathOperation(function(multiplier,multiplicand){return multiplier*multiplicand},1),round=createRound("round"),subtract=createMathOperation(function(minuend,subtrahend){return minuend-subtrahend},0);function sum(array){return array&&array.length?baseSum(array,identity):0}function sumBy(array,iteratee){return array&&array.length?baseSum(array,getIteratee(iteratee,2)):0}return lodash.after=after,lodash.ary=ary,lodash.assign=assign,lodash.assignIn=assignIn,lodash.assignInWith=assignInWith,lodash.assignWith=assignWith,lodash.at=at,lodash.before=before,lodash.bind=bind,lodash.bindAll=bindAll,lodash.bindKey=bindKey,lodash.castArray=castArray,lodash.chain=chain,lodash.chunk=chunk,lodash.compact=compact,lodash.concat=concat,lodash.cond=cond,lodash.conforms=conforms,lodash.constant=constant,lodash.countBy=countBy,lodash.create=create,lodash.curry=curry,lodash.curryRight=curryRight,lodash.debounce=debounce,lodash.defaults=defaults,lodash.defaultsDeep=defaultsDeep,lodash.defer=defer,lodash.delay=delay,lodash.difference=difference,lodash.differenceBy=differenceBy,lodash.differenceWith=differenceWith,lodash.drop=drop,lodash.dropRight=dropRight,lodash.dropRightWhile=dropRightWhile,lodash.dropWhile=dropWhile,lodash.fill=fill,lodash.filter=filter,lodash.flatMap=flatMap,lodash.flatMapDeep=flatMapDeep,lodash.flatMapDepth=flatMapDepth,lodash.flatten=flatten,lodash.flattenDeep=flattenDeep,lodash.flattenDepth=flattenDepth,lodash.flip=flip,lodash.flow=flow,lodash.flowRight=flowRight,lodash.fromPairs=fromPairs,lodash.functions=functions,lodash.functionsIn=functionsIn,lodash.groupBy=groupBy,lodash.initial=initial,lodash.intersection=intersection,lodash.intersectionBy=intersectionBy,lodash.intersectionWith=intersectionWith,lodash.invert=invert,lodash.invertBy=invertBy,lodash.invokeMap=invokeMap,lodash.iteratee=iteratee,lodash.keyBy=keyBy,lodash.keys=keys,lodash.keysIn=keysIn,lodash.map=map,lodash.mapKeys=mapKeys,lodash.mapValues=mapValues,lodash.matches=matches,lodash.matchesProperty=matchesProperty,lodash.memoize=memoize,lodash.merge=merge,lodash.mergeWith=mergeWith,lodash.method=method,lodash.methodOf=methodOf,lodash.mixin=mixin,lodash.negate=negate,lodash.nthArg=nthArg,lodash.omit=omit,lodash.omitBy=omitBy,lodash.once=once,lodash.orderBy=orderBy,lodash.over=over,lodash.overArgs=overArgs,lodash.overEvery=overEvery,lodash.overSome=overSome,lodash.partial=partial,lodash.partialRight=partialRight,lodash.partition=partition,lodash.pick=pick,lodash.pickBy=pickBy,lodash.property=property,lodash.propertyOf=propertyOf,lodash.pull=pull,lodash.pullAll=pullAll,lodash.pullAllBy=pullAllBy,lodash.pullAllWith=pullAllWith,lodash.pullAt=pullAt,lodash.range=range,lodash.rangeRight=rangeRight,lodash.rearg=rearg,lodash.reject=reject,lodash.remove=remove,lodash.rest=rest,lodash.reverse=reverse,lodash.sampleSize=sampleSize,lodash.set=set,lodash.setWith=setWith,lodash.shuffle=shuffle,lodash.slice=slice,lodash.sortBy=sortBy,lodash.sortedUniq=sortedUniq,lodash.sortedUniqBy=sortedUniqBy,lodash.split=split,lodash.spread=spread,lodash.tail=tail,lodash.take=take,lodash.takeRight=takeRight,lodash.takeRightWhile=takeRightWhile,lodash.takeWhile=takeWhile,lodash.tap=tap,lodash.throttle=throttle,lodash.thru=thru,lodash.toArray=toArray,lodash.toPairs=toPairs,lodash.toPairsIn=toPairsIn,lodash.toPath=toPath,lodash.toPlainObject=toPlainObject,lodash.transform=transform,lodash.unary=unary,lodash.union=union,lodash.unionBy=unionBy,lodash.unionWith=unionWith,lodash.uniq=uniq,lodash.uniqBy=uniqBy,lodash.uniqWith=uniqWith,lodash.unset=unset,lodash.unzip=unzip,lodash.unzipWith=unzipWith,lodash.update=update,lodash.updateWith=updateWith,lodash.values=values,lodash.valuesIn=valuesIn,lodash.without=without,lodash.words=words,lodash.wrap=wrap,lodash.xor=xor,lodash.xorBy=xorBy,lodash.xorWith=xorWith,lodash.zip=zip,lodash.zipObject=zipObject,lodash.zipObjectDeep=zipObjectDeep,lodash.zipWith=zipWith,lodash.entries=toPairs,lodash.entriesIn=toPairsIn,lodash.extend=assignIn,lodash.extendWith=assignInWith,mixin(lodash,lodash),lodash.add=add,lodash.attempt=attempt,lodash.camelCase=camelCase,lodash.capitalize=capitalize,lodash.ceil=ceil,lodash.clamp=clamp,lodash.clone=clone,lodash.cloneDeep=cloneDeep,lodash.cloneDeepWith=cloneDeepWith,lodash.cloneWith=cloneWith,lodash.conformsTo=conformsTo,lodash.deburr=deburr,lodash.defaultTo=defaultTo,lodash.divide=divide,lodash.endsWith=endsWith,lodash.eq=eq,lodash.escape=escape,lodash.escapeRegExp=escapeRegExp,lodash.every=every,lodash.find=find,lodash.findIndex=findIndex,lodash.findKey=findKey,lodash.findLast=findLast,lodash.findLastIndex=findLastIndex,lodash.findLastKey=findLastKey,lodash.floor=floor,lodash.forEach=forEach,lodash.forEachRight=forEachRight,lodash.forIn=forIn,lodash.forInRight=forInRight,lodash.forOwn=forOwn,lodash.forOwnRight=forOwnRight,lodash.get=get,lodash.gt=gt,lodash.gte=gte,lodash.has=has,lodash.hasIn=hasIn,lodash.head=head,lodash.identity=identity,lodash.includes=includes,lodash.indexOf=indexOf,lodash.inRange=inRange,lodash.invoke=invoke,lodash.isArguments=isArguments,lodash.isArray=isArray,lodash.isArrayBuffer=isArrayBuffer,lodash.isArrayLike=isArrayLike,lodash.isArrayLikeObject=isArrayLikeObject,lodash.isBoolean=isBoolean,lodash.isBuffer=isBuffer,lodash.isDate=isDate,lodash.isElement=isElement,lodash.isEmpty=isEmpty,lodash.isEqual=isEqual,lodash.isEqualWith=isEqualWith,lodash.isError=isError,lodash.isFinite=isFinite,lodash.isFunction=isFunction,lodash.isInteger=isInteger,lodash.isLength=isLength,lodash.isMap=isMap,lodash.isMatch=isMatch,lodash.isMatchWith=isMatchWith,lodash.isNaN=isNaN,lodash.isNative=isNative,lodash.isNil=isNil,lodash.isNull=isNull,lodash.isNumber=isNumber,lodash.isObject=isObject,lodash.isObjectLike=isObjectLike,lodash.isPlainObject=isPlainObject,lodash.isRegExp=isRegExp,lodash.isSafeInteger=isSafeInteger,lodash.isSet=isSet,lodash.isString=isString,lodash.isSymbol=isSymbol,lodash.isTypedArray=isTypedArray,lodash.isUndefined=isUndefined,lodash.isWeakMap=isWeakMap,lodash.isWeakSet=isWeakSet,lodash.join=join,lodash.kebabCase=kebabCase,lodash.last=last,lodash.lastIndexOf=lastIndexOf,lodash.lowerCase=lowerCase,lodash.lowerFirst=lowerFirst,lodash.lt=lt,lodash.lte=lte,lodash.max=max,lodash.maxBy=maxBy,lodash.mean=mean,lodash.meanBy=meanBy,lodash.min=min,lodash.minBy=minBy,lodash.stubArray=stubArray,lodash.stubFalse=stubFalse,lodash.stubObject=stubObject,lodash.stubString=stubString,lodash.stubTrue=stubTrue,lodash.multiply=multiply,lodash.nth=nth,lodash.noConflict=noConflict,lodash.noop=noop,lodash.now=now,lodash.pad=pad,lodash.padEnd=padEnd,lodash.padStart=padStart,lodash.parseInt=parseInt,lodash.random=random,lodash.reduce=reduce,lodash.reduceRight=reduceRight,lodash.repeat=repeat,lodash.replace=replace,lodash.result=result,lodash.round=round,lodash.runInContext=runInContext,lodash.sample=sample,lodash.size=size,lodash.snakeCase=snakeCase,lodash.some=some,lodash.sortedIndex=sortedIndex,lodash.sortedIndexBy=sortedIndexBy,lodash.sortedIndexOf=sortedIndexOf,lodash.sortedLastIndex=sortedLastIndex,lodash.sortedLastIndexBy=sortedLastIndexBy,lodash.sortedLastIndexOf=sortedLastIndexOf,lodash.startCase=startCase,lodash.startsWith=startsWith,lodash.subtract=subtract,lodash.sum=sum,lodash.sumBy=sumBy,lodash.template=template,lodash.times=times,lodash.toFinite=toFinite,lodash.toInteger=toInteger,lodash.toLength=toLength,lodash.toLower=toLower,lodash.toNumber=toNumber,lodash.toSafeInteger=toSafeInteger,lodash.toString=toString,lodash.toUpper=toUpper,lodash.trim=trim,lodash.trimEnd=trimEnd,lodash.trimStart=trimStart,lodash.truncate=truncate,lodash.unescape=unescape,lodash.uniqueId=uniqueId,lodash.upperCase=upperCase,lodash.upperFirst=upperFirst,lodash.each=forEach,lodash.eachRight=forEachRight,lodash.first=head,mixin(lodash,function(){var source={};return baseForOwn(lodash,function(func,methodName){hasOwnProperty.call(lodash.prototype,methodName)||(source[methodName]=func)}),source}(),{chain:!1}),lodash.VERSION=VERSION,arrayEach(["bind","bindKey","curry","curryRight","partial","partialRight"],function(methodName){lodash[methodName].placeholder=lodash}),arrayEach(["drop","take"],function(methodName,index){LazyWrapper.prototype[methodName]=function(n){n=n===undefined?1:nativeMax(toInteger(n),0);var result=this.__filtered__&&!index?new LazyWrapper(this):this.clone();return result.__filtered__?result.__takeCount__=nativeMin(n,result.__takeCount__):result.__views__.push({size:nativeMin(n,MAX_ARRAY_LENGTH),type:methodName+(result.__dir__<0?"Right":"")}),result},LazyWrapper.prototype[methodName+"Right"]=function(n){return this.reverse()[methodName](n).reverse()}}),arrayEach(["filter","map","takeWhile"],function(methodName,index){var type=index+1,isFilter=type==LAZY_FILTER_FLAG||type==LAZY_WHILE_FLAG;LazyWrapper.prototype[methodName]=function(iteratee){var result=this.clone();return result.__iteratees__.push({iteratee:getIteratee(iteratee,3),type:type}),result.__filtered__=result.__filtered__||isFilter,result}}),arrayEach(["head","last"],function(methodName,index){var takeName="take"+(index?"Right":"");LazyWrapper.prototype[methodName]=function(){return this[takeName](1).value()[0]}}),arrayEach(["initial","tail"],function(methodName,index){var dropName="drop"+(index?"":"Right");LazyWrapper.prototype[methodName]=function(){return this.__filtered__?new LazyWrapper(this):this[dropName](1)}}),LazyWrapper.prototype.compact=function(){return this.filter(identity)},LazyWrapper.prototype.find=function(predicate){return this.filter(predicate).head()},LazyWrapper.prototype.findLast=function(predicate){return this.reverse().find(predicate)},LazyWrapper.prototype.invokeMap=baseRest(function(path,args){return"function"==typeof path?new LazyWrapper(this):this.map(function(value){return baseInvoke(value,path,args)})}),LazyWrapper.prototype.reject=function(predicate){return this.filter(negate(getIteratee(predicate)))},LazyWrapper.prototype.slice=function(start,end){start=toInteger(start);var result=this;return result.__filtered__&&(start>0||end<0)?new LazyWrapper(result):(start<0?result=result.takeRight(-start):start&&(result=result.drop(start)),end!==undefined&&(end=toInteger(end),result=end<0?result.dropRight(-end):result.take(end-start)),result)},LazyWrapper.prototype.takeRightWhile=function(predicate){return this.reverse().takeWhile(predicate).reverse()},LazyWrapper.prototype.toArray=function(){return this.take(MAX_ARRAY_LENGTH)},baseForOwn(LazyWrapper.prototype,function(func,methodName){var checkIteratee=/^(?:filter|find|map|reject)|While$/.test(methodName),isTaker=/^(?:head|last)$/.test(methodName),lodashFunc=lodash[isTaker?"take"+("last"==methodName?"Right":""):methodName],retUnwrapped=isTaker||/^find/.test(methodName);lodashFunc&&(lodash.prototype[methodName]=function(){var value=this.__wrapped__,args=isTaker?[1]:arguments,isLazy=value instanceof LazyWrapper,iteratee=args[0],useLazy=isLazy||isArray(value),interceptor=function(value){var result=lodashFunc.apply(lodash,arrayPush([value],args));return isTaker&&chainAll?result[0]:result};useLazy&&checkIteratee&&"function"==typeof iteratee&&1!=iteratee.length&&(isLazy=useLazy=!1);var chainAll=this.__chain__,isHybrid=!!this.__actions__.length,isUnwrapped=retUnwrapped&&!chainAll,onlyLazy=isLazy&&!isHybrid;if(!retUnwrapped&&useLazy){value=onlyLazy?value:new LazyWrapper(this);var result=func.apply(value,args);return result.__actions__.push({func:thru,args:[interceptor],thisArg:undefined}),new LodashWrapper(result,chainAll)}return isUnwrapped&&onlyLazy?func.apply(this,args):(result=this.thru(interceptor),isUnwrapped?isTaker?result.value()[0]:result.value():result)})}),arrayEach(["pop","push","shift","sort","splice","unshift"],function(methodName){var func=arrayProto[methodName],chainName=/^(?:push|sort|unshift)$/.test(methodName)?"tap":"thru",retUnwrapped=/^(?:pop|shift)$/.test(methodName);lodash.prototype[methodName]=function(){var args=arguments;if(retUnwrapped&&!this.__chain__){var value=this.value();return func.apply(isArray(value)?value:[],args)}return this[chainName](function(value){return func.apply(isArray(value)?value:[],args)})}}),baseForOwn(LazyWrapper.prototype,function(func,methodName){var lodashFunc=lodash[methodName];if(lodashFunc){var key=lodashFunc.name+"",names=realNames[key]||(realNames[key]=[]);names.push({name:methodName,func:lodashFunc})}}),realNames[createHybrid(undefined,WRAP_BIND_KEY_FLAG).name]=[{name:"wrapper",func:undefined}],LazyWrapper.prototype.clone=lazyClone,LazyWrapper.prototype.reverse=lazyReverse,LazyWrapper.prototype.value=lazyValue,lodash.prototype.at=wrapperAt,lodash.prototype.chain=wrapperChain,lodash.prototype.commit=wrapperCommit,lodash.prototype.next=wrapperNext,lodash.prototype.plant=wrapperPlant,lodash.prototype.reverse=wrapperReverse,lodash.prototype.toJSON=lodash.prototype.valueOf=lodash.prototype.value=wrapperValue,lodash.prototype.first=lodash.prototype.head,symIterator&&(lodash.prototype[symIterator]=wrapperToIterator),lodash},_=runInContext();0?freeModule?((freeModule.exports=_)._=_,freeExports._=_):root._=_:(root._=_,__WEBPACK_AMD_DEFINE_RESULT__=function(){return _}.call(exports,__webpack_require__,exports,module),!(__WEBPACK_AMD_DEFINE_RESULT__!==undefined&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__)))}).call(this)}).call(exports,function(){return this}(),__webpack_require__(217)(module))},function(module,exports,__webpack_require__){(function(process){exports=module.exports=SemVer;var debug;debug="object"===typeof process&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?function(){var args=Array.prototype.slice.call(arguments,0);args.unshift("SEMVER"),void 0}:function(){},exports.SEMVER_SPEC_VERSION="2.0.0";var MAX_LENGTH=256,MAX_SAFE_INTEGER=Number.MAX_SAFE_INTEGER||9007199254740991,MAX_SAFE_COMPONENT_LENGTH=16,re=exports.re=[],src=exports.src=[],R=0,NUMERICIDENTIFIER=R++;src[NUMERICIDENTIFIER]="0|[1-9]\\d*";var NUMERICIDENTIFIERLOOSE=R++;src[NUMERICIDENTIFIERLOOSE]="[0-9]+";var NONNUMERICIDENTIFIER=R++;src[NONNUMERICIDENTIFIER]="\\d*[a-zA-Z-][a-zA-Z0-9-]*";var MAINVERSION=R++;src[MAINVERSION]="("+src[NUMERICIDENTIFIER]+")\\."+"("+src[NUMERICIDENTIFIER]+")\\."+"("+src[NUMERICIDENTIFIER]+")";var MAINVERSIONLOOSE=R++;src[MAINVERSIONLOOSE]="("+src[NUMERICIDENTIFIERLOOSE]+")\\."+"("+src[NUMERICIDENTIFIERLOOSE]+")\\."+"("+src[NUMERICIDENTIFIERLOOSE]+")";var PRERELEASEIDENTIFIER=R++;src[PRERELEASEIDENTIFIER]="(?:"+src[NUMERICIDENTIFIER]+"|"+src[NONNUMERICIDENTIFIER]+")";var PRERELEASEIDENTIFIERLOOSE=R++;src[PRERELEASEIDENTIFIERLOOSE]="(?:"+src[NUMERICIDENTIFIERLOOSE]+"|"+src[NONNUMERICIDENTIFIER]+")";var PRERELEASE=R++;src[PRERELEASE]="(?:-("+src[PRERELEASEIDENTIFIER]+"(?:\\."+src[PRERELEASEIDENTIFIER]+")*))";var PRERELEASELOOSE=R++;src[PRERELEASELOOSE]="(?:-?("+src[PRERELEASEIDENTIFIERLOOSE]+"(?:\\."+src[PRERELEASEIDENTIFIERLOOSE]+")*))";var BUILDIDENTIFIER=R++;src[BUILDIDENTIFIER]="[0-9A-Za-z-]+";var BUILD=R++;src[BUILD]="(?:\\+("+src[BUILDIDENTIFIER]+"(?:\\."+src[BUILDIDENTIFIER]+")*))";var FULL=R++,FULLPLAIN="v?"+src[MAINVERSION]+src[PRERELEASE]+"?"+src[BUILD]+"?";src[FULL]="^"+FULLPLAIN+"$";var LOOSEPLAIN="[v=\\s]*"+src[MAINVERSIONLOOSE]+src[PRERELEASELOOSE]+"?"+src[BUILD]+"?",LOOSE=R++;src[LOOSE]="^"+LOOSEPLAIN+"$";var GTLT=R++;src[GTLT]="((?:<|>)?=?)";var XRANGEIDENTIFIERLOOSE=R++;src[XRANGEIDENTIFIERLOOSE]=src[NUMERICIDENTIFIERLOOSE]+"|x|X|\\*";var XRANGEIDENTIFIER=R++;src[XRANGEIDENTIFIER]=src[NUMERICIDENTIFIER]+"|x|X|\\*";
var XRANGEPLAIN=R++;src[XRANGEPLAIN]="[v=\\s]*("+src[XRANGEIDENTIFIER]+")"+"(?:\\.("+src[XRANGEIDENTIFIER]+")"+"(?:\\.("+src[XRANGEIDENTIFIER]+")"+"(?:"+src[PRERELEASE]+")?"+src[BUILD]+"?"+")?)?";var XRANGEPLAINLOOSE=R++;src[XRANGEPLAINLOOSE]="[v=\\s]*("+src[XRANGEIDENTIFIERLOOSE]+")"+"(?:\\.("+src[XRANGEIDENTIFIERLOOSE]+")"+"(?:\\.("+src[XRANGEIDENTIFIERLOOSE]+")"+"(?:"+src[PRERELEASELOOSE]+")?"+src[BUILD]+"?"+")?)?";var XRANGE=R++;src[XRANGE]="^"+src[GTLT]+"\\s*"+src[XRANGEPLAIN]+"$";var XRANGELOOSE=R++;src[XRANGELOOSE]="^"+src[GTLT]+"\\s*"+src[XRANGEPLAINLOOSE]+"$";var COERCE=R++;src[COERCE]="(?:^|[^\\d])"+"(\\d{1,"+MAX_SAFE_COMPONENT_LENGTH+"})"+"(?:\\.(\\d{1,"+MAX_SAFE_COMPONENT_LENGTH+"}))?"+"(?:\\.(\\d{1,"+MAX_SAFE_COMPONENT_LENGTH+"}))?"+"(?:$|[^\\d])";var LONETILDE=R++;src[LONETILDE]="(?:~>?)";var TILDETRIM=R++;src[TILDETRIM]="(\\s*)"+src[LONETILDE]+"\\s+",re[TILDETRIM]=new RegExp(src[TILDETRIM],"g");var tildeTrimReplace="$1~",TILDE=R++;src[TILDE]="^"+src[LONETILDE]+src[XRANGEPLAIN]+"$";var TILDELOOSE=R++;src[TILDELOOSE]="^"+src[LONETILDE]+src[XRANGEPLAINLOOSE]+"$";var LONECARET=R++;src[LONECARET]="(?:\\^)";var CARETTRIM=R++;src[CARETTRIM]="(\\s*)"+src[LONECARET]+"\\s+",re[CARETTRIM]=new RegExp(src[CARETTRIM],"g");var caretTrimReplace="$1^",CARET=R++;src[CARET]="^"+src[LONECARET]+src[XRANGEPLAIN]+"$";var CARETLOOSE=R++;src[CARETLOOSE]="^"+src[LONECARET]+src[XRANGEPLAINLOOSE]+"$";var COMPARATORLOOSE=R++;src[COMPARATORLOOSE]="^"+src[GTLT]+"\\s*("+LOOSEPLAIN+")$|^$";var COMPARATOR=R++;src[COMPARATOR]="^"+src[GTLT]+"\\s*("+FULLPLAIN+")$|^$";var COMPARATORTRIM=R++;src[COMPARATORTRIM]="(\\s*)"+src[GTLT]+"\\s*("+LOOSEPLAIN+"|"+src[XRANGEPLAIN]+")",re[COMPARATORTRIM]=new RegExp(src[COMPARATORTRIM],"g");var comparatorTrimReplace="$1$2$3",HYPHENRANGE=R++;src[HYPHENRANGE]="^\\s*("+src[XRANGEPLAIN]+")"+"\\s+-\\s+"+"("+src[XRANGEPLAIN]+")"+"\\s*$";var HYPHENRANGELOOSE=R++;src[HYPHENRANGELOOSE]="^\\s*("+src[XRANGEPLAINLOOSE]+")"+"\\s+-\\s+"+"("+src[XRANGEPLAINLOOSE]+")"+"\\s*$";var STAR=R++;src[STAR]="(<|>)?=?\\s*\\*";for(var i=0;i<R;i++)debug(i,src[i]),re[i]||(re[i]=new RegExp(src[i]));exports.parse=parse;function parse(version,loose){if(version instanceof SemVer)return version;if("string"!==typeof version)return null;if(version.length>MAX_LENGTH)return null;var r=loose?re[LOOSE]:re[FULL];if(!r.test(version))return null;try{return new SemVer(version,loose)}catch(er){return null}}exports.valid=valid;function valid(version,loose){var v=parse(version,loose);return v?v.version:null}exports.clean=clean;function clean(version,loose){var s=parse(version.trim().replace(/^[=v]+/,""),loose);return s?s.version:null}exports.SemVer=SemVer;function SemVer(version,loose){if(version instanceof SemVer){if(version.loose===loose)return version;version=version.version}else if("string"!==typeof version)throw new TypeError("Invalid Version: "+version);if(version.length>MAX_LENGTH)throw new TypeError("version is longer than "+MAX_LENGTH+" characters");if(!(this instanceof SemVer))return new SemVer(version,loose);debug("SemVer",version,loose),this.loose=loose;var m=version.trim().match(loose?re[LOOSE]:re[FULL]);if(!m)throw new TypeError("Invalid Version: "+version);if(this.raw=version,this.major=+m[1],this.minor=+m[2],this.patch=+m[3],this.major>MAX_SAFE_INTEGER||this.major<0)throw new TypeError("Invalid major version");if(this.minor>MAX_SAFE_INTEGER||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>MAX_SAFE_INTEGER||this.patch<0)throw new TypeError("Invalid patch version");m[4]?this.prerelease=m[4].split(".").map(function(id){if(/^[0-9]+$/.test(id)){var num=+id;if(num>=0&&num<MAX_SAFE_INTEGER)return num}return id}):this.prerelease=[],this.build=m[5]?m[5].split("."):[],this.format()}SemVer.prototype.format=function(){return this.version=this.major+"."+this.minor+"."+this.patch,this.prerelease.length&&(this.version+="-"+this.prerelease.join(".")),this.version},SemVer.prototype.toString=function(){return this.version},SemVer.prototype.compare=function(other){return debug("SemVer.compare",this.version,this.loose,other),other instanceof SemVer||(other=new SemVer(other,this.loose)),this.compareMain(other)||this.comparePre(other)},SemVer.prototype.compareMain=function(other){return other instanceof SemVer||(other=new SemVer(other,this.loose)),compareIdentifiers(this.major,other.major)||compareIdentifiers(this.minor,other.minor)||compareIdentifiers(this.patch,other.patch)},SemVer.prototype.comparePre=function(other){if(other instanceof SemVer||(other=new SemVer(other,this.loose)),this.prerelease.length&&!other.prerelease.length)return-1;if(!this.prerelease.length&&other.prerelease.length)return 1;if(!this.prerelease.length&&!other.prerelease.length)return 0;var i=0;do{var a=this.prerelease[i],b=other.prerelease[i];if(debug("prerelease compare",i,a,b),void 0===a&&void 0===b)return 0;if(void 0===b)return 1;if(void 0===a)return-1;if(a!==b)return compareIdentifiers(a,b)}while(++i)},SemVer.prototype.inc=function(release,identifier){switch(release){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",identifier);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",identifier);break;case"prepatch":this.prerelease.length=0,this.inc("patch",identifier),this.inc("pre",identifier);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",identifier),this.inc("pre",identifier);break;case"major":0===this.minor&&0===this.patch&&0!==this.prerelease.length||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":0===this.patch&&0!==this.prerelease.length||this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":if(0===this.prerelease.length)this.prerelease=[0];else{var i=this.prerelease.length;while(--i>=0)"number"===typeof this.prerelease[i]&&(this.prerelease[i]++,i=-2);i===-1&&this.prerelease.push(0)}identifier&&(this.prerelease[0]===identifier?isNaN(this.prerelease[1])&&(this.prerelease=[identifier,0]):this.prerelease=[identifier,0]);break;default:throw new Error("invalid increment argument: "+release)}return this.format(),this.raw=this.version,this},exports.inc=inc;function inc(version,release,loose,identifier){"string"===typeof loose&&(identifier=loose,loose=void 0);try{return new SemVer(version,loose).inc(release,identifier).version}catch(er){return null}}exports.diff=diff;function diff(version1,version2){if(eq(version1,version2))return null;var v1=parse(version1),v2=parse(version2);if(v1.prerelease.length||v2.prerelease.length){for(var key in v1)if(("major"===key||"minor"===key||"patch"===key)&&v1[key]!==v2[key])return"pre"+key;return"prerelease"}for(var key in v1)if(("major"===key||"minor"===key||"patch"===key)&&v1[key]!==v2[key])return key}exports.compareIdentifiers=compareIdentifiers;var numeric=/^[0-9]+$/;function compareIdentifiers(a,b){var anum=numeric.test(a),bnum=numeric.test(b);return anum&&bnum&&(a=+a,b=+b),anum&&!bnum?-1:bnum&&!anum?1:a<b?-1:a>b?1:0}exports.rcompareIdentifiers=rcompareIdentifiers;function rcompareIdentifiers(a,b){return compareIdentifiers(b,a)}exports.major=major;function major(a,loose){return new SemVer(a,loose).major}exports.minor=minor;function minor(a,loose){return new SemVer(a,loose).minor}exports.patch=patch;function patch(a,loose){return new SemVer(a,loose).patch}exports.compare=compare;function compare(a,b,loose){return new SemVer(a,loose).compare(new SemVer(b,loose))}exports.compareLoose=compareLoose;function compareLoose(a,b){return compare(a,b,!0)}exports.rcompare=rcompare;function rcompare(a,b,loose){return compare(b,a,loose)}exports.sort=sort;function sort(list,loose){return list.sort(function(a,b){return exports.compare(a,b,loose)})}exports.rsort=rsort;function rsort(list,loose){return list.sort(function(a,b){return exports.rcompare(a,b,loose)})}exports.gt=gt;function gt(a,b,loose){return compare(a,b,loose)>0}exports.lt=lt;function lt(a,b,loose){return compare(a,b,loose)<0}exports.eq=eq;function eq(a,b,loose){return 0===compare(a,b,loose)}exports.neq=neq;function neq(a,b,loose){return 0!==compare(a,b,loose)}exports.gte=gte;function gte(a,b,loose){return compare(a,b,loose)>=0}exports.lte=lte;function lte(a,b,loose){return compare(a,b,loose)<=0}exports.cmp=cmp;function cmp(a,op,b,loose){var ret;switch(op){case"===":"object"===typeof a&&(a=a.version),"object"===typeof b&&(b=b.version),ret=a===b;break;case"!==":"object"===typeof a&&(a=a.version),"object"===typeof b&&(b=b.version),ret=a!==b;break;case"":case"=":case"==":ret=eq(a,b,loose);break;case"!=":ret=neq(a,b,loose);break;case">":ret=gt(a,b,loose);break;case">=":ret=gte(a,b,loose);break;case"<":ret=lt(a,b,loose);break;case"<=":ret=lte(a,b,loose);break;default:throw new TypeError("Invalid operator: "+op)}return ret}exports.Comparator=Comparator;function Comparator(comp,loose){if(comp instanceof Comparator){if(comp.loose===loose)return comp;comp=comp.value}return this instanceof Comparator?(debug("comparator",comp,loose),this.loose=loose,this.parse(comp),this.semver===ANY?this.value="":this.value=this.operator+this.semver.version,debug("comp",this),void 0):new Comparator(comp,loose)}var ANY={};Comparator.prototype.parse=function(comp){var r=this.loose?re[COMPARATORLOOSE]:re[COMPARATOR],m=comp.match(r);if(!m)throw new TypeError("Invalid comparator: "+comp);this.operator=m[1],"="===this.operator&&(this.operator=""),m[2]?this.semver=new SemVer(m[2],this.loose):this.semver=ANY},Comparator.prototype.toString=function(){return this.value},Comparator.prototype.test=function(version){return debug("Comparator.test",version,this.loose),this.semver===ANY||("string"===typeof version&&(version=new SemVer(version,this.loose)),cmp(version,this.operator,this.semver,this.loose))},Comparator.prototype.intersects=function(comp,loose){if(!(comp instanceof Comparator))throw new TypeError("a Comparator is required");var rangeTmp;if(""===this.operator)return rangeTmp=new Range(comp.value,loose),satisfies(this.value,rangeTmp,loose);if(""===comp.operator)return rangeTmp=new Range(this.value,loose),satisfies(comp.semver,rangeTmp,loose);var sameDirectionIncreasing=(">="===this.operator||">"===this.operator)&&(">="===comp.operator||">"===comp.operator),sameDirectionDecreasing=("<="===this.operator||"<"===this.operator)&&("<="===comp.operator||"<"===comp.operator),sameSemVer=this.semver.version===comp.semver.version,differentDirectionsInclusive=(">="===this.operator||"<="===this.operator)&&(">="===comp.operator||"<="===comp.operator),oppositeDirectionsLessThan=cmp(this.semver,"<",comp.semver,loose)&&(">="===this.operator||">"===this.operator)&&("<="===comp.operator||"<"===comp.operator),oppositeDirectionsGreaterThan=cmp(this.semver,">",comp.semver,loose)&&("<="===this.operator||"<"===this.operator)&&(">="===comp.operator||">"===comp.operator);return sameDirectionIncreasing||sameDirectionDecreasing||sameSemVer&&differentDirectionsInclusive||oppositeDirectionsLessThan||oppositeDirectionsGreaterThan},exports.Range=Range;function Range(range,loose){if(range instanceof Range)return range.loose===loose?range:new Range(range.raw,loose);if(range instanceof Comparator)return new Range(range.value,loose);if(!(this instanceof Range))return new Range(range,loose);if(this.loose=loose,this.raw=range,this.set=range.split(/\s*\|\|\s*/).map(function(range){return this.parseRange(range.trim())},this).filter(function(c){return c.length}),!this.set.length)throw new TypeError("Invalid SemVer Range: "+range);this.format()}Range.prototype.format=function(){return this.range=this.set.map(function(comps){return comps.join(" ").trim()}).join("||").trim(),this.range},Range.prototype.toString=function(){return this.range},Range.prototype.parseRange=function(range){var loose=this.loose;range=range.trim(),debug("range",range,loose);var hr=loose?re[HYPHENRANGELOOSE]:re[HYPHENRANGE];range=range.replace(hr,hyphenReplace),debug("hyphen replace",range),range=range.replace(re[COMPARATORTRIM],comparatorTrimReplace),debug("comparator trim",range,re[COMPARATORTRIM]),range=range.replace(re[TILDETRIM],tildeTrimReplace),range=range.replace(re[CARETTRIM],caretTrimReplace),range=range.split(/\s+/).join(" ");var compRe=loose?re[COMPARATORLOOSE]:re[COMPARATOR],set=range.split(" ").map(function(comp){return parseComparator(comp,loose)}).join(" ").split(/\s+/);return this.loose&&(set=set.filter(function(comp){return!!comp.match(compRe)})),set=set.map(function(comp){return new Comparator(comp,loose)}),set},Range.prototype.intersects=function(range,loose){if(!(range instanceof Range))throw new TypeError("a Range is required");return this.set.some(function(thisComparators){return thisComparators.every(function(thisComparator){return range.set.some(function(rangeComparators){return rangeComparators.every(function(rangeComparator){return thisComparator.intersects(rangeComparator,loose)})})})})},exports.toComparators=toComparators;function toComparators(range,loose){return new Range(range,loose).set.map(function(comp){return comp.map(function(c){return c.value}).join(" ").trim().split(" ")})}function parseComparator(comp,loose){return debug("comp",comp),comp=replaceCarets(comp,loose),debug("caret",comp),comp=replaceTildes(comp,loose),debug("tildes",comp),comp=replaceXRanges(comp,loose),debug("xrange",comp),comp=replaceStars(comp,loose),debug("stars",comp),comp}function isX(id){return!id||"x"===id.toLowerCase()||"*"===id}function replaceTildes(comp,loose){return comp.trim().split(/\s+/).map(function(comp){return replaceTilde(comp,loose)}).join(" ")}function replaceTilde(comp,loose){var r=loose?re[TILDELOOSE]:re[TILDE];return comp.replace(r,function(_,M,m,p,pr){debug("tilde",comp,_,M,m,p,pr);var ret;return isX(M)?ret="":isX(m)?ret=">="+M+".0.0 <"+(+M+1)+".0.0":isX(p)?ret=">="+M+"."+m+".0 <"+M+"."+(+m+1)+".0":pr?(debug("replaceTilde pr",pr),"-"!==pr.charAt(0)&&(pr="-"+pr),ret=">="+M+"."+m+"."+p+pr+" <"+M+"."+(+m+1)+".0"):ret=">="+M+"."+m+"."+p+" <"+M+"."+(+m+1)+".0",debug("tilde return",ret),ret})}function replaceCarets(comp,loose){return comp.trim().split(/\s+/).map(function(comp){return replaceCaret(comp,loose)}).join(" ")}function replaceCaret(comp,loose){debug("caret",comp,loose);var r=loose?re[CARETLOOSE]:re[CARET];return comp.replace(r,function(_,M,m,p,pr){debug("caret",comp,_,M,m,p,pr);var ret;return isX(M)?ret="":isX(m)?ret=">="+M+".0.0 <"+(+M+1)+".0.0":isX(p)?ret="0"===M?">="+M+"."+m+".0 <"+M+"."+(+m+1)+".0":">="+M+"."+m+".0 <"+(+M+1)+".0.0":pr?(debug("replaceCaret pr",pr),"-"!==pr.charAt(0)&&(pr="-"+pr),ret="0"===M?"0"===m?">="+M+"."+m+"."+p+pr+" <"+M+"."+m+"."+(+p+1):">="+M+"."+m+"."+p+pr+" <"+M+"."+(+m+1)+".0":">="+M+"."+m+"."+p+pr+" <"+(+M+1)+".0.0"):(debug("no pr"),ret="0"===M?"0"===m?">="+M+"."+m+"."+p+" <"+M+"."+m+"."+(+p+1):">="+M+"."+m+"."+p+" <"+M+"."+(+m+1)+".0":">="+M+"."+m+"."+p+" <"+(+M+1)+".0.0"),debug("caret return",ret),ret})}function replaceXRanges(comp,loose){return debug("replaceXRanges",comp,loose),comp.split(/\s+/).map(function(comp){return replaceXRange(comp,loose)}).join(" ")}function replaceXRange(comp,loose){comp=comp.trim();var r=loose?re[XRANGELOOSE]:re[XRANGE];return comp.replace(r,function(ret,gtlt,M,m,p,pr){debug("xRange",comp,ret,gtlt,M,m,p,pr);var xM=isX(M),xm=xM||isX(m),xp=xm||isX(p),anyX=xp;return"="===gtlt&&anyX&&(gtlt=""),xM?ret=">"===gtlt||"<"===gtlt?"<0.0.0":"*":gtlt&&anyX?(xm&&(m=0),xp&&(p=0),">"===gtlt?(gtlt=">=",xm?(M=+M+1,m=0,p=0):xp&&(m=+m+1,p=0)):"<="===gtlt&&(gtlt="<",xm?M=+M+1:m=+m+1),ret=gtlt+M+"."+m+"."+p):xm?ret=">="+M+".0.0 <"+(+M+1)+".0.0":xp&&(ret=">="+M+"."+m+".0 <"+M+"."+(+m+1)+".0"),debug("xRange return",ret),ret})}function replaceStars(comp,loose){return debug("replaceStars",comp,loose),comp.trim().replace(re[STAR],"")}function hyphenReplace($0,from,fM,fm,fp,fpr,fb,to,tM,tm,tp,tpr){return from=isX(fM)?"":isX(fm)?">="+fM+".0.0":isX(fp)?">="+fM+"."+fm+".0":">="+from,to=isX(tM)?"":isX(tm)?"<"+(+tM+1)+".0.0":isX(tp)?"<"+tM+"."+(+tm+1)+".0":tpr?"<="+tM+"."+tm+"."+tp+"-"+tpr:"<="+to,(from+" "+to).trim()}Range.prototype.test=function(version){if(!version)return!1;"string"===typeof version&&(version=new SemVer(version,this.loose));for(var i=0;i<this.set.length;i++)if(testSet(this.set[i],version))return!0;return!1};function testSet(set,version){for(var i=0;i<set.length;i++)if(!set[i].test(version))return!1;if(version.prerelease.length){for(var i=0;i<set.length;i++)if(debug(set[i].semver),set[i].semver!==ANY&&set[i].semver.prerelease.length>0){var allowed=set[i].semver;if(allowed.major===version.major&&allowed.minor===version.minor&&allowed.patch===version.patch)return!0}return!1}return!0}exports.satisfies=satisfies;function satisfies(version,range,loose){try{range=new Range(range,loose)}catch(er){return!1}return range.test(version)}exports.maxSatisfying=maxSatisfying;function maxSatisfying(versions,range,loose){var max=null,maxSV=null;try{var rangeObj=new Range(range,loose)}catch(er){return null}return versions.forEach(function(v){rangeObj.test(v)&&(max&&maxSV.compare(v)!==-1||(max=v,maxSV=new SemVer(max,loose)))}),max}exports.minSatisfying=minSatisfying;function minSatisfying(versions,range,loose){var min=null,minSV=null;try{var rangeObj=new Range(range,loose)}catch(er){return null}return versions.forEach(function(v){rangeObj.test(v)&&(min&&1!==minSV.compare(v)||(min=v,minSV=new SemVer(min,loose)))}),min}exports.validRange=validRange;function validRange(range,loose){try{return new Range(range,loose).range||"*"}catch(er){return null}}exports.ltr=ltr;function ltr(version,range,loose){return outside(version,range,"<",loose)}exports.gtr=gtr;function gtr(version,range,loose){return outside(version,range,">",loose)}exports.outside=outside;function outside(version,range,hilo,loose){version=new SemVer(version,loose),range=new Range(range,loose);var gtfn,ltefn,ltfn,comp,ecomp;switch(hilo){case">":gtfn=gt,ltefn=lte,ltfn=lt,comp=">",ecomp=">=";break;case"<":gtfn=lt,ltefn=gte,ltfn=gt,comp="<",ecomp="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(satisfies(version,range,loose))return!1;for(var i=0;i<range.set.length;++i){var comparators=range.set[i],high=null,low=null;if(comparators.forEach(function(comparator){comparator.semver===ANY&&(comparator=new Comparator(">=0.0.0")),high=high||comparator,low=low||comparator,gtfn(comparator.semver,high.semver,loose)?high=comparator:ltfn(comparator.semver,low.semver,loose)&&(low=comparator)}),high.operator===comp||high.operator===ecomp)return!1;if((!low.operator||low.operator===comp)&&ltefn(version,low.semver))return!1;if(low.operator===ecomp&&ltfn(version,low.semver))return!1}return!0}exports.prerelease=prerelease;function prerelease(version,loose){var parsed=parse(version,loose);return parsed&&parsed.prerelease.length?parsed.prerelease:null}exports.intersects=intersects;function intersects(r1,r2,loose){return r1=new Range(r1,loose),r2=new Range(r2,loose),r1.intersects(r2)}exports.coerce=coerce;function coerce(version){if(version instanceof SemVer)return version;if("string"!==typeof version)return null;var match=version.match(re[COERCE]);return null==match?null:parse((match[1]||"0")+"."+(match[2]||"0")+"."+(match[3]||"0"))}}).call(exports,__webpack_require__(61))},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_events=__webpack_require__(3),_events2=_interopRequireDefault(_events),_eventHandler=__webpack_require__(5),_eventHandler2=_interopRequireDefault(_eventHandler),_errors=__webpack_require__(4);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!==typeof call&&"function"!==typeof call?self:call}function _inherits(subClass,superClass){if("function"!==typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var CustomKeyLoader=function(_EventHandler){_inherits(CustomKeyLoader,_EventHandler);function CustomKeyLoader(hlsJs,keyLoaderCallback){_classCallCheck(this,CustomKeyLoader);var _this=_possibleConstructorReturn(this,(CustomKeyLoader.__proto__||Object.getPrototypeOf(CustomKeyLoader)).call(this,hlsJs,_events2.default.KEY_LOADING));return _this._disposed=!1,_this._keyLoaderCallback=keyLoaderCallback,_this._decryptkey=null,_this._decrypturl=null,_this}return _createClass(CustomKeyLoader,[{key:"destroy",value:function(){this._disposed=!0,this._keyLoadCallback=null,this._decryptkey=null,this._decrypturl=null,_eventHandler2.default.prototype.destroy.call(this)}},{key:"_bourneKeyLoadCallback",value:function(context,callbacks){var bourneKey=[93,140,30,231,14,111,78,235,77,110,176,80,59,173,77,111],key=new Uint8Array(bourneKey);callbacks.onSuccess(key)}},{key:"onKeyLoading",value:function(data){if(!this._disposed){var frag=data.frag,decryptdata=frag.decryptdata,uri=decryptdata.uri;if(uri!==this._decrypturl||null===this._decryptkey){this._decrypturl=uri,this._decryptkey=null;var context={url:uri,frag:frag},callbacks={onSuccess:this._doSuccess.bind(this,context),onError:this._doError.bind(this,context),onTimeout:this._doTimeout.bind(this,context)};this._keyLoaderCallback(context,callbacks)}else this._decryptkey&&(decryptdata.key=this._decryptkey,this.hls.trigger(_events2.default.KEY_LOADED,{frag:frag}))}}},{key:"_doSuccess",value:function(context,key){if(!this._disposed){var frag=context.frag;this._decryptkey=frag.decryptdata.key=key,this.hls.trigger(_events2.default.KEY_LOADED,{frag:frag})}}},{key:"_doError",value:function(context,response,error){if(!this._disposed){var data={type:_errors.ErrorTypes.NETWORK_ERROR,details:_errors.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:context.frag,response:response,err:error};this.hls.trigger(_events2.default.ERROR,data)}}},{key:"_doTimeout",value:function(context){this._disposed||this.hls.trigger(_events2.default.ERROR,{type:_errors.ErrorTypes.NETWORK_ERROR,details:_errors.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:context.frag})}}]),CustomKeyLoader}(_eventHandler2.default);exports.default=CustomKeyLoader,module.exports=exports["default"]},function(module,exports,__webpack_require__){(function(process){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_eventemitter=__webpack_require__(34),_eventemitter2=_interopRequireDefault(_eventemitter),_HlsEvents=__webpack_require__(14),_HlsEvents2=_interopRequireDefault(_HlsEvents),_HlsStates=__webpack_require__(65),_HlsStates2=_interopRequireDefault(_HlsStates),_HlsErrors=__webpack_require__(64),_HlsErrors2=_interopRequireDefault(_HlsErrors),_errors=__webpack_require__(4),_HlsErrorStrings=__webpack_require__(63),_HlsErrorStrings2=_interopRequireDefault(_HlsErrorStrings),_PlaybackStates=__webpack_require__(67),_PlaybackStates2=_interopRequireDefault(_PlaybackStates),_MediaStates=__webpack_require__(66),_MediaStates2=_interopRequireDefault(_MediaStates),_EventHandlers=__webpack_require__(35),_EventHandlers2=_interopRequireDefault(_EventHandlers),_HlsJsController=__webpack_require__(103),_HlsJsController2=_interopRequireDefault(_HlsJsController),_MediaController=__webpack_require__(106),_MediaController2=_interopRequireDefault(_MediaController),_HlsUtils=__webpack_require__(6),_HlsUtils2=_interopRequireDefault(_HlsUtils),_HlsMarkers=__webpack_require__(104),_HlsMarkers2=_interopRequireDefault(_HlsMarkers),_instanceCounter=__webpack_require__(166),_instanceCounter2=_interopRequireDefault(_instanceCounter),_hlsKey=__webpack_require__(165),_hlsKey2=_interopRequireDefault(_hlsKey),_logger=__webpack_require__(1);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var _counter=new _instanceCounter2.default,_hlsKeyLoader=new _hlsKey2.default,HlsController=function(){function HlsController(){var config=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},di=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};_classCallCheck(this,HlsController);var disableWorkarounds=!!config.disableWorkarounds||!1,decryptOutsideWebworker=!1,instanceId=0;instanceId=_counter.increment(),0===this._instanceId&&(this._instanceId=instanceId),config.decryptOutsideWebworker===!0&&(decryptOutsideWebworker=!0),this._emitter=di.eventEmitter||new _eventemitter2.default,this._hlsJsController=di.hlsJsController||new _HlsJsController2.default({disableWorkarounds:disableWorkarounds,instanceId:instanceId,decryptOutsideWebworker:decryptOutsideWebworker},{eventEmitter:this._emitter}),this._mediaController=di.mediaController||new _MediaController2.default({disableWorkarounds:disableWorkarounds,instanceId:instanceId},{eventEmitter:this._emitter}),this._markers=new _HlsMarkers2.default({instanceId:instanceId},{eventEmitter:this._emitter}),this._state=_HlsStates2.default.UNLOADED,this._playbackState=_PlaybackStates2.default.NOTREADY,this._mediaState=_MediaStates2.default.DETACHED,this._source=null,this._pendingMedia=null,this._media=null,this._paused=!0,this._canplay=!1,this._canplaythrough=!1,this._ended=!1,this._seeking=!1,this._buffering=!1,this._startPositionSet=!1,this._startPosition=0,this._canplayWaiting=!1,this._instanceId=instanceId,this._lastPlaybackRate=1,this._seekOverHoleWorkaround=_HlsUtils2.default.isIE()&&!disableWorkarounds,this._swallowNextSeek=!1,this._canplayWorkaround=_HlsUtils2.default.isFirefox()&&!disableWorkarounds,this._canplayWorkaroundCount=0,this._lateStartWorkaround=_HlsUtils2.default.isTizen3()&&!disableWorkarounds,this._audioOnlySeekWorkaround=_HlsUtils2.default.isTizen2()&&!disableWorkarounds,this._seekWaitingForBuffer=!1,this._dataReadySeekWorkaround=_HlsUtils2.default.isIEWin8Point1()&&!disableWorkarounds,this._forcePlaybackRateWorkaround=_HlsUtils2.default.isTizen2()&&!disableWorkarounds,this._resyncPlaybackRateWorkaround=(_HlsUtils2.default.isFirefox()||_HlsUtils2.default.isChromeMacOS())&&!disableWorkarounds,this._disableFakeSeek=!1,this._seekBackOnPlay=!1,this._initialTime=-1,this._pendingSeek=void 0,this._seekableRange={start:void 0,end:void 0,duration:void 0},this._prevDuration=0,this._playbackRange={start:void 0,end:void 0,duration:void 0},this._playbackMetrics={},this._debug=!1,this._disposed=!1,this._disposedPromise=void 0,this._loaded=!1,this._fetching=!1,this._autoPrefetch=!0,this._autoPlay=!1,this._autoRecover=!0,this._prefetch=!1,this._sourceLoaded=!1,this._sourceMetadataLoaded=!1,this._pendingUrl=null,this._pendingDispose=!1,this._mediaErrorRecovery=!1,this._playOnMediaErrorRecovery=!1,this._recoveryOptions={playbackRate:void 0,volume:void 0,startPdt:void 0},this._runtimeCheckFinished=!1,this._handlers=new _EventHandlers2.default,this._handlers.setHlsEventsList(this,this._emitter,[{event:_HlsEvents2.default.MEDIA_WIRING,func:this._onMediaWiring},{event:_HlsEvents2.default.MEDIA_WIRED,func:this._onMediaWired},{event:_HlsEvents2.default.MEDIA_ATTACHING,func:this._onMediaAttaching},{event:_HlsEvents2.default.MEDIA_ATTACHED,func:this._onMediaAttached},{event:_HlsEvents2.default.MEDIA_DETACHING,func:this._onMediaDetaching},{event:_HlsEvents2.default.MEDIA_DETACHED,func:this._onMediaDetached},{event:_HlsEvents2.default.HLSJS_ERROR,func:this._onHlsJsError},{event:_HlsEvents2.default.MANIFEST_PARSED,func:this._onManifestParsed},{event:_HlsEvents2.default.CHUNK_BUFFERED,func:this._onChunkBuffered},{event:_HlsEvents2.default.STREAM_SUBTITLERENDITIONS_CHANGED,func:this._onHlsJsSubtitleUpdate},{event:_HlsEvents2.default.VARIANT_DURATION_UPDATED,func:this._onVariantDurationUpdate},{event:_HlsEvents2.default.STREAM_STARTPOSITION_SET,func:this._onStartPositionSet},{event:_HlsEvents2.default.HLSJS_MEDIA_ATTACHED,func:this._onHlsJsMediaAttached},{event:_HlsEvents2.default.HLSJS_MEDIA_DETACHED,func:this._onHlsJsMediaDetached},{event:_HlsEvents2.default.STREAM_NETWORKMETRICS_CHANGED,func:this._onNetworkMetricsChanged},{event:_HlsEvents2.default.HLSJS_SEEK_READY,func:this._onHlsJsSeekReady},{event:_HlsEvents2.default.MEDIA_CONTROLLER_WIRED,func:this._onMediaControllerWired},{event:_HlsEvents2.default.MEDIA_CONTROLLER_UNWIRED,func:this._onMediaControllerUnwired},{event:_HlsEvents2.default.MEDIA_CANPLAY,func:this._onMediaCanPlay},{event:_HlsEvents2.default.MEDIA_CANPLAYTHROUGH,func:this._onMediaCanPlayThrough},{event:_HlsEvents2.default.MEDIA_DURATIONCHANGE,func:this._onMediaDurationChange},{event:_HlsEvents2.default.MEDIA_TIMEUPDATE,func:this._onMediaTimeUpdate},{event:_HlsEvents2.default.MEDIA_SEEKING,func:this._onMediaSeeking},{event:_HlsEvents2.default.MEDIA_SEEKED,func:this._onMediaSeeked},{event:_HlsEvents2.default.MEDIA_ENDED,func:this._onMediaEnded},{event:_HlsEvents2.default.MEDIA_RATECHANGE,func:this._onMediaRateChange},{event:_HlsEvents2.default.MEDIA_CONTROLLER_ERROR,func:this._onMediaControllerError},{event:_HlsEvents2.default.MEDIA_ELEMENT_ERROR,func:this._onMediaElementError},{event:_HlsEvents2.default.TEST_EVENT,func:this._onTestEvent}]).wireHlsEvents(),_HlsUtils2.default.applyConfig(this,config),this._hlsJsController.keyCache(_hlsKeyLoader)}return _createClass(HlsController,[{key:"_runtimeCheck",value:function(){this._runtimeCheckFinished||(_HlsUtils2.default.isPromiseOverloaded()&&(_logger.logger.warn("The native Promise object has been overloaded. This may cause issues, as various native APIs will return native Promises."),this._emitWarning(_errors.ErrorDetails.PROMISE_IS_OVERLOADED)),this._runtimeCheckFinished=!0)}},{key:"_doDispose",value:function(){_logger.logger.log("HlsController::_doDispose() instanceId "+this._instanceId+", instanceCount "+_counter.active()),this._disposed||(this._disposed=!0,_logger.logger.log("STREAM_DISPOSING"),this._emit(_HlsEvents2.default.STREAM_DISPOSING),this._mediaController.dispose(),this._hlsJsController.dispose(),this._source=null,this._media=null,this._pendingMedia=null,this._STREAM_VARIANTS_CHANGED=[],this._sourceLoaded=!1,this._sourceMetadataLoaded=!1,this._swallowNextSeek=!1,this._seekOverHoleWorkaround=!1,this._seekableRange=null,this._playbackRange=null,this._playbackMetrics=null,this._markers.dispose(),this._markers=null,this._handlers.unwireHlsEvents(),this._handlers.dispose(),this._handlers=null,_counter.decrement(),_logger.logger.log("STREAM_DISPOSED"),this._emit(_HlsEvents2.default.STREAM_DISPOSED),this._emitter.removeAllListeners(),this._emitter=null,this._mediaEvents=null,this._hlsJsEvents=null)}},{key:"dispose",value:function(){_logger.logger.log("HlsController::dispose()"),this._disposed?_logger.logger.log("HlsController::dispose - already disposed"):this._mediaState===_MediaStates2.default.DETACHED&&this._state===_HlsStates2.default.UNLOADED?this._doDispose():this._pendingDispose||(_logger.logger.log("HlsController::dispose - pending dispose after detach"),
this._pendingDispose=!0,this._doDetach())}},{key:"loadPendingSource",value:function(){_logger.logger.log("HlsController::loadPendingSource"),this._state!==_HlsStates2.default.UNLOADED&&this._unloadSource(),this._loaded=!1;var pendingUrl=this._pendingUrl;this._pendingUrl=null,this._beginStreamLoading(pendingUrl)}},{key:"loadSource",value:function(url){var _this=this;if(_logger.logger.log("HlsController::loadSource()"),null!==url&&!_HlsUtils2.default.isString(url))throw new Error("loadSource: url "+url+" must be either null, or a string");this._runtimeCheck(),this._pendingUrl=null,this._disposed?_logger.logger.log("loadSource() Disposed; cannot load"):(this._pendingUrl=url,this._safeDoNextTick(function(){return _this.doLoadSource()}))}},{key:"doLoadSource",value:function(){this._pendingUrl&&(this._mediaState!==_MediaStates2.default.ATTACHED&&this._mediaState!==_MediaStates2.default.DETACHING||this._state===_HlsStates2.default.UNLOADED?(_logger.logger.log("doLoadSource() loadPendingSource"),this.loadPendingSource()):(_logger.logger.log("doLoadSource() Need to detach first"),null!=this._media&&this._mediaState!==_MediaStates2.default.DETACHING&&(this._pendingMedia=this._media,_logger.logger.log("HlsController::doLoadSource() old media stashed")),this._doDetach()))}},{key:"flushBuffer",value:function(levelFlush){return this._hlsJsController.flushBuffer(!!levelFlush)}},{key:"attachMedia",value:function(video){_logger.logger.log("HlsController::attachMedia() { video: "+video+", mediaState: "+this._mediaState+" }"),this._disposed?_logger.logger.log("attachMedia() Disposed; cannot attach"):(this._pendingMedia=video,this._mediaState!==_MediaStates2.default.DETACHED&&this._mediaState!==_MediaStates2.default.DETACHING?(_logger.logger.log("HlsController::attachMedia, still attached, forcing detach, { mediaState: "+this._mediaState+", media: "+this._media+" }"),this._doDetach()):this._attachPendingMediaOrUrl())}},{key:"detachMedia",value:function(){_logger.logger.log("HlsController::detachMedia()"),this._pendingMedia=null,this._doDetach()}},{key:"_doDetach",value:function(){var _this2=this;_logger.logger.log("HlsController::_doDetach() { mediaState: "+this._mediaState+" }"),this._mediaState===_MediaStates2.default.DETACHED?(_logger.logger.log("HlsController::_doDetach(), already DETACHED emitting MEDIA_DETACHED anyway"),this._emit(_HlsEvents2.default.MEDIA_DETACHED,{media:null})):this._mediaState!==_MediaStates2.default.DETACHING?this._safeDoNextTick(function(){return _this2._emit(_HlsEvents2.default.MEDIA_DETACHING,{media:null})}):(_logger.logger.log("HlsController::_doDetach() not requesting detach"),_logger.logger.log(this._mediaState))}},{key:"prefetch",value:function(){this._doStreamPrefetch()}},{key:"stopFetching",value:function(){this.loaded&&this._fetching&&(this._fetching=!1,this._hlsJsController.stopFetching())}},{key:"resumeFetching",value:function(){this._loaded&&!this._fetching&&(this._fetching=!0,this._hlsJsController.resumeFetching(this.currentTime))}},{key:"pause",value:function(){this._doStreamPause()}},{key:"play",value:function(){this._doStreamPlay()}},{key:"playPause",value:function(){this._paused?this.play():this.pause()}},{key:"seek",value:function(seconds){if(_HlsUtils2.default.checkNotFiniteAndThrow(seconds,"seek time"),_HlsUtils2.default.checkLessThanZeroPointZeroAndWarn(seconds,"seek time"),_logger.logger.log("seek: seconds: "+seconds+", currentTime: "+this.currentTime+", _seekableRange: ["+this._seekableRange.start+","+this._seekableRange.end+"]"),this._playbackState===_PlaybackStates2.default.NOTREADY||this._playbackState===_PlaybackStates2.default.SEEKING||this._seekWaitingForBuffer)_logger.logger.log("seek: pendingSeek playbackState: "+this._playbackState+" seekWaitingForBuffer: "+this._seekWaitingForBuffer),this._pendingSeek=seconds;else{var targetTime=this._determineSeekTime(seconds);if(this._audioOnlySeekWorkaround&&this.audioOnly||this._dataReadySeekWorkaround){for(var seekReady=!1,i=0;i<this.bufferedRange.length;i++)targetTime>this.bufferedRange[i].start&&targetTime<this.bufferedRange[i].end&&(seekReady=!0);seekReady?this._mediaController.seek(targetTime):(_logger.logger.log("seek: _seekWaitingForBuffer"),this._hlsJsController.bufferBeforeSeeking=targetTime,this._seekWaitingForBuffer=!0)}else this._mediaController.seek(targetTime)}}},{key:"seekByPdt",value:function(time){if(!_HlsUtils2.default.isValidDate(time))throw this._startTimeByPdt=time,new Error("seekByPdt: "+time+" is not a valid date");var pdtBaseDate=this._hlsJsController.basePdt;if(_HlsUtils2.default.isValidDate(pdtBaseDate)&&_HlsUtils2.default.isValidDate(time)){var seekTime=0;seekTime=this.getTimeForPdt(time),_logger.logger.log("seekByPdt: seekTime: "+seekTime+" time: "+time.getTime()/1e3+" pdtBaseDate: "+pdtBaseDate.getTime()/1e3),this.seek(seekTime)}}},{key:"seekToLive",value:function(){this.live&&this.currentTime<this.liveTime&&(_logger.logger.log("seekToLive: liveTime: "+this.liveTime+", duration: "+this.duration),this.seek(this.liveTime))}},{key:"_determineSeekTime",value:function(requestTime){var seekTime=requestTime;return seekTime=Math.min(seekTime,this._seekableRange.end),this.live&&(seekTime=Math.min(seekTime,this.liveTime)),seekTime=Math.max(seekTime,this._seekableRange.start),_logger.logger.log("determineSeekTime: seeking to "+seekTime),Number(seekTime.toFixed(6))}},{key:"_resolvePendingSeek",value:function(){_logger.logger.log("_resolvePendingSeek: _pendingSeek: "+this._pendingSeek+" _seekableRange: ["+this._seekableRange.start+", "+this._seekableRange.end+"] currentTime: "+this.currentTime),this._pendingSeek!==this.currentTime&&this.seek(this._pendingSeek),this._pendingSeek=void 0}},{key:"_onHlsJsSeekReady",value:function(data){_logger.logger.log("_onHlsJsSeekReady: time: "+data.time+" _seekableRange: ["+this._seekableRange.start+", "+this._seekableRange.end+"] currentTime: "+this.currentTime),this._seekWaitingForBuffer=!1,this._mediaController.seek(this._determineSeekTime(data.time))}},{key:"_wireEvents",value:function(){this._handlers._wireHlsEvents(this,this.emitter)}},{key:"_unwireEvents",value:function(){this._handlers._unwireHlsEvents(this.emitter)}},{key:"_decidePlaybackState",value:function(){var newState=void 0;if(newState=this._state!==_HlsStates2.default.PLAYBACK?_PlaybackStates2.default.NOTREADY:this._ended?_PlaybackStates2.default.ENDED:this._seeking?_PlaybackStates2.default.SEEKING:this._paused?_PlaybackStates2.default.PAUSED:this._buffering?_PlaybackStates2.default.BUFFERING:_PlaybackStates2.default.PLAYING,newState===_PlaybackStates2.default.NOTREADY&&this._state===_HlsStates2.default.PLAYBACK)throw new Error("PlaybackState should not be NOTREADY");if(void 0===newState)throw new Error("PlaybackState should not be undefined");this._setPlaybackState(newState)}},{key:"_setMediaState",value:function(newMediaState){if(!newMediaState)throw new Error("invalid mediaState: "+newMediaState);if(this._mediaState!==newMediaState){var oldMediaState=this._mediaState;this._mediaState=newMediaState,this._doMediaStateChanged({mediaState:newMediaState,lastMediaState:oldMediaState})}}},{key:"_setPlaybackState",value:function(newPlaybackState){if(!newPlaybackState)throw new Error("invalid playbackState: "+newPlaybackState);if(this._playbackState!==newPlaybackState){var oldPlaybackState=this._playbackState;this._playbackState=newPlaybackState,this._doStreamPlaybackStateChanged({playbackState:newPlaybackState,lastPlaybackState:oldPlaybackState})}}},{key:"_setState",value:function(newState){if(!newState)throw new Error("invalid state: "+newState);if(this._state!==newState){var oldState=this._state;this._state=newState,this._doStreamStateChanged({state:newState,lastState:oldState})}}},{key:"_resetState",value:function(){this._disposed||(_logger.logger.log("HlsController::_resetState"),this._paused=!0,this._canplay=!1,this._canplaythrough=!1,this._ended=!1,this._seeking=!1,this._buffering=!1,this._loaded=!1,this._fetching=!1,this._prefetch=!1,this._startPositionSet=!1,this._canplayWaiting=!1,this._markers.clearAllMarkers(),this._seekableRange.start=void 0,this._seekableRange.end=void 0,this._seekableRange.duration=void 0,this._playbackRange.start=void 0,this._playbackRange.end=void 0,this._playbackRange.duration=void 0,this._prevDuration=0,this._canplayWorkaroundCount=0)}},{key:"_setMedia",value:function(newMedia){if(_logger.logger.log("HlsController::_setMedia"),void 0===newMedia)throw new Error("invalid media: "+newMedia);if(this._media!==newMedia){var oldMedia=this._media;this._media=newMedia;var data={media:newMedia,lastMedia:oldMedia};_logger.logger.log("STREAM_MEDIA_CHANGED: { media: "+data.media+" lastMedia: "+data.lastMedia+" }"),this._emit(_HlsEvents2.default.STREAM_MEDIA_CHANGED,data)}}},{key:"_startFetching",value:function(){if(!this._fetching){if(this._state!==_HlsStates2.default.LOADED)throw new Error("can't start fetching if not loaded! state: "+this._state);this._beginStreamFetching()}}},{key:"_doStreamStateChanged",value:function(data){_logger.logger.log("STREAM_STATE_CHANGED: { state: "+data.state+" lastState: "+data.lastState+" }"),data.state!==_HlsStates2.default.PLAYBACK&&data.lastState!==_HlsStates2.default.PLAYBACK||this._decidePlaybackState(),this._emit(_HlsEvents2.default.STREAM_STATE_CHANGED,data)}},{key:"_doStreamPlaybackStateChanged",value:function(data){switch(_logger.logger.log("STREAM_PLAYBACKSTATE_CHANGED: { playbackState: "+data.playbackState+" lastPlaybackState: "+data.lastPlaybackState+" }"),data.lastPlaybackState){case _PlaybackStates2.default.BUFFERING:_logger.logger.log("STREAM_BUFFERING_FINISHED"),this._emit(_HlsEvents2.default.STREAM_BUFFERING_FINISHED);break;case _PlaybackStates2.default.SEEKING:_logger.logger.log("STREAM_SEEKING_FINISHED"),this._emit(_HlsEvents2.default.STREAM_SEEKING_FINISHED)}if(data.playbackState!==_PlaybackStates2.default.NOTREADY&&data.playbackState!==_PlaybackStates2.default.SEEKING&&void 0!==this._pendingSeek&&this._resolvePendingSeek(),data.playbackState!==this._playbackState)throw new Error("playbackState: "+this._playbackState+" out of sync with new playbackState "+data.playbackState);switch(data.playbackState){case _PlaybackStates2.default.PAUSED:this._doPlaybackPaused();break;case _PlaybackStates2.default.BUFFERING:this._doPlaybackBuffering();break;case _PlaybackStates2.default.PLAYING:this._doPlaybackPlaying();break;case _PlaybackStates2.default.SEEKING:this._doPlaybackSeeking();break;case _PlaybackStates2.default.ENDED:this._doPlaybackEnded();break;case _PlaybackStates2.default.NOTREADY:this._emit(_HlsEvents2.default.PLAYBACK_NOTREADY);break;default:throw new Error("invalid playback state transition")}this._emit(_HlsEvents2.default.STREAM_PLAYBACKSTATE_CHANGED,data)}},{key:"_doMediaStateChanged",value:function(data){_logger.logger.log("STREAM_MEDIASTATE_CHANGED: { mediaState: "+data.mediaState+" lastMediaState: "+data.lastMediaState+" }"),this._emit(_HlsEvents2.default.STREAM_MEDIASTATE_CHANGED,data)}},{key:"_onManifestParsed",value:function(data){void 0!==this._recoveryOptions.startPdt&&(this._hlsJsController.recoveryStartTimeByPdt=this._recoveryOptions.startPdt,this._recoveryOptions.startPdt=void 0),this._doStreamLoaded(data),this._afterStreamLoaded()}},{key:"_unloadSource",value:function(){this._onStreamUnloaded(),this._emit(_HlsEvents2.default.STREAM_UNLOADED)}},{key:"_handleMediaControllerError",value:function(data){var _this3=this,theError={};theError._data=data,theError.fatal=!0,theError.cause=data.details,theError.streamId=this._instanceId,theError.source=this._source,theError.lastState=this._state,theError.lastPlaybackState=this._playbackState,theError.lastMediaState=this._mediaState,void 0!==data.errorObj&&(theError.errorObj=data.errorObj),theError.error=_HlsErrors2.default.MEDIA_CONTROLLER_FAILED,theError.message=_HlsErrorStrings2.default[theError.error],theError.messageDetailed="["+theError.error+"] "+theError.message+" ("+theError.cause+")",theError.willDetachMedia=!0,theError.willUnload=!1,theError.willDetachMedia&&(_logger.logger.log("MediaController Error; Detaching due to error"),this._safeDoNextTick(function(){return _this3._emit(_HlsEvents2.default.MEDIA_DETACHING,{media:null})})),this._emit(_HlsEvents2.default.STREAM_ERROR,theError)}},{key:"_emitError",value:function(errorFatal,errorCause,errorObj){var errorData={};errorData.details=errorCause,errorData.err=errorObj,errorData.fatal=errorFatal,this._handleError(errorData)}},{key:"_emitWarning",value:function(errorCause,errorObj){this._emitError(!1,errorCause,errorObj)}},{key:"_handleMediaElementError",value:function(data){_logger.logger.warn("media element errored out");var theError={};theError._data=data,theError.cause=data.details,theError.streamId=this._instanceId,theError.source=this._source,theError.lastState=this._state,theError.lastPlaybackState=this._playbackState,theError.lastMediaState=this._mediaState,void 0!==data.errorObj&&(theError.errorObj=data.errorObj),void 0!==data.mediaErrorObj&&(theError.mediaErrorObj=data.mediaErrorObj),theError.error=_HlsErrors2.default.MEDIA_ELEMENT_FAILED,theError.message=_HlsErrorStrings2.default[theError.error],theError.messageDetailed="["+theError.error+"] "+theError.message+" ("+theError.cause+")",this._autoRecover?(_logger.logger.log("media error recovery: autoRecover === true"),theError.willDetachMedia=!1,theError.willUnload=!1,theError.fatal=!1,this._emit(_HlsEvents2.default.STREAM_ERROR,theError),this._media&&(_logger.logger.log("Attempting to recover media element"),this._doMediaErrorRecovery(!0,!0))):(_logger.logger.log("media error recovery: autoRecover === false, treating as fatal"),theError.willDetachMedia=!0,theError.willUnload=!1,theError.fatal=!0,this._emit(_HlsEvents2.default.STREAM_ERROR,theError),_logger.logger.log("MediaElement Error; Detaching due to error"),this._doDetach())}},{key:"_handleError",value:function(data){var theError={},shouldUnload=!1;if(theError._data=data,theError.fatal=data.fatal,theError.cause=data.details,theError.streamId=this._instanceId,theError.source=this._source,theError.lastState=this._state,theError.lastPlaybackState=this._playbackState,theError.lastMediaState=this._mediaState,void 0!==data.response&&(theError.response=data.response),void 0!==data.err&&(theError.errorObj=data.err),theError.cause===_errors.ErrorDetails.INTERNAL_EXCEPTION&&(theError.fatal=!0),theError.cause===_errors.ErrorDetails.MEDIA_PLAY_FAILED&&this.pause(),theError.cause===_errors.ErrorDetails.BUFFER_STALLED_ERROR)return this._buffering=!0,this._decidePlaybackState(),this._emit(_HlsEvents2.default.STREAM_BUFFERING_STARTED),void 0;if(theError.cause===_errors.ErrorDetails.BUFFER_SEEK_OVER_HOLE&&this._seekOverHoleWorkaround&&(this._swallowNextSeek=!0),theError.fatal)switch(this._state){case _HlsStates2.default.UNLOADED:throw theError.error=_HlsErrors2.default.UNEXPECTED_ERROR,new Error("Should be impossible to have an error in state: "+this._state+", data:"+data);case _HlsStates2.default.LOADING:theError.error=_HlsErrors2.default.LOAD_FAILED,shouldUnload=!0;break;case _HlsStates2.default.FETCHING:theError.error=_HlsErrors2.default.FETCH_FAILED,shouldUnload=!0;break;case _HlsStates2.default.PLAYBACK:theError.error=_HlsErrors2.default.PLAYBACK_FAILED,shouldUnload=!0;break;default:throw theError.error=_HlsErrors2.default.UNEXPECTED_ERROR,shouldUnload=!0,new Error("Should be impossible to be in this state : "+this._state)}else theError.error=_HlsErrors2.default.WARNING;theError.message=_HlsErrorStrings2.default[theError.error],theError.messageDetailed="["+theError.error+"] "+theError.message+" ("+theError.cause+")",theError.willUnload=shouldUnload,theError.willDetachMedia=!1,this._emit(_HlsEvents2.default.STREAM_ERROR,theError),shouldUnload&&(_logger.logger.log("Unloading due to error"),this._unloadSource())}},{key:"_onHlsJsError",value:function(data){_logger.logger.log("STREAM_ERROR"),_logger.logger.log(data),this._handleError(data)}},{key:"_doMediaErrorRecovery",value:function(force,recoverTime){this._mediaErrorRecovery||force?(_logger.logger.log("_doMediaErrorRecovery: force: "+force+" _mediaErrorRecovery: "+this._mediaErrorRecovery),this._mediaErrorRecovery=!0,_logger.logger.log("_doMediaErrorRecovery: starting recovery"),this._hlsJsController.basePdt&&(this._hlsJsController._resumeBasePdt=this._hlsJsController.basePdt),_logger.logger.log("_doMediaErrorRecovery: _resumeBasePdt "+this._hlsJsController._resumeBasePdt),this._paused?_logger.logger.log("media error recovery: playback state paused, will not autoplay"):(this._playOnMediaErrorRecovery=!0,_logger.logger.log("media error recovery: playback state not paused, will autoplay after recovery")),recoverTime?(this._recoveryOptions.startPdt=this.getPdtForTime(this.currentTime),_logger.logger.log("media error recovery: recovered currentTime: "+this._recoveryOptions.startPdt)):this.live&&0!==this.liveTime?(this._recoveryOptions.startPdt=this.getPdtForTime(this.liveTime),_logger.logger.log("media error recovery: recovered liveTime: "+this._recoveryOptions.startPdt)):(this._recoveryOptions.startPdt=this.getPdtForTime(0),_logger.logger.log("media error recovery: zeroed currentTime: "+this._recoveryOptions.startPdt)),this._recoveryOptions.playbackRate=this.playbackRate,_logger.logger.log("media error recovery: recovered playbackRate: "+this._recoveryOptions.playbackRate),this._recoveryOptions.volume=this.volume,_logger.logger.log("media error recovery: recovered volume: "+this._recoveryOptions.volume),this.currentAudioRendition&&(this._hlsJsController.recoveryAudioIndex=this.currentAudioRendition,_logger.logger.log("media error recovery: recovered and applied audio rendition: "+this.currentAudioRendition)),this._pendingUrl=this._source,this._pendingMedia=this._media,this._doDetach()):_logger.logger.log("_doMediaErrorRecovery: already in recovery")}},{key:"_onHlsJsMediaAttached",value:function(data){if(_logger.logger.log("HLSJS_MEDIA_ATTACHED: { media: "+data.media+" mediaState: "+this._mediaState+" }"),this._mediaState===_MediaStates2.default.ATTACHING)this._emit(_HlsEvents2.default.MEDIA_ATTACHED,data);else{if(this._mediaState!==_MediaStates2.default.DETACHING)throw new Error("HlsController::_onHlsJsMediaAttached invalid mediaState { "+this._mediaState+" }");this._hlsJsController.detachMedia()}}},{key:"_onHlsJsMediaDetached",value:function(data){if(_logger.logger.log("HLSJS_MEDIA_DETACHED: { media: "+data.media+" mediaState: "+this._mediaState+" }"),this._mediaState!==_MediaStates2.default.DETACHING)throw new Error("HlsController::_onHlsJsMediaDetached invalid mediaState { "+this._mediaState+" }");this._mediaController.media=null}},{key:"_onChunkBuffered",value:function(){this._updatePlaybackRange(),this._canplayWorkaround&&!this._canplay&&(this._canplayWorkaroundCount++,this._canplayWorkaroundCount>2&&this._doStreamCanPlay()),this._checkIfInBufferedRange()&&(this._buffering=!1,this._state===_HlsStates2.default.PLAYBACK&&this._seeking&&!this._disableFakeSeek&&(_logger.logger.log("faking a MEDIA_SEEKED"),this._mediaController._onMediaSeeked())),this._decidePlaybackState()}},{key:"_onHlsJsSubtitleUpdate",value:function(){this._mediaController.captionsControl()}},{key:"_onVariantDurationUpdate",value:function(data){(void 0===this._seekableRange.start||this._seekableRange.start<data.totalDuration-data.playlistDuration||this._seekableRange.end<data.totalDuration)&&(this._seekableRange.end=data.totalDuration,this._seekableRange.duration=data.playlistDuration,this._seekableRange.start=Math.max(this._seekableRange.end-this._seekableRange.duration,0)),this._checkIfInSeekableRange(),this._updatePlaybackRange()}},{key:"_onStartPositionSet",value:function(data){this._startPositionSet=!0,this._startPosition=data.startPosition,this._canplayWaiting&&this._doStreamCanPlay()}},{key:"_onStreamUnloaded",value:function(){_logger.logger.log("STREAM_UNLOADED"),this._setState(_HlsStates2.default.UNLOADED),this._prefetch=!1}},{key:"_beginStreamLoading",value:function(url){_logger.logger.log("STREAM_LOADING: { url: "+url+" }"),this._source=url,this._setState(_HlsStates2.default.LOADING),this._hlsJsController.loadSource(url),null!==this._source&&this._mediaState===_MediaStates2.default.WIRED&&(_logger.logger.log("_beginStreamLoading: mediaState: "+this._mediaState),this._attemptMediaAttaching()),this._emit(_HlsEvents2.default.STREAM_LOADING,{url:url})}},{key:"_afterStreamLoaded",value:function(){this._prefetch||!this._autoPrefetch&&this._paused!==!1||this.prefetch(),this._mediaErrorRecovery?(_logger.logger.log("media error recovery: reapplying state before error"),this._playOnMediaErrorRecovery&&(this.play(),this._playOnMediaErrorRecovery=!1,_logger.logger.log("media error recovery: playing video")),this._recoveryOptions.playbackRate&&(this.playbackRate=this._recoveryOptions.playbackRate,this._recoveryOptions.playbackRate=void 0,_logger.logger.log("media error recovery: reapplying playbackRate: "+this.playbackRate)),this._recoveryOptions.volume&&(this.volume=this._recoveryOptions.volume,this._recoveryOptions.volume=void 0,_logger.logger.log("media error recovery: reapplying volume: "+this.volume)),this._mediaErrorRecovery=!1):this.paused&&this._autoPlay&&this.play()}},{key:"_doStreamLoaded",value:function(data){_logger.logger.log("STREAM_LOADED"),this._loaded=!0,this._setState(_HlsStates2.default.LOADED),this._emit(_HlsEvents2.default.STREAM_LOADED,data)}},{key:"_beginStreamFetching",value:function(){_logger.logger.log("STREAM_FETCHING"),this._fetching=!0,this._setState(_HlsStates2.default.FETCHING),this._hlsJsController.startFetching(),this._emit(_HlsEvents2.default.STREAM_FETCHING)}},{key:"_beginStreamPlayback",value:function(){_logger.logger.log("STREAM_PLAYBACK"),this._setState(_HlsStates2.default.PLAYBACK),this._emit(_HlsEvents2.default.STREAM_PLAYBACK)}},{key:"_doPlaybackSeeking",value:function(){this._swallowNextSeek?this._swallowNextSeek=!1:(_logger.logger.log("PLAYBACK_SEEKING"),this._emit(_HlsEvents2.default.PLAYBACK_SEEKING))}},{key:"_doPlaybackPaused",value:function(){_logger.logger.log("PLAYBACK_PAUSED"),this._mediaController.pause(),this._emit(_HlsEvents2.default.PLAYBACK_PAUSED)}},{key:"_doPlaybackBuffering",value:function(){_logger.logger.log("PLAYBACK_BUFFERING"),this._emit(_HlsEvents2.default.PLAYBACK_BUFFERING)}},{key:"_doPlaybackPlaying",value:function(){var _this4=this;_logger.logger.log("PLAYBACK_PLAYING");var playPromise=this._mediaController.play();this._emit(_HlsEvents2.default.PLAYBACK_PLAYING),playPromise.then(function(){_this4._seekBackOnPlay&&(_this4.currentTime-=1e-6,_this4._seekBackOnPlay=!1)}).catch(function(err){_this4._disposed||_this4._paused||_this4._emitWarning(_errors.ErrorDetails.MEDIA_PLAY_FAILED,err)})}},{key:"_doPlaybackEnded",value:function(){_logger.logger.log("PLAYBACK_ENDED"),this.playbackRate=1,this._emit(_HlsEvents2.default.PLAYBACK_ENDED)}},{key:"_doStreamCanPlay",value:function(){if(_logger.logger.log("STREAM_CANPLAY"),this._lateStartWorkaround&&this.audioOnly&&this.seek(this._startPosition),this._canplay=!0,this._initialTime=this._startPosition,this._buffering=!0,this._state!==_HlsStates2.default.FETCHING)throw new Error("impossible not to be in fetching when canplay comes through");this._emit(_HlsEvents2.default.STREAM_CANPLAY),this._beginStreamPlayback()}},{key:"_doStreamCanPlayThrough",value:function(){_logger.logger.log("STREAM_CANPLAYTHROUGH"),this._canplaythrough=!0,this._buffering=!1,this._ended=!1,this._mediaController.captionsControl(),this._emit(_HlsEvents2.default.STREAM_CANPLAYTHROUGH),this._decidePlaybackState()}},{key:"_doStreamPrefetch",value:function(){this._state===_HlsStates2.default.LOADED&&(this._prefetch=!0,this._emit(_HlsEvents2.default.STREAM_PREFETCH),this._startFetching())}},{key:"_doStreamPause",value:function(){this._paused=!0,this._emit(_HlsEvents2.default.STREAM_PAUSE),this._decidePlaybackState()}},{key:"_doStreamPlay",value:function(){_logger.logger.log("HlsController::_doStreamPlay"),this._paused=!1,this._ended=!1,this._checkIfInBufferedRange()&&(this._buffering=!1),this._emit(_HlsEvents2.default.STREAM_PLAY),this._prefetch||this.prefetch(),this._decidePlaybackState()}},{key:"_attemptMediaAttaching",value:function(){_logger.logger.log("HlsController::_attemptMediaAttaching"),this._mediaState===_MediaStates2.default.WIRED&&null!==this._source&&this._emit(_HlsEvents2.default.MEDIA_ATTACHING,{media:this._media})}},{key:"_attachPendingMediaOrUrl",value:function(){if(_logger.logger.log("HlsController::_attachPendingMediaOrUrl { mediaState: "+this._mediaState+" }"),this._mediaState!==_MediaStates2.default.DETACHING){if(_logger.logger.log("HlsController::_attachPendingMediaOrUrl checking for pending Url or Media"),this._pendingMedia){if(this._media)throw new Error("_attachPendingMediaOrUrl with valid media already set!");_logger.logger.log("HlsController::_attachPendingMediaOrUrl: wiring media "+this._pendingMedia),this._setMedia(this._pendingMedia),this._pendingMedia=null,this._emit(_HlsEvents2.default.MEDIA_WIRING,{media:this._media})}this._pendingUrl&&(_logger.logger.log("HlsController::_attachPendingMediaOrUrl: setting url "+this._pendingUrl),this.loadPendingSource())}}},{key:"_onMediaWiring",value:function(data){if(!data.media)throw new Error("HlsController::_onMediaWiring, invalid media { media: "+data.media+" }");_logger.logger.log("MEDIA_WIRING: { media: "+data.media+" mediaState: "+this._mediaState+" }"),this._setMediaState(_MediaStates2.default.WIRING),this._mediaController.media=data.media}},{key:"_onMediaWired",value:function(data){var _this5=this;_logger.logger.log("MEDIA_WIRED: { media: "+data.media+" mediaState: "+this._mediaState+" }"),this._media=data.media,this._setMediaState(_MediaStates2.default.WIRED),null!==this._source&&(_logger.logger.log("_onMediaWired, queuing _attemptMediaAttaching"),this._safeDoNextTick(function(){return _this5._attemptMediaAttaching()}))}},{key:"_onMediaAttaching",value:function(data){var _this6=this;if(_logger.logger.log("MEDIA_ATTACHING: { media: "+data.media+" mediaState: "+this._mediaState+" }"),!(data.media instanceof HTMLMediaElement))throw new Error("HlsController::_onMediaAttaching, invalid media { media: "+data.media+" }");if(this._mediaState!==_MediaStates2.default.WIRED)throw new Error("HlsController::_onMediaAttaching, invalid state { mediaState: "+this._mediaState+" }");this._setMediaState(_MediaStates2.default.ATTACHING),_logger.logger.log("_onMediaAttaching, queuing _hlsJsController.attachMedia"),this._safeDoNextTick(function(){return _this6._hlsJsController.attachMedia(data.media)})}},{key:"_onMediaAttached",value:function(data){if(_logger.logger.log("MEDIA_ATTACHED: { media: "+data.media+", mediaState: "+this._mediaState+" }"),this._mediaState!==_MediaStates2.default.ATTACHING)throw new Error("HlsController::_onMediaAttached invalid state { mediaState: "+this._mediaState+" }");this._setMediaState(_MediaStates2.default.ATTACHED)}},{key:"_onMediaDetaching",value:function(data){var _this7=this;if(_logger.logger.log("MEDIA_DETACHING: { media: "+data.media+" mediaState: "+this._mediaState+" }"),this._mediaState===_MediaStates2.default.DETACHED)throw new Error("HlsController::_onMediaDetaching invalid mediaState { "+this._mediaState+"}");var lastMediaState=this._mediaState;this._setMediaState(_MediaStates2.default.DETACHING),lastMediaState===_MediaStates2.default.WIRING||lastMediaState===_MediaStates2.default.WIRED?(_logger.logger.log("HlsController::_onMediaDetaching unwiring mediaController"),this._safeDoNextTick(function(){_this7._mediaController.media?_this7._mediaController.media=null:_this7._emit(_HlsEvents2.default.MEDIA_CONTROLLER_UNWIRED,{media:null})})):lastMediaState===_MediaStates2.default.ATTACHED&&(_logger.logger.log("HlsController::_onMediaDetaching detaching hlsJsController"),this._hlsJsController.detachMedia())}},{key:"_onMediaDetached",value:function(data){var _this8=this;_logger.logger.log("MEDIA_DETACHED: { media: "+data.media+" }"),this._setMedia(null),this._setMediaState(_MediaStates2.default.DETACHED),this._resetState(),this._pendingDispose?(_logger.logger.log("HlsController::_onMediaDetached processing _pendingDispose"),process.nextTick(function(){return _this8._doDispose()})):this._disposed||this._attachPendingMediaOrUrl()}},{key:"_safeDoNextTick",value:function(lambda){var _this9=this;process.nextTick(function(){_this9._disposed||lambda()})}},{key:"_onMediaControllerWired",value:function(data){var _this10=this;if(_logger.logger.log("MEDIA_CONTROLLER_WIRED: { media: "+data.media+" mediaState: "+this._mediaState+" }"),this._mediaState===_MediaStates2.default.WIRING)this._safeDoNextTick(function(){return _this10._emit(_HlsEvents2.default.MEDIA_WIRED,data)});else{if(this._mediaState!==_MediaStates2.default.DETACHING)throw new Error("HlsController::_onMediaControllerWired invalid state { mediaState: "+this._mediaState+" }");this._mediaController=null}}},{key:"_onMediaControllerUnwired",value:function(data){var _this11=this;if(_logger.logger.log("MEDIA_CONTROLLER_UNWIRED: { media: "+data.media+" mediaState: "+this._mediaState+" }"),this._mediaState!==_MediaStates2.default.DETACHING)throw new Error("HlsController:_onMediaControllerUnwired invalid state { mediaState: "+this._mediaState+" }");this._safeDoNextTick(function(){return _this11._emit(_HlsEvents2.default.MEDIA_DETACHED,data)})}},{key:"_onMediaControllerError",value:function(data){_logger.logger.log("MEDIA_CONTROLLER_ERROR: { data: "+data+" }"),this._handleMediaControllerError(data)}},{key:"_onMediaElementError",value:function(data){_logger.logger.log("MEDIA_ELEMENT_ERROR: { data: "+data+" }"),this._handleMediaElementError(data)}},{key:"_onMediaCanPlayThrough",value:function(){_logger.logger.log("MEDIA_CANPLAYTHROUGH"),this._canplaythrough?_logger.logger.log("redundant CANPLAYTHROUGH call, ignoring"):this._doStreamCanPlayThrough()}},{key:"_onMediaDurationChange",value:function(){_logger.logger.log("MEDIA_DURATIONCHANGE");var data={duration:this._mediaController.duration,lastDuration:this._prevDuration};this._prevDuration=this._mediaController.duration,this._emit(_HlsEvents2.default.STREAM_DURATION_CHANGED,data)}},{key:"_onMediaTimeUpdate",value:function(data){this._updatePlaybackRange(),this.live&&(this.playbackRate>1&&this.currentTime>this.liveTime?(_logger.logger.log("live time reached, setting playback rate to 1"),this.playbackRate=1):this.currentTime<=this.seekableRange.start&&this.playbackRate<1&&(_logger.logger.log("start of stream reached, setting playback rate to 1"),this.playbackRate=1)),this._emit(_HlsEvents2.default.STREAM_TIMEUPDATE,data)}},{key:"_onMediaCanPlay",value:function(){_logger.logger.log("MEDIA_CANPLAY"),this._canplay?_logger.logger.log("redundant CANPLAY call, ignoring"):this._startPositionSet?this._doStreamCanPlay():this._canplayWaiting=!0}},{key:"_onMediaSeeking",value:function(){this._mediaState!==_MediaStates2.default.DETACHING&&(_logger.logger.log("MEDIA_SEEKING"),this._fetching||this._state!==_HlsStates2.default.PLAYBACK||this.resumeFetching(),this._seeking=!0,this._ended=!1,_logger.logger.log("playbackRange: ["+this._playbackRange.start+","+this._playbackRange.end+","+this._playbackRange.duration+"], isLive: "+this.live)),this._decidePlaybackState()}},{key:"_onMediaSeeked",value:function(){this._seeking&&(_logger.logger.log("MEDIA_SEEKED"),this._seeking=!1),this._checkIfInBufferedRange()&&(this._buffering=!1),this._decidePlaybackState()}},{key:"_onMediaEnded",value:function(){this._ended=!0,this._seeking=!1,this._buffering=!1,this._decidePlaybackState()}},{key:"_onMediaRateChange",value:function(){_logger.logger.log("MEDIA_RATECHANGE");var lastPlaybackRate=this._lastPlaybackRate;this._lastPlaybackRate=this.playbackRate,this._emit(_HlsEvents2.default.STREAM_PLAYBACKRATE_CHANGED,{playbackRate:this.playbackRate,lastPlaybackRate:lastPlaybackRate}),(this._forcePlaybackRateWorkaround||this._resyncPlaybackRateWorkaround&&1===this.playbackRate&&1!==lastPlaybackRate)&&(this._paused?this._seekBackOnPlay=!0:this.currentTime-=1e-6)}},{key:"_updatePlaybackRange",
value:function(){this._playbackRange.start=this.currentTime,this._playbackRange.end=Math.min(this.seekableRange.end,this.bufferedRangeCurrent.end),this._playbackRange.duration=this._playbackRange.end-this._playbackRange.start}},{key:"_checkIfInSeekableRange",value:function(){if(_logger.logger.log("_checkIfInSeekableRange: currentTime: "+this.currentTime+" _seekableRange.start: "+this._seekableRange.start),this._seekableRange.start>this.currentTime){var data={currentTime:this.currentTime,windowStart:this._seekableRange.start,timeBehindWindow:this._seekableRange.start-this.currentTime};_logger.logger.warn("playhead has fallen behind sliding window start @"+this.currentTime),this._checkIfInBufferedRange()&&this.live||(_logger.logger.warn("attempting to correct playhead"),this._mediaController.currentTime=this.seekableRange.start+.001),this._emit(_HlsEvents2.default.STREAM_PLAYHEAD_BEHIND_SLIDING_WINDOW,data)}}},{key:"_checkIfInBufferedRange",value:function(){for(var i=0;i<this.bufferedRange.length;i++)if(this.bufferedRange[i].start!==this.bufferedRange[i].end&&this.currentTime>=this.bufferedRange[i].start&&this.currentTime<=this.bufferedRange[i].end)return!0;return!1}},{key:"on",value:function(event,func){_HlsUtils2.default.throwIfNotEvent(event),this._emitter.on(event,func)}},{key:"off",value:function(event,func){_HlsUtils2.default.throwIfNotEvent(event),this._emitter.off(event,func)}},{key:"once",value:function(event,func){_HlsUtils2.default.throwIfNotEvent(event),this._emitter.once(event,func)}},{key:"_emit",value:function(event){for(var _emitter,_len=arguments.length,args=Array(_len>1?_len-1:0),_key=1;_key<_len;_key++)args[_key-1]=arguments[_key];(_emitter=this._emitter).emit.apply(_emitter,[event].concat(args))}},{key:"getConstraints",value:function(){return this._hlsJsController.getConstraints()}},{key:"setConstraints",value:function(constraints){this._hlsJsController.setConstraints(constraints)}},{key:"getTimeouts",value:function(){return this._hlsJsController.getTimeouts()}},{key:"setTimeouts",value:function(timeouts){this._hlsJsController.setTimeouts(timeouts)}},{key:"getPlaybackMetrics",value:function(){var metrics={};return metrics.bitrate=this._playbackMetrics.bitrate,metrics.droppedFramesCount=this._mediaController.droppedFramesCount,metrics.frameRate=this._mediaController.frameRate,metrics.time=this.currentTime,metrics.bufferedRange=this.bufferedRangeCurrent,metrics.playbackRange=this.playbackRange,metrics.seekableRange=this.seekableRange,metrics}},{key:"getNetworkMetrics",value:function(){return this._hlsJsController.getNetworkMetrics()}},{key:"getDrmCapabilities",value:function(){return this._hlsJsController.getDrmCapabilities()}},{key:"_onNetworkMetricsChanged",value:function(data){var lastMetrics=data.lastNetworkMetrics,currentMetrics=data.networkMetrics;if(currentMetrics.chosenVariant!==lastMetrics.chosenVariant){var eventData={chosenVariant:currentMetrics.chosenVariant,lastChosenVariant:lastMetrics.chosenVariant};this._emit(_HlsEvents2.default.STREAM_CHOSENVARIANT_CHANGED,eventData)}if(currentMetrics.chosenBitrate!==lastMetrics.chosenBitrate){this._playbackMetrics.bitrate=currentMetrics.chosenBitrate;var _eventData={chosenBitrate:currentMetrics.chosenBitrate,lastChosenBitrate:lastMetrics.chosenBitrate};this._emit(_HlsEvents2.default.STREAM_CHOSENBITRATE_CHANGED,_eventData)}}},{key:"_onTestEvent",value:function(data){_logger.logger.log("TEST_EVENT received"),this.testEventData=data}},{key:"fireTestEvent",value:function(data){_logger.logger.log("firing TEST_EVENT"),this._emit(_HlsEvents2.default.TEST_EVENT,data)}},{key:"addUserMarker",value:function(time,callback,data){return this._markers.addTypedMarker(time,callback,"user",data)}},{key:"removeMarker",value:function(markerId){this._markers.removeMarker(markerId)}},{key:"getTimeForPdt",value:function(pdt){return this.basePdt?this._hlsJsController.getTimeForPdt(pdt):void 0}},{key:"getPdtForTime",value:function(time){return this.basePdt?this._hlsJsController.getPdtForTime(time):void 0}},{key:"emitter",get:function(){return this._emitter}},{key:"isMediaAttached",get:function(){return this._mediaState===_MediaStates2.default.ATTACHED}},{key:"state",get:function(){return this._state}},{key:"playbackState",get:function(){return this._playbackState}},{key:"mediaState",get:function(){return this._mediaState}},{key:"src",get:function(){var retSource=null;return retSource=this._pendingUrl?this._pendingUrl:this._source,retSource},set:function(url){this.loadSource(url)}},{key:"media",get:function(){return this._media},set:function(video){this.attachMedia(video)}},{key:"autoPrefetch",get:function(){return this._autoPrefetch},set:function(value){this._autoPrefetch=!!value}},{key:"autoPlay",get:function(){return this._autoPlay},set:function(value){this._autoPlay=!!value}},{key:"autoRecover",get:function(){return this._autoRecover},set:function(value){this._autoRecover=!!value}},{key:"nudgeOnStall",get:function(){return this._hlsJsController.nudgeOnStall},set:function(value){this._hlsJsController.nudgeOnStall=value}},{key:"liveStreamsStartAtLiveTime",get:function(){return this._hlsJsController.liveStreamsStartAtLiveTime},set:function(value){this._hlsJsController.liveStreamsStartAtLiveTime=value}},{key:"xhrSetup",get:function(){return this._hlsJsController.xhrSetup},set:function(func){this._hlsJsController.xhrSetup=func}},{key:"keyLoadCallback",get:function(){return this._hlsJsController.keyLoadCallback},set:function(func){this._hlsJsController.keyLoadCallback=func}},{key:"obtainKeySystemConfigCallback",get:function(){return this._hlsJsController.obtainKeySystemConfigCallback},set:function(func){this._hlsJsController.obtainKeySystemConfigCallback=func}},{key:"loaded",get:function(){return this._loaded}},{key:"fetching",get:function(){return this._fetching}},{key:"paused",get:function(){return this._paused}},{key:"ended",get:function(){return this._ended}},{key:"basePdt",get:function(){return this._hlsJsController.basePdt}},{key:"buffering",get:function(){return this._buffering}},{key:"seeking",get:function(){return this._seeking}},{key:"live",get:function(){return this._hlsJsController.live}},{key:"slidingWindow",get:function(){return this._hlsJsController.slidingWindow}},{key:"audioOnly",get:function(){return this._hlsJsController.audioOnly}},{key:"multithreaded",get:function(){return this._hlsJsController.multithreaded}},{key:"duration",get:function(){return this._mediaController.duration}},{key:"variants",get:function(){return this._hlsJsController.levels}},{key:"audioRenditions",get:function(){return this._hlsJsController.audioRenditions}},{key:"currentAudioRendition",get:function(){return this._hlsJsController.currentAudioRendition},set:function(index){this._hlsJsController.currentAudioRendition=index}},{key:"initialAudioLanguage",get:function(){return this._hlsJsController.initialAudioLanguage},set:function(language){this._hlsJsController.initialAudioLanguage=language}},{key:"initialAudioName",get:function(){return this._hlsJsController.initialAudioName},set:function(name){this._hlsJsController.initialAudioName=name}},{key:"initialAudioIndex",get:function(){return this._hlsJsController.initialAudioIndex},set:function(index){this._hlsJsController.initialAudioIndex=index}},{key:"subtitleRenditions",get:function(){return this._hlsJsController.subtitleRenditions}},{key:"subtitlesEnabled",get:function(){return this._mediaController.subtitlesEnabled},set:function(value){this._mediaController.subtitlesEnabled=value}},{key:"changeSubtitlesByIndex",set:function(value){this._hlsJsController.changeSubtitlesByIndex=value}},{key:"muted",get:function(){return this._mediaController.muted},set:function(value){this._mediaController.muted=value}},{key:"volume",get:function(){return this._mediaController.volume},set:function(value){this._mediaController.volume=value}},{key:"debug",get:function(){return this._debug},set:function(value){this._debug=!!value,(0,_logger.enableLogs)(this._debug)}},{key:"disposed",get:function(){return this._disposed}},{key:"useAutomaticComplexityReduction",get:function(){return this._hlsJsController.useAutomaticComplexityReduction},set:function(value){this._hlsJsController.useAutomaticComplexityReduction=value}},{key:"bitrateCycle",get:function(){return this._hlsJsController.bitrateCycle},set:function(value){this._hlsJsController.bitrateCycle=value}},{key:"maximumBufferSize",get:function(){return this._hlsJsController.maximumBufferSize},set:function(value){this._hlsJsController.maximumBufferSize=value}},{key:"minimumBufferLength",get:function(){return this._hlsJsController.minimumBufferLength},set:function(value){this._hlsJsController.minimumBufferLength=value}},{key:"maximumBufferLength",get:function(){return this._hlsJsController.maximumBufferLength},set:function(value){this._hlsJsController.maximumBufferLength=value}},{key:"startTime",get:function(){return this._hlsJsController.startTime},set:function(seconds){this._hlsJsController.startTime=seconds}},{key:"startTimeByPdt",get:function(){return this._hlsJsController.startTimeByPdt},set:function(time){this._hlsJsController.startTimeByPdt=time}},{key:"startVariant",get:function(){return this._hlsJsController.startLevel},set:function(variant){this._hlsJsController.startLevel=variant}},{key:"startBitrate",get:function(){return this._hlsJsController.startBitrate},set:function(bitrate){this._hlsJsController.startBitrate=bitrate}},{key:"currentTime",get:function(){return this._mediaController.currentTime},set:function(seconds){_logger.logger.log("set currentTime: seconds: "+seconds+", _seekableRange.start: "+this._seekableRange.start+" liveTime: "+this.liveTime),_HlsUtils2.default.checkNotFiniteAndThrow(seconds,"currentTime"),this.seek(seconds)}},{key:"currentTimeAsPdt",get:function(){return this.getPdtForTime(this.currentTime)},set:function(pdt){this.seekByPdt(pdt)}},{key:"playbackRate",get:function(){return this._mediaController.playbackRate},set:function(value){this.live?this.currentTime>this.liveTime&&value>1?_logger.logger.warn("set playbackRate: can't fast forward after the live point"):this.currentTime<this.seekableRange.start&&value<1?_logger.logger.warn("set playbackRate: can't slow forward before the start of the sliding window"):this._mediaController.playbackRate=value:this._mediaController.playbackRate=value}},{key:"initialTime",get:function(){return this._initialTime!==-1?this._initialTime:0}},{key:"liveTime",get:function(){return this._hlsJsController.liveTime}},{key:"seekableRange",get:function(){var seekableRange={start:void 0!==this._seekableRange.start?this._seekableRange.start:0,end:void 0!==this._seekableRange.end?this._seekableRange.end:0,duration:void 0!==this._seekableRange.duration?this._seekableRange.duration:0};return seekableRange}},{key:"bufferedRange",get:function(){return this._hlsJsController.bufferedRange}},{key:"playbackRange",get:function(){var playbackRange={start:void 0!==this._playbackRange.start?this._playbackRange.start:0,end:void 0!==this._playbackRange.end?this._playbackRange.end:0,duration:void 0!==this._playbackRange.duration?this._playbackRange.duration:0};return playbackRange}},{key:"bufferedRangeCurrent",get:function(){for(var i=0;i<this.bufferedRange.length;i++)if(this.currentTime>=this.bufferedRange[i].start&&this.currentTime<=this.bufferedRange[i].end)return this.bufferedRange[i];return{start:this.currentTime,end:this.currentTime,duration:0}}},{key:"instanceId",get:function(){return this._instanceId}}],[{key:"isSupported",value:function(){return _HlsUtils2.default.isBrowser()&&_HlsJsController2.default.isSupported()}},{key:"totalActive",value:function(){return _counter.active()}},{key:"totalCreated",value:function(){return _counter.total()}},{key:"isRedirectSupported",value:function(){var redirectSupported=!0;return _HlsUtils2.default.isIE()===!0?redirectSupported=!1:_HlsUtils2.default.isTizen2()===!0&&(redirectSupported=!1),redirectSupported}}]),HlsController}();exports.default=HlsController,module.exports=exports["default"]}).call(exports,__webpack_require__(61))},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var HlsDataTypes={MANIFEST:"MANIFEST",CHUNK:"CHUNK",KEY:"KEY"};exports.default=HlsDataTypes,module.exports=exports["default"]},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_hls=__webpack_require__(130),_hls2=_interopRequireDefault(_hls),_HlsEvents=__webpack_require__(14),_HlsEvents2=_interopRequireDefault(_HlsEvents),_events=__webpack_require__(3),_events2=_interopRequireDefault(_events),_errors=__webpack_require__(4),_EventHandlers=__webpack_require__(35),_EventHandlers2=_interopRequireDefault(_EventHandlers),_eventemitter=__webpack_require__(34),_eventemitter2=_interopRequireDefault(_eventemitter),_KeySystems=__webpack_require__(36),_KeySystems2=_interopRequireDefault(_KeySystems),_CencModes=__webpack_require__(62),_CencModes2=_interopRequireDefault(_CencModes),_CustomKeyLoader=__webpack_require__(100),_CustomKeyLoader2=_interopRequireDefault(_CustomKeyLoader),_keyLoader=__webpack_require__(70),_keyLoader2=_interopRequireDefault(_keyLoader),_HlsUtils=__webpack_require__(6),_HlsUtils2=_interopRequireDefault(_HlsUtils),_logger=__webpack_require__(1);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}__webpack_require__(77);var HlsJsController=function(){_createClass(HlsJsController,null,[{key:"isHlsSupported",value:function(){return _hls2.default.isSupported()}}]);function HlsJsController(){var config=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},di=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};_classCallCheck(this,HlsJsController);var disableWorkarounds=!!config.disableWorkarounds||!1,enableMuxJs=!0,decryptOutsideWebworker=!1;config.decryptOutsideWebworker===!0&&(decryptOutsideWebworker=!0),this._instanceId=config.instanceId,this._emitter=di.eventEmitter||new _eventemitter2.default,this._hlsJs=di.hlsJs||new _hls2.default({autoStartLoad:!1,maxBufferSize:6e7,maxBufferLength:30,maxMaxBufferLength:60,enableWorker:!_HlsUtils2.default.isFirefoxBadWorker()||disableWorkarounds,enableMuxJs:enableMuxJs,decryptOutsideWebworker:decryptOutsideWebworker,xhrSetup:this._hlsJsXhrSetup.bind(this),obtainKeySystemConfigCallback:this._hlsJsObtainKeySystemConfigCallback.bind(this),fetchSetup:function(context,initParams){return initParams.credentials="include",new Request(context.url,initParams)}}),this._disposed=!1,this._inDetach=!1,this._pendingDispose=!1,this._handlers=new _EventHandlers2.default,this._source="",this._levels=[],this._startTime=0,this._startTimeByPdt=void 0,this._startLevel=-1,this._startBitrate=-1,this._liveStreamsStartAtLiveTime=!0,this._fetching=!1,this._loaded=!1,this._live=void 0,this._basePdt=void 0,this._slidingWindow=!1,this._slidingWindowSize=0,this._liveTime=void 0,this._bufferedRange=void 0,this._networkMetrics={chosenBitrate:null,chosenVariant:null,perceivedBitrate:null,displayTime:null},this._nextNetworkMetrics={chosenBitrate:null,chosenVariant:null,perceivedBitrate:null,displayTime:null},this._multithreaded=(!_HlsUtils2.default.isFirefoxBadWorker()||disableWorkarounds)&&"undefined"!==typeof Worker,this._audioOnly=!1,this._mediaAttached=!1,this._media=null,this._constraints={minVariant:-1,maxVariant:-1,minBitrate:-1,maxBitrate:-1,minWidth:-1,minHeight:-1,maxWidth:-1,maxHeight:-1},this._timeouts={manifestTimeout:1e4,manifestTimeoutMax:5e3,variantTimeout:1e4,variantTimeoutMax:5e3,chunkTimeout:2e4,chunkTimeoutMax:5e3,streamTimeout:3e4},this._hlsJs.timeouts=this._timeouts,this._minimumConstraint=-1,this._maximumConstraint=-1,this._subtitleRenditions=[],this._explicitDimensions=!1,this._bitrateCycle=!1,this._bitrateStepDown=!1,this._bitrateCycleMax=-1,this._bitrateCycleMin=-1,this._xhrSetup=null,this._customKeyLoadCallback=null,this._originalKeyLoader=null,this._keyCache=null,this._obtainKeySystemConfigCallback=null,this._fatalErrors=0,this._initialAudioLanguage=null,this._initialAudioName=null,this._initialAudioIndex=-1,this._initialAudioTrackSelected=!1,this._recoveryAudioIndex=-1,this._recoveryStartTime=-1,this._recoveryStartTimeByPdt=void 0,this._hlsJsEvents=[{event:_events2.default.ERROR,func:this._onHlsJsError},{event:_events2.default.MEDIA_ATTACHING,func:this._onHlsJsMediaAttaching},{event:_events2.default.MEDIA_ATTACHED,func:this._onHlsJsMediaAttached},{event:_events2.default.MEDIA_DETACHING,func:this._onHlsJsMediaDetaching},{event:_events2.default.MEDIA_DETACHED,func:this._onHlsJsMediaDetached},{event:_events2.default.MANIFEST_LOADED,func:this._onHlsJsManifestLoaded},{event:_events2.default.MANIFEST_PARSED,func:this._onHlsJsManifestParsed},{event:_events2.default.LEVEL_LOADED,func:this._onHlsJsLevelLoaded},{event:_events2.default.LEVEL_UPDATED,func:this._onHlsJsLevelUpdated},{event:_events2.default.LEVEL_DURATION_UPDATED,func:this._onHlsJsLevelDurationUpdated},{event:_events2.default.BUFFER_CREATED,func:this._onHlsJsBufferCreated},{event:_events2.default.BUFFER_APPENDED,func:this._onHlsJsBufferAppended},{event:_events2.default.BUFFER_FLUSHED,func:this._onHlsJsBufferFlushed},{event:_events2.default.LEVEL_SWITCHING,func:this._onHlsJsLevelSwitching},{event:_events2.default.FRAG_LOADED,func:this._onHlsJsFragLoaded},{event:_events2.default.FRAG_PARSING_METADATA,func:this._onHlsJsMetadataParsed},{event:_events2.default.FRAG_BUFFERED,func:this._onHlsJsFragBuffered},{event:_events2.default.TEXT_TRACK_ADDED,func:this._onHlsJsTextTrackAdded},{event:_events2.default.AUDIO_TRACKS_UPDATED,func:this._onHlsJsAudioTracksUpdated},{event:_events2.default.START_POSITION_SET,func:this._onHlsJsStartPositionSet},{event:_events2.default.FPS_DROP_LEVEL_CAPPING,func:this._onHlsJsFpsDropLevelCapping},{event:_events2.default.LOGTUBE_LOG,func:this._onHlsJsLogTube},{event:_events2.default.FRAG_DATERANGE_UPDATE,func:this._onHlsJsDateRange},{event:_events2.default.STREAM_LIVETIME_CHANGED,func:this._onHlsJsLiveTimeChange},{event:_events2.default.STREAM_BASEPDT_FOUND,func:this._onHlsJsBasePdtFound},{event:_events2.default.BITRATE_ESTIMATE_UPDATED,func:this._onHlsJsBitrateEstimateUpdated},{event:_events2.default.LEVEL_SELECTION_FINISHED,func:this._onHlsJsLevelSelectionFinished},{event:_events2.default.FRAG_START_FOUND,func:this._onHlsJsFragStartFound},{event:_events2.default.SEEK_READY,func:this._onHlsJsSeekReady}],_EventHandlers2.default.verifyEventsList(this._hlsJsEvents),this._wireHlsJsEvents(),_HlsUtils2.default.applyConfig(this,config)}return _createClass(HlsJsController,[{key:"dispose",value:function(){if(this._disposed||this._pendingDispose)throw new Error("HlsJsController can not be disposed more than once");if(!this._hlsJs)throw new Error("HlsJsController.dispose no hlsjs instance");this._mediaAttached?(this._pendingDispose=!0,this._doDetachMedia()):this._doDispose()}},{key:"_doDispose",value:function(){this._disposed=!0,this._unwireHlsJsEvents(),this._hlsJs.destroy(),this._hlsJs=null,this._originalKeyLoader&&this._originalKeyLoader.destroy(),this._originalKeyLoader=null,this._constraints=null,this._timeouts=null,this._source=null,this._levels=null,this._subtitleRenditions=null,this._customKeyLoadCallback=null,this._bufferedRange=null,this._basePdt=null,this._startTimeByPdt=null,this._handlers.dispose(),this._handlers=null,this._hlsJsEvents=null,this._emitter=null,this._pendingDispose=!1}},{key:"flushBuffer",value:function(levelFlush){return this._hlsJs.flushBuffers(levelFlush)}},{key:"_wireHlsJsEvent",value:function(_ref){var event=_ref.event,func=_ref.func,handler=this._handlers.createEventHandler(this,func);this._hlsJs.on(event,handler)}},{key:"_unwireHlsJsEvent",value:function(_ref2){var event=_ref2.event,func=_ref2.func,handler=this._handlers.getHandlerForFunction(func);handler&&this._hlsJs.off(event,handler)}},{key:"_wireHlsJsEvents",value:function(){var _this=this;this._hlsJsEvents.forEach(function(event){return _this._wireHlsJsEvent(event)})}},{key:"_unwireHlsJsEvents",value:function(){var _this2=this;this._hlsJsEvents.forEach(function(event){return _this2._unwireHlsJsEvent(event)})}},{key:"_hlsJsXhrSetup",value:function(xhr,url,type){this._xhrSetup&&this._xhrSetup(xhr,url,type)}},{key:"_hlsJsObtainKeySystemConfigCallback",value:function(keySystem,keySystemData){return this._obtainKeySystemConfigCallback?this._obtainKeySystemConfigCallback(keySystem,keySystemData):null}},{key:"_emit",value:function(event){for(var _emitter,_len=arguments.length,args=Array(_len>1?_len-1:0),_key=1;_key<_len;_key++)args[_key-1]=arguments[_key];(_emitter=this._emitter).emit.apply(_emitter,[event].concat(args))}},{key:"_setLevels",value:function(levels){this._levels=levels,this._emit(_HlsEvents2.default.STREAM_VARIANTS_CHANGED,{variants:levels})}},{key:"_processLevelUpdate",value:function(levelUpdate){var sliding=levelUpdate.sliding,liveSyncPosition=this._hlsJs.streamController.computeLivePosition(sliding,levelUpdate.details);_logger.logger.log("_processLevelUpdate: sliding: "+sliding+", liveSyncPosition: "+liveSyncPosition),this._setLive(levelUpdate.details.live),sliding>=levelUpdate.details.targetduration/2&&this._setSlidingWindowSize(sliding)}},{key:"_setLiveTime",value:function(newLiveTime){if(void 0===newLiveTime||newLiveTime<0)throw new Error("_setLiveTime: newLiveTime "+newLiveTime+" must be valid");if(void 0===this._liveTime||newLiveTime>this._liveTime){var oldLiveTime=this.liveTime;this._liveTime=newLiveTime;var data={liveTime:newLiveTime,lastLiveTime:oldLiveTime};_logger.logger.log("STREAM_LIVETIME_CHANGED: { liveTime: "+data.liveTime+" lastLiveTime: "+data.lastLiveTime+" }"),this._emit(_HlsEvents2.default.STREAM_LIVETIME_CHANGED,data)}}},{key:"_setLive",value:function(newLive){if(void 0===newLive)throw new Error("_setLive: newLive must be valid");if(void 0===this._live||this._live===!0&&newLive===!1){var oldLive=this.live;this._live=newLive;var data={live:newLive,lastLive:oldLive};_logger.logger.log("STREAM_ISLIVE_CHANGED: { live: "+data.live+" lastLive: "+data.lastLive+" }"),this._emit(_HlsEvents2.default.STREAM_ISLIVE_CHANGED,data)}}},{key:"_setSlidingWindow",value:function(slidingWindow){if(slidingWindow!==!0)throw new Error("_setSlidingWindow: slidingWindow can only ever become true. slidingWindow: "+slidingWindow);if(this._slidingWindow!==slidingWindow){var oldSlidingWindow=this._slidingWindow;this._slidingWindow=slidingWindow;var data={slidingWindow:slidingWindow,lastSlidingWindow:oldSlidingWindow};_logger.logger.log("STREAM_ISSLIDINGWINDOW_CHANGED: { slidingWindow: "+data.slidingWindow+" lastSlidingWindow: "+data.lastSlidingWindow+" }"),this._emit(_HlsEvents2.default.STREAM_ISSLIDINGWINDOW_CHANGED,data)}}},{key:"_setSlidingWindowSize",value:function(slidingWindowSize){if(void 0===slidingWindowSize)throw new Error("_setSlidingWindowSize: slidingWindowSize must be valid");slidingWindowSize>this._slidingWindowSize&&(this._slidingWindowSize=slidingWindowSize,this._slidingWindow||this._setSlidingWindow(!0))}},{key:"_setAudioOnly",value:function(audioOnly){if(audioOnly!==this._audioOnly){var data={audioOnly:audioOnly,lastAudioOnly:this._audioOnly};_logger.logger.log("STREAM_ISAUDIOONLY_CHANGED: { audioOnly: "+data.audioOnly+" lastAudioOnly: "+data.lastAudioOnly+" }"),this._audioOnly=audioOnly,this._emit(_HlsEvents2.default.STREAM_ISAUDIOONLY_CHANGED,data)}}},{key:"_setMultithreaded",value:function(multithreaded){if(multithreaded!==!1)throw new Error("_setMultithreaded: multithreaded should only ever become false. multithreaded: "+multithreaded);if(this._multithreaded!==multithreaded){var oldMultithreaded=this._multithreaded;this._multithreaded=multithreaded;var data={multithreaded:this._multithreaded,lastMultithreaded:oldMultithreaded};_logger.logger.log("STREAM_ISMULTITHREADED_CHANGED: { multithreaded: "+data.multithreaded+" lastMultithreaded: "+data.lastMultithreaded+" }"),this._emit(_HlsEvents2.default.STREAM_ISMULTITHREADED_CHANGED,data)}}},{key:"_setHlsJsMinMaxBitrate",value:function(){this._setHlsJsMaximumBitrate(this._constraints.maxBitrate),this._setHlsJsMinimumBitrate(this._constraints.minBitrate)}},{key:"_setHlsJsMaximumBitrate",value:function(maxBitrate){if(this._levels&&this._levels.length>0){var maxLevel=this._levels.length-1;if(maxBitrate>=0)while(maxLevel>0&&this._levels[maxLevel].bitrate>maxBitrate)maxLevel--;this._hlsJs.autoLevelCapping=maxLevel}}},{key:"_setHlsJsMinimumBitrate",value:function(minBitrate){this._levels&&this._levels.length>0&&(minBitrate===-1||1===this._levels.length?this._hlsJs.config.minAutoBitrate=void 0:this._hlsJs.config.minAutoBitrate=Math.min(minBitrate,this._levels[this._levels.length-1].bitrate))}},{key:"_setBasePdt",value:function(pdt){var oldBasePdt=this.basePdt;this._basePdt=pdt;var data={basePdt:new Date(this._basePdt),oldBasePdt:oldBasePdt};_logger.logger.log("STREAM_BASEPDT_CHANGED: { basePdt: "+data.basePdt+" oldBasePdt: "+data.oldBasePdt+" }"),this._emit(_HlsEvents2.default.STREAM_BASEPDT_CHANGED,data)}},{key:"_setChosenVariant",value:function(newVariant){if(_logger.logger.log("HlsJsController::_setChosenVariant"),void 0===newVariant||newVariant<0)throw new Error("invalid variant: "+newVariant);this._nextNetworkMetrics.chosenVariant!==newVariant&&(this._nextNetworkMetrics.chosenVariant=newVariant,this._levels[newVariant].bitrate&&this._setChosenBitrate(this._levels[newVariant].bitrate))}},{key:"_setChosenBitrate",value:function(newBitrate){if(_logger.logger.log("HlsJsController::_setChosenBitrate"),void 0===newBitrate||newBitrate<0)throw new Error("invalid bitrate: "+newBitrate);this._nextNetworkMetrics.chosenBitrate!==newBitrate&&(this._nextNetworkMetrics.chosenBitrate=newBitrate)}},{key:"_setPerceivedBitrate",value:function(newBitrate){if(_logger.logger.log("HlsJsController::_setPerceivedBitrate"),void 0===newBitrate||newBitrate<0)throw new Error("invalid bitrate: "+newBitrate);var roundedBitrate=Math.round(newBitrate);this._nextNetworkMetrics.perceivedBitrate!==roundedBitrate&&(this._nextNetworkMetrics.perceivedBitrate=roundedBitrate)}},{key:"_updateNetworkMetrics",value:function(){var nm=this._networkMetrics,nnm=this._nextNetworkMetrics;nm.displayTime===nnm.displayTime&&nm.perceivedBitrate===nnm.perceivedBitrate&&nm.chosenBitrate===nnm.chosenBitrate&&nm.chosenVariant===nnm.chosenVariant||(this._networkMetrics={chosenVariant:this._nextNetworkMetrics.chosenVariant,chosenBitrate:this._nextNetworkMetrics.chosenBitrate,perceivedBitrate:this._nextNetworkMetrics.perceivedBitrate,displayTime:this._nextNetworkMetrics.displayTime},_logger.logger.log("STREAM_NETWORKMETRICS_CHANGED"),this._emit(_HlsEvents2.default.STREAM_NETWORKMETRICS_CHANGED,{networkMetrics:nnm,lastNetworkMetrics:nm}))}},{key:"_setKeyLoadCallback",value:function(){null===this._originalKeyLoader&&(this._originalKeyLoader=this._hlsJs.keyLoader),null===this._customKeyLoadCallback&&null===this._originalKeyLoader&&(this._originalKeyLoader=new _keyLoader2.default(this._hlsJs)),null!=this._keyCache?(this._keyCache.downloader=new this._hlsJs.config.loader,this._hlsJs.keyLoader=new _CustomKeyLoader2.default(this._hlsJs,this._keyCache.hlsKeyLoadCallback)):null!==this._customKeyLoadCallback?this._hlsJs.keyLoader=new _CustomKeyLoader2.default(this._hlsJs,this._customKeyLoadCallback):null===this._hlsJs.keyLoader&&(this._hlsJs.keyLoader=this._originalKeyLoader,this._originalKeyLoader=null)}},{key:"_updateBufferedRange",value:function(){var bufferedRange=[],bufferTimes=[];try{if(bufferTimes=this._hlsJs.media.buffered,void 0===bufferTimes||0===bufferTimes.length)bufferedRange[0]={start:0,end:0,duration:0};else for(var i=0;i<bufferTimes.length;i++)bufferedRange[i]={start:bufferTimes.start(i),end:bufferTimes.end(i),duration:bufferTimes.end(i)-bufferTimes.start(i)};_logger.logger.log("_updateBufferedRange completed")}catch(err){bufferedRange=[],bufferedRange[0]={start:0,end:0,duration:0}}this._bufferedRange=bufferedRange}},{key:"loadSource",value:function(url){this._source=url,this._loaded=!1,this._fetching=!1,this._hlsJs.resumeBasePdt=this._resumeBasePdt,this._resumeBasePdt=void 0,this._hlsJs.loadSource(this._source)}},{key:"attachMedia",value:function(video){if(_logger.logger.log("HlsjsController::attachMedia"),this._mediaAttached)throw new Error("HlsjsController::attachMedia media already attached");video&&(this._media=video,this._hlsJs.attachMedia(video))}},{key:"_doDetachMedia",value:function(){if(!this._mediaAttached)throw new Error("HlsjsController::_doDetachMedia no media attached");this._inDetach?_logger.logger.log("HlsJsController::_doDetachMedia not requesting detach"):(this._inDetach=!0,this._hlsJs.detachMedia())}},{key:"detachMedia",value:function(){_logger.logger.log("HlsJsController::detachMedia()"),this._doDetachMedia()}},{key:"startFetching",value:function(){if(!this._loaded)throw new Error("stream not loaded");if(this._fetching)throw new Error("stream already loading");var timeToStartAt=this._startTime;this._recoveryStartTime!==-1&&(timeToStartAt=this._recoveryStartTime,this._recoveryStartTime=-1),this._fetching=!0,_logger.logger.log("startFetching: { isLive: "+this.live+", LSSALT: "+this._liveStreamsStartAtLiveTime+", startTime: "+timeToStartAt+" }"),this._hlsJs.startLoad(timeToStartAt,this._liveStreamsStartAtLiveTime)}},{key:"stopFetching",value:function(){if(!this._loaded)throw new Error("stream not loaded");if(!this._fetching)throw new Error("stream already not fetching");this._fetching=!1,this._hlsJs.stopFetch()}},{key:"resumeFetching",value:function(){var resumePosition=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;if(!this._loaded)throw new Error("stream not loaded");if(this._fetching)throw new Error("stream already fetching");this._fetching=!0,this._hlsJs.resumeFetch(resumePosition)}},{key:"_resetState",value:function(){this._live=void 0,this._liveTime=void 0,this._audioOnly=!1,this._slidingWindow=!1,this._bufferedRange=void 0,this._fatalErrors=0,this._basePdt=void 0,this._initialAudioTrackSelected=!1}},{key:"_onHlsJsError",value:function(event,data){data.fatal===!0?(_logger.logger.log("HLSJS FATAL ERROR"),this._hlsJs.stopLoad()):_logger.logger.log("HLSJS ERROR"),data.details===_errors.ErrorDetails.DEMUX_WORKER_ALLOC_ERROR&&this._setMultithreaded(!1),this._emit(_HlsEvents2.default.HLSJS_ERROR,data)}},{key:"_onHlsJsLogTube",value:function(event,data){_logger.logger.log(data.message)}},{key:"_onHlsJsDateRange",value:function(event,data){_logger.logger.log("HLSJS STREAM_DATERANGE_UPDATE"),data&&this._emit(_HlsEvents2.default.STREAM_DATERANGE_UPDATE,{dateRange:data.dateRange,startTime:data.startTime})}},{key:"_onHlsJsMediaAttached",value:function(event,data){_logger.logger.log("HLSJS MEDIA_ATTACHED"),this._mediaAttached=!0,this._updateBufferedRange(),this._emit(_HlsEvents2.default.HLSJS_MEDIA_ATTACHED,data)}},{key:"_onHlsJsMediaDetaching",value:function(){_logger.logger.log("HLSJS MEDIA_DETACHING { mediaAttached: "+this._mediaAttached+" }")}},{key:"_onHlsJsMediaAttaching",value:function(){_logger.logger.log("HLSJS MEDIA_ATTACHING { mediaAttached: "+this._mediaAttached+" }")}},{key:"_onHlsJsMediaDetached",value:function(){this._disposed?_logger.logger.log("HLSJS MEDIA_DETACHED - already disposed, dropping event"):(_logger.logger.log("HLSJS MEDIA_DETACHED { mediaAttached: "+this._mediaAttached+", _inDetach: "+this._inDetach+", pendingDispose: "+this._pendingDispose+" }"),this._mediaAttached=!1,this._resetState(),this._media=null,
this._inDetach&&(this._inDetach=!1,this._emit(_HlsEvents2.default.HLSJS_MEDIA_DETACHED,{media:null})),this._pendingDispose&&this._doDispose())}},{key:"_onHlsJsManifestLoaded",value:function(event,data){_logger.logger.log("HLSJS MANIFEST_LOADED"),this._emit(_HlsEvents2.default.MANIFEST_LOADED,data)}},{key:"_onHlsJsManifestParsed",value:function(event,data){if(_logger.logger.log("HLSJS MANIFEST_PARSED"),this._loaded)throw new Error("manifest is already parsed!");this._setLevels(data.levels);var newExplicitDimensions=!1;this._levels&&this._levels.forEach(function(item){void 0!==item.width&&void 0!==item.height&&(newExplicitDimensions=!0)}),this._explicitDimensions=newExplicitDimensions,this._loaded=!0;var newMinMax=this._updateConstraints(),startLevel=this._getDefaultLevel();if(this._maximumConstraint=newMinMax.max,this._minimumConstraint=newMinMax.min,this._startBitrate!==-1){var startBitrate=this._startBitrate;this._constraints.minBitrate!==-1&&(startBitrate=Math.max(startBitrate,this._constraints.minBitrate)),this._constraints.maxBitrate!==-1&&(startBitrate=Math.min(startBitrate,this._constraints.maxBitrate)),startLevel=this._setStartLevelUsingBitrate(startBitrate)}else this._startLevel!==-1&&(startLevel=this._startLevel),this._minimumConstraint!==-1&&(startLevel=Math.max(startLevel,this._minimumConstraint)),this._maximumConstraint!==-1&&(startLevel=Math.min(startLevel,this._maximumConstraint));this._hlsJs.startLevel=startLevel,this._emit(_HlsEvents2.default.MANIFEST_PARSED,data)}},{key:"_onHlsJsFragBuffered",value:function(event,data){_logger.logger.log("HLSJS FRAG_BUFFERED"),this._emit(_HlsEvents2.default.CHUNK_BUFFERED),this._bitrateCycle&&"main"===data.id&&this._cycleBitrates()}},{key:"_onHlsJsLiveTimeChange",value:function(event,data){this._setLiveTime(data.liveTime)}},{key:"_onHlsJsBasePdtFound",value:function(event,data){_HlsUtils2.default.isValidDate(data.basePdt)&&(this._setBasePdt(data.basePdt),_HlsUtils2.default.isValidDate(this._recoveryStartTimeByPdt)?(this._recoveryStartTimeByPdt.getTime()>data.basePdt.getTime()?(_logger.logger.log("_onHlsJsBasePdtFound: applied this._recoveryStartTimeByPdt: "+this._recoveryStartTimeByPdt),this._hlsJs.startPositionPdt(this._recoveryStartTimeByPdt)):_logger.logger.log("_onHlsJsBasePdtFound: ignoring recovery time as it is too early this._recoveryStartTimeByPdt: "+this._recoveryStartTimeByPdt),this._recoveryStartTimeByPdt=void 0):_HlsUtils2.default.isValidDate(this._startTimeByPdt)&&this._hlsJs.startPositionPdt(this._startTimeByPdt))}},{key:"_cycleBitrates",value:function(){this._bitrateStepDown?this.getConstraints().maxVariant===this._bitrateCycleMin?(this._bitrateStepDown=!1,this.setConstraints({minVariant:this.getConstraints().maxVariant+1,maxVariant:this.getConstraints().maxVariant+1,noFlush:!0})):this.setConstraints({minVariant:this.getConstraints().maxVariant-1,maxVariant:this.getConstraints().maxVariant-1,noFlush:!0}):this.getConstraints().maxVariant===this._bitrateCycleMax?(this._bitrateStepDown=!0,this.setConstraints({minVariant:this.getConstraints().maxVariant-1,maxVariant:this.getConstraints().maxVariant-1,noFlush:!0})):this.setConstraints({minVariant:this.getConstraints().maxVariant+1,maxVariant:this.getConstraints().maxVariant+1,noFlush:!0}),_logger.logger.log("HlsJsController::_cycleBitrates: level changed to "+this.getConstraints().maxVariant)}},{key:"_selectInitialAudioTrack",value:function(renditions){_logger.logger.log("Selecting Initial Audio Track "+this._initialAudioLanguage+" "+this._initialAudioName);var renditionCount=renditions.audioTracks.length,i=0,initialAudioIndex=this._initialAudioIndex,primarySelect=-1,secondarySelect=-1;if(this._recoveryAudioIndex!==-1&&(initialAudioIndex=this._recoveryAudioIndex,this._recoveryAudioIndex=-1),initialAudioIndex>0&&this._initialAudioIndex<renditionCount)primarySelect=initialAudioIndex;else while(i<renditionCount&&primarySelect===-1)null!==this._initialAudioLanguage&&null!==this._initialAudioName?this._initialAudioLanguage===renditions.audioTracks[i].lang&&this._initialAudioName===renditions.audioTracks[i].name?primarySelect=i:secondarySelect===-1&&this._initialAudioName===renditions.audioTracks[i].name?secondarySelect=i:secondarySelect===-1&&this._initialAudioLanguage===renditions.audioTracks[i].lang&&(secondarySelect=i):null!==this._initialAudioLanguage?this._initialAudioLanguage===renditions.audioTracks[i].lang&&(primarySelect=i):null!==this._initialAudioName&&this._initialAudioName===renditions.audioTracks[i].name&&(primarySelect=i),i++;primarySelect!==-1?this.currentAudioRendition=primarySelect:secondarySelect!==-1&&(this.currentAudioRendition=secondarySelect)}},{key:"_setStartLevelUsingBitrate",value:function(bitrate){var closest=-1,diff=-1,count=0;return this._levels.forEach(function(item){var newDiff=Math.abs(bitrate-item.bitrate);(diff===-1||newDiff<diff)&&(diff=newDiff,closest=count),count++}),closest}},{key:"_onHlsJsLevelLoaded",value:function(event,data){_logger.logger.log("HLSJS LEVEL_LOADED"),this._emit(_HlsEvents2.default.VARIANT_LOADED,data)}},{key:"_onHlsJsLevelUpdated",value:function(event,data){_logger.logger.log("HLSJS LEVEL_UPDATED"),this._emit(_HlsEvents2.default.VARIANT_UPDATED,data),_logger.logger.log(data),this._processLevelUpdate(data)}},{key:"_onHlsJsLevelDurationUpdated",value:function(event,data){_logger.logger.log("HLSJS LEVEL_DURATION_UPDATED"),this._emit(_HlsEvents2.default.VARIANT_DURATION_UPDATED,data)}},{key:"_onHlsJsBufferCreated",value:function(){for(var audioOnly=!0,i=0;i<this._levels.length;i++)void 0!==this._levels[i].videoCodec&&(audioOnly=!1);this._setAudioOnly(audioOnly)}},{key:"_onHlsJsBufferAppended",value:function(){this._updateBufferedRange()}},{key:"_onHlsJsBufferFlushed",value:function(){this._updateBufferedRange(),this._emit(_HlsEvents2.default.BUFFER_FLUSHED)}},{key:"_onHlsJsLevelSwitching",value:function(event,data){_logger.logger.log("HLSJS LEVEL_SWITCHING"),this._setChosenVariant(data.level)}},{key:"_onHlsJsBitrateEstimateUpdated",value:function(event,data){this._setPerceivedBitrate(data.bitrate)}},{key:"_onHlsJsLevelSelectionFinished",value:function(){this._updateNetworkMetrics()}},{key:"_onHlsJsFragStartFound",value:function(event,data){this._nextNetworkMetrics.displayTime=this.getTimeForPdt(new Date(data.startPdt)),this._updateNetworkMetrics()}},{key:"_onHlsJsFragLoaded",value:function(event,data){_logger.logger.log("HLSJS FRAG_LOADED"),this._emit(_HlsEvents2.default.CHUNK_LOADED,data)}},{key:"_onHlsJsTextTrackAdded",value:function(event,data){_logger.logger.log("HLSJS TEXT_TRACK_ADDED"),this._subtitleRenditions.push(data.track),this._emit(_HlsEvents2.default.STREAM_SUBTITLERENDITIONS_CHANGED,data)}},{key:"_onHlsJsAudioTracksUpdated",value:function(event,data){_logger.logger.log("HLSJS AUDIO_TRACKS_UPDATED"),this._initialAudioTrackSelected===!1&&data.audioTracks.length>0&&(null!==this._initialAudioLanguage||null!==this._initialAudioName||null!==this._initialAudioIndex)&&(this._initialAudioTrackSelected=!0,this._selectInitialAudioTrack(data)),this._emit(_HlsEvents2.default.STREAM_AUDIORENDITIONS_CHANGED,data)}},{key:"_onHlsJsMetadataParsed",value:function(event,data){_logger.logger.log("HLSJS FRAG_PARSING_METADATA"),data.frag&&this._emit(_HlsEvents2.default.TIMED_METADATA_UPDATE,{id:data.id,variant:data.frag.level,chunkIdx:data.frag.sn,chunkStartTime:data.frag.start,chunkEndTime:data.frag.start+data.frag.duration,samples:data.samples})}},{key:"_onHlsJsStartPositionSet",value:function(event,data){_logger.logger.log("HLSJS START_POSITION_SET"),this._emit(_HlsEvents2.default.STREAM_STARTPOSITION_SET,data)}},{key:"_onHlsJsFpsDropLevelCapping",value:function(event,data){_logger.logger.log("HLSJS FPS_DROP_LEVEL_CAPPING"),this._constraints.maxVariant=data.level}},{key:"_onHlsJsSeekReady",value:function(event,data){this._emit(_HlsEvents2.default.HLSJS_SEEK_READY,data)}},{key:"getConstraints",value:function(){var constraints={};return constraints.minVariant=this._constraints.minVariant,constraints.maxVariant=this._constraints.maxVariant,constraints.minBitrate=this._constraints.minBitrate,constraints.maxBitrate=this._constraints.maxBitrate,constraints.minWidth=this._constraints.minWidth,constraints.minHeight=this._constraints.minHeight,constraints.maxWidth=this._constraints.maxWidth,constraints.maxHeight=this._constraints.maxHeight,constraints}},{key:"setConstraints",value:function(constraints){if(!_HlsUtils2.default.isObject(constraints))throw new Error("setConstraints: must use a valid constraints object");var newConstraints=this._constraints,flush=!1;void 0!==constraints.minVariant&&(_HlsUtils2.default.checkNotIntegerAndThrow(constraints.minVariant,"minVariant"),_HlsUtils2.default.checkLessThanMinusOneAndThrow(constraints.minVariant,"minVariant"),newConstraints.minVariant=constraints.minVariant),void 0!==constraints.maxVariant&&(_HlsUtils2.default.checkNotIntegerAndThrow(constraints.maxVariant,"maxVariant"),_HlsUtils2.default.checkLessThanMinusOneAndThrow(constraints.maxVariant,"maxVariant"),newConstraints.maxVariant=constraints.maxVariant),void 0!==constraints.minBitrate&&(_HlsUtils2.default.checkNotIntegerAndThrow(constraints.minBitrate,"minBitrate"),_HlsUtils2.default.checkLessThanMinusOneAndThrow(constraints.minBitrate,"minBitrate"),newConstraints.minBitrate=constraints.minBitrate),void 0!==constraints.maxBitrate&&(_HlsUtils2.default.checkNotIntegerAndThrow(constraints.maxBitrate,"maxBitrate"),_HlsUtils2.default.checkLessThanMinusOneAndThrow(constraints.maxBitrate,"maxBitrate"),newConstraints.maxBitrate=constraints.maxBitrate),void 0!==constraints.minWidth&&(_HlsUtils2.default.checkNotIntegerAndThrow(constraints.minWidth,"minWidth"),_HlsUtils2.default.checkLessThanMinusOneAndThrow(constraints.minWidth,"minWidth"),newConstraints.minWidth=constraints.minWidth),void 0!==constraints.minHeight&&(_HlsUtils2.default.checkNotIntegerAndThrow(constraints.minHeight,"minHeight"),_HlsUtils2.default.checkLessThanMinusOneAndThrow(constraints.minHeight,"minHeight"),newConstraints.minHeight=constraints.minHeight),void 0!==constraints.maxWidth&&(_HlsUtils2.default.checkNotIntegerAndThrow(constraints.maxWidth,"maxWidth"),_HlsUtils2.default.checkLessThanMinusOneAndThrow(constraints.maxWidth,"maxWidth"),newConstraints.maxWidth=constraints.maxWidth),void 0!==constraints.maxHeight&&(_HlsUtils2.default.checkNotIntegerAndThrow(constraints.maxHeight,"maxHeight"),_HlsUtils2.default.checkLessThanMinusOneAndThrow(constraints.maxHeight,"maxHeight"),newConstraints.maxHeight=constraints.maxHeight),this._constraints=newConstraints;var newMinMax=this._updateConstraints();(newMinMax.max>this._maximumConstraint||newMinMax.max===-1)&&this._maximumConstraint!==-1&&(flush=!0),constraints.noFlush===!0&&(flush=!1),this._maximumConstraint=newMinMax.max,this._minimumConstraint=newMinMax.min,flush&&(this._hlsJs.stopFetch(),this.flushBuffer(!0),this._hlsJs.resumeFetch())}},{key:"getTimeouts",value:function(){var timeouts={};return timeouts.manifestTimeout=this._timeouts.manifestTimeout,timeouts.manifestTimeoutMax=this._timeouts.manifestTimeoutMax,timeouts.variantTimeout=this._timeouts.variantTimeout,timeouts.variantTimeoutMax=this._timeouts.variantTimeoutMax,timeouts.chunkTimeout=this._timeouts.chunkTimeout,timeouts.chunkTimeoutMax=this._timeouts.chunkTimeoutMax,timeouts.streamTimeout=this._timeouts.streamTimeout,timeouts}},{key:"setTimeouts",value:function(timeouts){if(!_HlsUtils2.default.isObject(timeouts))throw new Error("setTimeouts: must use a valid timeouts object");var newTimeouts=this._timeouts;void 0!==timeouts.manifestTimeout&&(_HlsUtils2.default.checkNotIntegerAndThrow(timeouts.manifestTimeout,"manifestTimeout"),_HlsUtils2.default.checkLessThanZeroPointZeroAndThrow(timeouts.manifestTimeout,"manifestTimeout"),newTimeouts.manifestTimeout=timeouts.manifestTimeout),void 0!==timeouts.manifestTimeoutMax&&(_HlsUtils2.default.checkNotIntegerAndThrow(timeouts.manifestTimeoutMax,"manifestTimeoutMax"),_HlsUtils2.default.checkLessThanZeroPointZeroAndThrow(timeouts.manifestTimeoutMax,"manifestTimeoutMax"),newTimeouts.manifestTimeoutMax=timeouts.manifestTimeoutMax),void 0!==timeouts.variantTimeout&&(_HlsUtils2.default.checkNotIntegerAndThrow(timeouts.variantTimeout,"variantTimeout"),_HlsUtils2.default.checkLessThanZeroPointZeroAndThrow(timeouts.variantTimeout,"variantTimeout"),newTimeouts.variantTimeout=timeouts.variantTimeout),void 0!==timeouts.variantTimeoutMax&&(_HlsUtils2.default.checkNotIntegerAndThrow(timeouts.variantTimeoutMax,"variantTimeoutMax"),_HlsUtils2.default.checkLessThanZeroPointZeroAndThrow(timeouts.variantTimeoutMax,"variantTimeoutMax"),newTimeouts.variantTimeoutMax=timeouts.variantTimeoutMax),void 0!==timeouts.chunkTimeout&&(_HlsUtils2.default.checkNotIntegerAndThrow(timeouts.chunkTimeout,"chunkTimeout"),_HlsUtils2.default.checkLessThanZeroPointZeroAndThrow(timeouts.chunkTimeout,"chunkTimeout"),newTimeouts.chunkTimeout=timeouts.chunkTimeout),void 0!==timeouts.chunkTimeoutMax&&(_HlsUtils2.default.checkNotIntegerAndThrow(timeouts.chunkTimeoutMax,"chunkTimeoutMax"),_HlsUtils2.default.checkLessThanZeroPointZeroAndThrow(timeouts.chunkTimeoutMax,"chunkTimeoutMax"),newTimeouts.chunkTimeoutMax=timeouts.chunkTimeoutMax),void 0!==timeouts.streamTimeout&&(_HlsUtils2.default.checkNotIntegerAndThrow(timeouts.streamTimeout,"streamTimeout"),_HlsUtils2.default.checkLessThanZeroPointZeroAndThrow(timeouts.streamTimeout,"streamTimeout"),newTimeouts.streamTimeout=timeouts.streamTimeout),this._timeouts=newTimeouts,this._hlsJs.timeouts=this._timeouts}},{key:"getNetworkMetrics",value:function(){return this._networkMetrics}},{key:"getDrmCapabilities",value:function(){var _this3=this;return this._drmCapabilitiesPromise||(this._drmCapabilitiesPromise=new Promise(function(resolve,reject){_this3._hlsJs.getCdmListAsync().then(function(cdmList){var processedList=_this3.generateCapabilities(cdmList);resolve(processedList)}).catch(function(err){reject(err)})})),this._drmCapabilitiesPromise}},{key:"keyCache",value:function(cache){if(null!==cache&&!_HlsUtils2.default.isFunction(cache.hlsKeyLoadCallback))throw new Error("keyCache: func "+cache.hlsKeyLoadCallback+" must be either null, or a function");null!==this._keyCache&&(this._keyCache=null),this._keyCache=cache,this._keyCache=null,null!=this._keyCache&&this._setKeyLoadCallback()}},{key:"_updateConstraints",value:function(){if(this._levels&&this._levels.length>0){var lastLevel=this._levels.length-1,maxBitrateAsLevel=lastLevel,minBitrateAsLevel=-1,minBitrateAsBitrate=-1;if(this._constraints.maxBitrate>=0)while(maxBitrateAsLevel>0&&this._levels[maxBitrateAsLevel].bitrate>this._constraints.maxBitrate)maxBitrateAsLevel--;if(this._explicitDimensions){if(this._constraints.maxWidth>=0)while(maxBitrateAsLevel>0&&this._levels[maxBitrateAsLevel].width>this._constraints.maxWidth)maxBitrateAsLevel--;if(this._constraints.maxHeight>=0)while(maxBitrateAsLevel>0&&this._levels[maxBitrateAsLevel].height>this._constraints.maxHeight)maxBitrateAsLevel--}if(this._constraints.maxVariant>=0&&this._constraints.maxVariant<=lastLevel&&maxBitrateAsLevel>this._constraints.maxVariant&&(maxBitrateAsLevel=this._constraints.maxVariant),this._hlsJs.autoLevelCapping=maxBitrateAsLevel,_logger.logger.log("_updateConstraints autoLevelCapping to "+maxBitrateAsLevel),(this._constraints.minBitrate>=0||this._constraints.minVariant>=0||this._constraints.minWidth>=0||this._constraints.minHeight>=0)&&(minBitrateAsLevel=0),this._constraints.minBitrate>=0)while(minBitrateAsLevel<lastLevel&&this._levels[minBitrateAsLevel].bitrate<this._constraints.minBitrate)minBitrateAsLevel++;if(this._explicitDimensions){if(this._constraints.minWidth>=0)while(minBitrateAsLevel<lastLevel&&this._levels[minBitrateAsLevel].width<this._constraints.minWidth)minBitrateAsLevel++;if(this._constraints.minHeight>=0)while(minBitrateAsLevel<lastLevel&&this._levels[minBitrateAsLevel].height<this._constraints.minHeight)minBitrateAsLevel++}return this._constraints.minVariant>=0&&minBitrateAsLevel<=this._constraints.minVariant&&(minBitrateAsLevel=this._constraints.minVariant),maxBitrateAsLevel!==-1&&minBitrateAsLevel>maxBitrateAsLevel&&(minBitrateAsLevel=maxBitrateAsLevel),minBitrateAsLevel>=0&&(minBitrateAsLevel>lastLevel&&(minBitrateAsLevel=lastLevel),minBitrateAsBitrate=this._levels[minBitrateAsLevel].bitrate),minBitrateAsBitrate<this._constraints.minBitrate&&(minBitrateAsBitrate=this._constraints.minBitrate),maxBitrateAsLevel!==-1&&minBitrateAsBitrate>this._levels[maxBitrateAsLevel].bitrate&&(minBitrateAsBitrate=this._levels[maxBitrateAsLevel].bitrate),minBitrateAsBitrate===-1||1===this._levels.length?this._hlsJs.minAutoBitrate=void 0:(this._hlsJs.minAutoBitrate=Math.min(this._levels[lastLevel].bitrate,minBitrateAsBitrate-1),_logger.logger.log("_updateConstraints minAutoBitrate to "+minBitrateAsLevel)),{min:minBitrateAsLevel,max:maxBitrateAsLevel}}return{min:-1,max:-1}}},{key:"_getDefaultLevel",value:function(){if(this.levels&&this.levels.length>0)for(var i=0;i<this.levels.length;i++)if(this.levels[i].default)return i;return 0}},{key:"getTimeForPdt",value:function(pdt){return this._hlsJs.getTimeForPdt(pdt)}},{key:"getPdtForTime",value:function(time){return this._hlsJs.getPdtForTime(time)}},{key:"generateCapabilities",value:function(cdmList){var drmCaps={keySystems:{}};for(var key in _KeySystems2.default)if(_KeySystems2.default.hasOwnProperty(key)){drmCaps.keySystems[key]={supported:!1,modes:{}};for(var mode in _CencModes2.default)_CencModes2.default.hasOwnProperty(mode)&&(drmCaps.keySystems[key].modes[mode]=!1)}return cdmList.includes("com.apple.fps.2_0")&&(drmCaps.keySystems[_KeySystems2.default.FAIRPLAY].supported=!0,drmCaps.keySystems[_KeySystems2.default.FAIRPLAY].modes[_CencModes2.default.CBC]=!0),cdmList.includes("com.microsoft.playready")&&(drmCaps.keySystems[_KeySystems2.default.PLAYREADY].supported=!0,drmCaps.keySystems[_KeySystems2.default.PLAYREADY].modes[_CencModes2.default.CTR]=!0),cdmList.includes("com.widevine.alpha")&&(drmCaps.keySystems[_KeySystems2.default.WIDEVINE].supported=!0,drmCaps.keySystems[_KeySystems2.default.WIDEVINE].modes[_CencModes2.default.CTR]=!0),cdmList.includes("org.w3.clearkey")&&(drmCaps.keySystems[_KeySystems2.default.CLEARKEY].supported=!0,drmCaps.keySystems[_KeySystems2.default.CLEARKEY].modes[_CencModes2.default.CTR]=!0),drmCaps}},{key:"hlsJs",get:function(){return this._hlsJs}},{key:"emitter",get:function(){return this._emitter}},{key:"live",get:function(){return void 0===this._live||this._live}},{key:"liveTime",get:function(){return void 0!==this._liveTime?this._liveTime:0}},{key:"bufferedRange",get:function(){if(void 0!==this._bufferedRange)return this._bufferedRange;var bufferedRange=[];return bufferedRange[0]={start:0,end:0,duration:0},bufferedRange}},{key:"isMediaAttached",get:function(){return this._mediaAttached}},{key:"levels",get:function(){return this._levels}},{key:"audioRenditions",get:function(){return this._hlsJs.audioTracks||[]}},{key:"currentAudioRendition",get:function(){return this._hlsJs.audioTrack>=0?this._hlsJs.audioTrack:0},set:function(index){if(_HlsUtils2.default.checkNotIntegerAndThrow(index,"audioRendition"),_HlsUtils2.default.checkLessThanZeroPointZeroAndThrow(index,"audioRendition"),index>=this.audioRenditions.length)throw new Error("audioRendition can not be greater than "+(this.audioRenditions.length-1)+" for this stream, ( "+index+" )");var lastAudioRendition=this.currentAudioRendition;lastAudioRendition!==index&&(this._hlsJs.audioTrack=index,this._emit(_HlsEvents2.default.STREAM_AUDIORENDITION_CHANGED,{lastAudioRendition:lastAudioRendition,audioRendition:index}))}},{key:"subtitleRenditions",get:function(){return this._subtitleRenditions}},{key:"changeSubtitlesByIndex",set:function(value){_HlsUtils2.default.checkNotIntegerAndThrow(value,"subtitleIndex"),_HlsUtils2.default.checkLessThanOnePointZeroAndThrow(value,"subtitleIndex");var lastSubtitleRendition=this._hlsJs.subtitleIndex;lastSubtitleRendition!==value&&(this._hlsJs.subtitleIndex=value,this._emit(_HlsEvents2.default.STREAM_SUBTITLERENDITION_CHANGED,{lastSubtitleRendition:lastSubtitleRendition,subtitleRendition:value}))}},{key:"slidingWindow",get:function(){return this._slidingWindow}},{key:"audioOnly",get:function(){return this._audioOnly}},{key:"multithreaded",get:function(){return this._multithreaded}},{key:"useAutomaticComplexityReduction",get:function(){return this._hlsJs.config.capLevelOnFPSDrop},set:function(value){!!value===!0&&_HlsUtils2.default.isTizen()&&_logger.logger.warn("enabling useAutomaticComplexityReduction will have no effect on Tizen applications"),this._hlsJs.config.capLevelOnFPSDrop=!!value}},{key:"bitrateCycle",get:function(){return this._bitrateCycle},set:function(value){this._bitrateCycle=!!value,this._bitrateCycle&&(this._bitrateStepDown=!1,this._bitrateCycleMax=this.getConstraints().maxVariant===-1?this._levels.length-1:this.getConstraints().maxVariant,this._bitrateCycleMin=this.getConstraints().minVariant===-1?0:this.getConstraints().minVariant,this.setConstraints({minVariant:1,maxVariant:1}))}},{key:"maximumBufferSize",get:function(){return this._hlsJs.config.maxBufferSize},set:function(value){_HlsUtils2.default.checkNotIntegerAndThrow(value,"maximumBufferSize"),_HlsUtils2.default.checkLessThanZeroPointZeroAndThrow(value,"maximumBufferSize"),this._hlsJs.config.maxBufferSize=value}},{key:"minimumBufferLength",get:function(){return this._hlsJs.config.maxBufferLength},set:function(value){_HlsUtils2.default.checkNotIntegerAndThrow(value,"minimumBufferLength"),_HlsUtils2.default.checkLessThanOnePointZeroAndThrow(value,"minimumBufferLength"),this._hlsJs.config.maxBufferLength=value}},{key:"maximumBufferLength",get:function(){return this._hlsJs.config.maxMaxBufferLength},set:function(value){_HlsUtils2.default.checkNotIntegerAndThrow(value,"maximumBufferLength"),_HlsUtils2.default.checkLessThanOnePointZeroAndThrow(value,"maximumBufferLength"),this._hlsJs.config.maxMaxBufferLength=value}},{key:"startTime",get:function(){return this._startTime},set:function(seconds){_HlsUtils2.default.checkNotFiniteAndThrow(seconds,"startTime"),_HlsUtils2.default.checkLessThanZeroPointZeroAndThrow(seconds,"startTime"),this._startTime=Number(seconds)}},{key:"recoveryStartTime",set:function(seconds){_HlsUtils2.default.checkNotFiniteAndThrow(seconds,"recoveryStartTime"),_HlsUtils2.default.checkLessThanZeroPointZeroAndThrow(seconds,"recoveryStartTime"),this._recoveryStartTime=Number(seconds)}},{key:"startTimeByPdt",get:function(){return _HlsUtils2.default.isValidDate(this._startTimeByPdt)?this._startTimeByPdt:null},set:function(time){if(!_HlsUtils2.default.isValidDate(time))throw new Error("set startTimeByPdt: "+time+" is not a valid date");this._startTimeByPdt=time}},{key:"startLevel",get:function(){return this._startLevel},set:function(level){_HlsUtils2.default.checkNotIntegerAndThrow(level,"startVariant"),_HlsUtils2.default.checkLessThanMinusOneAndThrow(level,"startVariant"),this._startLevel=level}},{key:"startBitrate",get:function(){return this._startBitrate},set:function(bitrate){_HlsUtils2.default.checkNotIntegerAndThrow(bitrate,"startBitrate"),_HlsUtils2.default.checkLessThanMinusOneAndThrow(bitrate,"startBitrate"),this._startBitrate=bitrate}},{key:"nudgeOnStall",get:function(){return this._hlsJs.config.nudgeOnStall},set:function(value){if(!!value===!1&&!this._hlsJs.config.enableMuxJs)throw new Error("Disabling nudgeOnStall while using the legacy demuxer is not allowed");this._hlsJs.config.nudgeOnStall=!!value}},{key:"initialAudioLanguage",get:function(){return this._initialAudioLanguage},set:function(language){this._initialAudioLanguage=language}},{key:"initialAudioName",get:function(){return this._initialAudioName},set:function(name){this._initialAudioName=name}},{key:"initialAudioIndex",get:function(){return this._initialAudioIndex},set:function(index){this._initialAudioIndex=index}},{key:"recoveryAudioIndex",set:function(index){this._recoveryAudioIndex=index}},{key:"recoveryStartTimeByPdt",set:function(time){if(!_HlsUtils2.default.isValidDate(time))throw new Error("set recoveryStartTimeByPdt: "+time+" is not a valid date");this._recoveryStartTimeByPdt=time}},{key:"liveStreamsStartAtLiveTime",get:function(){return this._liveStreamsStartAtLiveTime},set:function(value){this._liveStreamsStartAtLiveTime=!!value}},{key:"xhrSetup",get:function(){return this._xhrSetup},set:function(func){if(null!==func&&!_HlsUtils2.default.isFunction(func))throw new Error("xhrSetup: func "+func+" must be either null, or a function");this._xhrSetup=func}},{key:"obtainKeySystemConfigCallback",get:function(){return this._obtainKeySystemConfigCallback},set:function(func){if(null!==func&&!_HlsUtils2.default.isFunction(func))throw new Error("obtainKeySystemConfigCallback: func "+func+" must be either null, or a function");this._obtainKeySystemConfigCallback=func}},{key:"keyLoadCallback",get:function(){return this._customKeyLoadCallback},set:function(callback){if(null!==callback&&!_HlsUtils2.default.isFunction(callback))throw new Error("keyLoadCallback: func "+callback+" must be either null, or a function");this._customKeyLoadCallback=callback,this._setKeyLoadCallback()}},{key:"basePdt",get:function(){return _HlsUtils2.default.isValidDate(this._basePdt)?this._basePdt:null}},{key:"bufferBeforeSeeking",set:function(seconds){this._hlsJs.bufferBeforeSeeking=seconds}}],[{key:"isSupported",value:function(){return!!_hls2.default.isSupported()}}]),HlsJsController}();exports.default=HlsJsController,module.exports=exports["default"]},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_HlsEvents=__webpack_require__(14),_HlsEvents2=_interopRequireDefault(_HlsEvents),_markerM=__webpack_require__(168),_markerM2=_interopRequireDefault(_markerM),_eventemitter=__webpack_require__(34),_eventemitter2=_interopRequireDefault(_eventemitter),_EventHandlers=__webpack_require__(35),_EventHandlers2=_interopRequireDefault(_EventHandlers),_HlsUtils=__webpack_require__(6),_HlsUtils2=_interopRequireDefault(_HlsUtils),_logger=__webpack_require__(1);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var HlsMarkers=function(){function HlsMarkers(){var config=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},di=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};_classCallCheck(this,HlsMarkers),this._emitter=di.eventEmitter||new _eventemitter2.default,this._markers=new _markerM2.default,this._chunkIndex=[],this._markerTriggeredCallback=this._markerTriggered.bind(this),this._handlers=new _EventHandlers2.default,this._lastTime=0,this._instanceId=config.instanceId,this._handlers.setHlsEventsList(this,this._emitter,[{event:_HlsEvents2.default.TIMED_METADATA_UPDATE,func:this._onTimedMetadataUpdate},{event:_HlsEvents2.default.STREAM_TIMEUPDATE,func:this._onStreamTimeUpdate},{event:_HlsEvents2.default.MEDIA_SEEKED,func:this._onMediaSeeked}]).wireHlsEvents()}return _createClass(HlsMarkers,[{key:"dispose",value:function(){this._handlers.unwireHlsEvents(),this._handlers.dispose(),this._handlers=null,this._chunkIndex=null,this._markers.dispose(),this._markers=null,this._markerTriggeredCallback=null,this._emitter=null}},{key:"_emit",value:function(event){for(var _emitter,_len=arguments.length,args=Array(_len>1?_len-1:0),_key=1;_key<_len;_key++)args[_key-1]=arguments[_key];(_emitter=this._emitter).emit.apply(_emitter,[event].concat(args))}},{key:"_onTimedMetadataUpdate",value:function(data){this._addHlsMetaMarkers(data)}},{key:"_onStreamTimeUpdate",value:function(data){Math.abs(data.currentTime-this._lastTime)<15?this.timeUpdateMeta(data.currentTime):this.seekMarkers(data.currentTime)}},{key:"_onMediaSeeked",value:function(data){this.seekMarkers(data.currentTime)}},{key:"_markerTriggered",value:function(time,data,id){switch(data.type){case"meta":this._emit(_HlsEvents2.default.TIMED_METADATA_PTS_REACHED,{time:time,id:data.id,sample:data.sample});break;case"user":data.usercallback(time,data.userdata,id);break;default:throw new Error("HlsMarkers._markerTriggered: unknown type "+data.type)}}},{key:"addMarker",value:function(marker){var markerId=this._markers.addMarker(marker.time,marker.data,marker.callback);return markerId}},{key:"addTypedMarker",value:function(time,callback,type,data){if(!_HlsUtils2.default.isFunction(callback))throw new Error("HlsMarkers.addTypedMarker: callback must be valid");var markerId=this._markers.addMarker(time,{userdata:data,usercallback:callback,type:type},this._markerTriggeredCallback);return markerId}},{key:"_addHlsMetaMarkers",value:function(data){var _this=this,markerId=0;if(void 0!==data.samples&&void 0!==data.chunkIdx){var replacing=!1;void 0!==this._chunkIndex[data.chunkIdx]&&(replacing=!0),this._chunkIndex[data.chunkIdx]={variant:data.variant,startTime:data.chunkStartTime,endTime:data.chunkEndTime},replacing&&this._markers.removeMarkerRange({time:data.chunkStartTime},{time:data.chunkEndTime},function(v){return"meta"===v.type}),data.samples.forEach(function(sample){var sampleTime=Number(sample.pts);isNaN(sampleTime)&&(_logger.logger.log("addHlsMetaMarkers; no pts!"),sampleTime=data.chunkStartTime),markerId=_this._markers.addMarker(sampleTime,{sample:sample,type:"meta",id:data.id},_this._markerTriggeredCallback)})}return markerId}},{key:"removeMarker",value:function(markerId){this._markers.removeMarker(markerId)}},{key:"removeMarkerRange",value:function(start,end,filter){this._markers.removeMarkerRange({time:start},{time:end},filter)}},{key:"removeMetaMarkerRange",value:function(start,end){this._markers.removeMarkerRange({time:start},{time:end},function(v){return"meta"===v.data.type})}},{key:"clearAllMarkers",value:function(){this._markers.clearAllMarkers()}},{key:"seekMarkers",value:function(time){this._markers.seekMarkers(time),this._lastTime=time}},{key:"timeUpdate",value:function(timeNow){this._markers.timeUpdate(timeNow)}},{key:"timeUpdateMeta",value:function(timeNow){this._markers.timeUpdate(timeNow),this._markers.seekMarkers(timeNow),this._lastTime=timeNow}},{key:"emitter",get:function(){return this._emitter}},{key:"count",get:function(){return this._markers.count}}]),HlsMarkers}();exports.default=HlsMarkers,module.exports=exports["default"]},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_HlsEvents=__webpack_require__(14),_HlsEvents2=_interopRequireDefault(_HlsEvents),_HlsStates=__webpack_require__(65),_HlsStates2=_interopRequireDefault(_HlsStates),_HlsErrors=__webpack_require__(64),_HlsErrors2=_interopRequireDefault(_HlsErrors),_HlsErrorStrings=__webpack_require__(63),_HlsErrorStrings2=_interopRequireDefault(_HlsErrorStrings),_PlaybackStates=__webpack_require__(67),_PlaybackStates2=_interopRequireDefault(_PlaybackStates),_MediaStates=__webpack_require__(66),_MediaStates2=_interopRequireDefault(_MediaStates),_HlsController=__webpack_require__(101),_HlsController2=_interopRequireDefault(_HlsController),_HlsUtils=__webpack_require__(6),_HlsUtils2=_interopRequireDefault(_HlsUtils),_HlsDataTypes=__webpack_require__(102),_HlsDataTypes2=_interopRequireDefault(_HlsDataTypes),_KeySystems=__webpack_require__(36),_KeySystems2=_interopRequireDefault(_KeySystems),_CencModes=__webpack_require__(62),_CencModes2=_interopRequireDefault(_CencModes);
function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var HlsStream=function(){_createClass(HlsStream,null,[{key:"isSupported",value:function(){return _HlsController2.default.isSupported()}},{key:"version",get:function(){return"3.2.1"}},{key:"activeStreamCount",get:function(){return _HlsController2.default.totalActive()}},{key:"isRedirectSupported",get:function(){return _HlsController2.default.isRedirectSupported()}},{key:"Events",get:function(){return _HlsEvents2.default}},{key:"Errors",get:function(){return _HlsErrors2.default}},{key:"ErrorStrings",get:function(){return _HlsErrorStrings2.default}},{key:"States",get:function(){return _HlsStates2.default}},{key:"PlaybackStates",get:function(){return _PlaybackStates2.default}},{key:"MediaStates",get:function(){return _MediaStates2.default}},{key:"DataTypes",get:function(){return _HlsDataTypes2.default}},{key:"KeySystems",get:function(){return _KeySystems2.default}},{key:"CencModes",get:function(){return _CencModes2.default}}]);function HlsStream(){var config=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,HlsStream),this._controller=new _HlsController2.default({disableWorkarounds:!!config.disableWorkarounds||!1,decryptOutsideWebworker:config.decryptOutsideWebworker}),this._disposed=!1,this.applyConfig(config)}return _createClass(HlsStream,[{key:"dispose",value:function(){var _this=this;this._disposed||(this._disposed=!0,this.once(_HlsEvents2.default.STREAM_DISPOSED,function(){_this._controller=null}),this._controller.dispose())}},{key:"on",value:function(event,func){this._controller.on(event,func)}},{key:"off",value:function(event,func){this._controller.off(event,func)}},{key:"once",value:function(event,func){this._controller.once(event,func)}},{key:"prefetch",value:function(){this._controller.prefetch()}},{key:"stopFetching",value:function(){this._controller.stopFetching()}},{key:"resumeFetching",value:function(){this._controller.resumeFetching()}},{key:"pause",value:function(){this._controller.pause()}},{key:"play",value:function(){this._controller.play()}},{key:"playPause",value:function(){this._controller.playPause()}},{key:"seek",value:function(seconds){this._controller.seek(seconds)}},{key:"seekByPdt",value:function(time){this._controller.seekByPdt(time)}},{key:"seekToLive",value:function(){this._controller.seekToLive()}},{key:"attachMedia",value:function(video){this._controller.attachMedia(video)}},{key:"detachMedia",value:function(){this._controller.detachMedia()}},{key:"loadSource",value:function(url){this._controller.loadSource(url)}},{key:"flushBuffer",value:function(levelFlush){return this._controller.flushBuffer(levelFlush)}},{key:"getConstraints",value:function(){return this._controller.getConstraints()}},{key:"setConstraints",value:function(){var constraints=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._controller.setConstraints(constraints)}},{key:"getTimeouts",value:function(){return this._controller.getTimeouts()}},{key:"setTimeouts",value:function(){var timeouts=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._controller.setTimeouts(timeouts)}},{key:"getPlaybackMetrics",value:function(){return this._controller.getPlaybackMetrics()}},{key:"getNetworkMetrics",value:function(){return this._controller.getNetworkMetrics()}},{key:"getDrmCapabilities",value:function(){return this._controller.getDrmCapabilities()}},{key:"addMarker",value:function(time,callback,data){return this._controller.addUserMarker(time,callback,data)}},{key:"removeMarker",value:function(id){this._controller.removeMarker(id)}},{key:"applyConfig",value:function(){var config=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_HlsUtils2.default.applyConfig(this,config)}},{key:"getTimeForPdt",value:function(pdt){return this._controller.getTimeForPdt(pdt)}},{key:"getPdtForTime",value:function(time){return this._controller.getPdtForTime(time)}},{key:"isMediaAttached",get:function(){return this._controller.isMediaAttached}},{key:"state",get:function(){return this._controller.state}},{key:"playbackState",get:function(){return this._controller.playbackState}},{key:"mediaState",get:function(){return this._controller.mediaState}},{key:"startTime",get:function(){return this._controller.startTime},set:function(seconds){this._controller.startTime=seconds}},{key:"startTimeByPdt",get:function(){return this._controller.startTimeByPdt},set:function(time){this._controller.startTimeByPdt=time}},{key:"startVariant",get:function(){return this._controller.startVariant},set:function(value){this._controller.startVariant=value}},{key:"startBitrate",get:function(){return this._controller.startBitrate},set:function(value){this._controller.startBitrate=value}},{key:"autoPrefetch",get:function(){return this._controller.autoPrefetch},set:function(value){this._controller.autoPrefetch=value}},{key:"autoPlay",get:function(){return this._controller.autoPlay},set:function(value){this._controller.autoPlay=value}},{key:"autoRecover",get:function(){return this._controller.autoRecover},set:function(value){this._controller.autoRecover=value}},{key:"nudgeOnStall",get:function(){return this._controller.nudgeOnStall},set:function(value){this._controller.nudgeOnStall=value}},{key:"liveStreamsStartAtLiveTime",get:function(){return this._controller.liveStreamsStartAtLiveTime},set:function(value){this._controller.liveStreamsStartAtLiveTime=value}},{key:"source",get:function(){return this._controller.src},set:function(url){this._controller.src=url}},{key:"media",get:function(){return this._controller.media},set:function(video){this._controller.media=video}},{key:"currentTime",get:function(){return this._controller.currentTime},set:function(seconds){this._controller.currentTime=seconds}},{key:"currentTimeAsPdt",get:function(){return this._controller.currentTimeAsPdt},set:function(time){this._controller.currentTimeAsPdt=time}},{key:"playbackRate",get:function(){return this._controller.playbackRate},set:function(value){this._controller.playbackRate=value}},{key:"isLoaded",get:function(){return this._controller.loaded}},{key:"isFetching",get:function(){return this._controller.fetching}},{key:"isPaused",get:function(){return this._controller.paused}},{key:"isBuffering",get:function(){return this._controller.buffering}},{key:"isSeeking",get:function(){return this._controller.seeking}},{key:"isEnded",get:function(){return this._controller.ended}},{key:"isLive",get:function(){return this._controller.live}},{key:"isSlidingWindow",get:function(){return this._controller.slidingWindow}},{key:"isAudioOnly",get:function(){return this._controller.audioOnly}},{key:"isMultithreaded",get:function(){return this._controller.multithreaded}},{key:"seekableRange",get:function(){return this._controller.seekableRange}},{key:"bufferedRange",get:function(){return this._controller.bufferedRange}},{key:"bufferedRangeCurrent",get:function(){return this._controller.bufferedRangeCurrent}},{key:"playbackRange",get:function(){return this._controller.playbackRange}},{key:"basePdt",get:function(){return this._controller.basePdt}},{key:"duration",get:function(){return this._controller.duration}},{key:"initialTime",get:function(){return this._controller.initialTime}},{key:"liveTime",get:function(){return this._controller.liveTime}},{key:"variants",get:function(){return this._controller.variants}},{key:"audioRenditions",get:function(){return this._controller.audioRenditions}},{key:"currentAudioRendition",get:function(){return this._controller.currentAudioRendition},set:function(index){this._controller.currentAudioRendition=index}},{key:"initialAudioLanguage",get:function(){return this._controller.initialAudioLanguage},set:function(language){this._controller.initialAudioLanguage=language}},{key:"initialAudioName",get:function(){return this._controller.initialAudioName},set:function(name){this._controller.initialAudioName=name}},{key:"initialAudioIndex",get:function(){return this._controller.initialAudioIndex},set:function(index){this._controller.initialAudioIndex=index}},{key:"subtitleRenditions",get:function(){return this._controller.subtitleRenditions}},{key:"isMuted",get:function(){return this._controller.muted},set:function(value){this._controller.muted=value}},{key:"volume",get:function(){return this._controller.volume},set:function(value){this._controller.volume=value}},{key:"useAutomaticComplexityReduction",get:function(){return this._controller.useAutomaticComplexityReduction},set:function(value){this._controller.useAutomaticComplexityReduction=!!value}},{key:"bitrateCycle",get:function(){return this._controller.bitrateCycle},set:function(value){this._controller.bitrateCycle=value}},{key:"maximumBufferSize",get:function(){return this._controller.maximumBufferSize},set:function(value){this._controller.maximumBufferSize=value}},{key:"minimumBufferSeconds",get:function(){return this._controller.minimumBufferLength},set:function(value){this._controller.minimumBufferLength=value}},{key:"maximumBufferSeconds",get:function(){return this._controller.maximumBufferLength},set:function(value){this._controller.maximumBufferLength=value}},{key:"areSubtitlesEnabled",get:function(){return this._controller.subtitlesEnabled},set:function(value){this._controller.subtitlesEnabled=value}},{key:"changeSubtitlesByIndex",set:function(value){this._controller.changeSubtitlesByIndex=value}},{key:"xhrSetupCallback",get:function(){return this._controller.xhrSetup},set:function(func){this._controller.xhrSetup=func}},{key:"keyLoadCallback",get:function(){return this._controller.keyLoadCallback},set:function(func){this._controller.keyLoadCallback=func}},{key:"obtainKeySystemConfigCallback",get:function(){return this._controller.obtainKeySystemConfigCallback},set:function(func){this._controller.obtainKeySystemConfigCallback=func}},{key:"isDisposed",get:function(){return!!this._disposed}},{key:"isDestroyed",get:function(){return!this._controller}},{key:"streamId",get:function(){return this._controller.instanceId}},{key:"debug",get:function(){return this._controller.debug},set:function(value){this._controller.debug=value}},{key:"chosenVariant",get:function(){return this.getNetworkMetrics().chosenVariant}},{key:"chosenBitrate",get:function(){return this.getNetworkMetrics().chosenBitrate}},{key:"maximumBitrate",get:function(){throw new Error("maximumBitrate is no longer supported")},set:function(){throw new Error("maximumBitrate is no longer supported")}},{key:"minimumBitrate",get:function(){throw new Error("minimumBitrate is no longer supported")},set:function(){throw new Error("minimumBitrate is no longer supported")}},{key:"maximumVariant",get:function(){throw new Error("maximumVariant is no longer supported")},set:function(){throw new Error("maximumVariant is no longer supported")}},{key:"minimumVariant",get:function(){throw new Error("minimumVariant is no longer supported")},set:function(){throw new Error("minimumVariant is no longer supported")}},{key:"maximumWidth",get:function(){throw new Error("maximumWidth is no longer supported")},set:function(){throw new Error("maximumWidth is no longer supported")}},{key:"maximumHeight",get:function(){throw new Error("maximumHeight is no longer supported")},set:function(){throw new Error("maximumHeight is no longer supported")}}]),HlsStream}();exports.default=HlsStream,module.exports=exports["default"]},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_eventemitter=__webpack_require__(34),_eventemitter2=_interopRequireDefault(_eventemitter),_EventHandlers=__webpack_require__(35),_EventHandlers2=_interopRequireDefault(_EventHandlers),_HlsEvents=__webpack_require__(14),_HlsEvents2=_interopRequireDefault(_HlsEvents),_HlsUtils=__webpack_require__(6),_HlsUtils2=_interopRequireDefault(_HlsUtils),_logger=__webpack_require__(1);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var HAVE_METADATA=1,minReadyStateForCurrentTime=HAVE_METADATA,MediaController=function(){function MediaController(){var config=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},di=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};_classCallCheck(this,MediaController);var disableWorkarounds=!!config.disableWorkarounds||!1;this._emitter=di.eventEmitter||new _eventemitter2.default,this._media=null,this._subtitlesEnabled=!1,this._seeking=!1,this._mediaDefaults={muted:!1,volume:1,ended:!1,duration:0,readyState:0,currentTime:0,playbackRate:1},this._frameRate=0,this._lastDecoded=0,this._lastFrameRateTime=new Date,this._safariFrameRateWorkaround=_HlsUtils2.default.isSafari()&&!disableWorkarounds,this._lastFrameRate=0,this._tizenSeekWorkaround=_HlsUtils2.default.isTizen()&&!disableWorkarounds,this._tizen2ReseekWorkaround=_HlsUtils2.default.isTizen2()&&!disableWorkarounds,this._targetSeekTime=0,this._usePendingPlaybackRate=!0,this._pendingPlaybackRate=void 0,this._pendingCurrentTime=void 0,this._windows8Point1IESeekWorkaround=!1,this._pauseAfterSeek=!1,this._IEPlaybackRateWorkaround=_HlsUtils2.default.isIE()&&!disableWorkarounds,this._rateChangeExpected=!1,this._expectedPlaybackRate=1,this._mediaOverrides={},this._seekTimer=void 0,this._handlers=new _EventHandlers2.default,this._mediaEvents=[{event:"seeking",func:this._onMediaSeeking},{event:"seeked",func:this._onMediaSeeked},{event:"ended",func:this._onMediaEnded},{event:"timeupdate",func:this._onMediaTimeUpdate},{event:"pause",func:this._onMediaPause},{event:"play",func:this._onMediaPlay},{event:"durationchange",func:this._onMediaDurationChange},{event:"playing",func:this._onMediaPlaying},{event:"loadedmetadata",func:this._onMediaLoadedMetaData},{event:"loadeddata",func:this._onMediaLoadedData},{event:"canplay",func:this._onMediaCanPlay},{event:"canplaythrough",func:this._onMediaCanPlayThrough},{event:"ratechange",func:this._onMediaRateChange},{event:"volumechange",func:this._onMediaVolumeChange},{event:"error",func:this._onMediaError}],_EventHandlers2.default.verifyEventsList(this._mediaEvents),_HlsUtils2.default.applyConfig(this,config)}return _createClass(MediaController,[{key:"dispose",value:function(){this._seekTimer&&(clearTimeout(this._seekTimer),this._seekTimer=void 0),this._subtitlesEnabled=!1,this.captionsControl(),this.media=null,this._handlers.dispose(),this._handlers=null,this._mediaEvents=null,this._mediaDefaults=null,this._mediaOverrides=null,this._emitter=null,clearInterval(this._fpsMonitor),this._frameRate=0,this._lastDecoded=0}},{key:"_wireMediaEvent",value:function(_ref){var event=_ref.event,func=_ref.func,handler=this._handlers.createEventHandler(this,func);this._media.addEventListener(event,handler)}},{key:"_unwireMediaEvent",value:function(_ref2){var event=_ref2.event,func=_ref2.func,handler=this._handlers.getHandlerForFunction(func);handler&&this._media.removeEventListener(event,handler)}},{key:"_wireMediaEvents",value:function(){var _this=this,data={media:this._media};_logger.logger.log("MediaController::_wireMediaEvents: { media: "+data.media+" }");try{this._mediaEvents.forEach(function(event){return _this._wireMediaEvent(event)}),this._emit(_HlsEvents2.default.MEDIA_CONTROLLER_WIRED,data)}catch(e){this._media=null,this._emitMediaError(e)}}},{key:"_unwireMediaEvents",value:function(){var _this2=this,data={media:this._media};_logger.logger.log("MediaController::_unwireMediaEvents: { media: "+data.media+" }"),this._mediaEvents.forEach(function(event){return _this2._unwireMediaEvent(event)}),this._emit(_HlsEvents2.default.MEDIA_CONTROLLER_UNWIRED,data)}},{key:"_emitMediaError",value:function(errObj){var theError={};theError.details="mediaControllerError",theError.errorObj=errObj||new Error("MediaController::_emitMediaError '"+theError.details+"'"),this._emit(_HlsEvents2.default.MEDIA_CONTROLLER_ERROR,theError)}},{key:"_onMediaLoadedMetaData",value:function(){_logger.logger.log("MEDIA_LOADEDMETADATA"),this._mediaReadyStateChange()}},{key:"_onMediaLoadedData",value:function(){_logger.logger.log("MEDIA_LOADEDDATA :"+this.currentTime),this._emit(_HlsEvents2.default.MEDIA_LOADEDDATA)}},{key:"_onMediaCanPlay",value:function(){_logger.logger.log("Media: CANPLAY : duration: "+this.duration),this._emit(_HlsEvents2.default.MEDIA_CANPLAY)}},{key:"_onMediaCanPlayThrough",value:function(){_logger.logger.log("Media: CANPLAYTHROUGH : duration: "+this.duration),this._emit(_HlsEvents2.default.MEDIA_CANPLAYTHROUGH)}},{key:"_mediaReadyStateChange",value:function(){this._pendingCurrentTime&&this._readyForCurrentTime()&&(this._media.currentTime=this._pendingCurrentTime,this._pendingCurrentTime=void 0)}},{key:"_onMediaSeeked",value:function(){_logger.logger.log("seeked: currentTime: "+this.currentTime+", _seeking: "+this._seeking),this._seeking&&(this._tizen2ReseekWorkaround&&this.currentTime<this._targetSeekTime&&0!==this._targetSeekTime?this.currentTime=this._targetSeekTime:(this._seeking=!1,this._emit(_HlsEvents2.default.MEDIA_SEEKED,{currentTime:this.currentTime}),this._pauseAfterSeek&&(this.pause(),this._pauseAfterSeek=!1)))}},{key:"_onMediaSeeking",value:function(){_logger.logger.log("seeking: currentTime: "+this.currentTime+", _seeking: "+this._seeking),this._seeking||(this._seeking=!0,this._tizenSeekWorkaround&&(this._targetSeekTime=this.currentTime),this._emit(_HlsEvents2.default.MEDIA_SEEKING))}},{key:"_onMediaEnded",value:function(){_logger.logger.log("ended :"+this.currentTime),this._targetSeekTime=0,this._emit(_HlsEvents2.default.MEDIA_ENDED)}},{key:"_onMediaTimeUpdate",value:function(){if(this._tizenSeekWorkaround&&0===this.currentTime&&0!==this._targetSeekTime?this.currentTime=this._targetSeekTime:this._emit(_HlsEvents2.default.MEDIA_TIMEUPDATE,{currentTime:this.currentTime}),void 0!==this._pendingPlaybackRate&&0!==this.currentTime){var pendingPlaybackRate=this._pendingPlaybackRate;this._pendingPlaybackRate=void 0,this.playbackRate=pendingPlaybackRate,_logger.logger.log("_onMediaTimeUpdate: applying pending playback rate:"+pendingPlaybackRate)}}},{key:"_onMediaPause",value:function(){_logger.logger.log("pause :"+this.currentTime),this._emit(_HlsEvents2.default.MEDIA_PAUSE)}},{key:"_onMediaPlay",value:function(){_logger.logger.log("play :"+this.currentTime),this._emit(_HlsEvents2.default.MEDIA_PLAY)}},{key:"_onMediaDurationChange",value:function(){_logger.logger.log("durationchange :"+this.duration),this._emit(_HlsEvents2.default.MEDIA_DURATIONCHANGE)}},{key:"_onMediaPlaying",value:function(){_logger.logger.log("MEDIA_PLAYING playing :"+this.currentTime)}},{key:"_onMediaRateChange",value:function(){this._IEPlaybackRateWorkaround&&!this._rateChangeExpected&&1===this.playbackRate?(_logger.logger.log("_onMediaRateChange: rate change correction"),this.playbackRate=this._expectedPlaybackRate):(this._rateChangeExpected=!1,_logger.logger.log("_onMediaRateChange: ratechange: "+this.playbackRate),this._emit(_HlsEvents2.default.MEDIA_RATECHANGE))}},{key:"_onMediaVolumeChange",value:function(){_logger.logger.log("volumechange :"+this.currentTime),this._emit(_HlsEvents2.default.MEDIA_VOLUMECHANGE)}},{key:"_onMediaError",value:function(){var theError={};theError.details="mediaElementError",theError.mediaErrorObj=this._media.error,theError.mediaErrorObj&&void 0!==theError.mediaErrorObj.msExtendedCode&&(theError.mediaErrorObj.msExtendedHex=_HlsUtils2.default.msErrToHex(theError.mediaErrorObj.msExtendedCode)),theError.errorObj=new Error("MediaController::_onMediaError '"+theError.details+"'"),_logger.logger.log("media error"),this._emit(_HlsEvents2.default.MEDIA_ELEMENT_ERROR,theError)}},{key:"_emit",value:function(event){for(var _emitter,_len=arguments.length,args=Array(_len>1?_len-1:0),_key=1;_key<_len;_key++)args[_key-1]=arguments[_key];(_emitter=this._emitter).emit.apply(_emitter,[event].concat(args))}},{key:"pause",value:function(){this._media.pause()}},{key:"play",value:function(){var playPromise=this._media.play();return void 0===playPromise&&(playPromise=Promise.resolve()),this._pauseAfterSeek&&(this._pauseAfterSeek=!1),playPromise}},{key:"seek",value:function(seconds){this._windows8Point1IESeekWorkaround&&this.paused&&(this.play(),this._pauseAfterSeek=!0),this.currentTime=seconds}},{key:"_getMediaProperty",value:function(prop){if(this._media)return this._media[prop];if(void 0!==this._mediaOverrides[prop])return this._mediaOverrides[prop];if(void 0===this._mediaDefaults[prop])throw new Error("no default for media."+prop+" defined");return this._mediaDefaults[prop]}},{key:"_setMediaProperty",value:function(prop,value){if(void 0===this._mediaDefaults[prop])throw new Error("media."+prop+" has no default. Not safe to override with "+value);if(void 0===value)throw new Error("setting media."+prop+" to undefined is not currently supported.");this._mediaOverrides[prop]=value,this._media&&(this._media[prop]=value)}},{key:"_checkFrameRate",value:function(){var frames=0,time=new Date,timeSinceLast=time.getTime()-this._lastFrameRateTime.getTime();if(this._media){if(frames="function"===typeof this._media.getVideoPlaybackQuality?this._media.getVideoPlaybackQuality().totalVideoFrames:this._media.webkitDecodedFrameCount,this._frameRate=Math.max(frames-this._lastDecoded,0)*(1e3/timeSinceLast),this._lastDecoded=frames,this._safariFrameRateWorkaround){var lastFrameRate=this._lastFrameRate;this._lastFrameRate=this._frameRate,0===this._frameRate&&0!==lastFrameRate&&(this._frameRate=lastFrameRate)}}else this._lastDecoded=0;this._lastFrameRateTime=time}},{key:"captionsControl",value:function(){this._media&&this._media.textTracks&&0!==this._media.textTracks.length&&(this._media.textTracks[0].mode="hidden",this._subtitlesEnabled&&(this._media.textTracks[0].mode="showing"))}},{key:"_applyProperties",value:function(propertyList){if(this._media&&propertyList)for(var setProps=Object.keys(propertyList),i=0;i<setProps.length;i++)this._media[setProps[i]]=propertyList[setProps[i]]}},{key:"_readMediaProperties",value:function(){var propertyList={};return this._media&&(propertyList.muted=this._media.muted,propertyList.volume=this._media.volume,propertyList.playbackRate=this._media.playbackRate),propertyList}},{key:"_readyForCurrentTime",value:function(){return this._media&&this._media.readyState>=minReadyStateForCurrentTime}},{key:"emitter",get:function(){return this._emitter}},{key:"media",get:function(){return this._media},set:function(video){this._media&&(this._mediaOverrides=this._readMediaProperties(),this._unwireMediaEvents(),clearInterval(this._fpsMonitor)),this._media=video,this._media&&(this._media.src&&(this._media.removeAttribute("src"),this._media.load()),this._wireMediaEvents(),this._lastFrameRateTime=new Date,this._fpsMonitor=setInterval(this._checkFrameRate.bind(this),1e3,this._media),this._applyProperties(this._mediaOverrides))}},{key:"paused",get:function(){return this._media.paused}},{key:"ended",get:function(){return this._getMediaProperty("ended")}},{key:"duration",get:function(){var duration=0;return this._media&&(duration=this._media.duration,isNaN(duration)&&(duration=0)),duration}},{key:"readyState",get:function(){return this._getMediaProperty("readyState")}},{key:"muted",get:function(){return 0===this._getMediaProperty("volume")||this._getMediaProperty("muted")},set:function(value){this._setMediaProperty("muted",!!value)}},{key:"volume",get:function(){return this._getMediaProperty("muted")?0:this._getMediaProperty("volume")},set:function(value){_HlsUtils2.default.checkNotFiniteAndThrow(value,"volume"),_HlsUtils2.default.checkLessThanZeroPointZeroAndThrow(value,"volume"),_HlsUtils2.default.checkMoreThanOnePointZeroAndThrow(value,"volume"),this._setMediaProperty("volume",value)}},{key:"currentTime",get:function(){var time=this._pendingCurrentTime;return void 0===time&&(time=this._getMediaProperty("currentTime")),time},set:function(seconds){seconds===this.currentTime?(_logger.logger.log("already at the seek time, faking a seek"),this._emit(_HlsEvents2.default.MEDIA_SEEKED,{currentTime:this.currentTime})):this._readyForCurrentTime()?this._media.currentTime=seconds:(_logger.logger.log("Media not ready. Pending seek"),this._pendingCurrentTime=seconds)}},{key:"playbackRate",get:function(){return void 0!==this._pendingPlaybackRate?this._pendingPlaybackRate:this._getMediaProperty("playbackRate")},set:function(value){_HlsUtils2.default.checkNotFiniteAndThrow(value,"playbackRate"),_HlsUtils2.default.checkEqualToZeroPointZeroAndThrow(value,"playbackRate"),_HlsUtils2.default.checkLessThanZeroPointZeroAndThrow(value,"playbackRate");var newPlaybackRate=value;newPlaybackRate>8&&(_logger.logger.warn("set playbackRate: fast forward is currently limited to 8x"),newPlaybackRate=8),this._usePendingPlaybackRate&&0===this.currentTime||void 0!==this._pendingPlaybackRate?(_logger.logger.log("set playbackRate: Pending change to "+newPlaybackRate),this._pendingPlaybackRate=newPlaybackRate):this.playbackRate!==newPlaybackRate?(_logger.logger.log("set playbackRate: Requesting change to "+newPlaybackRate),this._expectedPlaybackRate=newPlaybackRate,this._rateChangeExpected=!0,this._setMediaProperty("playbackRate",newPlaybackRate)):this.playbackRate===newPlaybackRate&&void 0===this._pendingPlaybackRate&&(_logger.logger.log("set playbackRate: Rate is already "+newPlaybackRate),this._emit(_HlsEvents2.default.MEDIA_RATECHANGE))}},{key:"droppedFramesCount",get:function(){return this._media?"function"===typeof this._media.getVideoPlaybackQuality?this._media.getVideoPlaybackQuality().droppedVideoFrames:this._media.webkitDroppedFrameCount:0}},{key:"frameRate",get:function(){return this._frameRate}},{key:"isPlaying",get:function(){var playing=!1;return this._media&&!this._media.paused&&!this._media.ended&&this._media.readyState>2&&(playing=!0),playing}},{key:"subtitlesEnabled",get:function(){return this._subtitlesEnabled},set:function(value){this._subtitlesEnabled=!!value,this.captionsControl()}}]),MediaController}();exports.default=MediaController,module.exports=exports["default"]},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_WebCryptoAesCbc=__webpack_require__(111),_WebCryptoAesCbc2=_interopRequireDefault(_WebCryptoAesCbc),_JsCryptoAesCbc=__webpack_require__(108),_JsCryptoAesCbc2=_interopRequireDefault(_JsCryptoAesCbc);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}__webpack_require__(78);var CryptoAesCbc=function(){function CryptoAesCbc(){_classCallCheck(this,CryptoAesCbc),this.crypto=_WebCryptoAesCbc2.default.isSupportedAsync().then(function(webCryptoSupported){return webCryptoSupported?new _WebCryptoAesCbc2.default:new _JsCryptoAesCbc2.default}).catch(function(){return new _JsCryptoAesCbc2.default})}return _createClass(CryptoAesCbc,[{key:"createKey",value:function(key){return this.crypto.then(function(crypto){return crypto.createKey(key)})}},{key:"decrypt",value:function(cryptoKey,iv,cypherText){return this.crypto.then(function(crypto){return crypto.decrypt(cryptoKey,iv,cypherText)})}}]),CryptoAesCbc}();exports.default=CryptoAesCbc,module.exports=exports["default"]},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_JsCryptoWrapper=__webpack_require__(109),_JsCryptoWrapper2=_interopRequireDefault(_JsCryptoWrapper),_ArrayHelper=__webpack_require__(21),_ArrayHelper2=_interopRequireDefault(_ArrayHelper);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var JsCryptoAesCbc=function(){_createClass(JsCryptoAesCbc,null,[{key:"isSupported",value:function(){return!0}}]);function JsCryptoAesCbc(){_classCallCheck(this,JsCryptoAesCbc),this.wrapper=new _JsCryptoWrapper2.default}return _createClass(JsCryptoAesCbc,[{key:"createKey",value:function(key){try{if(16!==key.length)throw new Error("JsCryptoAesCbc.createKey length must be 16");return this.wrapper.importKey("raw",key,{name:"AES-CBC"},!1,["encrypt","decrypt"])}catch(err){return Promise.reject(err)}}},{key:"_decryptInternal",value:function(cryptoKey,iv,cypherText){return this.wrapper.decrypt({name:"AES-CBC",iv:iv},cryptoKey,cypherText)}},{key:"_stripPadding",value:function(clearText){var myClearText=clearText,len=myClearText.length,p=myClearText[len-1];if(p>0&&p<=16){for(var good=!0,i=len-p;i<len;i++)if(myClearText[i]!==p){good=!1;break}good&&(myClearText=myClearText.subarray(0,len-p))}return myClearText}},{key:"decrypt",value:function(cryptoKey,iv,cypherText){var _this=this;try{var myCypherText=_ArrayHelper2.default.makeUint8Array(cypherText),truncated=void 0,_ArrayHelper$makeModu=_ArrayHelper2.default.makeModulo16(myCypherText);return myCypherText=_ArrayHelper$makeModu.data,truncated=_ArrayHelper$makeModu.truncated,this._decryptInternal(cryptoKey,iv,myCypherText).then(function(decrypted){var result=new Uint8Array(decrypted);return truncated||(result=_this._stripPadding(result)),result})}catch(err){return Promise.reject(err)}}}]),JsCryptoAesCbc}();exports.default=JsCryptoAesCbc,module.exports=exports["default"]},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_HlsUtils=__webpack_require__(6),_HlsUtils2=_interopRequireDefault(_HlsUtils),_jsAesDecryptor=__webpack_require__(113),_jsAesDecryptor2=_interopRequireDefault(_jsAesDecryptor);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function");
}var JsCryptoWrapper=function(){function JsCryptoWrapper(){_classCallCheck(this,JsCryptoWrapper),this.crypto=new _jsAesDecryptor2.default}return _createClass(JsCryptoWrapper,[{key:"_importKeyCheck",value:function(format,keyData,algo){if("raw"!==format)throw new Error("JsCryptoWrapper.importKey only supports raw keys : "+format);if("AES-CBC"!==algo.name)throw new Error("JsCryptoWrapper.importKey only supports AES-CBC algorithm : "+algo);if(16!==keyData.length)throw new Error("JsCryptoWrapper.importKey key is not a valid length : "+keyData.length)}},{key:"importKey",value:function(format,keyData,algo,extractable,usages){var _this=this;return new Promise(function(resolve,reject){try{_this._importKeyCheck(format,keyData,algo,extractable,usages);var aesKey=_this.crypto.expandKey(keyData),cryptoKey={aesKey:aesKey,algo:algo};extractable&&(cryptoKey.key=keyData),resolve(cryptoKey)}catch(err){reject(err)}})}},{key:"_decryptCheck",value:function(algo,key,data){if(!_HlsUtils2.default.isObject(key.aesKey)||!_HlsUtils2.default.isObject(key.algo))throw new Error("JsCryptoWrapper.decrypt, key is not valid : "+key);if(key.algo.name!==algo.name)throw new Error("JsCryptoWrapper.decrypt, algorithm doesn't match key : "+algo);if(!_HlsUtils2.default.isObject(algo.iv))throw new Error("JsCryptoWrapper.decrypt, IV invalid : "+algo.iv);if(16!==algo.iv.length)throw new Error("JsCryptoWrapper.decrypt, IV length invalid : "+algo.iv.length);if(data.length%16!==0)throw new Error("JsCryptoWrapper.decrypt, data is not a multiple of 16 : "+data.length)}},{key:"decrypt",value:function(algo,key,data){var _this2=this,result=new Promise(function(resolve,reject){try{_this2._decryptCheck(algo,key,data);var decrypted=_this2.crypto.decrypt(key.aesKey,data,algo.iv);resolve(decrypted)}catch(err){reject(err)}});return result}}]),JsCryptoWrapper}();exports.default=JsCryptoWrapper,module.exports=exports["default"]},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var MsCryptoWrapper=function(){_createClass(MsCryptoWrapper,null,[{key:"getMsCrypto",value:function(){var msCrypto=void 0;try{msCrypto=msCrypto||self.msCrypto}catch(e){}return msCrypto}},{key:"isSupported",value:function(){return!!MsCryptoWrapper.getMsCrypto()}}]);function MsCryptoWrapper(){_classCallCheck(this,MsCryptoWrapper);var crypto=MsCryptoWrapper.getMsCrypto();if(!crypto)throw new Error("MsCryptoWrapper: msCrypto not supported");this.crypto=crypto}return _createClass(MsCryptoWrapper,[{key:"importKey",value:function(format,keyData,algo,extractable,usages){var _this=this;return new Promise(function(resolve,reject){try{var keyOp=_this.crypto.subtle.importKey(format,keyData,algo,extractable,usages);keyOp.onerror=function(){reject(new Error("MsCryptoWrapper.importKey failed"))},keyOp.oncomplete=function(e){resolve(e.target.result)}}catch(err){reject(err)}})}},{key:"decrypt",value:function(algorithm,key,data){var _this2=this;return new Promise(function(resolve,reject){try{var decryptOp=_this2.crypto.subtle.decrypt(algorithm,key,data);decryptOp.onerror=function(){reject(new Error("MsCryptoWrapper.decrypt failed"))},decryptOp.oncomplete=function(e){resolve(e.target.result)}}catch(err){reject(err)}})}},{key:"encrypt",value:function(algorithm,key,data){var _this3=this;return new Promise(function(resolve,reject){try{var encryptOp=_this3.crypto.subtle.encrypt(algorithm,key,data);encryptOp.onerror=function(){reject(new Error("MsCryptoWrapper.encrypt failed"))},encryptOp.oncomplete=function(e){resolve(e.target.result)}}catch(err){reject(err)}})}}]),MsCryptoWrapper}();exports.default=MsCryptoWrapper,module.exports=exports["default"]},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_WebCryptoWrapper=__webpack_require__(112),_WebCryptoWrapper2=_interopRequireDefault(_WebCryptoWrapper),_ArrayHelper=__webpack_require__(21),_ArrayHelper2=_interopRequireDefault(_ArrayHelper);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var WebCryptoAesCbc=function(){_createClass(WebCryptoAesCbc,null,[{key:"isSupportedAsync",value:function(){return _WebCryptoWrapper2.default.isSupportedAsync()}}]);function WebCryptoAesCbc(){_classCallCheck(this,WebCryptoAesCbc),this.crypto=new _WebCryptoWrapper2.default}return _createClass(WebCryptoAesCbc,[{key:"createKey",value:function(key){try{if(16!==key.length)throw new Error("WebCryptoAesCbc.createKey length must be 16");return this.crypto.importKey("raw",key,{name:"AES-CBC"},!1,["encrypt","decrypt"])}catch(err){return Promise.reject(err)}}},{key:"_padCypherTextAsync",value:function(cryptoKey,cypherText){var paddingIv=cypherText.subarray(cypherText.length-16),padding=new Uint8Array(16).fill(16);return this.crypto.encrypt({name:"AES-CBC",iv:paddingIv},cryptoKey,padding).then(function(encrypted){var encryptedPadding=new Uint8Array(encrypted,0,16),paddedCypherText=new Uint8Array(cypherText.length+16);return paddedCypherText.set(cypherText),paddedCypherText.set(encryptedPadding,cypherText.length),paddedCypherText})}},{key:"_decryptInternal",value:function(cryptoKey,iv,cypherText){return this.crypto.decrypt({name:"AES-CBC",iv:iv},cryptoKey,cypherText)}},{key:"decrypt",value:function(cryptoKey,iv,cypherText){var _this=this;try{var myCypherText=_ArrayHelper2.default.makeUint8Array(cypherText),truncated=void 0,_ArrayHelper$makeModu=_ArrayHelper2.default.makeModulo16(myCypherText);return myCypherText=_ArrayHelper$makeModu.data,truncated=_ArrayHelper$makeModu.truncated,truncated&&(myCypherText=this._padCypherTextAsync(cryptoKey,myCypherText)),Promise.resolve(myCypherText).then(function(resolvedCypherText){return _this._decryptInternal(cryptoKey,iv,resolvedCypherText).catch(function(err){if(truncated)throw err;return _this._padCypherTextAsync(cryptoKey,resolvedCypherText).then(function(paddedCypherText){return _this._decryptInternal(cryptoKey,iv,paddedCypherText)})})})}catch(err){return Promise.reject(err)}}}]),WebCryptoAesCbc}();exports.default=WebCryptoAesCbc,module.exports=exports["default"]},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_MsCryptoWrapper=__webpack_require__(110),_MsCryptoWrapper2=_interopRequireDefault(_MsCryptoWrapper),_logger=__webpack_require__(1);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var WebCryptoWrapper=function(){_createClass(WebCryptoWrapper,null,[{key:"getSubtle",value:function(){var subtle=void 0;try{var browserCrypto=crypto||self.crypto;subtle=browserCrypto.subtle||browserCrypto.webkitSubtle}catch(e){}return subtle||_MsCryptoWrapper2.default.isSupported()&&(subtle=new _MsCryptoWrapper2.default),subtle}},{key:"isSupportedAsync",value:function(){var subtle=WebCryptoWrapper.getSubtle(),supported=Promise.resolve(!1);if(subtle)try{supported=subtle.importKey("raw",new Uint8Array(16),{name:"AES-CBC"},!1,["encrypt","decrypt"]).then(function(){return!0}).catch(function(){return!1})}catch(err){_logger.logger.warn("WebCryptoWrapper.isSupported: Unexpected error while testing WebCrypto : "+err.message,err),supported=Promise.resolve(!1)}return supported}}]);function WebCryptoWrapper(){_classCallCheck(this,WebCryptoWrapper);var subtle=WebCryptoWrapper.getSubtle();if(!subtle)throw new Error("WebCryptoWrapper: no WebCrypto implementation available");this.crypto=subtle}return _createClass(WebCryptoWrapper,[{key:"importKey",value:function(format,keyData,algo,extractable,usages){try{if(16!==keyData.length)throw new Error("WebCryptoWrapper.importKey, invalid key length "+keyData.length);return this.crypto.importKey(format,keyData,algo,extractable,usages)}catch(err){return Promise.reject(err)}}},{key:"decrypt",value:function(algorithm,key,data){try{if(data.byteLength%16!==0)throw new Error("WebCryptoWrapper.decrypt, data.byteLength must be modulo-16 "+data.byteLength);return this.crypto.decrypt(algorithm,key,data)}catch(err){return Promise.reject(err)}}},{key:"encrypt",value:function(algorithm,key,data){try{return this.crypto.encrypt(algorithm,key,data)}catch(err){return Promise.reject(err)}}}]),WebCryptoWrapper}();exports.default=WebCryptoWrapper,module.exports=exports["default"]},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_ArrayHelper=__webpack_require__(21),_ArrayHelper2=_interopRequireDefault(_ArrayHelper);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var AESDecryptor=function(){function AESDecryptor(){_classCallCheck(this,AESDecryptor),this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.initTable()}return _createClass(AESDecryptor,[{key:"uint8ArrayToUint32Array_",value:function(blockArray){for(var view=new DataView(blockArray.buffer,blockArray.byteOffset,blockArray.byteLength),newArray=new Uint32Array(4),i=0;i<4;i++)newArray[i]=view.getUint32(4*i);return newArray}},{key:"initTable",value:function(){var sBox=this.sBox,invSBox=this.invSBox,subMix=this.subMix,subMix0=subMix[0],subMix1=subMix[1],subMix2=subMix[2],subMix3=subMix[3],invSubMix=this.invSubMix,invSubMix0=invSubMix[0],invSubMix1=invSubMix[1],invSubMix2=invSubMix[2],invSubMix3=invSubMix[3],d=new Uint32Array(256),x=0,xi=0,i=0;for(i=0;i<256;i++)i<128?d[i]=i<<1:d[i]=i<<1^283;for(i=0;i<256;i++){var sx=xi^xi<<1^xi<<2^xi<<3^xi<<4;sx=sx>>>8^255&sx^99,sBox[x]=sx,invSBox[sx]=x;var x2=d[x],x4=d[x2],x8=d[x4],t=257*d[sx]^16843008*sx;subMix0[x]=t<<24|t>>>8,subMix1[x]=t<<16|t>>>16,subMix2[x]=t<<8|t>>>24,subMix3[x]=t,t=16843009*x8^65537*x4^257*x2^16843008*x,invSubMix0[sx]=t<<24|t>>>8,invSubMix1[sx]=t<<16|t>>>16,invSubMix2[sx]=t<<8|t>>>24,invSubMix3[sx]=t,x?(x=x2^d[d[d[x8^x2]]],xi^=d[d[xi]]):x=xi=1}}},{key:"expandKey",value:function(keyBuffer){var theKey={},key=this.uint8ArrayToUint32Array_(keyBuffer),keySize=theKey.keySize=key.length;if(4!==keySize&&6!==keySize&&8!==keySize)throw new Error("Invalid aes key size="+keySize);var ksRows=theKey.ksRows=4*(keySize+6+1),ksRow=void 0,invKsRow=void 0,keySchedule=theKey.keySchedule=new Uint32Array(ksRows),invKeySchedule=theKey.invKeySchedule=new Uint32Array(ksRows),sbox=this.sBox,rcon=this.rcon,invSubMix=this.invSubMix,invSubMix0=invSubMix[0],invSubMix1=invSubMix[1],invSubMix2=invSubMix[2],invSubMix3=invSubMix[3],prev=void 0,t=void 0;for(ksRow=0;ksRow<ksRows;ksRow++)ksRow<keySize?prev=keySchedule[ksRow]=key[ksRow]:(t=prev,ksRow%keySize===0?(t=t<<8|t>>>24,t=sbox[t>>>24]<<24|sbox[t>>>16&255]<<16|sbox[t>>>8&255]<<8|sbox[255&t],t^=rcon[ksRow/keySize|0]<<24):keySize>6&&ksRow%keySize===4&&(t=sbox[t>>>24]<<24|sbox[t>>>16&255]<<16|sbox[t>>>8&255]<<8|sbox[255&t]),keySchedule[ksRow]=prev=(keySchedule[ksRow-keySize]^t)>>>0);for(invKsRow=0;invKsRow<ksRows;invKsRow++)ksRow=ksRows-invKsRow,t=3&invKsRow?keySchedule[ksRow]:keySchedule[ksRow-4],invKsRow<4||ksRow<=4?invKeySchedule[invKsRow]=t:invKeySchedule[invKsRow]=invSubMix0[sbox[t>>>24]]^invSubMix1[sbox[t>>>16&255]]^invSubMix2[sbox[t>>>8&255]]^invSubMix3[sbox[255&t]],invKeySchedule[invKsRow]=invKeySchedule[invKsRow]>>>0;return theKey}},{key:"networkToHostOrderSwap",value:function(word){return word<<24|(65280&word)<<8|(16711680&word)>>8|word>>>24}},{key:"decrypt",value:function(key,inputArray,aesIV){var ksRow,i,nRounds=key.keySize+6,invKeySchedule=key.invKeySchedule,invSBOX=this.invSBox,invSubMix=this.invSubMix,invSubMix0=invSubMix[0],invSubMix1=invSubMix[1],invSubMix2=invSubMix[2],invSubMix3=invSubMix[3],initVector=this.uint8ArrayToUint32Array_(aesIV),initVector0=initVector[0],initVector1=initVector[1],initVector2=initVector[2],initVector3=initVector[3],inputUint8=_ArrayHelper2.default.makeUint8Array(inputArray),inputInt32=new Int32Array(inputUint8.buffer,inputUint8.byteOffset,inputUint8.byteLength>>2),outputInt32=new Int32Array(inputInt32.length),t0=void 0,t1=void 0,t2=void 0,t3=void 0,s0=void 0,s1=void 0,s2=void 0,s3=void 0,inputWords0=void 0,inputWords1=void 0,inputWords2=void 0,inputWords3=void 0,swapWord=this.networkToHostOrderSwap,offset=0;while(offset<inputInt32.length){for(inputWords0=swapWord(inputInt32[offset]),inputWords1=swapWord(inputInt32[offset+1]),inputWords2=swapWord(inputInt32[offset+2]),inputWords3=swapWord(inputInt32[offset+3]),s0=inputWords0^invKeySchedule[0],s1=inputWords3^invKeySchedule[1],s2=inputWords2^invKeySchedule[2],s3=inputWords1^invKeySchedule[3],ksRow=4,i=1;i<nRounds;i++)t0=invSubMix0[s0>>>24]^invSubMix1[s1>>16&255]^invSubMix2[s2>>8&255]^invSubMix3[255&s3]^invKeySchedule[ksRow],t1=invSubMix0[s1>>>24]^invSubMix1[s2>>16&255]^invSubMix2[s3>>8&255]^invSubMix3[255&s0]^invKeySchedule[ksRow+1],t2=invSubMix0[s2>>>24]^invSubMix1[s3>>16&255]^invSubMix2[s0>>8&255]^invSubMix3[255&s1]^invKeySchedule[ksRow+2],t3=invSubMix0[s3>>>24]^invSubMix1[s0>>16&255]^invSubMix2[s1>>8&255]^invSubMix3[255&s2]^invKeySchedule[ksRow+3],s0=t0,s1=t1,s2=t2,s3=t3,ksRow+=4;t0=invSBOX[s0>>>24]<<24^invSBOX[s1>>16&255]<<16^invSBOX[s2>>8&255]<<8^invSBOX[255&s3]^invKeySchedule[ksRow],t1=invSBOX[s1>>>24]<<24^invSBOX[s2>>16&255]<<16^invSBOX[s3>>8&255]<<8^invSBOX[255&s0]^invKeySchedule[ksRow+1],t2=invSBOX[s2>>>24]<<24^invSBOX[s3>>16&255]<<16^invSBOX[s0>>8&255]<<8^invSBOX[255&s1]^invKeySchedule[ksRow+2],t3=invSBOX[s3>>>24]<<24^invSBOX[s0>>16&255]<<16^invSBOX[s1>>8&255]<<8^invSBOX[255&s2]^invKeySchedule[ksRow+3],ksRow+=3,outputInt32[offset]=swapWord(t0^initVector0),outputInt32[offset+1]=swapWord(t3^initVector1),outputInt32[offset+2]=swapWord(t2^initVector2),outputInt32[offset+3]=swapWord(t1^initVector3),initVector0=inputWords0,initVector1=inputWords1,initVector2=inputWords2,initVector3=inputWords3,offset+=4}return _ArrayHelper2.default.makeUint8Array(outputInt32)}},{key:"destroy",value:function(){this.key=void 0,this.keySize=void 0,this.ksRows=void 0,this.sBox=void 0,this.invSBox=void 0,this.subMix=void 0,this.invSubMix=void 0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.rcon=void 0}}]),AESDecryptor}();exports.default=AESDecryptor,module.exports=exports["default"]},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_logger=__webpack_require__(1),_EME2=__webpack_require__(40),_EME3=_interopRequireDefault(_EME2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!==typeof call&&"function"!==typeof call?self:call}function _inherits(subClass,superClass){if("function"!==typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var LegacyEME=function(_EME){_inherits(LegacyEME,_EME);function LegacyEME(hls,keySystem,obtainKeySystemConfigCallback,video,totalSessions){_classCallCheck(this,LegacyEME),_logger.logger.log("LegacyEME: constructor");var _this=_possibleConstructorReturn(this,(LegacyEME.__proto__||Object.getPrototypeOf(LegacyEME)).call(this,hls,keySystem,obtainKeySystemConfigCallback,totalSessions));return _this._options=null,_this._ensurePromise=null,_this._video=video,_this._sessions=[],"PLAYREADY"===keySystem?(_this._prefix="ms",_this._mediaKeys=window.MSMediaKeys):"FAIRPLAY"===keySystem?(_this._prefix="webkit",_this._mediaKeys=window.WebKitMediaKeys):_this.onError({message:"unsupported keySystem "+keySystem}),_this.needkey=_this.onNeedKey.bind(_this),_this.keymessage=_this.onKeyMessage.bind(_this),_this.keyerror=_this.onKeyError.bind(_this),_this.keyadded=_this.onKeyAdded.bind(_this),_this._video.addEventListener(_this._prefix+"needkey",_this.needkey),_this}return _createClass(LegacyEME,[{key:"dispose",value:function(){this._video&&(this._video.removeEventListener(this._prefix+"needkey",this.needkey),this._video=null);while(this._sessions.length>0){var session=this._sessions.shift();session.removeEventListener(this._prefix+"keymessage",this.keymessage),session.removeEventListener(this._prefix+"keyerror",this.keyerror),session.removeEventListener(this._prefix+"keyadded",this.keyadded)}this._options=null}},{key:"setOptions",value:function(options){this._options=options}},{key:"onKeyMessage",value:function(event){var strMessage=String.fromCharCode.apply(null,event.message);_logger.logger.log("createSession: keyMessage"),"certificate"===strMessage?(_logger.logger.log("createSession: obtainCertificate"),this.obtainCertificate(event)):(_logger.logger.log("createSession: obtainLicense"),this.obtainLicense(event))}},{key:"onKeyError",value:function(event){this.onError(event)}},{key:"onKeyAdded",value:function(){_logger.logger.log("onKeyAdded: key added")}},{key:"createSession",value:function(data,keys){_logger.logger.log("createSession");var session=null,initData=data;this._initData&&(initData=this._initData);try{session=keys.createSession("video/mp4",initData),session.addEventListener(this._prefix+"keymessage",this.keymessage),session.addEventListener(this._prefix+"keyerror",this.keyerror),session.addEventListener(this._prefix+"keyadded",this.keyadded),_logger.logger.log("createSession: session created")}catch(err){_logger.logger.log("createSession: failed to create the session"),this.onError(err)}}},{key:"onNeedKey",value:function(event){if(!this._video.msKeys&&!this._video.webkitKeys){_logger.logger.log("onNeedKey");try{var keys=new this._mediaKeys(this.keySystem);keys?("ms"===this._prefix?this._video.msSetMediaKeys(keys):"webkit"===this._prefix?this._video.webkitSetMediaKeys(keys):this.onError({message:"unsupported keySystem "+this.keySystem}),this.createSession(event.initData,this._video.msKeys?this._video.msKeys:this._video.webkitKeys)):this.onError({message:"failed to create media keys"})}catch(e){this.onError(e)}}}},{key:"initData",set:function(initData){this._initData=initData}}]),LegacyEME}(_EME3.default);exports.default=LegacyEME,module.exports=exports["default"]},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_errors=__webpack_require__(4),_events=__webpack_require__(3),_events2=_interopRequireDefault(_events),_eventHandler=__webpack_require__(5),_eventHandler2=_interopRequireDefault(_eventHandler),_EME=__webpack_require__(40),_EME2=_interopRequireDefault(_EME),_KeySystems=__webpack_require__(36),_KeySystems2=_interopRequireDefault(_KeySystems),_logger=__webpack_require__(1),_LegacyEME=__webpack_require__(114),_LegacyEME2=_interopRequireDefault(_LegacyEME),_ModernEME=__webpack_require__(116),_ModernEME2=_interopRequireDefault(_ModernEME),_muxjs=__webpack_require__(44),_muxjs2=_interopRequireDefault(_muxjs);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!==typeof call&&"function"!==typeof call?self:call}function _inherits(subClass,superClass){if("function"!==typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var LicenseManager=function(_EventHandler){_inherits(LicenseManager,_EventHandler);function LicenseManager(hls,obtainKeySystemConfigCallback){_classCallCheck(this,LicenseManager);var _this=_possibleConstructorReturn(this,(LicenseManager.__proto__||Object.getPrototypeOf(LicenseManager)).call(this,hls,_events2.default.MEDIA_ATTACHING,_events2.default.MEDIA_DETACHING,_events2.default.DESTROYING,_events2.default.BUFFER_CREATED));return _this._obtainKeySystemConfigCallback=obtainKeySystemConfigCallback,_this}return _createClass(LicenseManager,[{key:"onMediaAttaching",value:function(data){this._video=data.media}},{key:"onDestroying",value:function(){this._obtainKeySystemConfigCallback=null}},{key:"onMediaDetaching",value:function(){this._drm&&this._drm.dispose(),this._drm=null,this._video=null}},{key:"onLicenseManagerError",value:function(err){_logger.logger.error("license manager error: "+err.message),this.hls&&this.hls.trigger(_events2.default.ERROR,{type:_errors.ErrorTypes.MEDIA_ERROR,details:_errors.ErrorDetails.DRM_ERROR,fatal:!0,reason:err.message})}},{key:"extractSkd",value:function(levelkeys){var i=void 0,initData=null;if(levelkeys)for(i=0;i<levelkeys.length&&null===initData;i++)if("com.apple.streamingkeydelivery"===levelkeys[i].format){var str=levelkeys[i].reluri,base64IndexStart=6,base64IndexEnd=str.indexOf(";");base64IndexEnd<0&&(base64IndexEnd=str.length);var j=void 0,base64=str.substring(base64IndexStart,base64IndexEnd);for(initData=new Uint8Array(base64.length),j=0;j<base64.length;j++)initData[j]=base64.charCodeAt(j)}return initData}},{key:"hasSampleAes",value:function hasSampleAes(initFrag){var hasSampleAes=!1,i=void 0,frag=_muxjs2.default.mp4.tools.inspect(new Uint8Array(initFrag));for(i=0;i<frag.length&&hasSampleAes===!1;i++)if("moov"===frag[i].type){var j=void 0;for(j=0;j<frag[i].boxes.length&&hasSampleAes===!1;j++)if("pssh"===frag[i].boxes[j].type)_logger.logger.log("hasSampleAes - pssh found"),hasSampleAes=!0;else if(this.hls.browSafari&&"trak"===frag[i].boxes[j].type){var k=void 0;for(k=0;k<frag[i].boxes[j].boxes.length&&hasSampleAes===!1;k++)if("mdia"===frag[i].boxes[j].boxes[k].type){var l=void 0;for(l=0;l<frag[i].boxes[j].boxes[k].boxes.length&&hasSampleAes===!1;l++)if("minf"===frag[i].boxes[j].boxes[k].boxes[l].type){var m=void 0;for(m=0;m<frag[i].boxes[j].boxes[k].boxes[l].boxes.length&&hasSampleAes===!1;m++)if("stbl"===frag[i].boxes[j].boxes[k].boxes[l].boxes[m].type){var n=void 0;for(n=0;n<frag[i].boxes[j].boxes[k].boxes[l].boxes[m].boxes.length&&hasSampleAes===!1;n++)if("stsd"===frag[i].boxes[j].boxes[k].boxes[l].boxes[m].boxes[n].type){var sampleDescriptions=frag[i].boxes[j].boxes[k].boxes[l].boxes[m].boxes[n].sampleDescriptions;if(sampleDescriptions){var o=void 0;for(o=0;o<sampleDescriptions.length&&hasSampleAes===!1;o++)"enca"!==sampleDescriptions[o].type&&"encv"!==sampleDescriptions[o].type||(_logger.logger.log("hasSampleAes - sample description type: "+sampleDescriptions[o].type),hasSampleAes=!0)}}}}}}}return hasSampleAes}},{key:"onBufferCreated",value:function(data){_logger.logger.log("LicenseManager onBufferCreated");var tracks=data.tracks,encryptedCount=0,skd=null;if(!this._drm){var options=[{initDataTypes:["cenc"]}];if(tracks.audio&&this.hasSampleAes(tracks.audio.initSegment)&&(options=this.setOptions(tracks.audio,options),skd=this.extractSkd(tracks.audio.levelkeys),encryptedCount++),tracks.video&&this.hasSampleAes(tracks.video.initSegment)&&(options=this.setOptions(tracks.video,options),skd=this.extractSkd(tracks.video.levelkeys),encryptedCount++),encryptedCount>0&&(window.navigator.requestMediaKeySystemAccess?this.hls.browEdge?(_logger.logger.log("PlayReady ModernEME"),this._drm=new _ModernEME2.default(this.hls,_KeySystems2.default.PLAYREADY,this._obtainKeySystemConfigCallback,this._video,encryptedCount)):this.hls.browChrome||this.hls.browFirefox?(_logger.logger.log("Widevine ModernEME"),this._drm=new _ModernEME2.default(this.hls,_KeySystems2.default.WIDEVINE,this._obtainKeySystemConfigCallback,this._video,encryptedCount)):this.onLicenseManagerError({message:"unsupported browser"}):this.hls.browIE?(_logger.logger.log("PlayReady LegacyEME"),this._drm=new _LegacyEME2.default(this.hls,_KeySystems2.default.PLAYREADY,this._obtainKeySystemConfigCallback,this._video,encryptedCount)):this.hls.browSafari?(_logger.logger.log("FairPlay LegacyEME"),this._drm=new _LegacyEME2.default(this.hls,_KeySystems2.default.FAIRPLAY,this._obtainKeySystemConfigCallback,this._video,encryptedCount)):this.onLicenseManagerError({message:"unsupported browser"}),this._drm)){this._drm.setOptions(options);var keySystem=this._drm.keySystemName;keySystem===_KeySystems2.default.FAIRPLAY&&(this._drm.initData=skd),this._drm.setKeySystemConfig(null)}}}},{key:"setOptions",value:function(data,options){var newOptions=options;if("audio/mp4"===data.container){var audioContentType=data.container;data.codec&&(audioContentType+='; codecs="'+data.codec+'"'),newOptions[0].audioCapabilities=[{contentType:audioContentType}]}else if("video/mp4"===data.container){var videoContentType=data.container;data.codec&&(videoContentType+='; codecs="'+data.codec+'"'),newOptions[0].videoCapabilities=[{contentType:videoContentType}]}return newOptions}},{key:"drmCapabilities",get:function(){return _EME2.default.capabilities}}]),LicenseManager}(_eventHandler2.default);exports.default=LicenseManager,module.exports=exports["default"]},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_logger=__webpack_require__(1),_EME2=__webpack_require__(40),_EME3=_interopRequireDefault(_EME2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!==typeof call&&"function"!==typeof call?self:call}function _inherits(subClass,superClass){if("function"!==typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var ModernEME=function(_EME){_inherits(ModernEME,_EME);function ModernEME(hls,keySystem,obtainKeySystemConfigCallback,video,totalSessions){_classCallCheck(this,ModernEME),_logger.logger.log("ModernEME: constructor");var _this=_possibleConstructorReturn(this,(ModernEME.__proto__||Object.getPrototypeOf(ModernEME)).call(this,hls,keySystem,obtainKeySystemConfigCallback,totalSessions));return _this._options=null,_this._ensurePromise=null,_this._video=video,_this._sessions=[],_this.encrypted=_this.onEncrypted.bind(_this),_this.message=_this.obtainLicense.bind(_this),_this._video.addEventListener("encrypted",_this.encrypted),_this}return _createClass(ModernEME,[{key:"setOptions",value:function(options){this._options=options}},{key:"dispose",value:function(){var _this2=this;this._video&&(this._video.removeEventListener("encrypted",this.encrypted),this._video=null);var _loop=function(){var session=_this2._sessions.shift();session.removeEventListener("message",_this2.message),session.close().then(function(){_logger.logger.log("dispose: media key session closed"),session.remove().then(function(){_logger.logger.log("dispose: media key session removed")}).catch(function(){_logger.logger.log("dispose: failed to remove the media key session")})}).catch(function(){_logger.logger.log("dispose: failed to close the media key session")})};while(this._sessions.length>0)_loop();
this._options=null}},{key:"ensureMediaKeysCreated",value:function(){var _this3=this;return this._ensurePromise?(_logger.logger.log("ensureMediaKeysCreated: media keys already created"),this._ensurePromise):(this._ensurePromise=navigator.requestMediaKeySystemAccess(this._keySystem,this._options).then(function(keySystemAccess){return _logger.logger.log("ensureMediaKeysCreated: createMediaKeys"),keySystemAccess.createMediaKeys()}).then(function(mediaKeys){return _this3._video.mediaKeys?(_logger.logger.log("ensureMediaKeysCreated: media keys already set"),_this3._video.mediaKeys):(_logger.logger.log("ensureMediaKeysCreated: setMediaKeys"),_this3._video.setMediaKeys(mediaKeys))}).catch(function(err){_this3.onError(err)}),this._ensurePromise)}},{key:"onEncrypted",value:function(event){var _this4=this;this._sessions.length<this._totalSessions&&this.ensureMediaKeysCreated().then(function(){_logger.logger.log("onEncrypted: createSession");var session=_this4._video.mediaKeys.createSession();return session.addEventListener("message",_this4.message),_this4._sessions.push(session),session.generateRequest(event.initDataType,event.initData)}).then(function(){_logger.logger.log("onEncrypted: generated request")}).catch(function(err){_this4.onError(err)})}}]),ModernEME}(_EME3.default);exports.default=ModernEME,module.exports=exports["default"]},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.hlsDefaultConfig=void 0;var _abrController=__webpack_require__(118),_abrController2=_interopRequireDefault(_abrController),_bufferController=__webpack_require__(121),_bufferController2=_interopRequireDefault(_bufferController),_capLevelController=__webpack_require__(122),_capLevelController2=_interopRequireDefault(_capLevelController),_fpsController=__webpack_require__(123),_fpsController2=_interopRequireDefault(_fpsController),_xhrLoader=__webpack_require__(141),_xhrLoader2=_interopRequireDefault(_xhrLoader),_audioTrackController=__webpack_require__(120),_audioTrackController2=_interopRequireDefault(_audioTrackController),_audioStreamController=__webpack_require__(119),_audioStreamController2=_interopRequireDefault(_audioStreamController),_cues=__webpack_require__(136),_cues2=_interopRequireDefault(_cues),_timelineController=__webpack_require__(129),_timelineController2=_interopRequireDefault(_timelineController),_subtitleTrackController=__webpack_require__(128),_subtitleTrackController2=_interopRequireDefault(_subtitleTrackController),_subtitleStreamController=__webpack_require__(127),_subtitleStreamController2=_interopRequireDefault(_subtitleStreamController);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.hlsDefaultConfig={autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,maxBufferSize:60*1e3*1e3,maxBufferHole:.5,maxSeekHole:2,lowBufferWatchdogPeriod:.5,highBufferWatchdogPeriod:3,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:0,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxMaxBufferLength:60,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:2,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:1e4,fragLoadingLoopThreshold:3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:_xhrLoader2.default,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,fetchSetup:void 0,abrController:_abrController2.default,bufferController:_bufferController2.default,capLevelController:_capLevelController2.default,fpsController:_fpsController2.default,audioStreamController:_audioStreamController2.default,audioTrackController:_audioTrackController2.default,subtitleStreamController:_subtitleStreamController2.default,subtitleTrackController:_subtitleTrackController2.default,timelineController:_timelineController2.default,cueHandler:_cues2.default,enableCEA708Captions:!0,enableWebVTT:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",stretchShortVideoTrack:!1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,browChrome:void 0,browEdge:void 0,browIE:void 0,browFirefox:void 0,browSafari:void 0,browOpera:void 0,browAndroid:void 0,browTizen2:void 0,browTizen3:void 0,browDetected:void 0,enableMuxJs:!0,nudgeOnStall:!1,decryptOutsideWebworker:!1,streamTimeOut:3e4,minAutoBitrate:0}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_events=__webpack_require__(3),_events2=_interopRequireDefault(_events),_eventHandler=__webpack_require__(5),_eventHandler2=_interopRequireDefault(_eventHandler),_bufferHelper=__webpack_require__(25),_bufferHelper2=_interopRequireDefault(_bufferHelper),_errors=__webpack_require__(4),_logger=__webpack_require__(1),_ewmaBandwidthEstimator=__webpack_require__(137),_ewmaBandwidthEstimator2=_interopRequireDefault(_ewmaBandwidthEstimator);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!==typeof call&&"function"!==typeof call?self:call}function _inherits(subClass,superClass){if("function"!==typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var AbrController=function(_EventHandler){_inherits(AbrController,_EventHandler);function AbrController(hls){_classCallCheck(this,AbrController);var _this=_possibleConstructorReturn(this,(AbrController.__proto__||Object.getPrototypeOf(AbrController)).call(this,hls,_events2.default.FRAG_LOADING,_events2.default.FRAG_LOADED,_events2.default.FRAG_BUFFERED,_events2.default.ERROR));return _this.lastLoadedFragLevel=0,_this._nextAutoLevel=-1,_this.hls=hls,_this.onCheck=_this._abandonRulesCheck.bind(_this),_this.latency=0,_this}return _createClass(AbrController,[{key:"destroy",value:function(){this.clearTimer(),_eventHandler2.default.prototype.destroy.call(this),this.onCheck=null,this._bwEstimator&&(this._bwEstimator.destroy(),this._bwEstimator=null),this.fragCurrent=null}},{key:"onFragLoading",value:function(data){var frag=data.frag;if("main"===frag.type){if(this.timer||(this.timer=setInterval(this.onCheck,100)),!this._bwEstimator){var hls=this.hls,level=data.frag.level,isLive=hls.levels[level].details.live,config=hls.config,ewmaFast=void 0,ewmaSlow=void 0;isLive?(ewmaFast=config.abrEwmaFastLive,ewmaSlow=config.abrEwmaSlowLive):(ewmaFast=config.abrEwmaFastVoD,ewmaSlow=config.abrEwmaSlowVoD),this._bwEstimator=new _ewmaBandwidthEstimator2.default(hls,ewmaSlow,ewmaFast,config.abrEwmaDefaultEstimate)}this.fragCurrent=frag}}},{key:"_abandonRulesCheck",value:function(){var hls=this.hls,v=hls.media,frag=this.fragCurrent,loader=frag.loader,minAutoLevel=hls.minAutoLevel;if(!loader||loader.stats&&loader.stats.aborted)return this.clearTimer(),void 0;var stats=loader.stats;if(v&&(!v.paused&&0!==v.playbackRate||!v.readyState)&&frag.autoLevel&&frag.level>minAutoLevel&&stats.tfirst){var requestDelay=performance.now()-stats.tfirst,playbackRate=Math.abs(v.playbackRate);if(requestDelay>500*frag.duration/playbackRate){var levels=hls.levels,loadRate=Math.max(1,stats.loaded/(requestDelay/1e3)),level=levels[frag.level],levelBitrate=level.realBitrate?Math.max(level.realBitrate,level.bitrate):level.bitrate,expectedLen=stats.total?stats.total:Math.max(stats.loaded,Math.round(frag.duration*levelBitrate/8)),pos=v.currentTime,fragLoadedDelay=(expectedLen-stats.loaded)/loadRate,bufferStarvationDelay=(_bufferHelper2.default.bufferInfo(v,pos,hls.config.maxBufferHole).end-pos)/playbackRate;if(bufferStarvationDelay<2*frag.duration/playbackRate&&fragLoadedDelay>bufferStarvationDelay){var fragLevelNextLoadedDelay=void 0,nextLoadLevel=frag.level;do{nextLoadLevel--;var levelNextBitrate=levels[nextLoadLevel].realBitrate?Math.max(levels[nextLoadLevel].realBitrate,levels[nextLoadLevel].bitrate):levels[nextLoadLevel].bitrate;if(fragLevelNextLoadedDelay=levelNextBitrate*frag.duration/(8*loadRate*.8)/playbackRate+this.latency/1e3,fragLevelNextLoadedDelay<bufferStarvationDelay)break}while(nextLoadLevel>minAutoLevel);fragLevelNextLoadedDelay<fragLoadedDelay&&(_logger.logger.warn("loading too slow, abort fragment loading and switch to level "+nextLoadLevel+":fragLoadedDelay["+nextLoadLevel+"]<fragLoadedDelay["+(frag.level-1)+"];bufferStarvationDelay:"+fragLevelNextLoadedDelay.toFixed(1)+"<"+fragLoadedDelay.toFixed(1)+":"+bufferStarvationDelay.toFixed(1)),hls.nextLoadLevel=nextLoadLevel,this._bwEstimator.sample(requestDelay,stats.loaded),hls.trigger(_events2.default.BITRATE_ESTIMATE_UPDATED,{bitrate:this.getBitrateEstimate()}),loader.abort(),this.clearTimer(),hls.trigger(_events2.default.FRAG_LOAD_EMERGENCY_ABORTED,{frag:frag,stats:stats}))}}}}},{key:"onFragLoaded",value:function(data){var frag=data.frag;if("main"===frag.type&&!isNaN(frag.sn)){if(this.clearTimer(),this.lastLoadedFragLevel=frag.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var level=this.hls.levels[frag.level],loadedBytes=(level.loaded?level.loaded.bytes:0)+data.stats.loaded,loadedDuration=(level.loaded?level.loaded.duration:0)+data.frag.duration;level.loaded={bytes:loadedBytes,duration:loadedDuration},level.realBitrate=Math.round(8*loadedBytes/loadedDuration)}if(data.frag.bitrateTest){var stats=data.stats;stats.tparsed=stats.tbuffered=stats.tload,this.onFragBuffered(data)}}}},{key:"onFragBuffered",value:function(data){var stats=data.stats,frag=data.frag;if(stats.aborted!==!0&&1===frag.loadCounter&&"main"===frag.type&&!isNaN(frag.sn)&&(!frag.bitrateTest||stats.tload===stats.tbuffered)){var fragLoadingProcessingMs=stats.tparsed-stats.tfirst;this.latency=stats.tfirst-stats.trequest,_logger.logger.log("latency/loading/parsing/append/kbps: "+Math.round(stats.tfirst-stats.trequest)+"/"+Math.round(stats.tload-stats.tfirst)+"/"+Math.round(stats.tparsed-stats.tload)+"/"+Math.round(stats.tbuffered-stats.tparsed)+"/"+Math.round(8*stats.loaded/(stats.tbuffered-stats.trequest))),this._bwEstimator.sample(fragLoadingProcessingMs,stats.loaded),this.hls.trigger(_events2.default.BITRATE_ESTIMATE_UPDATED,{bitrate:this.getBitrateEstimate()}),frag.bitrateTest?this.bitrateTestDelay=(fragLoadingProcessingMs+this.latency)/1e3:this.bitrateTestDelay=0}}},{key:"onError",value:function(data){switch(data.details){case _errors.ErrorDetails.FRAG_LOAD_ERROR:case _errors.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer()}}},{key:"clearTimer",value:function(){this.timer&&(clearInterval(this.timer),this.timer=null)}},{key:"_findBestLevel",value:function(currentLevel,currentFragDuration,currentBw,minAutoLevel,maxAutoLevel,bufferLength,bwFactor,bwUpFactor,levels,playbackRate){for(var i=maxAutoLevel;i>=minAutoLevel;i--){var levelInfo=levels[i],levelDetails=levelInfo.details,avgDuration=levelDetails?levelDetails.totalduration/levelDetails.fragments.length:currentFragDuration,live=!!levelDetails&&levelDetails.live,adjustedbw=void 0,adjustedBwFactor=this._getBwFactor(bwFactor,1.25,bufferLength,2*avgDuration),adjustedBwUpFactor=this._getBwFactor(bwUpFactor,1.25,bufferLength,2*avgDuration),maxFetchDuration=bufferLength/playbackRate;adjustedbw=i<=currentLevel?adjustedBwFactor*currentBw/playbackRate:adjustedBwUpFactor*currentBw/playbackRate;var bitrate=levels[i].realBitrate?Math.max(levels[i].realBitrate,levels[i].bitrate):levels[i].bitrate,fetchDuration=bitrate*avgDuration/currentBw/playbackRate+this.latency/1e3;if(adjustedbw>bitrate&&(!fetchDuration||live||fetchDuration<maxFetchDuration))return i}return-1}},{key:"_getBwFactor",value:function(baseFactor,maxFactor,bufferLength,minBufferLength){var adjustedFactor=baseFactor,bufferSizeRemaining=(bufferLength-minBufferLength)/(this.hls.config.maxMaxBufferLength-minBufferLength);return adjustedFactor+=Math.max(0,(maxFactor-baseFactor)*bufferSizeRemaining),Math.min(adjustedFactor,maxFactor).toFixed(2)}},{key:"getBitrateEstimate",value:function(){return this._bwEstimator&&this._bwEstimator.canEstimate?this._bwEstimator.getEstimate():0}},{key:"nextAutoLevel",get:function(){var forcedAutoLevel=this._nextAutoLevel;if(forcedAutoLevel!==-1)return forcedAutoLevel;var nextABRAutoLevel=this._nextABRAutoLevel;return forcedAutoLevel!==-1&&(nextABRAutoLevel=Math.min(forcedAutoLevel,nextABRAutoLevel)),nextABRAutoLevel},set:function(nextLevel){this._nextAutoLevel=nextLevel}},{key:"_nextABRAutoLevel",get:function(){var hls=this.hls,maxAutoLevel=hls.maxAutoLevel,levels=hls.levels,config=hls.config,minAutoLevel=hls.minAutoLevel,v=hls.media,currentLevel=this.lastLoadedFragLevel,currentFragDuration=this.fragCurrent?this.fragCurrent.duration:0,pos=v?v.currentTime:0,playbackRate=v&&0!==v.playbackRate?Math.abs(v.playbackRate):1,avgbw=this._bwEstimator?this._bwEstimator.getEstimate():config.abrEwmaDefaultEstimate,bufferLength=_bufferHelper2.default.bufferInfo(v,pos,config.maxBufferHole).end-pos,bestLevel=this._findBestLevel(currentLevel,currentFragDuration,avgbw,minAutoLevel,maxAutoLevel,bufferLength,config.abrBandWidthFactor,config.abrBandWidthUpFactor,levels,playbackRate);if(bestLevel>=0)return bestLevel;_logger.logger.trace("rebuffering expected to happen, lets try to find a quality level minimizing the rebuffering");var maxStarvationDelay=currentFragDuration?Math.min(currentFragDuration,config.maxStarvationDelay):config.maxStarvationDelay,bwFactor=config.abrBandWidthFactor,bwUpFactor=config.abrBandWidthUpFactor;if(0===bufferLength){var bitrateTestDelay=this.bitrateTestDelay;if(bitrateTestDelay){var maxLoadingDelay=currentFragDuration?Math.min(currentFragDuration,config.maxLoadingDelay):config.maxLoadingDelay;maxStarvationDelay=maxLoadingDelay-bitrateTestDelay,_logger.logger.trace("bitrate test took "+Math.round(1e3*bitrateTestDelay)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*maxStarvationDelay)+" ms"),bwFactor=bwUpFactor=1}}return bestLevel=this._findBestLevel(currentLevel,currentFragDuration,avgbw,minAutoLevel,maxAutoLevel,bufferLength+maxStarvationDelay,bwFactor,bwUpFactor,levels,playbackRate),Math.max(bestLevel,0)}}]),AbrController}(_eventHandler2.default);exports.default=AbrController,module.exports=exports["default"]},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_bufferHelper=__webpack_require__(25),_bufferHelper2=_interopRequireDefault(_bufferHelper),_demuxer=__webpack_require__(69),_demuxer2=_interopRequireDefault(_demuxer),_events=__webpack_require__(3),_events2=_interopRequireDefault(_events),_eventHandler=__webpack_require__(5),_eventHandler2=_interopRequireDefault(_eventHandler),_timeRanges=__webpack_require__(71),_timeRanges2=_interopRequireDefault(_timeRanges),_errors=__webpack_require__(4),_logger=__webpack_require__(1);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!==typeof call&&"function"!==typeof call?self:call}function _inherits(subClass,superClass){if("function"!==typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var State={STOPPED:"STOPPED",STARTING:"STARTING",IDLE:"IDLE",PAUSED:"PAUSED",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",BUFFER_FLUSHING:"BUFFER_FLUSHING",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS"},AudioStreamController=function(_EventHandler){_inherits(AudioStreamController,_EventHandler);function AudioStreamController(hls){_classCallCheck(this,AudioStreamController);var _this=_possibleConstructorReturn(this,(AudioStreamController.__proto__||Object.getPrototypeOf(AudioStreamController)).call(this,hls,_events2.default.MEDIA_ATTACHED,_events2.default.MEDIA_DETACHING,_events2.default.AUDIO_TRACKS_UPDATED,_events2.default.AUDIO_TRACK_SWITCHING,_events2.default.AUDIO_TRACK_LOADED,_events2.default.STREAM_ALL_LEVELS_LOADED,_events2.default.STREAM_DESYNC,_events2.default.FRAG_BUFFERED,_events2.default.MANIFEST_LOADED,_events2.default.KEY_LOADED,_events2.default.FRAG_LOADED,_events2.default.FRAG_PARSING_INIT_SEGMENT,_events2.default.FRAG_PARSING_DATA,_events2.default.FRAG_PARSED,_events2.default.ERROR,_events2.default.BUFFER_CREATED,_events2.default.BUFFER_APPENDED,_events2.default.BUFFER_FLUSHED,_events2.default.BUFFER_WAIT,_events2.default.INIT_PTS_FOUND,_events2.default.SEEK_READY));return _this.config=hls.config,_this.audioCodecSwap=!1,_this.ticks=0,_this._state=State.STOPPED,_this.ontick=_this.tick.bind(_this),_this.initPTS=[],_this.waitingFragment=null,_this.forceStopFetching=!1,_this.allLevelsLoaded=!1,_this.videoFragBuffered=!1,_this._fragBufferCount=0,_this._pausedTimer=!0,_this._flushOnStoppedBuffering={},_this._skipAppendAfterFlush=!1,_this._waitForFlush=!1,_this._bufferBeforeSeekingTime=void 0,_this._bufferBeforeSeekingApplied=void 0,_this._videoSeekReady=void 0,_this}return _createClass(AudioStreamController,[{key:"destroy",value:function(){this.stopLoad(),this.pauseController(),_eventHandler2.default.prototype.destroy.call(this),this.config=null,this.initPTS=null,this.ontick=null,this.tracks=null}},{key:"onInitPtsFound",value:function(data){var demuxerId=data.id,cc=data.frag.cc,initPTS=data.initPTS;"main"===demuxerId&&(this.initPTS[cc]=initPTS,_logger.logger.log("InitPTS for cc:"+cc+" found from video track:"+initPTS),this.state===State.WAITING_INIT_PTS&&(_logger.logger.log("sending pending audio frag to demuxer"),this.state=State.FRAG_LOADING,this.onFragLoaded(this.waitingFragment),this.waitingFragment=null))}},{key:"startLoad",value:function(){}},{key:"onStreamAllLevelsLoaded",value:function(data){this.allLevelsLoaded=!0,this.videoFragBuffered=!1,this.tracks?(this.stopLoad(),this.state=State.STARTING,this.lastCurrentTime=this.nextLoadPosition=this.startPosition=data.startTime,this.fragLoadError=0,this.unpauseController()):(this.startPosition=data.startTime,this.state=State.STOPPED),_logger.logger.log("onStreamAllLevelsLoaded AUDIO this.startPosition: "+this.startPosition+" this.lastCurrentTime: "+this.lastCurrentTime)}},{key:"onStreamDesync",value:function(data){var i=void 0,fragments=this.tracks[this.trackId].details.fragments,totalDropDuration=0,duration=fragments[0].manifestDuration;for(i=0;fragments.length>1&&fragments[0].pdt<data.pdtToAlignTo-data.variance;i++)fragments.splice(0,1),totalDropDuration+=duration,duration=fragments[0].manifestDuration;if(i>0){var j=void 0;for(_logger.logger.log("audio PDT earlier than main PDT, adjusting audio timestamps"),j=0;j<fragments.length;j++)fragments[j].index=j,fragments[j].start-=totalDropDuration,fragments[j].pdt-=1e3*totalDropDuration,fragments[j].sn-=i;this.tracks[this.trackId].details.endSN-=i}}},{key:"pauseController",value:function(){this.timer&&!this._pausedTimer&&(clearInterval(this.timer),this.timer=null,this._pausedTimer=!0)}},{key:"unpauseController",value:function(){!this.timer&&this._pausedTimer&&this.tracks&&(this.timer=setInterval(this.ontick,100),this._pausedTimer=!1,this.tick())}},{key:"stopLoad",value:function(){var frag=this.fragCurrent;frag&&(_logger.logger.log("Audio resetting current frag load count as load was aborted"),frag.loadCounter=0,frag.loader&&frag.loader.abort(),this.fragCurrent=null),this._fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=State.STOPPED,this.timestampOffset=void 0}},{key:"tick",value:function(){this._pausedTimer||(this.ticks++,1===this.ticks&&(this.doTick(),this.ticks>1&&setTimeout(this.tick,1),this.ticks=0))}},{key:"_doTickIdle",value:function(){var tracks=this.tracks;if(tracks){var hls=this.hls,config=hls.config;if(this.media||!this.startFragRequested&&config.startFragPrefetch){var pos=void 0;void 0!==this._bufferBeforeSeekingTime&&this._bufferBeforeSeekingApplied===!1?(_logger.logger.log("audio: using bufferBeforeSeeking"),pos=this._bufferBeforeSeekingTime,this._fragPrevious=null,this._bufferBeforeSeekingApplied=!0):pos=this.videoFragBuffered?this.loadedmetadata&&this._videoSeekReady!==!1?this.media.currentTime:this.nextLoadPosition:this.startPosition;var media=this.mediaBuffer?this.mediaBuffer:this.media,bufferInfo=_bufferHelper2.default.bufferInfo(media,pos,config.maxBufferHole),bufferLen=bufferInfo.len,bufferEnd=bufferInfo.end,maxBufLen=config.maxMaxBufferLength,audioSwitch=this.audioSwitch,trackId=this.trackId;if(trackId<tracks.length&&(bufferLen<maxBufLen||this._bufferBeforeSeekingApplied===!0)){var trackDetails=void 0;if(trackDetails=tracks[trackId].details,"undefined"===typeof trackDetails)return this.state=State.WAITING_TRACK,void 0;if(!audioSwitch&&!trackDetails.live&&this._fragPrevious&&this._fragPrevious.sn===trackDetails.endSN&&(!this.media.seeking||this.media.duration-bufferEnd<this._fragPrevious.duration/2))return hls.trigger(_events2.default.BUFFER_EOS,{type:"audio"}),this.state=State.ENDED,void 0;var fragments=trackDetails.fragments,fragLen=fragments.length,start=fragments[0].start,end=fragments[fragLen-1].start+fragments[fragLen-1].duration,frag=void 0;if(audioSwitch&&(bufferEnd=pos,trackDetails.PTSKnown&&pos<start)){if(!(bufferInfo.end>start||bufferInfo.nextStart))return;_logger.logger.log("alt audio track ahead of main track, seek to start of alt audio track"),this.media.currentTime=start+.05}if(trackDetails.initSegment&&!trackDetails.initSegment.data)frag=trackDetails.initSegment;else if(bufferEnd<=start)frag=fragments[0];else{if(this.forceStopFetching===!0)return;var findFragResults=hls.streamController._findFragment(start,this._fragPrevious,fragLen,fragments,bufferEnd,end,trackDetails,pos,!1,this.media);frag=findFragResults.frag,this._fragPrevious=findFragResults.fragPrevious}if(frag&&(!this._fragPrevious||!this._fragPrevious.pdt||!frag.pdt||this._fragPrevious.pdt!==frag.pdt))if(frag.decryptdata&&null!=frag.decryptdata.uri&&null==frag.decryptdata.key)_logger.logger.log("Audio loading key for "+frag.sn+" of ["+trackDetails.startSN+" ,"+trackDetails.endSN+"],track "+trackId),this.state=State.KEY_LOADING,hls.trigger(_events2.default.KEY_LOADING,{frag:frag});else{if(_logger.logger.log("Audio loading "+frag.sn+" of ["+trackDetails.startSN+" ,"+trackDetails.endSN+"],track "+trackId+", pos:"+pos+",bufferEnd:"+bufferEnd.toFixed(3)),void 0!==this.fragLoadIdx?this.fragLoadIdx++:this.fragLoadIdx=0,frag.loadCounter&&this._bufferBeforeSeekingApplied!==!0){frag.loadCounter++;var maxThreshold=config.fragLoadingLoopThreshold;if(frag.loadCounter>maxThreshold&&Math.abs(this.fragLoadIdx-frag.loadIdx)<maxThreshold)return hls.trigger(_events2.default.ERROR,{type:_errors.ErrorTypes.MEDIA_ERROR,details:_errors.ErrorDetails.FRAG_LOOP_LOADING_ERROR,fatal:!1,frag:frag}),void 0}else frag.loadCounter=1;frag.loadIdx=this.fragLoadIdx,this.fragCurrent=frag,this.startFragRequested=!0,isNaN(frag.sn)||(this.nextLoadPosition=frag.start+frag.duration),hls.trigger(_events2.default.FRAG_LOADING,{frag:frag}),this.state=State.FRAG_LOADING}}}}}},{key:"doTick",value:function(){var track=void 0;switch(this.state){case State.ERROR:case State.PAUSED:case State.BUFFER_FLUSHING:break;case State.STARTING:this.state=State.WAITING_TRACK,this.loadedmetadata=!1;break;case State.IDLE:this._doTickIdle();break;case State.WAITING_TRACK:track=this.tracks[this.trackId],track&&track.details&&(this.state=State.IDLE);break;case State.FRAG_LOADING_WAITING_RETRY:var now=performance.now(),retryDate=this.retryDate,media=this.media,isSeeking=media&&media.seeking;(!retryDate||now>=retryDate||isSeeking)&&(_logger.logger.log("audioStreamController: retryDate reached, switch back to IDLE state"),this.state=State.IDLE);break;case State.WAITING_INIT_PTS:case State.STOPPED:case State.FRAG_LOADING:case State.PARSING:case State.PARSED:case State.ENDED:}}},{key:"onMediaAttached",value:function(data){var media=this.media=this.mediaBuffer=data.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),media.addEventListener("seeked",this.onvseeked),media.addEventListener("seeking",this.onvseeking),media.addEventListener("ended",this.onvended);var config=this.config;this.tracks&&config.autoStartLoad&&this.startLoad(config.startPosition)}},{key:"onMediaDetaching",value:function(){var media=this.media;media&&media.ended&&(_logger.logger.log("AUDIO MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0);var tracks=this.tracks;tracks&&tracks.forEach(function(track){track.details&&track.details.fragments.forEach(function(fragment){fragment.loadCounter=void 0})}),media&&(media.removeEventListener("seeking",this.onvseeking),media.removeEventListener("seeked",this.onvseeked),media.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.stopLoad()}},{key:"onMediaSeeking",value:function(){this.state===State.ENDED&&(this.state=State.IDLE),this.media&&(this.lastCurrentTime=this.media.currentTime),void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold),this.hls.trigger(_events2.default.BUFFER_SOURCE_SEEKING),this.tick()}},{key:"onMediaSeeked",value:function(){this.hls&&this.hls._inSlowDetach&&this.hls.streamCoordinator.checkReadyForDispose(void 0,!0)&&(_logger.logger.log("AUDIO slow detach seek finished"),this.hls._doCompleteSlowDetach())}},{key:"onMediaEnded",value:function(){this.startPosition=this.lastCurrentTime=0}},{key:"onSeekReady",value:function(){this._videoSeekReady=void 0}},{key:"onAudioTracksUpdated",value:function(data){_logger.logger.log("audio tracks updated"),this.tracks=data.audioTracks,this.tracks.forEach(function(track){track.deadFragList=[],track.containsGaps=!1,track.gapList=[]})}},{key:"onManifestLoaded",value:function(){this._fragBufferCount=0,this.cmaf=!1}},{key:"onAudioTrackSwitching",value:function(data){var altAudio=!!data.url;this.trackId=data.id,this.state=State.IDLE,this.pendingData=[];var tracks=this.tracks;tracks&&tracks.forEach(function(track){track.details&&track.details.fragments.forEach(function(fragment){fragment.loadCounter=void 0})}),this.fragCurrent=null,this.state=State.PAUSED,this.waitingFragment=null,altAudio?!this.timer&&this.allLevelsLoaded&&this.unpauseController():this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),altAudio&&(this.audioSwitch=!0,this.state=State.IDLE,void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold))}},{key:"onAudioTrackLoaded",value:function(data){var _this2=this,newDetails=data.details,trackId=data.id,track=this.tracks[trackId],duration=newDetails.totalduration,sliding=0;if(_logger.logger.log("onAudioTrackLoaded: track "+trackId+" loaded ["+newDetails.startSN+","+newDetails.endSN+"],duration:"+duration),void 0===this.initialPdt&&newDetails.fragments[0].pdt&&(this.initialPdt=newDetails.fragments[0].pdt),newDetails.live){var curDetails=track.details;curDetails&&newDetails.fragments.length>0?(this.hls.streamCoordinator.basePdt?this.hls.streamController.adjustStartByBasePdt(newDetails,this.hls.streamCoordinator.basePdt):(_logger.logger.log("onAudioTrackLoaded adjustStartBySlidingOffset NO BASEPDT YET"),this.hls.streamController.adjustStartBySlidingOffset(curDetails,newDetails)),sliding=newDetails.fragments[0].start,newDetails.PTSKnown?_logger.logger.log("live audio playlist sliding:"+sliding.toFixed(3)):_logger.logger.log("live audio playlist - outdated PTS, unknown sliding")):this.hls.streamCoordinator.basePdt?(_logger.logger.log("live audio playlist - first load, calculating slide by syncing to base PDT"),this.hls.streamController.adjustStartByBasePdt(newDetails,this.hls.streamCoordinator.basePdt),sliding=newDetails.fragments[0].start,_logger.logger.log("live audio playlist sliding:"+sliding.toFixed(3))):(newDetails.PTSKnown=!1,_logger.logger.log("live audio playlist - first load, unknown sliding"))}else this.hls.streamCoordinator.basePdt&&this.hls.streamController.adjustStartByBasePdt(newDetails,this.hls.streamCoordinator.basePdt),newDetails.PTSKnown=!1;if(track.gapList=[],newDetails.fragments.forEach(function(frag,index){if(frag.tagList.includes("GAP")){_this2.hls.streamController.removeDeadFrag(index,newDetails.fragments),track.containsGaps=!0;while(newDetails.fragments[index]&&newDetails.fragments[index].tagList.includes("GAP"))_this2.hls.streamController.removeDeadFrag(index,newDetails.fragments);newDetails.fragments[index]&&track.gapList.push({start:newDetails.fragments[index].start-newDetails.fragments[index].gap/1e3,end:newDetails.fragments[index].start})}else frag.gap>0&&(track.containsGaps=!0,track.gapList.push({start:frag.start-frag.gap/1e3,end:frag.start}))}),track.deadFragList.forEach(function(deadSn){var index=newDetails.fragments.findIndex(function(element){return element.sn===deadSn});index!==-1&&_this2.hls.streamController.removeDeadFrag(index,newDetails.fragments)}),newDetails.startSN=newDetails.fragments[0].sn,newDetails.originalEndSN=newDetails.endSN,newDetails.endSN=newDetails.fragments[newDetails.fragments.length-1].sn,track.details=newDetails,!this.startFragRequested){if(this.startPosition===-1){var startTimeOffset=newDetails.startTimeOffset;isNaN(startTimeOffset)?this.startPosition=0:(_logger.logger.log("start time offset found in playlist, adjust startPosition to "+startTimeOffset),this.startPosition=startTimeOffset);
}this.nextLoadPosition=this.startPosition}this.state===State.WAITING_TRACK&&(this.state=State.IDLE),this.hls.trigger(_events2.default.AUDIO_TRACK_UPDATED,{details:newDetails,track:trackId,sliding:sliding})}},{key:"onKeyLoaded",value:function(){this.state===State.KEY_LOADING&&(this.state=State.IDLE,this.tick())}},{key:"onFragLoaded",value:function(data){var fragCurrent=this.fragCurrent,fragLoaded=data.frag;if(this.state===State.FRAG_LOADING&&fragCurrent&&"audio"===fragLoaded.type&&fragLoaded.level===fragCurrent.level&&fragLoaded.sn===fragCurrent.sn){var track=this.tracks[this.trackId],details=track.details,duration=details.totalduration,trackId=fragCurrent.level,sn=fragCurrent.sn,cc=fragCurrent.cc,audioCodec=this.config.defaultAudioCodec||track.audioCodec||"mp4a.40.2",stats=this.stats=data.stats;if(this._flushOnStoppedBuffering={},this._waitForFlush)_logger.logger.log("audio aborting parse due to flush"),this._checkIfBufferReady();else if("initSegment"===sn)this.state=State.IDLE,stats.tparsed=stats.tbuffered=performance.now(),details.initSegment.data=this.hls.streamController.insertPssh(data.payload,details.initSegment),this.cmaf=this.hls.streamController.isCMAF(details.initSegment.data),this.hls.trigger(_events2.default.FRAG_BUFFERED,{stats:stats,frag:fragCurrent,id:"audio"}),this.tick();else{this.state=State.PARSING,this.appended=!1,_logger.logger.log("onFragLoaded: Loaded audio "+fragCurrent.sn+" of ["+details.startSN+" ,"+details.endSN+"],level "+fragCurrent.level);var initPTS=this.initPTS[cc],initSegmentData=details.initSegment?details.initSegment.data:[];if(initSegmentData||void 0!==initPTS)if(this.pendingBuffering=!0,this.cmaf){if(details.initSegment.data){var tracks={},initData={tracks:tracks};if(initData.frag=fragLoaded,initData.id="audio",tracks.audio={container:"audio/mp4",codec:"mp4a.40.2",initSegment:details.initSegment.data,metadata:{channelCount:2},levelkeys:details.initSegment.levelkeys},!this.timestampOffset){var timeScale=this.hls.streamController.getTimeScale(details.initSegment.data);this.timestampOffset=this.hls.streamController.getTimestampOffset(data.payload,timeScale)}this.onFragParsingInitSegment(initData)}var payload={data1:new Int8Array(data.payload),data2:null,startPTS:fragCurrent.startDTS/9e4,endPTS:fragCurrent.nextDTS/9e4,startDTS:fragCurrent.startDTS/9e4,endDTS:fragCurrent.nextDTS/9e4,type:"audio",nb:fragCurrent.frames,dropped:0,duplicate:!1,dts:fragCurrent.startDTS,frag:fragCurrent,id:"audio"};this.onFragParsingData(payload),this.onFragParsed(payload)}else{this.demuxer||(this.demuxer=new _demuxer2.default(this.hls,"audio")),_logger.logger.log("Audio Demuxing "+sn+" of ["+details.startSN+" ,"+details.endSN+"],track "+trackId);var accurateTimeOffset=!1;this.demuxer.push(data.payload,initSegmentData,audioCodec,null,fragCurrent,duration,accurateTimeOffset,initPTS)}else _logger.logger.log("unknown video PTS for continuity counter "+cc+", waiting for video PTS before demuxing audio frag "+sn+" of ["+details.startSN+" ,"+details.endSN+"],track "+trackId),this.waitingFragment=data,this.state=State.WAITING_INIT_PTS}}this.fragLoadError=0}},{key:"onFragParsingInitSegment",value:function(data){var fragCurrent=this.fragCurrent,fragNew=data.frag;if(fragCurrent&&"audio"===data.id&&fragNew.sn===fragCurrent.sn&&fragNew.level===fragCurrent.level&&this.state===State.PARSING){var tracks=data.tracks;tracks.video&&delete tracks.video;var track=tracks.audio;if(track){track.levelCodec="mp4a.40.2",track.id=data.id,this.hls.trigger(_events2.default.BUFFER_CODECS,tracks),_logger.logger.log("audio track:audio,container:"+track.container+",codecs[level/parsed]=["+track.levelCodec+"/"+track.codec+"]");var initSegment=track.initSegment;if(initSegment){var appendObj={type:"audio",data:initSegment,parent:"audio",content:"initSegment",sn:fragCurrent.sn};this.audioSwitch?this.pendingData=[appendObj]:(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(_events2.default.BUFFER_APPENDING,appendObj))}this.tick()}}}},{key:"onFragParsingData",value:function(data){var _this3=this,fragCurrent=this.fragCurrent,fragNew=data.frag;if(this._waitForFlush)_logger.logger.log("audio aborting append due to flush"),this._checkIfBufferReady();else if(fragCurrent&&"audio"===data.id&&"audio"===data.type&&fragNew.sn===fragCurrent.sn&&fragNew.level===fragCurrent.level&&this.state===State.PARSING){var hls=this.hls;isNaN(data.endPTS)&&(data.endPTS=data.startPTS+fragCurrent.duration,data.endDTS=data.startDTS+fragCurrent.duration),this._flushOnStoppedBuffering={start:data.startPTS,end:data.endPTS},_logger.logger.log("onFragParsingData Audio parsed "+data.type+",PTS:["+data.startPTS.toFixed(3)+","+data.endPTS.toFixed(3)+"],DTS:["+data.startDTS.toFixed(3)+"/"+data.endDTS.toFixed(3)+"],nb:"+data.nb);var audioSwitch=this.audioSwitch,media=this.media,appendOnBufferFlush=!1;if(audioSwitch&&media){var trackId=this.trackId;if(media.readyState){var currentTime=media.currentTime;_logger.logger.log("switching audio track : currentTime:"+currentTime),currentTime>=data.startPTS&&(_logger.logger.log("switching audio track : flushing all audio"),this.state=State.BUFFER_FLUSHING,hls.trigger(_events2.default.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),appendOnBufferFlush=!0,this.audioSwitch=!1,hls.trigger(_events2.default.AUDIO_TRACK_SWITCHED,{id:trackId}))}else this.audioSwitch=!1,hls.trigger(_events2.default.AUDIO_TRACK_SWITCHED,{id:trackId})}var pendingData=this.pendingData;this.audioSwitch||([data.data1,data.data2].forEach(function(buffer){buffer&&buffer.length&&pendingData.push({type:data.type,data:buffer,parent:"audio",content:"data",sn:data.frag.sn,level:data.frag.level,start:data.startPTS,end:data.endPTS,dts:data.dts,targetDuration:data.frag.duration})}),!appendOnBufferFlush&&pendingData.length&&(pendingData.forEach(function(appendObj){_this3.state===State.PARSING&&(_this3.pendingBuffering=!0,hls.trigger(_events2.default.BUFFER_APPENDING,appendObj))}),this.pendingData=[],this.appended=!0)),this.tick()}}},{key:"onFragParsed",value:function(data){var fragCurrent=this.fragCurrent,fragNew=data.frag;fragCurrent&&"audio"===data.id&&fragNew.sn===fragCurrent.sn&&fragNew.level===fragCurrent.level&&this.state===State.PARSING&&(this.stats.tparsed=performance.now(),this.state=State.PARSED,this._checkAppendedParsed())}},{key:"onFragBuffered",value:function(data){"audio"===data.id?this._fragBufferCount++:this.videoFragBuffered||"main"!==data.id||(this.videoFragBuffered=!0)}},{key:"onBufferCreated",value:function(data){var audioTrack=data.tracks.audio;audioTrack&&(this.mediaBuffer=audioTrack.buffer,this.timestampOffset&&(this.mediaBuffer.timestampOffset=this.timestampOffset),this.loadedmetadata=!0)}},{key:"onBufferAppended",value:function(data){if("audio"===data.parent){var state=this.state;state!==State.PARSING&&state!==State.PARSED||(this.pendingBuffering=data.pending>0,this._checkAppendedParsed())}}},{key:"_checkAppendedParsed",value:function(){if(this.state===State.PARSED&&(!this.appended||!this.pendingBuffering)){var frag=this.fragCurrent;if(frag){this._fragPrevious=frag;var stats=this.stats;stats.tbuffered=performance.now();var hls=this.hls;hls.trigger(_events2.default.FRAG_BUFFERED,{stats:stats,frag:frag,id:"audio"});var media=this.mediaBuffer?this.mediaBuffer:this.media;try{_logger.logger.log("audio buffered : "+_timeRanges2.default.toString(media.buffered))}catch(err){_logger.logger.error("error while trying to access media buffer:"+err.message)}if(void 0!==this._bufferBeforeSeekingTime)if(_bufferHelper2.default.isBuffered(media,this._bufferBeforeSeekingTime))_logger.logger.log("bufferBeforeSeeking: Audio Ready."),this._bufferBeforeSeekingTime=void 0,this._bufferBeforeSeekingApplied=void 0;else if(this._bufferBeforeSeekingApplied===!0){var targetTime=this._bufferBeforeSeekingTime+1;_logger.logger.log("bufferBeforeSeeking: Buffered audio but desired time not found. Pushing forward target time to "+targetTime+"."),hls.bufferBeforeSeeking=targetTime}this.audioSwitch&&this.appended&&(this.audioSwitch=!1,hls.trigger(_events2.default.AUDIO_TRACK_SWITCHED,{id:this.trackId})),this.state=State.IDLE}this.tick()}}},{key:"onError",value:function(data){var frag=data.frag;if(!frag||"audio"===frag.type)switch(data.details){case _errors.ErrorDetails.FRAG_LOAD_ERROR:case _errors.ErrorDetails.FRAG_LOAD_TIMEOUT:if(!data.fatal){var loadError=this.fragLoadError;loadError?loadError++:loadError=1;var config=this.config;if(loadError<2){this.fragLoadError=loadError,frag.loadCounter=0;var delay=Math.min(Math.pow(2,loadError-1)*config.fragLoadingRetryDelay,config.fragLoadingMaxRetryTimeout);_logger.logger.warn("audioStreamController: frag loading failed, retry in "+delay+" ms"),this.retryDate=performance.now()+delay,this.state=State.FRAG_LOADING_WAITING_RETRY}else 0!==this._fragBufferCount?data.frag&&(_logger.logger.warn("audio stream controller,"+data.details+": marking dead frag"),this.tracks[this.trackId]&&(this.tracks[this.trackId].deadFragList.push(data.frag.sn),this.tracks[this.trackId].details=void 0,this.hls.audioTrackController.updateTrack(this.trackId)),this.retryDate=performance.now(),this.state=State.WAITING_TRACK):(_logger.logger.error("audioStreamController: "+data.details+" reaches max retry, redispatch as fatal ..."),data.fatal=!0,this.state=State.ERROR)}break;case _errors.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case _errors.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:0===this._fragBufferCount?(data.fatal=!0,this.state=State.ERROR):this.state!==State.ERROR&&(this.state=State.IDLE),_logger.logger.warn("audioStreamController: "+data.details+" while loading audio track,switch to "+this.state+" state ...");break;case _errors.ErrorDetails.FRAG_LOOP_LOADING_ERROR:case _errors.ErrorDetails.KEY_LOAD_ERROR:case _errors.ErrorDetails.KEY_LOAD_TIMEOUT:this.state!==State.ERROR&&(this.state=data.fatal?State.ERROR:State.IDLE,_logger.logger.warn("audioStreamController: "+data.details+" while loading frag,switch to "+this.state+" state ..."));break;case _errors.ErrorDetails.BUFFER_FULL_ERROR:if("audio"===data.parent&&(this.state===State.PARSING||this.state===State.PARSED)){var media=this.mediaBuffer,desiredPlayPoint=this._bufferBeforeSeekingTime;void 0===desiredPlayPoint&&this.media&&(desiredPlayPoint=this.media.currentTime);var currentTime=desiredPlayPoint,mediaBuffered=media&&_bufferHelper2.default.isBuffered(media,currentTime)&&_bufferHelper2.default.isBuffered(media,currentTime+.5);if(mediaBuffered){var _config=this.config;_config.maxMaxBufferLength>=_config.maxBufferLength&&(_config.maxMaxBufferLength/=2,_logger.logger.warn("audio:reduce max buffer length to "+_config.maxMaxBufferLength+"s"),this.fragLoadIdx+=2*_config.fragLoadingLoopThreshold);var flushRange=this._flushOnStoppedBuffering;this._skipAppendAfterFlush=!0,this._fragPrevious=null,this.fragCurrent=null,this.hls.trigger(_events2.default.BUFFER_FLUSHING,{startOffset:flushRange.start,endOffset:flushRange.end,type:"audio"}),this.state=State.IDLE}else _logger.logger.warn("buffer full error also desired time is not buffered, flush audio buffer"),this.fragCurrent=null,this.state=State.BUFFER_FLUSHING,this.hls.trigger(_events2.default.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"});this._bufferBeforeSeekingApplied===!0&&(this._bufferBeforeSeekingApplied=!1,_logger.logger.log("Audio: onBufferFull Rescheduling bufferBeforeSeeking"))}}}},{key:"onBufferFlushed",value:function(){var _this4=this,pendingData=this.pendingData;this.state===State.BUFFER_FLUSHING&&this.hls.bufferController.readyForData===!0&&this._waitForFlush?(this._waitForFlush=!1,this.state=State.IDLE):pendingData&&pendingData.length&&!this._skipAppendAfterFlush?(_logger.logger.log("appending pending audio data on Buffer Flushed"),pendingData.forEach(function(appendObj){_this4.hls.trigger(_events2.default.BUFFER_APPENDING,appendObj)}),this.appended=!0,this.pendingData=[],this.state=State.PARSED):(this._skipAppendAfterFlush=!1,this.state=State.IDLE,this._fragPrevious=null,this.tick())}},{key:"onBufferWait",value:function(){var frag=this._fragCurrent;_logger.logger.log("Audio: BufferWait"),frag&&(frag.loader&&frag.loader.abort(),this._fragCurrent=null,this._bufferBeforeSeekingApplied===!0&&(this._bufferBeforeSeekingApplied=!1,_logger.logger.log("Audio: onBufferWait Rescheduling bufferBeforeSeeking"))),this.state!==State.FRAG_LOADING&&this.state!==State.KEY_LOADING&&this.state!==State.FRAG_LOADING_WAITING_RETRY||(this.state=State.BUFFER_FLUSHING),this._waitForFlush=!0}},{key:"_checkIfBufferReady",value:function(){this.hls.bufferController.readyForData===!0?(this._waitForFlush=!1,this.state=State.IDLE):this.state=State.BUFFER_FLUSHING}},{key:"pausedTimer",get:function(){return this._pausedTimer}},{key:"state",set:function(nextState){if(this.state!==nextState){var previousState=this.state;this._state=nextState,_logger.logger.log("audio stream state: "+previousState+"->"+nextState+" _pausedTimer: "+this._pausedTimer)}},get:function(){return this._state}},{key:"bufferBeforeSeeking",set:function(time){_logger.logger.log("audio bufferBeforeSeeking set to "+time),this._bufferBeforeSeekingTime=time,this._bufferBeforeSeekingApplied=!1,this._videoSeekReady=!1,this._fragCurrent&&this._fragCurrent.loader&&this._fragCurrent.loader.abort(),this._fragCurrent=null,this._fragPrevious=null,this.state=State.IDLE,this.unpauseController()},get:function(){return this._bufferBeforeSeekingTime}}]),AudioStreamController}(_eventHandler2.default);exports.default=AudioStreamController,module.exports=exports["default"]},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_events=__webpack_require__(3),_events2=_interopRequireDefault(_events),_eventHandler=__webpack_require__(5),_eventHandler2=_interopRequireDefault(_eventHandler),_logger=__webpack_require__(1);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!==typeof call&&"function"!==typeof call?self:call}function _inherits(subClass,superClass){if("function"!==typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var AudioTrackController=function(_EventHandler){_inherits(AudioTrackController,_EventHandler);function AudioTrackController(hls){_classCallCheck(this,AudioTrackController);var _this=_possibleConstructorReturn(this,(AudioTrackController.__proto__||Object.getPrototypeOf(AudioTrackController)).call(this,hls,_events2.default.MANIFEST_LOADING,_events2.default.MANIFEST_LOADED,_events2.default.AUDIO_TRACK_LOADED,_events2.default.LEVEL_SWITCHING,_events2.default.STREAM_ALL_LEVELS_LOADED));return _this.ticks=0,_this.ontick=_this.tick.bind(_this),_this._allLevelsLoaded=!1,_this._pendingInterval=void 0,_this}return _createClass(AudioTrackController,[{key:"destroy",value:function(){_eventHandler2.default.prototype.destroy.call(this),this.ontick=null}},{key:"stopLoad",value:function(){this.timer&&(clearInterval(this.timer),this.timer=null)}},{key:"tick",value:function(){this.ticks++,1===this.ticks&&(this.doTick(),this.ticks>1&&setTimeout(this.tick,1),this.ticks=0)}},{key:"doTick",value:function(){this.updateTrack(this.trackId)}},{key:"onManifestLoading",value:function(){this.tracks=[],this.trackId=-1}},{key:"onManifestLoaded",value:function(data){var _this2=this,tracks=data.audioTracks||[],defaultFound=!1;this.tracks=tracks;var id=0;tracks.forEach(function(track){return track.default?(_this2.audioTrack=id,defaultFound=!0,void 0):(id++,void 0)}),defaultFound===!1&&tracks.length&&(_logger.logger.log("no default audio track defined, use first audio track as default"),this.audioTrack=0),this.hls.trigger(_events2.default.AUDIO_TRACKS_UPDATED,{audioTracks:tracks})}},{key:"onAudioTrackLoaded",value:function(data){data.id<this.tracks.length&&(_logger.logger.log("audioTrack "+data.id+" loaded"),this.tracks[data.id].details=data.details,data.details.live&&!this.timer&&(this._allLevelsLoaded?this.timer=setInterval(this.ontick,1e3*data.details.targetduration):(_logger.logger.log("delaying arming timer until STREAM_ALL_LEVELS_LOADED"),this._pendingInterval=1e3*data.details.targetduration)),!data.details.live&&this.timer&&(clearInterval(this.timer),this.timer=null))}},{key:"onStreamAllLevelsLoaded",value:function(){this._allLevelsLoaded=!0,this._pendingInterval&&(this.timer=setInterval(this.ontick,this._pendingInterval))}},{key:"onLevelSwitching",value:function(){this.trackId>=0&&this.updateTrack(this.trackId)}},{key:"setAudioTrackInternal",value:function(newId){if(newId>=0&&newId<this.tracks.length){this.timer&&(clearInterval(this.timer),this.timer=null),this.trackId=newId,_logger.logger.log("switching to audioTrack "+newId);var audioTrack=this.tracks[newId],hls=this.hls,type=audioTrack.type,url=audioTrack.renditions[this.getRenditionNumber(newId)].url,eventObj={id:newId,type:type,url:url};hls.trigger(_events2.default.AUDIO_TRACK_SWITCH,eventObj),hls.trigger(_events2.default.AUDIO_TRACK_SWITCHING,eventObj);var details=audioTrack.details;!url||void 0!==details&&details.live!==!0||(_logger.logger.log("(re)loading playlist for audioTrack "+newId),hls.trigger(_events2.default.AUDIO_TRACK_LOADING,{url:url,id:newId}))}}},{key:"updateTrack",value:function(newId){if(newId>=0&&newId<this.tracks.length){this.timer&&(clearInterval(this.timer),this.timer=null),this.trackId=newId,_logger.logger.log("updating audioTrack "+newId);var audioTrack=this.tracks[newId],url=audioTrack.renditions[this.getRenditionNumber(newId)].url,details=audioTrack.details;!url||void 0!==details&&details.live!==!0||(_logger.logger.log("(re)loading playlist for audioTrack "+newId),this.hls.trigger(_events2.default.AUDIO_TRACK_LOADING,{url:url,id:newId}))}}},{key:"getRenditionNumber",value:function(trackId){var audioTrack=this.tracks[trackId],hls=this.hls,rendition=0;if(hls.nextLoadLevel>=0){var levelAudioGroup=hls.levels[hls.nextLoadLevel].audioGroup;if(levelAudioGroup)for(var i=0;i<audioTrack.renditions.length;i++)audioTrack.renditions[i].groupId===levelAudioGroup&&(rendition=i)}return rendition}},{key:"audioTracks",get:function(){return this.tracks}},{key:"audioTrack",get:function(){return this.trackId},set:function(audioTrackId){this.trackId===audioTrackId&&void 0!==this.tracks[audioTrackId].details||this.setAudioTrackInternal(audioTrackId)}}]),AudioTrackController}(_eventHandler2.default);exports.default=AudioTrackController,module.exports=exports["default"]},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_events=__webpack_require__(3),_events2=_interopRequireDefault(_events),_eventHandler=__webpack_require__(5),_eventHandler2=_interopRequireDefault(_eventHandler),_logger=__webpack_require__(1),_errors=__webpack_require__(4);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!==typeof call&&"function"!==typeof call?self:call}function _inherits(subClass,superClass){if("function"!==typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var BufferController=function(_EventHandler){_inherits(BufferController,_EventHandler);function BufferController(hls){_classCallCheck(this,BufferController);var _this=_possibleConstructorReturn(this,(BufferController.__proto__||Object.getPrototypeOf(BufferController)).call(this,hls,_events2.default.MEDIA_ATTACHING,_events2.default.MEDIA_DETACHING,_events2.default.MANIFEST_PARSED,_events2.default.BUFFER_RESET,_events2.default.BUFFER_APPENDING,_events2.default.BUFFER_CODECS,_events2.default.BUFFER_EOS,_events2.default.BUFFER_FLUSHING,_events2.default.BUFFER_SOURCE_SEEKING,_events2.default.AUDIO_TRACK_UPDATED,_events2.default.LEVEL_PTS_UPDATED,_events2.default.LEVEL_UPDATED));return _this._msDuration=null,_this._levelDuration=null,_this._playlistDuration=null,_this._audioTrackDuration=null,_this._audioPlaylistDuration=null,_this._needsDetach=!1,_this._firstAudioReceived=!1,_this._firstVideoReceived=!1,_this._firstAudioDts=-1,_this._firstVideoDts=-1,_this._firstAudioStart=-1,_this._firstVideoStart=-1,_this._syncChecked=!1,_this._sbEndedFound=!1,_this._readyForData=!1,_this.onsbue=_this.onSBUpdateEnd.bind(_this),_this.onsbe=_this.onSBUpdateError.bind(_this),_this.onsba=_this.onSBAbort.bind(_this),_this.pendingTracks={},_this.tracks={},_this}return _createClass(BufferController,[{key:"destroy",value:function(){_eventHandler2.default.prototype.destroy.call(this),this._levelDuration=null,this._playlistDuration=null,this._audioTrackDuration=null,this._audioPlaylistDuration=null,this._msDuration=null,this.flushRange=null,this.onsbe=null,this.onsbue=null,this.onsba=null,this.parent=null,this.pendingTracks=null,this.tracks=null}},{key:"onLevelPtsUpdated",value:function(data){var type=data.type,audioTrack=this.tracks.audio;if("audio"===type&&audioTrack&&"audio/mpeg"===audioTrack.container){var audioBuffer=this.sourceBuffer.audio,delta=Math.abs(audioBuffer.timestampOffset-data.start);if(delta>.1){var updating=audioBuffer.updating;try{_logger.logger.warn("audioBuffer.abort()"),audioBuffer.abort()}catch(err){updating=!0,_logger.logger.warn("can not abort audio buffer: "+err)}updating?this.audioTimestampOffset=data.start:(_logger.logger.warn("change mpeg audio timestamp offset from "+audioBuffer.timestampOffset+" to "+data.start),audioBuffer.timestampOffset=data.start)}}}},{key:"onManifestParsed",value:function(data){var audioExpected=data.audio,videoExpected=data.video,sourceBufferNb=0;data.altAudio&&(audioExpected||videoExpected)&&(sourceBufferNb=(audioExpected?1:0)+(videoExpected?1:0),_logger.logger.log(sourceBufferNb+" sourceBuffer(s) expected")),this.sourceBufferNb=sourceBufferNb}},{key:"onMediaAttaching",value:function(data){var media=this.media=data.media;if(media){var ms=this.mediaSource=new MediaSource;this.onmso=this.onMediaSourceOpen.bind(this),this.onmse=this.onMediaSourceEnded.bind(this),this.onmsc=this.onMediaSourceClose.bind(this),ms.addEventListener("sourceopen",this.onmso),ms.addEventListener("sourceended",this.onmse),ms.addEventListener("sourceclose",this.onmsc),media.src=URL.createObjectURL(ms),this.readyForData=!0}}},{key:"onMediaDetaching",value:function(){_logger.logger.log("media source detaching");var ms=this.mediaSource;if(ms){var notReady=this.checkEos();notReady?(this._needsDetach=!0,this._needsEos=!0):this.doDetach()}else this.hls.trigger(_events2.default.MEDIA_DETACHED)}},{key:"onMediaSourceOpen",value:function(){_logger.logger.log("media source opened"),this.hls.trigger(_events2.default.MEDIA_ATTACHED,{media:this.media});var mediaSource=this.mediaSource;mediaSource&&mediaSource.removeEventListener("sourceopen",this.onmso),this.checkPendingTracks()}},{key:"checkPendingTracks",value:function(){var pendingTracks=this.pendingTracks,pendingTracksNb=Object.keys(pendingTracks).length;pendingTracksNb&&(this.sourceBufferNb<=pendingTracksNb||0===this.sourceBufferNb)&&(this.createSourceBuffers(pendingTracks),this.pendingTracks={},this.doAppending())}},{key:"onMediaSourceClose",value:function(){_logger.logger.log("media source closed")}},{key:"onMediaSourceEnded",value:function(){_logger.logger.log("media source ended")}},{key:"onSBUpdateEnd",value:function(){if(this.audioTimestampOffset){var audioBuffer=this.sourceBuffer.audio;_logger.logger.warn("change mpeg audio timestamp offset from "+audioBuffer.timestampOffset+" to "+this.audioTimestampOffset),audioBuffer.timestampOffset=this.audioTimestampOffset,delete this.audioTimestampOffset}this._needsFlush&&this.doFlush(),this._needsEos&&this.checkEos(),this._needsDetach&&this.doDetach(),this.appending=!1;var parent=this.parent,pending=this.segments.reduce(function(counter,segment){return segment.parent===parent?counter+1:counter},0);this.hls.trigger(_events2.default.BUFFER_APPENDED,{parent:parent,pending:pending}),this._needsFlush||this.doAppending(),this.updateMediaElementDuration()}},{key:"onSBUpdateError",value:function(event){_logger.logger.error("sourceBuffer error:",event),this.hls.trigger(_events2.default.ERROR,{type:_errors.ErrorTypes.MEDIA_ERROR,details:_errors.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1})}},{key:"onSBAbort",value:function(){_logger.logger.log("sourceBuffer abort")}},{key:"onBufferReset",value:function(){this.doRemoveSourceBuffer(),this.flushRange=[],this.segments=[],this.appended=0,this._msDuration=null,this._levelDuration=null,this._playlistDuration=null,this._audioTrackDuration=null,this._audioPlaylistDuration=null,this._sbEndedFound=!1,this._resetSyncCheck(!0)}},{key:"onBufferSourceSeeking",value:function(){}},{key:"_resetSyncCheck",value:function(force){(this._firstAudioReceived&&this._firstVideoReceived||force===!0)&&(this._syncChecked=!1,this._firstAudioReceived=!1,this._firstVideoReceived=!1,this._firstAudioDts=-1,this._firstVideoDts=-1,this._firstAudioStart=-1,this._firstVideoStart=-1)}},{key:"onBufferCodecs",value:function(tracks){if(0===Object.keys(this.sourceBuffer).length){for(var trackName in tracks)this.pendingTracks[trackName]=tracks[trackName];var mediaSource=this.mediaSource;mediaSource&&"open"===mediaSource.readyState&&this.checkPendingTracks()}}},{key:"createSourceBuffers",value:function(tracks){var sourceBuffer=this.sourceBuffer,mediaSource=this.mediaSource;for(var trackName in tracks)if(!sourceBuffer[trackName]){for(var track=tracks[trackName],codec=track.levelCodec||track.codec,mimeType=track.container+";codecs="+codec,i=0;i<this.hls.levels.length;i++)track.container.indexOf("video")>-1&&void 0===this.hls.levels[i].videoCodec?this.hls.levels[i].videoCodec=codec:track.container.indexOf("audio")>-1&&void 0===this.hls.levels[i].audioCodec&&(this.hls.levels[i].audioCodec=codec);_logger.logger.log("creating sourceBuffer("+mimeType+")");try{var sb=sourceBuffer[trackName]=mediaSource.addSourceBuffer(mimeType);sb.addEventListener("updateend",this.onsbue),sb.addEventListener("error",this.onsbe),sb.addEventListener("abort",this.onsba),this.tracks[trackName]={codec:codec,container:track.container},sb.frags=[],track.buffer=sb}catch(err){_logger.logger.error("error while trying to add sourceBuffer:"+err.message),this.hls.trigger(_events2.default.ERROR,{type:_errors.ErrorTypes.MEDIA_ERROR,details:_errors.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,err:err,mimeType:mimeType})}}this.hls.trigger(_events2.default.BUFFER_CREATED,{tracks:tracks})}},{key:"onBufferAppending",value:function(data){if(!this._syncChecked&&("audio"!==data.type||void 0===data.dts||this._firstAudioReceived?"video"!==data.type||void 0===data.dts||this._firstVideoReceived||(this._firstVideoDts=data.dts,this._firstVideoStart=data.start,this._firstVideoReceived=!0):(this._firstAudioDts=data.dts,this._firstAudioStart=data.start,this._firstAudioReceived=!0),this._firstAudioReceived&&this._firstVideoReceived)){var ptsDiff=9e4*(this._firstAudioStart-this._firstVideoStart),dtsDiff=Math.abs(this._firstVideoDts+ptsDiff-this._firstAudioDts),maxDiff=67500*data.targetDuration;dtsDiff>maxDiff&&(_logger.logger.warn("onBufferAppending STREAM_SYNC_FAILED"),this.hls.trigger(_events2.default.ERROR,{type:_errors.ErrorTypes.MUX_ERROR,details:_errors.ErrorDetails.STREAM_SYNC_FAILED,fatal:!1})),this._syncChecked=!0}this.segments?this.segments.push(data):this.segments=[data],this._needsFlush?(_logger.logger.log("onBufferAppending: flush needed. Flushing...."),this.doFlush()):this.doAppending()}},{key:"onBufferAppendFail",value:function(data){_logger.logger.error("sourceBuffer error:",data.event),this.hls.trigger(_events2.default.ERROR,{type:_errors.ErrorTypes.MEDIA_ERROR,details:_errors.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1})}},{key:"onBufferEos",value:function(data){var sb=this.sourceBuffer,dataType=data.type;for(var type in sb)dataType&&type!==dataType||sb[type].ended||(sb[type].ended=!0,_logger.logger.log(type+" sourceBuffer now EOS"));this.checkEos()}},{key:"checkEos",value:function(){var sb=this.sourceBuffer,mediaSource=this.mediaSource,sbNotEndedFound=!1;if(!mediaSource||"open"!==mediaSource.readyState)return this._needsEos=!1,void 0;for(var type in sb)if("audio"===type||"video"===type){var sbobj=sb[type];if(sbobj.updating)return this._needsEos=!0,void 0;sbobj.ended?this._sbEndedFound=!0:this._sbEndedFound&&this._needsEos?(sbobj.ended=!0,_logger.logger.log(type+" sourceBuffer now set to Ended")):sbNotEndedFound=!0}if(this._sbEndedFound){if(this._sbEndedFound&&sbNotEndedFound)return this._needsEos=!0,void 0;_logger.logger.log("all media data available, signal endOfStream() to MediaSource and stop loading fragment");try{mediaSource.endOfStream()}catch(e){_logger.logger.warn("exception while calling mediaSource.endOfStream()")}this._needsEos=!1}}},{key:"onBufferFlushing",value:function(data){this.readyForData=!1,this.flushRange.push({start:data.startOffset,end:data.endOffset,type:data.type}),this.flushBufferCounter=0,this.doFlush()}},{key:"onLevelUpdated",value:function(event){var details=event.details;0!==details.fragments.length&&(_logger.logger.log("onLevelUpdated details.totalduration:"+details.totalduration+" details.fragments[0].start:"+details.fragments[0].start+" event.sliding:"+event.sliding),event.sliding?this._playlistDuration=details.totalduration-details.targetduration:this._playlistDuration=details.totalduration,this._levelDuration=details.totalduration+details.fragments[0].start,this.updateMediaElementDuration(),this.updateLevelDuration())}},{key:"onAudioTrackUpdated",value:function(event){var details=event.details;0!==details.fragments.length&&(event.sliding?this._audioPlaylistDuration=details.totalduration-details.targetduration:this._audioPlaylistDuration=details.totalduration,this._audioTrackDuration=details.totalduration+details.fragments[0].start,this.updateMediaElementDuration(),this.updateLevelDuration())}},{key:"updateLevelDuration",value:function(){if(this.hls.streamCoordinator._audioControllersActive&&this._audioTrackDuration&&this._audioPlaylistDuration){
var start=void 0,end=void 0,duration=void 0;this._levelDuration&&this._playlistDuration?(end=Math.min(this._levelDuration,this._audioTrackDuration),start=Math.max(this._levelDuration-this._playlistDuration,this._audioTrackDuration-this._audioPlaylistDuration)):(end=this._audioTrackDuration,start=this._audioTrackDuration-this._audioPlaylistDuration),duration=end-start,this.hls.trigger(_events2.default.LEVEL_DURATION_UPDATED,{playlistDuration:duration,totalDuration:end})}else this.hls.trigger(_events2.default.LEVEL_DURATION_UPDATED,{playlistDuration:this._playlistDuration,totalDuration:this._levelDuration})}},{key:"updateMediaElementDuration",value:function(){var media=this.media,mediaSource=this.mediaSource,sourceBuffer=this.sourceBuffer,levelDuration=this._levelDuration;if(null!==levelDuration&&media&&mediaSource&&sourceBuffer&&0!==media.readyState&&"open"===mediaSource.readyState){for(var type in sourceBuffer)if(sourceBuffer[type].updating)return;null===this._msDuration&&(this._msDuration=mediaSource.duration);var duration=media.duration;(levelDuration>this._msDuration&&levelDuration>duration||duration===1/0||isNaN(duration))&&(_logger.logger.log("Updating mediasource duration to "+levelDuration.toFixed(3)),this._msDuration=mediaSource.duration=levelDuration)}}},{key:"doFlush",value:function(){if(this.flushRange){while(this.flushRange.length){var range=this.flushRange[0];if(!this.flushBuffer(range.start,range.end,range.type))return this._needsFlush=!0,_logger.logger.warn("doFlush: needs flush set"),void 0;this.flushRange.shift(),this.flushBufferCounter=0}if(0===this.flushRange.length){this._needsFlush=!1;var appended=0,sourceBuffer=this.sourceBuffer;try{for(var type in sourceBuffer)appended+=sourceBuffer[type].buffered.length}catch(error){_logger.logger.warn("doFlush: error while accessing sourceBuffer.buffered")}this.appended=appended,this.readyForData=!0,this.hls.trigger(_events2.default.BUFFER_FLUSHED),_logger.logger.log("doFlush: Flush completed")}}}},{key:"doAppending",value:function(){var hls=this.hls,sourceBuffer=this.sourceBuffer,segments=this.segments;if(Object.keys(sourceBuffer).length){if(this.media.error)return this.segments=[],_logger.logger.error("trying to append although a media error occurred, flush segment and abort"),void 0;if(this.appending)return;if(segments&&segments.length){var segment=segments.shift();try{var type=segment.type,sb=sourceBuffer[type];sb?sb.updating?segments.unshift(segment):(sb.ended=!1,void 0!==segment.sn&&(sourceBuffer[type].frags[segment.sn]={level:segment.level,maxLevel:hls.autoLevelCapping,start:segment.start,end:segment.end}),this.parent=segment.parent,sb.appendBuffer(segment.data),this.appendError=0,this.appended++,this.appending=!0):this.onSBUpdateEnd()}catch(err){_logger.logger.warn("error while trying to append buffer:"+err.message),segments.unshift(segment);var event={type:_errors.ErrorTypes.MEDIA_ERROR,parent:segment.parent};if(22===err.code)return this.segments=[],event.details=_errors.ErrorDetails.BUFFER_FULL_ERROR,event.fatal=!1,hls.trigger(_events2.default.ERROR,event),void 0;if(this.appendError?this.appendError++:this.appendError=1,event.details=_errors.ErrorDetails.BUFFER_APPEND_ERROR,this.appendError>hls.config.appendErrorMaxRetry)return _logger.logger.log("fail "+hls.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),segments=[],event.fatal=!0,hls.trigger(_events2.default.ERROR,event),void 0;event.fatal=!1,hls.trigger(_events2.default.ERROR,event)}}}}},{key:"flushBuffer",value:function(startOffset,endOffset,typeIn){var sourceBuffer=this.sourceBuffer,allFlushed=!1;if(Object.keys(sourceBuffer).length)if(_logger.logger.log("flushBuffer: pos/start/end/type: "+this.media.currentTime.toFixed(3)+"/"+startOffset+"/"+endOffset+"/"+typeIn),this.flushBufferCounter<this.appended){var sb=void 0;for(var type in sourceBuffer)if(!typeIn||type===typeIn){sb=sourceBuffer[type],sb.ended=!1;try{sb.abort()}catch(e){_logger.logger.warn("error while accessing sourcebuffer, it might have been removed from MediaSource")}if(sb.updating)_logger.logger.warn("flushBuffer: cannot flush, "+type+" sb updating in progress");else{var i=void 0,bufStart=void 0,bufEnd=void 0,flushStart=void 0,flushEnd=void 0;try{sb.abort()}catch(e){_logger.logger.warn("flushBuffer: error while accessing sourcebuffer for abort, it might have been removed from MediaSource")}try{if(0===sb.buffered.length)_logger.logger.log("flushBuffer: nothing to flush!");else for(i=0;i<sb.buffered.length;i++)bufStart=sb.buffered.start(i),bufEnd=sb.buffered.end(i),this.hls.browFirefox===!0&&endOffset===Number.POSITIVE_INFINITY?(flushStart=startOffset,flushEnd=endOffset):(flushStart=Math.max(bufStart,startOffset),flushEnd=Math.min(bufEnd,endOffset)),Math.min(flushEnd,bufEnd)-flushStart>.5&&(this.flushBufferCounter++,_logger.logger.log("flushBuffer: flushed "+type+" ["+flushStart+","+flushEnd+"], of ["+bufStart+","+bufEnd+"], pos:"+this.media.currentTime),sb.remove(flushStart,flushEnd)),_logger.logger.log("flushBuffer: buffer range flushed");allFlushed=!0}catch(e){_logger.logger.warn("flushBuffer: error while accessing sourcebuffer, it might have been removed from MediaSource")}}}}else allFlushed=!0,_logger.logger.warn("flushBuffer: abort flushing too many retries");else allFlushed=!0,_logger.logger.warn("flushBuffer: Nothing to flush");return allFlushed}},{key:"flushLevels",value:function(startOffset,endOffset,currentFrag){var _this2=this;_logger.logger.log("flushLevels");var currentLevel=this.hls.nextLoadLevel;this.readyForData=!1,this.hls.trigger(_events2.default.BUFFER_WAIT);var _loop=function(type){"audio"!==type&&"video"!==type||_this2.sourceBuffer[type].frags.forEach(function(frag,sn,frags){Number(sn)!==currentFrag&&Number(sn)!==currentFrag+1&&Number(sn)!==currentFrag-1&&void 0!==frag&&frag.end>startOffset&&frag.start<endOffset&&(frag.level<currentLevel-1?(_this2.flushRange.push({start:frag.start,end:frag.end,type:type}),frags[sn]=void 0):frag.level===currentLevel-1&&frag.level===frag.maxLevel&&(_this2.flushRange.push({start:frag.start,end:frag.end,type:type}),frags[sn]=void 0))})};for(var type in this.sourceBuffer)_loop(type);this.flushRange.length>0?this.doFlush():(this.readyForData=!0,this.hls.trigger(_events2.default.BUFFER_FLUSHED))}},{key:"doDetach",value:function(){this.mediaSource.removeEventListener("sourceopen",this.onmso),this.mediaSource.removeEventListener("sourceended",this.onmse),this.mediaSource.removeEventListener("sourceclose",this.onmsc),this.doRemoveSourceBuffer(),this.media&&(URL.revokeObjectURL(this.media.src),this.media.removeAttribute("src"),this.media.load()),this.mediaSource=null,this.media=null,this.pendingTracks={},this.tracks={},this.flushRange=[],this.segments=[],this.appended=0,this.onmso=this.onmse=this.onmsc=null,this.hls.trigger(_events2.default.MEDIA_DETACHED),this._needsDetach=!1}},{key:"doRemoveSourceBuffer",value:function(){var sourceBuffer=this.sourceBuffer;for(var type in sourceBuffer)if("audio"===type||"video"===type){var sb=sourceBuffer[type];try{sb.removeEventListener("updateend",this.onsbue),sb.removeEventListener("error",this.onsbe),sb.removeEventListener("abort",this.onsba),"open"===this.mediaSource.readyState||"ended"===this.mediaSource.readyState?this.mediaSource.removeSourceBuffer(sb):_logger.logger.warn("doRemoveSourceBuffer: MediaSource is in an invalid state, probably closed. Would error or crash if we attempted to remove source buffer.")}catch(err){_logger.logger.error("doRemoveSourceBuffer: "+err.message+" while removing SourceBuffer")}}sourceBuffer={},this.sourceBuffer={}}},{key:"readyForData",set:function(value){this.flushRange&&(!this.flushRange||this.flushRange.length>0)?this._readyForData=!1:this._readyForData=value},get:function(){return this._readyForData}}]),BufferController}(_eventHandler2.default);exports.default=BufferController,module.exports=exports["default"]},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_events=__webpack_require__(3),_events2=_interopRequireDefault(_events),_eventHandler=__webpack_require__(5),_eventHandler2=_interopRequireDefault(_eventHandler);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!==typeof call&&"function"!==typeof call?self:call}function _inherits(subClass,superClass){if("function"!==typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var CapLevelController=function(_EventHandler){_inherits(CapLevelController,_EventHandler);function CapLevelController(hls){return _classCallCheck(this,CapLevelController),_possibleConstructorReturn(this,(CapLevelController.__proto__||Object.getPrototypeOf(CapLevelController)).call(this,hls,_events2.default.FPS_DROP_LEVEL_CAPPING,_events2.default.MEDIA_ATTACHING,_events2.default.MANIFEST_PARSED))}return _createClass(CapLevelController,[{key:"destroy",value:function(){this.hls.config.capLevelToPlayerSize&&(this.media=this.restrictedLevels=null,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(this.timer=clearInterval(this.timer))),_eventHandler2.default.prototype.destroy.call(this),this.hls=null}},{key:"onFpsDropLevelCapping",value:function(data){this.restrictedLevels||(this.restrictedLevels=[]),this.isLevelRestricted(data.droppedLevel)||this.restrictedLevels.push(data.droppedLevel)}},{key:"onMediaAttaching",value:function(data){this.media=data.media instanceof HTMLVideoElement?data.media:null}},{key:"onManifestParsed",value:function(data){var hls=this.hls;hls.config.capLevelToPlayerSize&&(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.levels=data.levels,hls.firstLevel=this.getMaxLevel(data.firstLevel),clearInterval(this.timer),this.timer=setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}},{key:"detectPlayerSize",value:function(){if(this.media){var levelsLength=this.levels?this.levels.length:0;if(levelsLength){var hls=this.hls;hls.autoLevelCapping=this.getMaxLevel(levelsLength-1),hls.autoLevelCapping>this.autoLevelCapping&&hls.streamController.nextLevelSwitch(),this.autoLevelCapping=hls.autoLevelCapping}}}},{key:"getMaxLevel",value:function(capLevelIndex){for(var result=0,mediaWidth=this.mediaWidth,mediaHeight=this.mediaHeight,i=0;i<=capLevelIndex;i++){var level=this.levels[i];if(this.isLevelRestricted(i))break;if(result=i,mediaWidth<=level.width||mediaHeight<=level.height)break}return result}},{key:"isLevelRestricted",value:function(level){return!(!this.restrictedLevels||this.restrictedLevels.indexOf(level)===-1)}},{key:"contentScaleFactor",get:function(){var pixelRatio=1;try{pixelRatio=window.devicePixelRatio}catch(e){}return pixelRatio}},{key:"mediaWidth",get:function(){var width=void 0,media=this.media;return media&&(width=media.width||media.clientWidth||media.offsetWidth,width*=this.contentScaleFactor),width}},{key:"mediaHeight",get:function(){var height=void 0,media=this.media;return media&&(height=media.height||media.clientHeight||media.offsetHeight,height*=this.contentScaleFactor),height}}]),CapLevelController}(_eventHandler2.default);exports.default=CapLevelController,module.exports=exports["default"]},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_events=__webpack_require__(3),_events2=_interopRequireDefault(_events),_eventHandler=__webpack_require__(5),_eventHandler2=_interopRequireDefault(_eventHandler),_logger=__webpack_require__(1);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!==typeof call&&"function"!==typeof call?self:call}function _inherits(subClass,superClass){if("function"!==typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var FPSController=function(_EventHandler){_inherits(FPSController,_EventHandler);function FPSController(hls){return _classCallCheck(this,FPSController),_possibleConstructorReturn(this,(FPSController.__proto__||Object.getPrototypeOf(FPSController)).call(this,hls,_events2.default.MEDIA_ATTACHING))}return _createClass(FPSController,[{key:"destroy",value:function(){this.timer&&clearInterval(this.timer),_eventHandler2.default.prototype.destroy.call(this),this.isVideoPlaybackQualityAvailable=!1,this.hls=null}},{key:"onMediaAttaching",value:function(data){var config=this.hls.config;if(config.capLevelOnFPSDrop){var video=this.video=data.media instanceof HTMLVideoElement?data.media:null;"function"===typeof video.getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),clearInterval(this.timer),this.timer=setInterval(this.checkFPSInterval.bind(this),config.fpsDroppedMonitoringPeriod)}}},{key:"checkFPS",value:function(video,decodedFrames,droppedFrames){var currentTime=performance.now();if(decodedFrames){if(this.lastTime){var currentPeriod=currentTime-this.lastTime,currentDropped=droppedFrames-this.lastDroppedFrames,currentDecoded=decodedFrames-this.lastDecodedFrames,droppedFPS=1e3*currentDropped/currentPeriod,hls=this.hls;if(hls.trigger(_events2.default.FPS_DROP,{currentDropped:currentDropped,currentDecoded:currentDecoded,totalDroppedFrames:droppedFrames}),droppedFPS>0&&currentDropped>hls.config.fpsDroppedMonitoringThreshold*currentDecoded){var currentLevel=hls.currentLevel;_logger.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+currentLevel),currentLevel>0&&(hls.autoLevelCapping===-1||hls.autoLevelCapping>=currentLevel)&&(currentLevel-=1,hls.trigger(_events2.default.FPS_DROP_LEVEL_CAPPING,{level:currentLevel,droppedLevel:hls.currentLevel}),hls.autoLevelCapping=currentLevel,hls.streamController.nextLevelSwitch())}}this.lastTime=currentTime,this.lastDroppedFrames=droppedFrames,this.lastDecodedFrames=decodedFrames}}},{key:"checkFPSInterval",value:function(){var video=this.video;if(video)if(this.isVideoPlaybackQualityAvailable){var videoPlaybackQuality=video.getVideoPlaybackQuality();this.checkFPS(video,videoPlaybackQuality.totalVideoFrames,videoPlaybackQuality.droppedVideoFrames)}else this.checkFPS(video,video.webkitDecodedFrameCount,video.webkitDroppedFrameCount)}}]),FPSController}(_eventHandler2.default);exports.default=FPSController,module.exports=exports["default"]},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_events=__webpack_require__(3),_events2=_interopRequireDefault(_events),_eventHandler=__webpack_require__(5),_eventHandler2=_interopRequireDefault(_eventHandler),_logger=__webpack_require__(1),_errors=__webpack_require__(4),_bufferHelper=__webpack_require__(25),_bufferHelper2=_interopRequireDefault(_bufferHelper);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!==typeof call&&"function"!==typeof call?self:call}function _inherits(subClass,superClass){if("function"!==typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var LevelController=function(_EventHandler){_inherits(LevelController,_EventHandler);function LevelController(hls){_classCallCheck(this,LevelController);var _this=_possibleConstructorReturn(this,(LevelController.__proto__||Object.getPrototypeOf(LevelController)).call(this,hls,_events2.default.MANIFEST_LOADED,_events2.default.LEVEL_LOADED,_events2.default.FRAG_LOADED,_events2.default.STREAM_ALL_LEVELS_LOADED,_events2.default.ERROR));return _this.ontick=_this.tick.bind(_this),_this._manualLevel=-1,_this._allLevelsLoaded=!1,_this._pendingTimer=void 0,_this._levelsFailed=0,_this._baseLevelFailed=void 0,_this}return _createClass(LevelController,[{key:"destroy",value:function(){this.stopLoad(),this.timer&&(clearTimeout(this.timer),this.timer=null),_eventHandler2.default.prototype.destroy.call(this),this._manualLevel=-1,this._levels=null,this.ontick=null}},{key:"startLoad",value:function(){this.canload=!0;var levels=this._levels;levels&&levels.forEach(function(level){level.loadError=0;var levelDetails=level.details;levelDetails&&levelDetails.live&&levels.length>1&&(level.details=void 0)}),this.timer&&this.tick()}},{key:"stopLoad",value:function(){this.timer&&(clearInterval(this.timer),this.timer=null),this.canload=!1}},{key:"onStreamAllLevelsLoaded",value:function(){this._allLevelsLoaded=!0,this._pendingTimer&&(this.timer=setTimeout(this.ontick,this._pendingTimer))}},{key:"onManifestLoaded",value:function(data){var hls=this.hls,brokenMp3InMp4=hls.browChrome||hls.browFirefox;this._level=void 0;var bitrateSet={},levels0=[],videoCodecFound=!1,audioCodecFound=!1;data.levels.forEach(function(level){level.videoCodec&&(videoCodecFound=!0),brokenMp3InMp4&&level.audioCodec&&level.audioCodec.indexOf("mp4a.40.34")!==-1&&(level.audioCodec=void 0),(level.audioCodec||level.attrs&&level.attrs.AUDIO)&&(audioCodecFound=!0);var redundantLevelId=bitrateSet[level.bitrate];void 0===redundantLevelId?(bitrateSet[level.bitrate]=levels0.length,level.url=[level.url],level.urlId=0,levels0.push(level)):levels0[redundantLevelId].url.push(level.url)});var levels=[];if(videoCodecFound&&audioCodecFound?levels0.forEach(function(level){level.videoCodec&&levels.push(level)}):levels=levels0,levels=levels.filter(function(level){var audioCodec=level.audioCodec,videoCodec=level.videoCodec,checkSupported=function(type,codec){return MediaSource.isTypeSupported(type+"/mp4;codecs="+codec)};return(!audioCodec||checkSupported("audio",audioCodec))&&(!videoCodec||checkSupported("video",videoCodec))}),levels.length){var bitrateStart=levels[0].bitrate;levels.sort(function(a,b){return a.bitrate-b.bitrate}),this._levels=levels;for(var i=0;i<levels.length;i++)if(levels[i].bitrate===bitrateStart){this._firstLevel=i,_logger.logger.log("manifest loaded,"+levels.length+" level(s) found, first bitrate:"+bitrateStart);break}hls.trigger(_events2.default.MANIFEST_PARSED,{levels:levels,firstLevel:this._firstLevel,stats:data.stats,audio:audioCodecFound,video:videoCodecFound,altAudio:data.audioTracks.length>0})}else hls.trigger(_events2.default.ERROR,{type:_errors.ErrorTypes.MEDIA_ERROR,details:_errors.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:hls.url,reason:"no level with compatible codecs found in manifest"})}},{key:"setLevelInternal",value:function(newLevel){var levels=this._levels,hls=this.hls;if(newLevel>=0&&newLevel<levels.length){if(this.timer&&(clearTimeout(this.timer),this.timer=null),this._level!==newLevel){_logger.logger.log("switching to level "+newLevel),this._level=newLevel;var levelProperties=levels[newLevel];levelProperties.level=newLevel,hls.trigger(_events2.default.LEVEL_SWITCHING,levelProperties)}var level=levels[newLevel],levelDetails=level.details;if(!levelDetails||levelDetails.live===!0&&levels.length>1){var urlId=level.urlId;hls.trigger(_events2.default.LEVEL_LOADING,{url:level.url[urlId],level:newLevel,id:urlId})}}else hls.trigger(_events2.default.ERROR,{type:_errors.ErrorTypes.OTHER_ERROR,details:_errors.ErrorDetails.LEVEL_SWITCH_ERROR,level:newLevel,fatal:!1,reason:"invalid level idx"})}},{key:"onError",value:function(data){if(!data.fatal){var details=data.details,levelId=void 0,levelError=!1;switch(details){case _errors.ErrorDetails.FRAG_LOAD_ERROR:case _errors.ErrorDetails.FRAG_LOAD_TIMEOUT:case _errors.ErrorDetails.FRAG_LOOP_LOADING_ERROR:case _errors.ErrorDetails.KEY_LOAD_ERROR:case _errors.ErrorDetails.KEY_LOAD_TIMEOUT:"audio"!==data.frag.type&&(levelId=data.frag.level);break;case _errors.ErrorDetails.LEVEL_LOAD_ERROR:case _errors.ErrorDetails.LEVEL_LOAD_TIMEOUT:levelId=data.context.level,levelError=!0;break;case _errors.ErrorDetails.REMUX_ALLOC_ERROR:levelId=data.level}if(void 0!==levelId){var level=this._levels[levelId];level.loadError?level.loadError++:level.loadError=1;var nbRedundantLevel=level.url.length;if(nbRedundantLevel>1&&level.loadError<nbRedundantLevel)level.urlId=(level.urlId+1)%nbRedundantLevel,level.details=void 0,_logger.logger.warn("level controller,"+details+" for level "+levelId+": switching to redundant stream id "+level.urlId);else{var hls=this.hls,media=hls.media,mediaBuffered=media&&_bufferHelper2.default.isBuffered(media,media.currentTime)&&_bufferHelper2.default.isBuffered(media,media.currentTime+.5);if(0===this._levelsFailed&&(this._baseLevelFailed=levelId),this._levelsFailed++,this.tryNextVariant(levelId,!0))_logger.logger.warn("level controller,"+details+": switch variant and retry fragment");else if(this._manualLevel===-1&&details===(_errors.ErrorDetails.FRAG_LOAD_ERROR||details===_errors.ErrorDetails.FRAG_LOAD_TIMEOUT)&&this._levelsFailed>1)data.frag&&(_logger.logger.warn("level controller,"+details+": marking dead frag"),hls.streamController.addToDeadFragList(data.frag.sn));else if(level&&level.details&&level.details.live)_logger.logger.warn("level controller,"+details+" on live stream, discard"),levelError&&(this._level=void 0);else if(details===_errors.ErrorDetails.LEVEL_LOAD_ERROR||details===_errors.ErrorDetails.LEVEL_LOAD_TIMEOUT)if(mediaBuffered){var retryDelay=hls.config.levelLoadingRetryDelay;_logger.logger.warn("level controller,"+details+", but media buffered, retry in "+retryDelay+"ms"),this.timer=setTimeout(this.ontick,retryDelay)}else _logger.logger.error("cannot recover "+details+" error"),this._level=void 0,this.timer&&(clearTimeout(this.timer),this.timer=null),data.fatal=!0;data.fatal||this.tick()}}}}},{key:"tryNextVariant",value:function(levelId,calledByErrorHandler){var hls=this.hls,media=hls.media,level=this._levels[levelId],bufferInfo={end:0};media&&(bufferInfo=_bufferHelper2.default.bufferInfo(media,media.currentTime,0)),void 0===this._baseLevelFailed&&(this._baseLevelFailed=levelId);var nbAllowedLevels=hls.maxAutoLevel-hls.minAutoLevel+1;if(media&&level.details&&(!calledByErrorHandler||level.details.live||bufferInfo.end-media.currentTime>=2*level.details.averagetargetduration)&&this._manualLevel===-1&&this._levelsFailed<Math.min(nbAllowedLevels,hls.config.levelLoadingMaxRetry)){var targetLevel=levelId;return levelId<=this._baseLevelFailed?(targetLevel=levelId-1,targetLevel<hls.minAutoLevel&&(targetLevel=Math.min(hls.maxAutoLevel,this._baseLevelFailed+1))):(targetLevel=levelId+1,targetLevel>hls.maxAutoLevel&&(targetLevel=Math.max(hls.minAutoLevel,this._baseLevelFailed))),hls.nextAutoLevel=targetLevel,this.setLevelInternal(hls.nextAutoLevel),calledByErrorHandler||this.tick(),!0}return!1}},{key:"onFragLoaded",value:function(data){var fragLoaded=data.frag;if(fragLoaded&&"main"===fragLoaded.type){var level=this._levels[fragLoaded.level];level&&(level.loadError=0),this._levelsFailed=0,this._baseLevelFailed=void 0}}},{key:"onLevelLoaded",value:function(data){var levelId=data.level;if(levelId===this._level){var curLevel=this._levels[levelId],newDetails=data.details;if(newDetails.live){var reloadInterval=1e3*(newDetails.averagetargetduration?newDetails.averagetargetduration:newDetails.targetduration),curDetails=curLevel.details;curDetails&&newDetails.endSN===curDetails.endSN&&(reloadInterval/=2,_logger.logger.log("same live playlist, reload twice faster")),reloadInterval-=performance.now()-data.stats.trequest,reloadInterval=Math.max(1e3,Math.round(reloadInterval)),_logger.logger.log("live playlist, reload in "+reloadInterval+" ms"),this._allLevelsLoaded?this.timer=setTimeout(this.ontick,reloadInterval):(_logger.logger.log("delaying arming timer until STREAM_ALL_LEVELS_LOADED"),this._pendingTimer=reloadInterval)}else this.timer=null}}},{key:"tick",value:function(){var levelId=this._level;if(this._levels&&void 0!==levelId&&this.canload){var level=this._levels[levelId],urlId=level.urlId;this.hls.trigger(_events2.default.LEVEL_LOADING,{url:level.url[urlId],level:levelId,id:urlId})}}},{key:"chunkIDAtTime",value:function(time){var levels=this.levels,level=this.level;if(levels&&level){var details=levels[level].details;if(details)for(var fragments=details.fragments,fragCount=fragments.length,i=0;i<fragCount;i++){var fragment=fragments[i];if(time>fragment.start&&time<fragment.start+fragment.duration)return i}}for(var levelsCount=levels.length,_i=0;_i<levelsCount;_i++){var _details=levels[_i].details;if(_details)for(var _fragments=_details.fragments,_fragCount=_fragments.length,j=0;j<_fragCount;j++){var _fragment=_fragments[j];if(time>_fragment.start&&time<_fragment.start+_fragment.duration)return j}}return-1}},{key:"endOfChunk",value:function(chunkID){var levels=this.levels,details=levels[this.level].details;try{if(details){var fragment=details.fragments[chunkID];return fragment.start+fragment.duration}for(var levelsCount=levels.length,i=0;i<levelsCount;i++)if(details=levels[i].details,details){var _fragment2=details.fragments[chunkID];return _fragment2.start+_fragment2.duration}return 0}catch(err){return 0}}},{key:"levels",get:function(){return this._levels}},{key:"level",get:function(){return this._level},set:function(newLevel){var levels=this._levels;levels&&levels.length>newLevel&&(this._level===newLevel&&void 0!==levels[newLevel].details||this.setLevelInternal(newLevel))}},{key:"manualLevel",get:function(){return this._manualLevel},set:function(newLevel){this._manualLevel=newLevel,void 0===this._startLevel&&(this._startLevel=newLevel),newLevel!==-1&&(this.level=newLevel)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(newLevel){this._firstLevel=newLevel}},{key:"startLevel",get:function(){if(void 0===this._startLevel){var configStartLevel=this.hls.config.startLevel;return void 0!==configStartLevel?configStartLevel:this._firstLevel}return this._startLevel},set:function(newLevel){this._startLevel=newLevel}},{key:"nextLoadLevel",get:function(){return this._manualLevel!==-1?this._manualLevel:this.hls.nextAutoLevel},set:function(nextLevel){this.level=nextLevel,this._manualLevel===-1&&(this.hls.nextAutoLevel=nextLevel)}}]),LevelController}(_eventHandler2.default);exports.default=LevelController,module.exports=exports["default"]},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_binarySearch=__webpack_require__(134),_binarySearch2=_interopRequireDefault(_binarySearch),_bufferHelper=__webpack_require__(25),_bufferHelper2=_interopRequireDefault(_bufferHelper),_demuxer=__webpack_require__(69),_demuxer2=_interopRequireDefault(_demuxer),_events=__webpack_require__(3),_events2=_interopRequireDefault(_events),_eventHandler=__webpack_require__(5),_eventHandler2=_interopRequireDefault(_eventHandler),_timeRanges=__webpack_require__(71),_timeRanges2=_interopRequireDefault(_timeRanges),_errors=__webpack_require__(4),_logger=__webpack_require__(1),_muxjs=__webpack_require__(44),_muxjs2=_interopRequireDefault(_muxjs);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!==typeof call&&"function"!==typeof call?self:call}function _inherits(subClass,superClass){if("function"!==typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}__webpack_require__(77);var State={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_LEVEL:"WAITING_LEVEL",PARSING:"PARSING",PARSED:"PARSED",BUFFER_FLUSHING:"BUFFER_FLUSHING",ENDED:"ENDED",ERROR:"ERROR"},StreamController=function(_EventHandler){_inherits(StreamController,_EventHandler);function StreamController(hls){_classCallCheck(this,StreamController);var _this=_possibleConstructorReturn(this,(StreamController.__proto__||Object.getPrototypeOf(StreamController)).call(this,hls,_events2.default.MEDIA_ATTACHED,_events2.default.MEDIA_DETACHING,_events2.default.MANIFEST_LOADING,_events2.default.MANIFEST_PARSED,_events2.default.LEVEL_LOADED,_events2.default.STREAM_ALL_LEVELS_LOADED,_events2.default.STREAM_DESYNC,_events2.default.KEY_LOADED,_events2.default.FRAG_LOADED,_events2.default.FRAG_LOAD_EMERGENCY_ABORTED,_events2.default.FRAG_PARSING_INIT_SEGMENT,_events2.default.FRAG_PARSING_DATA,_events2.default.FRAG_PARSED,_events2.default.ERROR,_events2.default.AUDIO_TRACK_SWITCHING,_events2.default.AUDIO_TRACK_SWITCHED,_events2.default.BUFFER_CREATED,_events2.default.BUFFER_APPENDED,_events2.default.BUFFER_FLUSHED,_events2.default.BUFFER_WAIT,_events2.default.AUDIO_TRACK_UPDATED));
return _this.config=hls.config,_this._state=State.STOPPED,_this._demuxer=void 0,_this._ticks=0,_this.ontick=_this.tick.bind(_this),_this._timer=void 0,_this._audioCodecSwap=!1,_this._altAudio=!1,_this._audioCodecSwitch=!1,_this._endStallOffseter=0,_this._streamTimeoutArmed=!1,_this._playbackStarted=!1,_this._fragBufferCount=0,_this._fragLoadError=0,_this._flushOnStoppedBuffering=[],_this._bufferNextDuplicate=!1,_this._slowDetachTicks=0,_this._lastCurrentTime=void 0,_this._levels=[],_this._level=0,_this._levelLastLoaded=void 0,_this._stats=void 0,_this._immediateSwitch=!1,_this._startFragRequested=!1,_this._loadedMetadata=!1,_this._nextLoadPosition=void 0,_this._startPosition=void 0,_this.forceStopFetching=!1,_this._fragCurrent=void 0,_this._fragPrevious=void 0,_this._fragLoadIdx=void 0,_this._fragLastKbps=void 0,_this._selectByPdt=!1,_this._clearFragPrevious=!1,_this._previouslyPaused=!1,_this._stalled=!1,_this._stallReported=!1,_this._nudgeRetry=0,_this._skipReloadDelay=!1,_this.liveSyncPosition=0,_this.initialPdt=void 0,_this._pendingBuffering=!1,_this._appended=!1,_this._gapCycleBase=void 0,_this._bufferBeforeSeekingTime=void 0,_this._bufferBeforeSeekingApplied=void 0,_this._waitForFlush=!1,_this._audioGapSeeking=!1,_this}return _createClass(StreamController,[{key:"destroy",value:function(){this.stopLoad(),this._timer&&(clearInterval(this._timer),this._timer=null),_eventHandler2.default.prototype.destroy.call(this),this.config=null,this._levels=null,this.ontick=null,this._stats=null,this.videoBuffer=null}},{key:"startLoad",value:function(){if(this._levels){var hls=this.hls;if(this.stopLoad(),this._level=-1,this._fragLoadError=0,!this._startFragRequested){var startLevel=hls.startLevel;startLevel===-1&&(startLevel=0,this._bitrateTest=!0),this._level=hls.nextLoadLevel=startLevel,this._loadedMetadata=!1,hls.trigger(_events2.default.LEVEL_SELECTION_FINISHED)}this.state=State.IDLE}}},{key:"onStreamAllLevelsLoaded",value:function(data){this._timer||(this._timer=setInterval(this.ontick,100)),this._playbackStarted=!1,this._streamTimeoutArmed=!0,this._nextLoadPosition=this._startPosition=this._lastCurrentTime=data.startTime,this.tick(),_logger.logger.log("onStreamAllLevelsLoaded MAIN this._startPosition: "+this._startPosition+" this._lastCurrentTime: "+this._lastCurrentTime)}},{key:"onStreamDesync",value:function(data){var i=void 0,fragments=this._levels[this._level].details.fragments,totalDropDuration=0,duration=fragments[0].manifestDuration;for(i=0;fragments.length>1&&fragments[0].pdt<data.pdtToAlignTo-data.variance;i++)fragments.splice(0,1),totalDropDuration+=duration,duration=fragments[0].manifestDuration;if(i>0){var j=void 0;for(_logger.logger.log("main PDT earlier than audio PDT, adjusting main timestamps"),j=0;j<fragments.length;j++)fragments[j].index=j,fragments[j].start-=totalDropDuration,fragments[j].pdt-=1e3*totalDropDuration,fragments[j].sn-=i;this._levels[this._level].details.endSN-=i}}},{key:"stopLoad",value:function(){var frag=this._fragCurrent;frag&&(_logger.logger.log("Video: resetting current frag load count as load was aborted"),frag.loadCounter=0,frag.loader&&frag.loader.abort(),this._fragCurrent=null),this._fragPrevious=null,this._demuxer&&(this._demuxer.destroy(),this._demuxer=null),this.state=State.STOPPED,this.timestampOffset=void 0}},{key:"tick",value:function(){this._ticks++,1===this._ticks&&(this.doTick(),this._ticks>1&&setTimeout(this.tick,1),this._ticks=0)}},{key:"doTick",value:function(){if(this.media){var media=this.media,mediaBuffered=0;if(mediaBuffered=media.buffered.length,(this._streamTimeoutArmed||0===mediaBuffered)&&!this.forceStopFetching&&(!media.paused&&!media.ended||!this._playbackStarted)&&(this.hls.streamCoordinator._mainTimedOut||this.hls.streamCoordinator._audioTimedOut))return _logger.logger.error("stream has timed out"),this.hls.trigger(_events2.default.ERROR,{type:_errors.ErrorTypes.NETWORK_ERROR,details:_errors.ErrorDetails.STREAM_TIMEOUT,fatal:!0}),void 0}switch(this.state){case State.ERROR:break;case State.BUFFER_FLUSHING:this._fragLoadError=0;break;case State.IDLE:if(!this._doTickIdle())return;break;case State.WAITING_LEVEL:var level=this._levels[this._level];level&&level.details&&(this.state=State.IDLE);break;case State.FRAG_LOADING_WAITING_RETRY:var now=performance.now(),retryDate=this.retryDate;(!retryDate||now>=retryDate||this.media&&this.media.seeking)&&(_logger.logger.log("mediaController: retryDate reached, switch back to IDLE state"),this.state=State.IDLE);break;case State.STOPPED:this.hls._inSlowDetach&&(this._slowDetachTicks++,this._slowDetachTicks>10&&(_logger.logger.log("slow detach idle"),this.hls._doCompleteSlowDetach()));break;case State.FRAG_LOADING:case State.PARSING:case State.PARSED:case State.ENDED:}this._checkBuffer()}},{key:"_doTickIdle",value:function(){var hls=this.hls,config=hls.config,media=this.media;if(void 0!==this._levelLastLoaded&&!media&&(this._startFragRequested||!config.startFragPrefetch))return!0;var pos=void 0;void 0!==this._bufferBeforeSeekingTime&&this._bufferBeforeSeekingApplied===!1?(_logger.logger.log("main: using bufferBeforeSeeking"),this._bufferBeforeSeekingApplied=!0,pos=this._bufferBeforeSeekingTime,this._fragPrevious=null):pos=this._loadedMetadata&&void 0===this._bufferBeforeSeekingTime?media.currentTime:this._nextLoadPosition;var level=hls.nextLoadLevel,levelInfo=this._levels[level],levelBitrate=levelInfo.bitrate,maxBufLen=void 0;maxBufLen=levelBitrate?Math.max(8*config.maxBufferSize/levelBitrate,config.maxBufferLength):config.maxBufferLength,maxBufLen=Math.min(maxBufLen,config.maxMaxBufferLength);var bufferInfo=_bufferHelper2.default.bufferInfo(this.mediaBuffer?this.mediaBuffer:media,pos,config.maxBufferHole),bufferLen=bufferInfo.len;if(bufferLen>=maxBufLen&&this._bufferBeforeSeekingApplied!==!0)return!0;_logger.logger.trace("buffer length of "+bufferLen.toFixed(3)+" is below max of "+maxBufLen.toFixed(3)+". checking for more payload ..."),this._level=hls.nextLoadLevel=level;var levelDetails=levelInfo.details;if("undefined"===typeof levelDetails||levelDetails.live&&this._levelLastLoaded!==level)return this.state=State.WAITING_LEVEL,!0;var fragPrevious=this._fragPrevious;if(!levelDetails.live&&fragPrevious&&fragPrevious.sn===levelDetails.endSN&&(this._lastCurrentTime===media.currentTime&&(this._endStallOffseter+=.2),media.duration-Math.max(bufferInfo.end,fragPrevious.start)<=Math.max(.2,fragPrevious.duration/2)+this._endStallOffseter||this._levels[this._level].deadFragList.length>0||this._levels[this._level].containsGaps)){var data={};return this._altAudio&&(data.type="video"),this.hls.trigger(_events2.default.BUFFER_EOS,data),this.state=State.ENDED,this._endStallOffseter=0,!0}return this._fetchPayloadOrEos(pos,bufferInfo,levelDetails)}},{key:"_fetchPayloadOrEos",value:function(pos,bufferInfo,levelDetails){var level=this._level,fragments=levelDetails.fragments,fragLen=fragments.length;if(0===fragLen)return!1;var start=fragments[0].start,end=fragments[fragLen-1].start+fragments[fragLen-1].duration,bufferEnd=bufferInfo.end,frag=void 0;if(levelDetails.initSegment&&!levelDetails.initSegment.data)frag=levelDetails.initSegment;else if(levelDetails.live){var initialLiveManifestSize=this.config.initialLiveManifestSize;if(fragLen<initialLiveManifestSize)return _logger.logger.warn("Can not start playback of a level, reason: not enough fragments "+fragLen+" < "+initialLiveManifestSize),!1;if(null===frag)return!1}else bufferEnd<start&&(frag=fragments[0]);if(this.forceStopFetching===!0)return!0;if(!frag){var findFragResults=this._findFragment(start,this._fragPrevious,fragLen,fragments,bufferEnd,end,levelDetails,pos,this.clearFragPrevious,this.media);frag=findFragResults.frag,this._clearFragPrevious=findFragResults.clearFragPrevious,this._fragPrevious=findFragResults.fragPrevious}if(frag){if(frag.gap&&this._gapCycleBase!==this._level&&this._fragPrevious&&frag.sn!==this._fragPrevious.sn+1&&(void 0===this._gapCycleBase&&(this._gapCycleBase=this._level),this.hls.levelController.tryNextVariant(this._level,!1)))return this.state=State.WAITING_LEVEL,!0;if(!this._fragPrevious||!this._fragPrevious.pdt||!frag.pdt||this._fragPrevious.pdt!==frag.pdt)return this.hls.trigger(_events2.default.FRAG_START_FOUND,{startPdt:frag.pdt}),this._loadFragmentOrKey(frag,level,levelDetails,pos,bufferEnd)}return!0}},{key:"_pdtAlign",value:function(fragments,trackDetails){var variance=500*fragments[0].manifestDuration,i=void 0,pdtToAlignTo=void 0,controller=void 0;for("main"===fragments[0].type?(pdtToAlignTo=this.hls.audioStreamController.initialPdt,controller=this):(pdtToAlignTo=this.initialPdt,controller=this.hls.audioStreamController),i=0;fragments.length>1&&fragments[0].pdt<pdtToAlignTo-variance;i++)controller.initialPdt+=1e3*fragments[0].manifestDuration,fragments.splice(0,1);if(i>0)for(fragments[0].start=0,fragments[0].index=0,fragments[0].pdt=controller.initialPdt,fragments[0].sn-=i,trackDetails.endSN-=i,i=1;i<fragments.length;i++)fragments[i].start=fragments[i-1].start+fragments[i-1].duration,fragments[i].pdt=fragments[i-1].pdt+1e3*fragments[i-1].manifestDuration,fragments[i].index=i,fragments[i].sn=fragments[i-1].sn+1}},{key:"_linearSearch",value:function(fragments,fragPrevious,millisTarget,snapToNearestFrag){for(var frag=void 0,i=0;i<fragments.length;i++){var millisCurrent=fragments[i].pdt,millisNext=millisCurrent+1e3*fragments[i].manifestDuration;if(!(millisNext<=millisTarget)){var millisMidpoint=(millisCurrent+millisNext)/2;if(!(millisMidpoint<millisTarget&&snapToNearestFrag===!0)&&(!fragPrevious||!fragPrevious.pdt||fragPrevious.pdt!==fragments[i].pdt)){frag=fragments[i];break}}}return frag}},{key:"_ensureFragmentAtLivePoint",value:function(levelDetails,bufferEnd,start,end,fragPrevious,fragments){var media=this.media,frag=void 0;if(levelDetails.PTSKnown&&bufferEnd>end&&media&&media.readyState)return null;if(this._startFragRequested&&!levelDetails.PTSKnown&&fragPrevious)if(this._selectByPdt&&void 0!==fragPrevious.pdt&&void 0!==fragments[0].pdt)frag=this._linearSearch(fragments,fragPrevious,fragPrevious.pdt+1e3*fragPrevious.manifestDuration,!0);else{var targetSN=fragPrevious.sn+1;targetSN>=levelDetails.startSN&&targetSN<=levelDetails.endSN&&(frag=fragments[targetSN-levelDetails.startSN],fragPrevious.pdt&&frag.pdt&&fragPrevious.pdt===frag.pdt&&(frag=frag.index<fragments.length-1?fragments[frag.index+1]:void 0),_logger.logger.log("live playlist, switching playlist, load frag with next SN: "+frag.sn))}return frag}},{key:"bufferEndToManifestTimeBrute",value:function(fragments,bufferEnd){var myBufferEnd=bufferEnd,count=0;for(count=0;count<fragments.length;count++){var variance=fragments[count].manifestDuration/5;if(myBufferEnd>fragments[count].start-variance&&myBufferEnd<fragments[count].start+variance){myBufferEnd=fragments[count].start;break}}return myBufferEnd}},{key:"bufferEndToManifestTimeViaPdt",value:function(fragments,bufferEnd,targetDuration){var index=Math.round(bufferEnd/targetDuration),myBufferEnd=bufferEnd;if(index>=0&&index<fragments.length){var variance=fragments[index].manifestDuration/5*1e3,basePdt=0;if(basePdt="main"===fragments[0].type?new Date(this.hls.streamCoordinator._mainBasePdt).getTime():new Date(this.hls.streamCoordinator._audioBasePdt).getTime(),myBufferEnd=basePdt+1e3*bufferEnd,myBufferEnd>fragments[index].pdt+variance){while(index<fragments.length&&myBufferEnd>fragments[index].pdt+variance)index++;index>=fragments.length&&(index=fragments.length-1)}else{while(index>=0&&myBufferEnd<fragments[index].pdt-variance)index--;index<0&&(index=0)}myBufferEnd=fragments[index].start}else index===fragments.length&&(myBufferEnd=fragments[fragments.length-1].start+fragments[fragments.length-1].manifestDuration);return myBufferEnd}},{key:"bufferEndToManifestTimeViaStart",value:function(fragments,bufferEnd,targetDuration){var index=Math.round(bufferEnd/targetDuration),myBufferEnd=bufferEnd,offset=-fragments[0].start;if(index>=0&&index<fragments.length){var variance=fragments[index].manifestDuration/5;if(myBufferEnd>fragments[index].start+offset+variance){while(index<fragments.length&&myBufferEnd>fragments[index].start+offset+variance)index++;index>=fragments.length&&(index=fragments.length-1)}else{while(index>=0&&myBufferEnd<fragments[index].start+offset-variance)index--;index<0&&(index=0)}myBufferEnd=fragments[index].start+offset}else index===fragments.length&&(myBufferEnd=fragments[fragments.length-1].start+fragments[fragments.length-1].manifestDuration);return myBufferEnd}},{key:"bufferEndToManifestTime",value:function(fragments,bufferEnd,targetDuration){var myBufferEnd=bufferEnd;return myBufferEnd=this.hls.streamCoordinator._mainBasePdt?this.bufferEndToManifestTimeViaPdt(fragments,bufferEnd,targetDuration):0===fragments[0].start?this.bufferEndToManifestTimeViaStart(fragments,bufferEnd,targetDuration):this.bufferEndToManifestTimeBrute(fragments,bufferEnd),myBufferEnd}},{key:"_findFragment",value:function(start,fragPreviousIn,fragLen,fragments,bufferEnd,end,levelDetails,pos,clearFragPreviousIn,media){var config=this.hls.config,frag=null,foundFrag=!1,maxFragLookUpTolerance=config.maxFragLookUpTolerance,bestCandidate=null,fragPrevious=fragPreviousIn,clearFragPrevious=clearFragPreviousIn;fragPrevious&&(!_bufferHelper2.default.isBuffered(media,pos)&&(fragPrevious.start>pos||fragPrevious.start+2*levelDetails.targetduration<pos)||clearFragPrevious)&&(_logger.logger.log("_findFragment: Clearing fragPrevious for "+fragPrevious.type),fragPrevious=null,clearFragPrevious=!1),!this.hls.media.seeking;var index=void 0;fragPrevious&&(index=fragments.findIndex(function(element){return element.sn===fragPrevious.sn}));var fragNext=fragPrevious?fragments[index+1]:void 0,fragmentWithinToleranceTest=function(candidate){var candidateLookupTolerance=Math.min(maxFragLookUpTolerance,candidate.manifestDuration);return candidate.start+candidate.manifestDuration-candidateLookupTolerance<=bufferEnd?(bestCandidate=candidate,1):candidate.start-candidateLookupTolerance>bufferEnd&&candidate.start?(bestCandidate=candidate,-1):0};if(bufferEnd<end){if(this._selectByPdt&&void 0!==this.initialPdt){var millisTolerance=0;foundFrag=this._linearSearch(fragments,fragPrevious,this.initialPdt+(1e3*bufferEnd-millisTolerance),!1)}else if(maxFragLookUpTolerance=.2,bufferEnd>end-maxFragLookUpTolerance&&(maxFragLookUpTolerance=0),fragNext&&!fragmentWithinToleranceTest(fragNext)?(foundFrag=fragNext,_logger.logger.log("_findFragment: Picked next frag")):(maxFragLookUpTolerance=0,foundFrag=_binarySearch2.default.search(fragments,fragmentWithinToleranceTest),null===foundFrag&&(foundFrag=bestCandidate)),maxFragLookUpTolerance=0,fragPrevious&&foundFrag&&fragPrevious.pdt&&foundFrag.pdt){var expectedTime=fragPrevious.pdt+1e3*fragPrevious.manifestDuration,variance=500*fragPrevious.manifestDuration;if(foundFrag.pdt<expectedTime-variance){while(foundFrag.index<fragments.length-1&&foundFrag.pdt<expectedTime-variance)foundFrag=fragments[foundFrag.index+1];levelDetails.live&&foundFrag.index===fragments.length-1&&foundFrag.pdt<expectedTime-variance&&"main"===foundFrag.type&&(levelDetails.endSN!==levelDetails.originalEndSN&&this._gapCycleBase!==this._level&&(void 0===this._gapCycleBase&&(this._gapCycleBase=this._level),this.hls.levelController.tryNextVariant(this._level,!1)&&(this.state=State.WAITING_LEVEL)),foundFrag=void 0)}else if(foundFrag.pdt-foundFrag.gap>expectedTime+variance){while(foundFrag.index>0&&foundFrag.pdt>expectedTime+variance)foundFrag=fragments[foundFrag.index-1];0===foundFrag.index&&foundFrag.pdt>expectedTime+variance}}}else if(foundFrag=fragments[fragLen-1],levelDetails.endSN!==levelDetails.originalEndSN&&this._gapCycleBase!==this._level&&"main"===foundFrag.type)void 0===this._gapCycleBase&&(this._gapCycleBase=this._level),this.hls.levelController.tryNextVariant(this._level,!1)&&(this.state=State.WAITING_LEVEL),foundFrag=void 0;else if(fragPrevious&&fragPrevious.pdt){var _expectedTime=fragPrevious.pdt+1e3*fragPrevious.manifestDuration,_variance=500*fragPrevious.manifestDuration;if(foundFrag.pdt>_expectedTime+_variance){while(foundFrag.index>0&&foundFrag.pdt>_expectedTime+_variance)foundFrag=fragments[foundFrag.index-1];0===foundFrag.index&&foundFrag.pdt>_expectedTime+_variance}}if(foundFrag){foundFrag.start<0&&(foundFrag=fragments[foundFrag.index+1]),frag=foundFrag;var curSNIdx=frag.sn-levelDetails.startSN;if(media&&media.buffered.length&&fragments[curSNIdx-2]&&0!==pos)for(var i=0;i<media.buffered.length;i++)fragPrevious&&pos<media.buffered.start(i)&&pos>media.buffered.start(i)-1&&!fragments[curSNIdx-2].loadCounter&&(_logger.logger.warn(fragPrevious.type+" buffer too far forward, backtracking to fill buffer hole"),frag=fragments[fragPrevious.sn-levelDetails.startSN-1])}var results={frag:frag,fragPrevious:fragPrevious,clearFragPrevious:clearFragPrevious};return results}},{key:"_loadFragmentOrKey",value:function(frag,level,levelDetails,pos,bufferEnd){var hls=this.hls,config=hls.config;if(!frag.decryptdata||null==frag.decryptdata.uri||null!=frag.decryptdata.key){try{this.hls.browIE||this.hls.browTizen2?_logger.logger.log("Main loading "+frag.sn+" of ["+levelDetails.startSN+" ,"+levelDetails.endSN+"],level "+level+", pos:"+pos+",bufferEnd:"+bufferEnd):Number.isFinite(pos)&&Number.isFinite(bufferEnd)?_logger.logger.log("Main loading "+frag.sn+" of ["+levelDetails.startSN+" ,"+levelDetails.endSN+"],level "+level+", pos:"+pos.toFixed(3)+",bufferEnd:"+bufferEnd.toFixed(3)):_logger.logger.log("Main loading "+frag.sn+" of ["+levelDetails.startSN+" ,"+levelDetails.endSN+"],level "+level+", pos:"+pos+",bufferEnd:"+bufferEnd)}catch(err){_logger.logger.warn("error occurred while logging start of frag load")}if(void 0!==frag.dateRange&&hls.trigger(_events2.default.FRAG_DATERANGE_UPDATE,{dateRange:frag.dateRange,startTime:frag.start}),void 0!==this._fragLoadIdx?this._fragLoadIdx++:this._fragLoadIdx=0,frag.loadCounter){frag.loadCounter++;var maxThreshold=config.fragLoadingLoopThreshold;if(frag.loadCounter>maxThreshold&&Math.abs(this._fragLoadIdx-frag.loadIdx)<maxThreshold)return hls.trigger(_events2.default.ERROR,{type:_errors.ErrorTypes.MEDIA_ERROR,details:_errors.ErrorDetails.FRAG_LOOP_LOADING_ERROR,fatal:!1,frag:frag}),!1}else frag.loadCounter=1;return frag.loadIdx=this._fragLoadIdx,this._fragCurrent=frag,this._startFragRequested=!0,isNaN(frag.sn)||(this._nextLoadPosition=frag.start+frag.duration),frag.autoLevel=hls.autoLevelEnabled,frag.bitrateTest=this._bitrateTest,hls.trigger(_events2.default.FRAG_LOADING,{frag:frag}),this._demuxer||(this._demuxer=new _demuxer2.default(hls,"main")),this.state=State.FRAG_LOADING,!0}return _logger.logger.log("Main loading key for "+frag.sn+" of ["+levelDetails.startSN+" ,"+levelDetails.endSN+"],level "+level),this.state=State.KEY_LOADING,hls.trigger(_events2.default.KEY_LOADING,{frag:frag}),!0}},{key:"getBufferedFrag",value:function(position){return _binarySearch2.default.search(this._bufferedFrags,function(frag){return position<frag.startPTS?-1:position>frag.endPTS?1:0})}},{key:"followingBufferedFrag",value:function(frag){return frag?this.getBufferedFrag(frag.endPTS+.5):null}},{key:"immediateLevelSwitch",value:function(){if(_logger.logger.log("immediateLevelSwitch"),!this._immediateSwitch){this._immediateSwitch=!0;var media=this.media,previouslyPaused=void 0;media?(previouslyPaused=media.paused,media.pause()):previouslyPaused=!0,this._previouslyPaused=previouslyPaused}var fragCurrent=this._fragCurrent;fragCurrent&&fragCurrent.loader&&fragCurrent.loader.abort(),this._fragCurrent=null,this._fragLoadIdx+=2*this.config.fragLoadingLoopThreshold,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}},{key:"immediateLevelSwitchEnd",value:function(){var media=this.media;media&&media.buffered.length&&(this._immediateSwitch=!1,_bufferHelper2.default.isBuffered(media,media.currentTime)&&(media.currentTime-=1e-4),this._previouslyPaused||media.play())}},{key:"nextLevelSwitch",value:function(){var media=this.media;if(media&&media.readyState){var fetchdelay=void 0,fragPlayingCurrent=void 0,nextBufferedFrag=void 0;if(this._fragLoadIdx+=2*this.config.fragLoadingLoopThreshold,fragPlayingCurrent=this.getBufferedFrag(media.currentTime),fragPlayingCurrent&&fragPlayingCurrent.startPTS>1&&this.flushMainBuffer(0,fragPlayingCurrent.startPTS-1),media.paused)fetchdelay=0;else{var nextLevelId=this.hls.nextLoadLevel,nextLevel=this._levels[nextLevelId],fragLastKbps=this._fragLastKbps;fetchdelay=fragLastKbps&&this._fragCurrent?this._fragCurrent.duration*nextLevel.bitrate/(1e3*fragLastKbps)+1:0}if(nextBufferedFrag=this.getBufferedFrag(media.currentTime+fetchdelay),nextBufferedFrag&&(nextBufferedFrag=this.followingBufferedFrag(nextBufferedFrag),nextBufferedFrag)){var fragCurrent=this._fragCurrent;fragCurrent&&fragCurrent.loader&&fragCurrent.loader.abort(),this._fragCurrent=null,this.flushMainBuffer(nextBufferedFrag.startPTS,Number.POSITIVE_INFINITY)}}}},{key:"flushMainBuffer",value:function(startOffset,endOffset){this.state=State.BUFFER_FLUSHING;var flushScope={startOffset:startOffset,endOffset:endOffset};this._altAudio&&(flushScope.type="video"),this.hls.trigger(_events2.default.BUFFER_FLUSHING,flushScope)}},{key:"onMediaAttached",value:function(data){var media=this.media=this.mediaBuffer=data.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),this.onvended=this.onMediaEnded.bind(this),media.addEventListener("seeking",this.onvseeking),media.addEventListener("seeked",this.onvseeked),media.addEventListener("ended",this.onvended);var config=this.config;this._levels&&config.autoStartLoad&&this.hls.startLoad(config.startPosition)}},{key:"onMediaDetaching",value:function(){var media=this.media;media&&media.ended&&(_logger.logger.log("MSE detaching and video ended, reset startPosition"),this._startPosition=this._lastCurrentTime=0);var levels=this._levels;levels&&levels.forEach(function(level){level.details&&level.details.fragments.forEach(function(fragment){fragment.loadCounter=void 0,fragment.backtracked=void 0})}),media&&(media.removeEventListener("seeking",this.onvseeking),media.removeEventListener("seeked",this.onvseeked),media.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=null,this._loadedMetadata=!1,this.initialPdt=void 0,this.stopLoad()}},{key:"onMediaSeeking",value:function(){var media=this.media,currentTime=media?media.currentTime:void 0,config=this.config;if(_logger.logger.log("media seeking to: "+currentTime.toFixed(3)),this.checkForAudioGap(!1),this.state===State.FRAG_LOADING){var mediaBuffer=this.mediaBuffer?this.mediaBuffer:media,bufferInfo=_bufferHelper2.default.bufferInfo(mediaBuffer,currentTime,this.config.maxBufferHole),fragCurrent=this._fragCurrent;if(0===bufferInfo.len&&fragCurrent){var tolerance=config.maxFragLookUpTolerance,fragStartOffset=fragCurrent.start-tolerance,fragEndOffset=fragCurrent.start+fragCurrent.duration+tolerance;currentTime<fragStartOffset||currentTime>fragEndOffset?(fragCurrent.loader&&(_logger.logger.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),fragCurrent.loader.abort()),this._fragCurrent=null,this._fragPrevious=null,this.state=State.IDLE):_logger.logger.log("seeking outside of buffer but within currently loaded fragment range")}}else this.state===State.ENDED&&(this._fragPrevious=null,this.state=State.IDLE);media&&(this._lastCurrentTime=currentTime),this.state!==State.FRAG_LOADING&&void 0!==this._fragLoadIdx&&(this._fragLoadIdx+=2*config.fragLoadingLoopThreshold),this._loadedMetadata||(this._nextLoadPosition=this._startPosition=currentTime),this.hls.trigger(_events2.default.BUFFER_SOURCE_SEEKING),this.tick()}},{key:"onAudioTrackUpdated",value:function(){this.checkForAudioGap(!1)}},{key:"checkForAudioGap",value:function(increaseRange){if(!this._audioGapSeeking&&this._altAudio){var asController=this.hls.audioStreamController,track=asController.tracks[asController.trackId];if(this.media&&track&&track.gapList.length>0)for(var offset=increaseRange?track.details.averagetargetduration:0,i=0;i<track.gapList.length;i++){var currTime=this.media.currentTime;if(!this._audioGapSeeking&&currTime<track.gapList[i].end&&currTime>track.gapList[i].start-offset){var nudgeTime=track.gapList[i].end+.001;_logger.logger.warn("adjusting currentTime from "+currTime+" to "+(track.gapList[i].end+.001)+" due to audio gap"),this.hls._preBufferSeeks===!1?this.media.currentTime=nudgeTime:this.hls.bufferBeforeSeeking=nudgeTime,this._audioGapSeeking=!0}}}}},{key:"onMediaSeeked",value:function(){_logger.logger.log("media seeked to "+this.media.currentTime.toFixed(3)),this.hls.browTizen3&&(this._clearFragPrevious=!0),this.hls._inSlowDetach?(_logger.logger.log("slow detach seek finished"),this.hls.streamCoordinator.checkReadyForDispose(!0,void 0)&&this.hls._doCompleteSlowDetach()):this.tick(),this._audioGapSeeking=!1}},{key:"onMediaEnded",value:function(){_logger.logger.log("media ended"),this._startPosition=this._lastCurrentTime=0}},{key:"onManifestLoading",value:function(){_logger.logger.log("trigger BUFFER_RESET"),this.hls.trigger(_events2.default.BUFFER_RESET),this._bufferedFrags=[],this._stalled=!1,this._startPosition=this._lastCurrentTime=0,this._altAudio=!1,this._fragBufferCount=0,this.cmaf=!1}},{key:"onManifestParsed",value:function(data){var aac=!1,heaac=!1,codec=void 0;data.levels.forEach(function(level){codec=level.audioCodec,codec&&(codec.indexOf("mp4a.40.2")!==-1&&(aac=!0),codec.indexOf("mp4a.40.5")!==-1&&(heaac=!0)),level.deadFragList=[],level.containsGaps=!1}),this._audioCodecSwitch=aac&&heaac,this._audioCodecSwitch&&_logger.logger.log("both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this._levels=data.levels,this._startFragRequested=!1;var config=this.config;config.autoStartLoad&&this.hls.startLoad(config.startPosition)}},{key:"adjustStartBySlidingOffset",value:function(curDetails,newDetails){var delta=newDetails.startSN-curDetails.startSN,curFrags=curDetails.fragments;if(delta>=0&&delta<curFrags.length)for(var sliding=curFrags[delta].start,newFrags=newDetails.fragments,newFragsCount=newFrags.length,i=0;i<newFragsCount;i++)newFrags[i].start+=sliding}},{key:"adjustStartByBasePdt",value:function(newDetails,pdt){for(var date=void 0,newFrags=newDetails.fragments,newFragsCount=newFrags.length,i=0;i<newFragsCount;i++){var frag=newFrags[i];if(frag.rawProgramDateTime){date=new Date(new Date(frag.rawProgramDateTime).valueOf()-1e3*frag.start),_logger.logger.log("raw PDT: "+date);break}}if(void 0!==date)for(var offset=date.getTime()-pdt.getTime(),offsetBasePdt=newFrags[0].pdt-offset,_i=0;_i<newFragsCount;_i++){var _frag=newFrags[_i];_frag.start=(_frag.pdt-offsetBasePdt)/1e3}}},{key:"onLevelLoaded",value:function(data){var _this2=this,newDetails=data.details,newLevelId=data.level,curLevel=this._levels[newLevelId],duration=newDetails.totalduration,sliding=0;if(_logger.logger.log("X level "+newLevelId+" loaded ["+newDetails.startSN+","+newDetails.endSN+"],duration:"+duration+" live:"+newDetails.live),this._levelLastLoaded=newLevelId,void 0===this.initialPdt&&newDetails.fragments[0].pdt&&(this.initialPdt=newDetails.fragments[0].pdt),newDetails.live){var curDetails=curLevel.details;curDetails&&newDetails.fragments.length>0?(this.hls.streamCoordinator.basePdt?this.adjustStartByBasePdt(newDetails,this.hls.streamCoordinator.basePdt):(_logger.logger.log("onLevelLoaded adjustStartBySlidingOffset NO BASEPDT YET"),this.adjustStartBySlidingOffset(curDetails,newDetails)),sliding=newDetails.fragments[0].start,this.liveSyncPosition=this.computeLivePosition(sliding,curDetails),newDetails.PTSKnown?_logger.logger.log("live X playlist sliding :"+sliding.toFixed(3)):_logger.logger.log("live X playlist - outdated PTS, unknown sliding")):this.hls.streamCoordinator.basePdt?(_logger.logger.log("live X playlist - first load, calculating slide by syncing to base PDT"),this.adjustStartByBasePdt(newDetails,this.hls.streamCoordinator.basePdt),sliding=newDetails.fragments[0].start,_logger.logger.log("basePDT live X playlist sliding:"+sliding.toFixed(3))):(newDetails.PTSKnown=!1,_logger.logger.log("live X playlist - first load, unknown sliding"))}else this.hls.streamCoordinator.basePdt&&this.adjustStartByBasePdt(newDetails,this.hls.streamCoordinator.basePdt),newDetails.PTSKnown=!1;if(newDetails.fragments.forEach(function(frag,index){if(frag.tagList.includes("GAP")){_this2.removeDeadFrag(index,newDetails.fragments),curLevel.containsGaps=!0;while(newDetails.fragments[index]&&newDetails.fragments[index].tagList.includes("GAP"))_this2.removeDeadFrag(index,newDetails.fragments)}}),curLevel.deadFragList.forEach(function(deadSn){var index=newDetails.fragments.findIndex(function(element){return element.sn===deadSn});index!==-1&&_this2.removeDeadFrag(index,newDetails.fragments)}),newDetails.startSN=newDetails.fragments[0].sn,newDetails.originalEndSN=newDetails.endSN,newDetails.endSN=newDetails.fragments[newDetails.fragments.length-1].sn,curLevel.details=newDetails,this.hls.trigger(_events2.default.LEVEL_UPDATED,{details:newDetails,level:newLevelId,sliding:sliding}),this._startFragRequested===!1){if(this._startPosition===-1||this._lastCurrentTime===-1){var startTimeOffset=newDetails.startTimeOffset;isNaN(startTimeOffset)?newDetails.live?(this._startPosition=this.computeLivePosition(sliding,newDetails),_logger.logger.log("configure startPosition to "+this._startPosition)):this._startPosition=0:(startTimeOffset<0&&(_logger.logger.log("negative start time offset "+startTimeOffset+", count from end of last fragment"),startTimeOffset=sliding+duration+startTimeOffset),_logger.logger.log("start time offset found in playlist, adjust startPosition to "+startTimeOffset),this._startPosition=startTimeOffset),this._lastCurrentTime=this._startPosition}this._nextLoadPosition=this._startPosition}this.state===State.WAITING_LEVEL&&(this.state=State.IDLE)}},{key:"onKeyLoaded",value:function(){this.state===State.KEY_LOADING&&(this.state=State.IDLE,this.tick())}},{key:"isCMAF",value:function(buffer){var initSegment=new DataView(buffer),ftyp=1718909296,cmaf=!1;return initSegment.getUint32(4)===ftyp&&(cmaf=!0),cmaf}},{key:"insertPssh",value:function(initSegment,initFrag){var i=void 0,newInitSegment=null,base64str=null,format=null,levelkey=null;if(this.hls.browChrome||this.hls.browFirefox?format="urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed":(this.hls.browIE||this.hls.browEdge)&&(format="com.microsoft.playready"),null!==format)for(i=0;i<initFrag.levelkeys.length&&null===base64str;i++)if(levelkey=initFrag.levelkeys[i],levelkey.format===format){var base64IndexStart=levelkey.reluri.indexOf("base64,");if(base64IndexStart>=0){var str=levelkey.reluri.substring(base64IndexStart),base64IndexEnd=str.indexOf(";");base64IndexEnd<0&&(base64IndexEnd=str.length),base64str=str.substring(7,base64IndexEnd)}}if(base64str){var decodedStr=atob(base64str),pssh=null,count=void 0,offset=0,fourcc=0,buffer=void 0,dv=void 0,moov=1836019574;if("com.microsoft.playready"===format){var psshArray=new ArrayBuffer(decodedStr.length+32);dv=new DataView(psshArray),dv.setUint32(0,psshArray.byteLength),dv.setUint32(4,1886614376),dv.setUint32(8,0),dv.setUint32(12,2584014969),dv.setUint32(16,2554348166),dv.setUint32(20,2878531163),dv.setUint32(24,3767033749),dv.setUint32(28,decodedStr.length),offset=32,pssh=new Uint8Array(psshArray)}else pssh=new Uint8Array(decodedStr.length);for(count=0;count<decodedStr.length;count++)pssh[count+offset]=decodedStr.charCodeAt(count);newInitSegment=new ArrayBuffer(initSegment.byteLength+pssh.length),dv=new DataView(newInitSegment),buffer=new Uint8Array(newInitSegment),buffer.set(new Uint8Array(initSegment),0),buffer.set(pssh,initSegment.byteLength),offset=0;do{var len=dv.getUint32(offset);fourcc=dv.getUint32(offset+4),fourcc===moov?dv.setUint32(offset,len+pssh.length):offset+=len}while(fourcc!==moov&&offset<buffer.length);offset>=buffer.length-8}else if(!levelkey||"SAMPLE-AES"!==levelkey.method&&"SAMPLE-AES-CTR"!==levelkey.method&&"SAMPLE-AES-CENC"!==levelkey.method)newInitSegment=initSegment;else{
var _psshArray=new ArrayBuffer(52),_dv=new DataView(_psshArray),_buffer=void 0,_offset=0,_fourcc=void 0,_moov=1836019574;_dv.setUint32(0,_psshArray.byteLength),_dv.setUint32(4,1886614376),_dv.setUint32(8,16777216),_dv.setUint32(12,276295660),_dv.setUint32(16,3232910594),_dv.setUint32(20,2900573214),_dv.setUint32(24,1390607179),_dv.setUint32(28,1),_dv.setUint32(32,808464432),_dv.setUint32(34,808464432),_dv.setUint32(40,808464432),_dv.setUint32(44,808464432),_dv.setUint32(48,0),newInitSegment=new ArrayBuffer(initSegment.byteLength+_psshArray.byteLength),_dv=new DataView(newInitSegment),_buffer=new Uint8Array(newInitSegment),_buffer.set(new Uint8Array(initSegment),0),_buffer.set(new Uint8Array(_psshArray),initSegment.byteLength);do{var _len=_dv.getUint32(_offset);_fourcc=_dv.getUint32(_offset+4),_fourcc===_moov?_dv.setUint32(_offset,_len+_psshArray.byteLength):_offset+=_len}while(_fourcc!==_moov&&_offset<_buffer.length);_offset>=_buffer.length-8}return newInitSegment}},{key:"getTimeScale",value:function(data){var frag=_muxjs2.default.mp4.tools.inspect(new Uint8Array(data)),timeScale=void 0,i=void 0,j=void 0,k=void 0,l=void 0;for(i=0;i<frag.length&&void 0===timeScale;i++)if("moov"===frag[i].type)for(j=0;j<frag[i].boxes.length&&void 0===timeScale;j++)if("mvhd"===frag[i].boxes[j].type)timeScale=frag[i].boxes[j].timescale;else if("trak"===frag[i].boxes[j].type)for(k=0;k<frag[i].boxes[j].boxes.length&&void 0===timeScale;k++)if("mdia"===frag[i].boxes[j].boxes[k].type)for(l=0;l<frag[i].boxes[j].boxes[k].boxes.length&&void 0===timeScale;l++)"mdhd"===frag[i].boxes[j].boxes[k].boxes[l].type&&(timeScale=frag[i].boxes[j].boxes[k].boxes[l].timescale);return void 0===timeScale&&(_logger.logger.warn("getTimeScale: No valid getTimeScale found, using the default getTimeScale of 30000"),timeScale=3e4),timeScale}},{key:"getTimestampOffset",value:function(data,timeScale){var frag=_muxjs2.default.mp4.tools.inspect(new Uint8Array(data)),ts=timeScale,timestampOffset=void 0,i=void 0,j=void 0,k=void 0;for(ts<=0&&(_logger.logger.warn("getTimestampOffset: Invalid timeScale found, using the default value of 30000"),ts=3e4),i=0;i<frag.length&&void 0===timestampOffset;i++)if("moof"===frag[i].type)for(j=0;j<frag[i].boxes.length&&void 0===timestampOffset;j++)if("traf"===frag[i].boxes[j].type)for(k=0;k<frag[i].boxes[j].boxes.length&&void 0===timestampOffset;k++)"tfdt"===frag[i].boxes[j].boxes[k].type&&(timestampOffset=frag[i].boxes[j].boxes[k].baseMediaDecodeTime/ts);return void 0===timestampOffset&&(_logger.logger.warn("getTimestampOffset: No valid timestampOffset found, using the default timestampOffset of 0"),timestampOffset=0),-timestampOffset}},{key:"onFragLoaded",value:function(data){var fragCurrent=this._fragCurrent,fragLoaded=data.frag;if(this.state===State.FRAG_LOADING&&fragCurrent&&"main"===fragLoaded.type&&fragLoaded.level===fragCurrent.level&&fragLoaded.sn===fragCurrent.sn){var stats=data.stats,currentLevel=this._levels[fragCurrent.level],details=currentLevel.details;if(this._flushOnStoppedBuffering=[],_logger.logger.log("onFragLoaded: Loaded main "+fragCurrent.sn+" of ["+details.startSN+" ,"+details.endSN+"],level "+fragCurrent.level),this._bitrateTest=!1,this._stats=stats,fragLoaded.bitrateTest===!0&&this.hls.nextLoadLevel)this.state=State.IDLE,this._startFragRequested=!1,stats.tparsed=stats.tbuffered=performance.now(),this.hls.trigger(_events2.default.FRAG_BUFFERED,{stats:stats,frag:fragCurrent,id:"main"}),this.tick();else if(this._waitForFlush)_logger.logger.log("main aborting parse due to flush"),this._checkIfBufferReady();else if("initSegment"===fragLoaded.sn)this.state=State.IDLE,stats.tparsed=stats.tbuffered=performance.now(),details.initSegment.data=this.insertPssh(data.payload,details.initSegment),this.cmaf=this.isCMAF(details.initSegment.data),this.hls.trigger(_events2.default.FRAG_BUFFERED,{stats:stats,frag:fragCurrent,id:"main"}),this.tick();else{this.state=State.PARSING;var duration=details.totalduration,level=fragCurrent.level,sn=fragCurrent.sn,audioCodec=this.config.defaultAudioCodec||currentLevel.audioCodec;this._audioCodecSwap&&(_logger.logger.log("swapping playlist audio codec"),void 0===audioCodec&&(audioCodec=this.lastAudioCodec),audioCodec&&(audioCodec=audioCodec.indexOf("mp4a.40.5")!==-1?"mp4a.40.2":"mp4a.40.5")),this._pendingBuffering=!0,this._appended=!1,_logger.logger.log("Parsing "+sn+" of ["+details.startSN+" ,"+details.endSN+"],level "+level+", cc "+fragCurrent.cc);var media=this.media,mediaSeeking=media&&media.seeking,accurateTimeOffset=!mediaSeeking&&(details.PTSKnown||!details.live),initSegmentData=details.initSegment?details.initSegment.data:[];if(this.cmaf){if(details.initSegment.data){var tracks={},initData={tracks:tracks};if(initData.frag=fragLoaded,initData.id="main",currentLevel.videoCodec?tracks.video={container:"video/mp4",codec:currentLevel.videoCodec,initSegment:details.initSegment.data,metadata:{width:currentLevel.width,height:currentLevel.height},levelkeys:details.initSegment.levelkeys}:tracks.audio={container:"audio/mp4",codec:currentLevel.audioCodec,initSegment:details.initSegment.data,metadata:{channelCount:2},levelkeys:details.initSegment.levelkeys},!this.timestampOffset){var timeScale=this.getTimeScale(details.initSegment.data);this.timestampOffset=this.getTimestampOffset(data.payload,timeScale)}this.onFragParsingInitSegment(initData)}var payload={data1:new Int8Array(data.payload),data2:null,startPTS:fragCurrent.startDTS/9e4,endPTS:fragCurrent.nextDTS/9e4,startDTS:fragCurrent.startDTS/9e4,endDTS:fragCurrent.nextDTS/9e4,type:currentLevel.videoCodec?"video":"audio",nb:fragCurrent.frames,dropped:0,duplicate:!1,dts:fragCurrent.startDTS,frag:fragCurrent,id:"main"};this.onFragParsingData(payload),this.onFragParsed(payload)}else{var demuxer=this._demuxer;demuxer||(demuxer=this._demuxer=new _demuxer2.default(this.hls,"main"));var deliberateGap=!1;if(fragCurrent.unmodifiedGap&&fragCurrent.unmodifiedGap!==fragCurrent.gap?fragCurrent.gap=fragCurrent.unmodifiedGap:fragCurrent.unmodifiedGap=fragCurrent.gap?fragCurrent.gap:0,this._fragPrevious&&fragCurrent.gap){var fragPrevious=this._fragPrevious,tolerance=this._levels[level].details.averagetargetduration/2;fragCurrent.start-fragCurrent.gap/1e3>fragPrevious.start+tolerance&&fragCurrent.start-fragCurrent.gap/1e3<fragPrevious.start+3*tolerance&&(deliberateGap=!0),this._altAudio&&!_bufferHelper2.default.isBuffered(media,fragCurrent.start-fragCurrent.gap/(1e3*2))||(fragCurrent.gap=0)}demuxer.push(data.payload,initSegmentData,audioCodec,currentLevel.videoCodec,fragCurrent,duration,accurateTimeOffset,void 0,deliberateGap)}}}this._fragLoadError=0,this._gapCycleBase=void 0}},{key:"onFragParsingInitSegment",value:function(data){var hls=this.hls,fragCurrent=this._fragCurrent,fragNew=data.frag;if(fragCurrent&&"main"===data.id&&fragNew.sn===fragCurrent.sn&&fragNew.level===fragCurrent.level&&this.state===State.PARSING){var tracks=data.tracks,trackName=void 0,track=void 0;if(tracks.audio&&this._altAudio&&delete tracks.audio,track=tracks.audio,track){var audioCodec=this._levels[this._level].audioCodec;audioCodec&&this._audioCodecSwap&&(_logger.logger.log("swapping playlist audio codec"),audioCodec=audioCodec.indexOf("mp4a.40.5")!==-1?"mp4a.40.2":"mp4a.40.5"),this._audioCodecSwitch&&1!==track.metadata.channelCount&&hls.browFirefox===!0&&(audioCodec="mp4a.40.5"),hls.browAndroid===!0&&"audio/mpeg"!==track.container&&(audioCodec="mp4a.40.2",_logger.logger.log("Android: force audio codec to "+audioCodec)),track.levelCodec=audioCodec,track.id=data.id}track=tracks.video,track&&(track.levelCodec=this._levels[this._level].videoCodec,track.id=data.id),hls.trigger(_events2.default.BUFFER_CODECS,tracks);for(trackName in tracks){track=tracks[trackName],_logger.logger.log("main track:"+trackName+",container:"+track.container+",codecs[level/parsed]=["+track.levelCodec+"/"+track.codec+"]");var initSegment=track.initSegment;initSegment&&(this._appended=!0,this._pendingBuffering=!0,hls.trigger(_events2.default.BUFFER_APPENDING,{type:trackName,data:initSegment,parent:"main",content:"initSegment",sn:fragCurrent.sn}))}this.tick()}}},{key:"onFragParsingData",value:function(data){var _this3=this,fragCurrent=this._fragCurrent,fragNew=data.frag;if(fragCurrent&&"main"===data.id&&fragNew.sn===fragCurrent.sn&&fragNew.level===fragCurrent.level&&("audio"!==data.type||!this._altAudio)&&this.state===State.PARSING){if(!data.duplicate||this._bufferNextDuplicate){this._bufferNextDuplicate=!1;var level=this._levels[this._level];isNaN(data.endPTS)&&(data.endPTS=data.startPTS+fragCurrent.duration,data.endDTS=data.startDTS+fragCurrent.duration),this._flushOnStoppedBuffering.push({type:data.type,start:data.startPTS,end:data.endPTS}),_logger.logger.log("onFragParsingData Main Parsed "+data.type+",PTS:["+data.startPTS.toFixed(3)+","+data.endPTS.toFixed(3)+"],DTS:["+data.startDTS.toFixed(3)+"/"+data.endDTS.toFixed(3)+"],nb:"+data.nb+",dropped:"+(data.dropped||0));var hls=this.hls;this._waitForFlush?(_logger.logger.log("main aborting append due to flush"),this._checkIfBufferReady()):(hls.trigger(_events2.default.LEVEL_PTS_UPDATED,{details:level.details,level:this._level,drift:0,type:data.type,start:data.startPTS,end:data.endPTS}),[data.data1,data.data2].forEach(function(buffer){buffer&&buffer.length&&_this3.state===State.PARSING&&(_this3._appended=!0,_this3._pendingBuffering=!0,hls.trigger(_events2.default.BUFFER_APPENDING,{type:data.type,data:buffer,parent:"main",content:"data",sn:data.frag.sn,level:data.frag.level,start:data.startPTS,end:data.endPTS,dts:data.dts,targetDuration:data.frag.duration}))}))}this.tick()}}},{key:"onFragParsed",value:function(data){var fragCurrent=this._fragCurrent,fragNew=data.frag;fragCurrent&&"main"===data.id&&fragNew.sn===fragCurrent.sn&&fragNew.level===fragCurrent.level&&this.state===State.PARSING&&(this._stats.tparsed=performance.now(),this.state=State.PARSED,this._checkAppendedParsed())}},{key:"onAudioTrackSwitching",value:function(data){this.forceStopFetching=!0;var altAudio=!!data.url,trackId=data.id,levels=this._levels;if(levels&&levels.forEach(function(level){level.details&&level.details.fragments.forEach(function(fragment){fragment.loadCounter=void 0,fragment.backtracked=void 0})}),altAudio)this._altAudio=!0;else{if(this.mediaBuffer!==this.media){_logger.logger.log("switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var fragCurrent=this._fragCurrent;fragCurrent.loader&&(_logger.logger.log("switching to main audio track, cancel main fragment load"),fragCurrent.loader.abort()),this._fragCurrent=null,this._fragPrevious=null,this._demuxer&&(this._demuxer.destroy(),this._demuxer=null),this.state=State.IDLE}var hls=this.hls;hls.trigger(_events2.default.AUDIO_TRACK_SWITCHED,{id:trackId}),this._altAudio=!1}}},{key:"onAudioTrackSwitched",value:function(data){var hls=this.hls,trackId=data.id,rendition=hls.audioTrackController.getRenditionNumber(trackId),altAudio=!!hls.audioTracks[trackId].renditions[rendition].url;if(altAudio){var videoBuffer=this.videoBuffer;videoBuffer&&this.mediaBuffer!==videoBuffer&&(_logger.logger.log("switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=videoBuffer)}this._altAudio=altAudio,this.forceStopFetching=!1,this.tick()}},{key:"onBufferCreated",value:function(data){var tracks=data.tracks,mediaTrack=void 0,name=void 0,alternate=!1;for(var type in tracks){var track=tracks[type];"main"===track.id?(name=type,mediaTrack=track,"video"===type&&(this.videoBuffer=tracks[type].buffer,this.timestampOffset&&(this.videoBuffer.timestampOffset=this.timestampOffset))):alternate=!0}alternate&&mediaTrack?(_logger.logger.log("alternate track found, use "+name+".buffered to schedule main fragment loading"),this.mediaBuffer=mediaTrack.buffer,this.timestampOffset&&(this.mediaBuffer.timestampOffset=this.timestampOffset)):this.mediaBuffer=this.media}},{key:"onBufferAppended",value:function(data){if("main"===data.parent){this._fragBufferCount++;var state=this.state;state!==State.PARSING&&state!==State.PARSED||(this._pendingBuffering=data.pending>0,this._checkAppendedParsed())}}},{key:"_checkAppendedParsed",value:function(){if(this.state===State.PARSED&&(!this._appended||!this._pendingBuffering)){var frag=this._fragCurrent;if(frag){var media=this.mediaBuffer?this.mediaBuffer:this.media;try{_logger.logger.log("main buffered : "+_timeRanges2.default.toString(media.buffered))}catch(err){_logger.logger.error("error while trying to access media buffer:"+err.message)}var bufferedFrags=this._bufferedFrags.filter(function(filterFrag){return _bufferHelper2.default.isBuffered(media,(filterFrag.startPTS+filterFrag.endPTS)/2)});bufferedFrags.push(frag),this._bufferedFrags=bufferedFrags.sort(function(a,b){return a.startPTS-b.startPTS}),this._fragPrevious=frag;var stats=this._stats;if(stats.tbuffered=performance.now(),this._fragLastKbps=Math.round(8*stats.total/(stats.tbuffered-stats.tfirst)),this.hls.trigger(_events2.default.FRAG_BUFFERED,{stats:stats,frag:frag,id:"main"}),void 0!==this._bufferBeforeSeekingTime&&this._bufferBeforeSeekingApplied)if(_bufferHelper2.default.isBuffered(this.media,this._bufferBeforeSeekingTime)){var bufferedTime=this._bufferBeforeSeekingTime;this._bufferBeforeSeekingTime=void 0,this._bufferBeforeSeekingApplied=void 0,_logger.logger.log("bufferBeforeSeeking: Ready."),this.hls.trigger(_events2.default.SEEK_READY,{time:bufferedTime})}else{var tryAgain=!0;if(this.hls.streamCoordinator.checkIfRenditionsAreActive&&void 0!==this.hls.audioStreamController.bufferBeforeSeeking&&(tryAgain=!1),tryAgain){var targetTime=this._bufferBeforeSeekingTime+1;_logger.logger.log("bufferBeforeSeeking: Buffered main but desired time not found. Pushing forward target time to "+targetTime+"."),this.hls.bufferBeforeSeeking=targetTime}else _logger.logger.log("bufferBeforeSeeking: Not ready.")}frag.unmodifiedGap&&!_bufferHelper2.default.isBuffered(media,this.media.currentTime)&&this.media.currentTime<frag.start&&this.media.currentTime>frag.start-frag.unmodifiedGap&&(_logger.logger.warn("seeked into a gap, seeking to start of frag"),this.media.currentTime=frag.start+.001),this.state=State.IDLE}this.tick()}}},{key:"onError",value:function(data){var _this4=this,frag=data.frag||this._fragCurrent;if(!frag||"main"===frag.type){var media=this.media,desiredPlayPoint=this._bufferBeforeSeekingTime;void 0===desiredPlayPoint&&this.media&&(desiredPlayPoint=this.media.currentTime);var mediaBuffered=media&&_bufferHelper2.default.isBuffered(media,desiredPlayPoint)&&_bufferHelper2.default.isBuffered(media,desiredPlayPoint+.5);switch(data.details){case _errors.ErrorDetails.FRAG_LOAD_ERROR:case _errors.ErrorDetails.FRAG_LOAD_TIMEOUT:case _errors.ErrorDetails.KEY_LOAD_ERROR:case _errors.ErrorDetails.KEY_LOAD_TIMEOUT:if(!data.fatal){var loadError=this._fragLoadError;loadError?loadError++:loadError=1;var config=this.config;if(loadError<2||0!==this._fragBufferCount){this._fragLoadError=loadError,frag.loadCounter=0;var delay=Math.min(Math.pow(2,loadError-1)*config.fragLoadingRetryDelay,config.fragLoadingMaxRetryTimeout);this._skipReloadDelay&&(delay=0,this._skipReloadDelay=!1),_logger.logger.warn("mediaController: frag loading failed, retry in "+delay+" ms"),this.retryDate=performance.now()+delay,this._loadedMetadata||(this._startFragRequested=!1,this._nextLoadPosition=this._startPosition),this.state=State.FRAG_LOADING_WAITING_RETRY}else _logger.logger.error("mediaController: "+data.details+" reaches max retry, redispatch as fatal ..."),data.fatal=!0,this.state=State.ERROR}break;case _errors.ErrorDetails.FRAG_LOOP_LOADING_ERROR:data.fatal||mediaBuffered&&(this._reduceMaxBufferLength(frag.duration),this.state=State.IDLE);break;case _errors.ErrorDetails.LEVEL_LOAD_ERROR:case _errors.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==State.ERROR&&(data.fatal?(this.state=State.ERROR,_logger.logger.warn("streamController: "+data.details+",switch to "+this.state+" state ...")):this.state===State.WAITING_LEVEL&&(this.state=State.IDLE));break;case _errors.ErrorDetails.BUFFER_FULL_ERROR:"main"!==data.parent||this.state!==State.PARSING&&this.state!==State.PARSED||(mediaBuffered?(this._reduceMaxBufferLength(this.config.maxBufferLength),this._flushOnStoppedBuffering.forEach(function(fragInfo){_this4.hls.trigger(_events2.default.BUFFER_FLUSHING,{startOffset:fragInfo.start,endOffset:fragInfo.end,type:fragInfo.type})}),this.state=State.IDLE):(_logger.logger.warn("buffer full error also desired time is not buffered, flush everything"),this._fragCurrent=null,this.flushMainBuffer(0,Number.POSITIVE_INFINITY))),this._bufferBeforeSeekingApplied===!0&&(this._bufferBeforeSeekingApplied=!1,_logger.logger.log("Main: onBufferFull Rescheduling bufferBeforeSeeking"))}}}},{key:"_reduceMaxBufferLength",value:function(minLength){var config=this.config;config.maxMaxBufferLength>=minLength&&(config.maxMaxBufferLength/=2,_logger.logger.warn("main:reduce max buffer length to "+config.maxMaxBufferLength+"s"),this._fragLoadIdx+=2*config.fragLoadingLoopThreshold)}},{key:"_checkBuffer",value:function(){var media=this.media;if(media&&media.readyState&&!media.errror&&("open"===this.hls.bufferController.mediaSource.readyState||"ended"===this.hls.bufferController.mediaSource.readyState)){var hls=this.hls,currentTime=media.currentTime,mediaBuffer=this.mediaBuffer?this.mediaBuffer:media,buffered=mediaBuffer.buffered;if(!this._loadedMetadata&&buffered.length){this._loadedMetadata=!0;var startPosition=media.seeking?currentTime:this._startPosition,startPositionBuffered=_bufferHelper2.default.isBuffered(mediaBuffer,startPosition);currentTime===startPosition&&startPositionBuffered||(_logger.logger.log("target start position:"+startPosition),(!startPositionBuffered||startPosition<buffered.start(0))&&(startPosition=buffered.start(0),_logger.logger.warn("target start position not buffered, seek to buffered.start(0) "+startPosition)),_logger.logger.log("adjust currentTime from "+currentTime+" to "+startPosition),this.hls.browTizen3&&void 0===this._levels[this._level].videoCodec||(media.currentTime=startPosition)),hls.trigger(_events2.default.START_POSITION_SET,{startPosition:startPosition})}else if(this._immediateSwitch)this.immediateLevelSwitchEnd();else{var bufferInfo=_bufferHelper2.default.bufferInfo(media,currentTime,0),expectedPlaying=!(media.paused||media.ended||hls._inSlowDetach||0===media.buffered.length),jumpThreshold=.5,playheadMoving=currentTime!==this._lastCurrentTime,config=this.config;if(playheadMoving)this._stallReported&&(_logger.logger.warn("playback not stuck anymore @"+currentTime+", after "+Math.round(performance.now()-this._stalled)+"ms"),this._stallReported=!1),this._stalled=void 0,this._nudgeRetry=0,this._streamTimeoutArmed=!1,this._playbackStarted=!0;else if(expectedPlaying&&config.nudgeOnStall){var tnow=performance.now();if(this._stalled){var stalledDuration=tnow-this._stalled,bufferLen=bufferInfo.len,nudgeRetry=this._nudgeRetry||0;if(bufferLen<=jumpThreshold&&stalledDuration>1e3*config.lowBufferWatchdogPeriod){this._stallReported||(this._stallReported=!0,_logger.logger.warn("playback stalling in low buffer @"+currentTime),hls.trigger(_events2.default.ERROR,{type:_errors.ErrorTypes.MEDIA_ERROR,details:_errors.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:bufferLen}));var nextBufferStart=bufferInfo.nextStart,delta=nextBufferStart-currentTime;if(nextBufferStart&&delta<config.maxSeekHole&&delta>0){this._nudgeRetry=++nudgeRetry;var nudgeOffset=nudgeRetry*config.nudgeOffset;_logger.logger.log("adjust currentTime from "+media.currentTime+" to next buffered @ "+nextBufferStart+" + nudge "+nudgeOffset),media.currentTime=nextBufferStart+nudgeOffset,this._stalled=void 0,hls.trigger(_events2.default.ERROR,{type:_errors.ErrorTypes.MEDIA_ERROR,details:_errors.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,hole:nextBufferStart+nudgeOffset-currentTime})}}else if(bufferLen>jumpThreshold&&stalledDuration>1e3*config.highBufferWatchdogPeriod)if(this._stallReported||(this._stallReported=!0,_logger.logger.warn("playback stalling in high buffer @"+currentTime),hls.trigger(_events2.default.ERROR,{type:_errors.ErrorTypes.MEDIA_ERROR,details:_errors.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:bufferLen})),this._stalled=void 0,this._nudgeRetry=++nudgeRetry,nudgeRetry<config.nudgeMaxRetry){var oldCurrentTime=media.currentTime,targetTime=currentTime+nudgeRetry*config.nudgeOffset;_logger.logger.log("adjust currentTime from "+oldCurrentTime+" to "+targetTime),media.currentTime=targetTime,hls.trigger(_events2.default.ERROR,{type:_errors.ErrorTypes.MEDIA_ERROR,details:_errors.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else _logger.logger.error("still stuck in high buffer @"+currentTime+" after "+config.nudgeMaxRetry+", raise fatal error"),hls.trigger(_events2.default.ERROR,{type:_errors.ErrorTypes.MEDIA_ERROR,details:_errors.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})}else this._stalled=tnow,this._stallReported=!1}else if(expectedPlaying&&!this.hls.config.nudgeOnStall){var _tnow=performance.now();if(this._stalled){var _stalledDuration=_tnow-this._stalled,_bufferLen=bufferInfo.len;_stalledDuration>1e3*config.lowBufferWatchdogPeriod&&(this._altAudio&&this.checkForAudioGap(!0),this._stallReported||this._audioGapSeeking||(this._stallReported=!0,_logger.logger.warn("playback stalling @"+currentTime),_bufferLen<=jumpThreshold&&hls.trigger(_events2.default.ERROR,{type:_errors.ErrorTypes.MEDIA_ERROR,details:_errors.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:_bufferLen}),this._streamTimeoutArmed=!0))}else this._stalled=_tnow,this._stallReported=!1}}this._lastCurrentTime=currentTime}}},{key:"onFragLoadEmergencyAborted",value:function(){this.state=State.IDLE,this._loadedMetadata||(this._startFragRequested=!1,this._nextLoadPosition=this._startPosition),this.tick()}},{key:"onBufferFlushed",value:function(){var _this5=this,media=this.mediaBuffer?this.mediaBuffer:this.media;this._bufferedFrags=this._bufferedFrags.filter(function(frag){return _bufferHelper2.default.isBuffered(media,(frag.startPTS+frag.endPTS)/2)}),this._fragLoadIdx+=2*this.config.fragLoadingLoopThreshold,this.state===State.BUFFER_FLUSHING&&this.hls.bufferController.readyForData===!0?(this._waitForFlush=!1,this.state=State.IDLE):this.state===State.PARSED&&(this.state=State.BUFFER_FLUSHING,this._bufferNextDuplicate=!0,this._flushOnStoppedBuffering.forEach(function(fragInfo){_this5.hls.trigger(_events2.default.BUFFER_FLUSHING,{startOffset:fragInfo.start,endOffset:fragInfo.end,type:fragInfo.type})})),this._fragPrevious=null}},{key:"onBufferWait",value:function(){var frag=this._fragCurrent;_logger.logger.log("Main: BufferWait"),frag&&(frag.loader&&frag.loader.abort(),this._fragCurrent=null,this._bufferBeforeSeekingApplied===!0&&(this._bufferBeforeSeekingApplied=!1,_logger.logger.log("Main: Rescheduling bufferBeforeSeeking"))),this.state!==State.FRAG_LOADING&&this.state!==State.KEY_LOADING&&this.state!==State.FRAG_LOADING_WAITING_RETRY||(this.state=State.BUFFER_FLUSHING),this._waitForFlush=!0}},{key:"_checkIfBufferReady",value:function(){this.hls.bufferController.readyForData===!0?(this._waitForFlush=!1,this.state=State.IDLE):this.state=State.BUFFER_FLUSHING}},{key:"swapAudioCodec",value:function(){this._audioCodecSwap=!this._audioCodecSwap}},{key:"computeLivePosition",value:function(sliding,levelDetails){var targetLatency=void 0!==this.config.liveSyncDuration?this.config.liveSyncDuration:this.config.liveSyncDurationCount*levelDetails.targetduration;return sliding+Math.max(0,levelDetails.totalduration-targetLatency)}},{key:"addToDeadFragList",value:function(deadSn){this._levels[this._level]&&this._levels[this._level].deadFragList.push(deadSn),this._skipReloadDelay=!0}},{key:"removeDeadFrag",value:function(index,fragList){if(fragList[index+1]){void 0===fragList[index].gap&&(fragList[index].gap=0),void 0===fragList[index+1].gap&&(fragList[index+1].gap=0),fragList[index+1].gap+=fragList[index].gap+(fragList[index+1].pdt-fragList[index].pdt),fragList.splice(index,1);for(var i=index;i<fragList.length;i++)fragList[i].index--}else fragList[index]&&fragList.splice(index,1)}},{key:"state",set:function(nextState){if(this._state!==nextState){var previousState=this._state;this._state=nextState,_logger.logger.log("main stream state:"+previousState+"->"+nextState),this.hls.trigger(_events2.default.STREAM_STATE_TRANSITION,{previousState:previousState,nextState:nextState})}},get:function(){return this._state}},{key:"currentLevel",get:function(){var media=this.media;if(media){var frag=this.getBufferedFrag(media.currentTime);if(frag)return frag.level}return-1}},{key:"nextBufferedFrag",get:function(){var media=this.media;return media?this.followingBufferedFrag(this.getBufferedFrag(media.currentTime)):null}},{key:"nextLevel",get:function(){var frag=this.nextBufferedFrag;return frag?frag.level:-1}},{key:"bufferBeforeSeeking",set:function(time){_logger.logger.log("main bufferBeforeSeeking set to "+time),this._bufferBeforeSeekingTime=time,this._bufferBeforeSeekingApplied=!1,this._fragCurrent&&this._fragCurrent.loader&&this._fragCurrent.loader.abort(),this._fragCurrent=null,this._fragPrevious=null,this.state=State.IDLE},get:function(){return this._bufferBeforeSeekingTime}},{key:"liveSyncPosition",get:function(){return this._liveSyncPosition},set:function(value){this._liveSyncPosition=value}}]),StreamController}(_eventHandler2.default);exports.default=StreamController,module.exports=exports["default"]},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_events=__webpack_require__(3),_events2=_interopRequireDefault(_events),_eventHandler=__webpack_require__(5),_eventHandler2=_interopRequireDefault(_eventHandler),_logger=__webpack_require__(1),_bufferHelper=__webpack_require__(25),_bufferHelper2=_interopRequireDefault(_bufferHelper);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!==typeof call&&"function"!==typeof call?self:call}function _inherits(subClass,superClass){if("function"!==typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var StreamCoordinator=function(_EventHandler){_inherits(StreamCoordinator,_EventHandler);function StreamCoordinator(hls){_classCallCheck(this,StreamCoordinator);var _this=_possibleConstructorReturn(this,(StreamCoordinator.__proto__||Object.getPrototypeOf(StreamCoordinator)).call(this,hls,_events2.default.MEDIA_ATTACHED,_events2.default.MEDIA_DETACHING,_events2.default.MANIFEST_LOADING,_events2.default.MANIFEST_PARSED,_events2.default.AUDIO_TRACKS_UPDATED,_events2.default.SUBTITLE_TRACKS_UPDATED,_events2.default.LEVEL_UPDATED,_events2.default.AUDIO_TRACK_UPDATED,_events2.default.SUBTITLE_TRACK_UPDATED,_events2.default.AUDIO_TRACK_SWITCHING,_events2.default.STREAM_DESYNC,_events2.default.FRAG_BUFFERED,_events2.default.BUFFER_FLUSHING,_events2.default.ERROR));return _this.config=_this.hls.config,_this.media=null,_this._monitorMainControllers=!1,_this._monitorAudioControllers=!1,_this._monitorSubtitleControllers=!1,_this._controllersParsed=0,_this._activeControllers=0,_this._mainControllersReady=!1,_this._audioControllersReady=!1,_this._subtitleControllersReady=!1,_this._allReady=!1,_this._audioControllersActive=!1,_this._mainLiveTime=void 0,_this._audioLiveTime=void 0,_this._mainLevelStartTime=void 0,_this._mainLevelEndTime=void 0,_this._audioLevelStartTime=void 0,_this._audioLevelEndTime=void 0,_this._combinedLiveTime=void 0,_this._mainBasePdt=void 0,_this._audioBasePdt=void 0,_this._basePdt=void 0,_this._startPdt=void 0,_this._resumeBasePdt=void 0,_this._mainLive=!0,_this._audioLive=!0,_this._startTime=-1,_this._liveStreamsStartAtLiveTime=!0,_this._mainStreamTimeoutTimer=null,_this._audioStreamTimeoutTimer=null,_this._mainTimedOut=!1,_this._audioTimedOut=!1,_this._audioForcedUnpause=!1,_this._vidReadyForDispose=!1,_this._audReadyForDispose=!1,_this._defaultTimeout=3e4,_this._targetDuration=void 0,_this}return _createClass(StreamCoordinator,[{key:"dispose",value:function(){this.disarmMainStreamTimeout(),this.disarmAudioStreamTimeout(),this.config=null,this.media=null,this.hls=null}},{key:"onMediaAttached",value:function(data){this.media=data.media,this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),this.media.addEventListener("seeking",this.onvseeking),this.media.addEventListener("ended",this.onvended),this.resetStreamTimeout()}},{key:"onMediaDetaching",value:function(){this.media&&(this.media.removeEventListener("seeking",this.onvseeking),this.media.removeEventListener("ended",this.onvended))}},{key:"resetStreamTimeout",value:function(){this._mainStreamTimeoutTimer&&(this.disarmMainStreamTimeout(),this.armMainStreamTimeout()),this._audioStreamTimeoutTimer&&(this.disarmAudioStreamTimeout(),this.armAudioStreamTimeout())}},{key:"onMediaSeeking",value:function(){this.resetStreamTimeout()}},{key:"onBufferFlushing",value:function(){this.resetStreamTimeout()}},{key:"onMediaEnded",value:function(){this.disarmMainStreamTimeout(),this.disarmAudioStreamTimeout()}},{key:"onManifestLoading",value:function(){this._monitorMainControllers=!1,this._monitorAudioControllers=!1,this._monitorSubtitleControllers=!1,this._controllersParsed=0,this._activeControllers=0,this._mainControllersReady=!1,this._audioControllersReady=!1,this._subtitleControllersReady=!1,this._allReady=!1,this._audioControllersActive=!1,this._mainLiveTime=void 0,this._audioLiveTime=void 0,this._mainLevelStartTime=void 0,this._mainLevelEndTime=void 0,this._audioLevelStartTime=void 0,this._audioLevelEndTime=void 0,this._combinedLiveTime=void 0,this._mainBasePdt=void 0,this._audioBasePdt=void 0,this._basePdt=void 0,this._startPdt=void 0,this._mainLive=!0,this._audioLive=!0,this._startTime=-1,this._liveStreamsStartAtLiveTime=!0,this.disarmMainStreamTimeout(),this.disarmAudioStreamTimeout(),this._mainTimedOut=!1,this._audioTimedOut=!1,this._defaultTimeout=3e4,this._vidReadyForDispose=!1,this._audReadyForDispose=!1,this._targetDuration=void 0}},{key:"onManifestParsed",value:function(data){data.levels.length>0&&(this._monitorMainControllers=!0),this.checkParsingFinished()}},{key:"onAudioTracksUpdated",value:function(data){data.audioTracks.length>0&&(this._monitorAudioControllers=!0),this.checkParsingFinished()}},{key:"onSubtitleTracksUpdated",value:function(data){data.subtitleTracks.length>0&&(this._monitorSubtitleControllers=!0),this.checkParsingFinished()}},{key:"onLevelUpdated",value:function(data){this._mainLive=data.details.live,this._mainLiveTime=this.determineLiveTime(data.details,data.sliding,"main"),this._mainLevelStartTime=data.details.fragments[0].start,this._mainLevelEndTime=data.details.totalduration,this.determineCombinedLiveTime(),!this._monitorMainControllers||this._mainControllersReady||this._allReady||(this._targetDuration=data.details.averagetargetduration,this._defaultTimeout=3e3*data.details.averagetargetduration,
this._mainBasePdt=this.determineBasePdt(data.details,"main"),this._mainControllersReady=!0,this.checkReady())}},{key:"onAudioTrackUpdated",value:function(data){this._audioLive=data.details.live,this._audioLiveTime=this.determineLiveTime(data.details,data.sliding,"audio"),this._audioLevelStartTime=data.details.fragments[0].start,this._audioLevelEndTime=data.details.totalduration,this.determineCombinedLiveTime(),!this._monitorAudioControllers||this._audioControllersReady||this._allReady||(this._audioBasePdt=this.determineBasePdt(data.details,"audio"),this._audioControllersReady=!0,this.checkReady())}},{key:"onSubtitleTrackUpdated",value:function(){!this._monitorSubtitleControllers||this._subtitleControllersReady||this._allReady||(this._subtitleControllersReady=!0,this.checkReady())}},{key:"onAudioTrackSwitching",value:function(){var trackId=this.hls.audioTrack,rendition=this.hls.audioTrackController.getRenditionNumber(trackId),altAudio=!!this.hls.audioTracks[trackId].renditions[rendition].url;this._audioControllersActive&&this.hls.audioStreamController.pausedTimer&&this.hls.audioStreamController.unpauseController(),altAudio?(this._audioControllersActive=!0,this.armAudioStreamTimeout()):(this._audioControllersActive=!1,this.disarmAudioStreamTimeout())}},{key:"onStreamDesync",value:function(data){var desync=data.desync/1e3;desync<0?(this._mainLevelStartTime+=desync,this._mainLevelEndTime+=desync,this._mainLiveTime+=desync):desync>0&&(this._audioLevelStartTime-=desync,this._audioLevelEndTime-=desync,this._audioLiveTime-=desync)}},{key:"onFragBuffered",value:function(data){if("main"===data.frag.type?(this.disarmMainStreamTimeout(),this.armMainStreamTimeout()):"audio"===data.frag.type&&(this.disarmAudioStreamTimeout(),this.armAudioStreamTimeout()),this._audioControllersActive){var audioStreamController=this.hls.audioStreamController,mainStreamController=this.hls.streamController,audioGapTolerance=.2,desiredPlayPoint=mainStreamController.bufferBeforeSeeking;void 0===desiredPlayPoint&&this.media&&(desiredPlayPoint=this.media.currentTime),audioStreamController.tracks[audioStreamController.trackId].containsGaps&&(audioGapTolerance=1.1*this._targetDuration);var mainBufferEnd=_bufferHelper2.default.bufferInfo(mainStreamController.videoBuffer,desiredPlayPoint,.2).end,audioBufferEnd=_bufferHelper2.default.bufferInfo(audioStreamController.mediaBuffer,desiredPlayPoint,audioGapTolerance).end;audioStreamController.pausedTimer&&audioBufferEnd-mainBufferEnd<this._targetDuration/2?(audioStreamController.unpauseController(),_logger.logger.log("onFragBuffered audio processing resumed")):!audioStreamController.pausedTimer&&audioBufferEnd-mainBufferEnd>this._targetDuration/2&&_bufferHelper2.default.isBuffered(this.media,this.media.currentTime+2*this._targetDuration)&&(audioStreamController.pauseController(),_logger.logger.log("onFragBuffered audio processing paused"))}}},{key:"onError",value:function(data){data.fatal&&(this.disarmMainStreamTimeout(),this.disarmAudioStreamTimeout())}},{key:"armMainStreamTimeout",value:function(){var _this2=this;null===this._mainStreamTimeoutTimer&&(this._mainStreamTimeoutTimer=setTimeout(function(){_this2._mainTimedOut=!0,_logger.logger.log("main stream timeout timer expired")},this.getTimeoutValue()),_logger.logger.log("main stream timeout timer armed"))}},{key:"armAudioStreamTimeout",value:function(){var _this3=this;null===this._audioStreamTimeoutTimer&&(this._audioStreamTimeoutTimer=setTimeout(function(){_this3._audioControllersActive&&_this3.hls.audioStreamController.pausedTimer&&!_this3._audioForcedUnpause?(_this3._audioForcedUnpause=!0,_this3.hls.audioStreamController.unpauseController(),_logger.logger.log("audio timeout force unpause")):(_this3._audioTimedOut=!0,_logger.logger.log("audio stream timeout timer expired"))},this.getTimeoutValue()),_logger.logger.log("audio stream timeout timer armed"))}},{key:"disarmMainStreamTimeout",value:function(){this._mainStreamTimeoutTimer&&(clearTimeout(this._mainStreamTimeoutTimer),this._mainStreamTimeoutTimer=null,_logger.logger.log("main stream timeout timer disarmed")),this._mainTimedOut=!1}},{key:"disarmAudioStreamTimeout",value:function(){this._audioStreamTimeoutTimer&&(clearTimeout(this._audioStreamTimeoutTimer),this._audioStreamTimeoutTimer=null,_logger.logger.log("audio stream timeout timer disarmed")),this._audioTimedOut=!1,this._audioForcedUnpause=!1}},{key:"getTimeoutValue",value:function(){var timeout=this._defaultTimeout,configTimeout=0;return this.config&&(configTimeout=this.config.streamTimeOut),timeout=Math.max(timeout,configTimeout),timeout}},{key:"checkParsingFinished",value:function(){this._controllersParsed++,3===this._controllersParsed&&(this._controllersParsed=0,this._activeControllers=this._monitorMainControllers+this._monitorAudioControllers+this._monitorSubtitleControllers,_logger.logger.log("all manifest parsed events received, number of active controllers: "+this._activeControllers),this.hls.trigger(_events2.default.STREAM_ALL_LEVELS_PARSED,{main:this._monitorMainControllers,audio:this._monitorAudioControllers,subtitle:this._monitorSubtitleControllers}))}},{key:"checkIfRenditionsExist",value:function(){return this._monitorAudioControllers}},{key:"checkIfRenditionsAreActive",value:function(){return this._audioControllersActive}},{key:"checkReady",value:function(){var expectedLoads=this._activeControllers;if(this._monitorAudioControllers&&!this._audioControllersActive&&(expectedLoads-=1),this._mainControllersReady+this._audioControllersReady+this._subtitleControllersReady===expectedLoads){if(this._mainBasePdt&&this._audioBasePdt){var mainBasePdt=this._mainBasePdt.getTime(),audioBasePdt=this._audioBasePdt.getTime(),mainTd=1e3*this.hls.levels[this.hls.loadLevel].details.targetduration,audioTd=1e3*this.hls.audioStreamController.tracks[this.hls.audioStreamController.trackId].details.targetduration,variance=(mainTd+audioTd)/4;if(mainBasePdt<audioBasePdt-variance||mainBasePdt>audioBasePdt+variance){var desync=mainBasePdt-audioBasePdt;_logger.logger.log("base pdt desync: "+desync),this.hls.trigger(_events2.default.STREAM_DESYNC,{desync:desync,pdtToAlignTo:desync>0?mainBasePdt:audioBasePdt,variance:variance})}}this._basePdt=this.determineCombinedBasePdt(),this.hls.trigger(_events2.default.STREAM_BASEPDT_FOUND,{basePdt:this._basePdt}),this.armMainStreamTimeout(),this._audioControllersActive&&this.armAudioStreamTimeout(),this._allReady=!0;var startTime=this.determineStartTime();_logger.logger.log("all expected level loaded events received, start time: "+startTime+", expected loads: "+expectedLoads),this.hls.trigger(_events2.default.STREAM_ALL_LEVELS_LOADED,{startTime:startTime})}}},{key:"checkReadyForDispose",value:function(videoTrackReady,audioTrackReady){var toDispose=this._activeControllers,haveDisposed=0,readyForDispose=!1;return _logger.logger.log("checkReadyForDispose Count "+toDispose),this._monitorAudioControllers&&!this._audioControllersActive&&(_logger.logger.log("checkReadyForDispose Not using renditions"),toDispose-=1),void 0!==videoTrackReady&&(_logger.logger.log("checkReadyForDispose Video"),this._vidReadyForDispose=videoTrackReady),void 0!==audioTrackReady&&(_logger.logger.log("checkReadyForDispose Audio"),this._audReadyForDispose=audioTrackReady),this._vidReadyForDispose&&(haveDisposed+=1),this._audReadyForDispose&&(haveDisposed+=1),toDispose===haveDisposed&&(readyForDispose=!0),_logger.logger.log("checkReadyForDispose "+readyForDispose),readyForDispose}},{key:"determineLiveTime",value:function(details,sliding,type){var liveSyncTime=void 0;if(void 0!==this.config.liveSyncDuration){var targetTime=details.totalduration+sliding-this.config.liveSyncDuration;if(targetTime<details.fragments[0].start)_logger.logger.warn("StreamCoordinator::determineLiveTime: current manifest for "+type+" shorter than liveSyncDuration, setting to start of manifest"),liveSyncTime=details.fragments[0].start;else for(var i=details.fragments.length-1;i>=0;i--)if(details.fragments[i].start<=targetTime){liveSyncTime=details.fragments[i].start;break}}else{if(void 0===this.config.liveSyncDurationCount)throw new Error("StreamCoordinator::determineLiveTime: No live sync offset found");details.fragments.length<this.config.liveSyncDurationCount?(_logger.logger.warn("StreamCoordinator::determineLiveTime: current manifest for "+type+" has less frags than liveSyncDurationCount, setting to start of manifest"),liveSyncTime=details.fragments[0].start):liveSyncTime=details.fragments[details.fragments.length-this.config.liveSyncDurationCount].start}return _logger.logger.log(type+" live sync time: "+liveSyncTime),liveSyncTime}},{key:"determineCombinedLiveTime",value:function(){var liveTime=void 0;if(this._monitorAudioControllers&&this._audioControllersActive?this._mainLiveTime&&this._audioLiveTime&&(liveTime=Math.min(this._mainLiveTime,this._audioLiveTime),liveTime=Math.max(liveTime,this._mainLevelStartTime,this._audioLevelStartTime)):liveTime=this._mainLiveTime,liveTime&&(liveTime>this._combinedLiveTime||void 0===this._combinedLiveTime)){var lastLiveTime=this._combinedLiveTime;this._combinedLiveTime=liveTime,_logger.logger.log("combined live sync time: "+liveTime),this.hls.trigger(_events2.default.STREAM_LIVETIME_CHANGED,{liveTime:liveTime,lastLiveTime:lastLiveTime})}}},{key:"determineStartTime",value:function(){var liveStream=this._mainLive;if(liveStream&&this._monitorAudioControllers&&this._audioControllersActive&&(liveStream=this._mainLive&&this._audioLive),liveStream&&this._liveStreamsStartAtLiveTime)return _logger.logger.log("live stream with LSSALT enabled, setting live time as start time"),this._combinedLiveTime;var startTime=void 0;return this._startPdt&&(startTime=this.getTimeForPdt(this._startPdt)),startTime||(startTime=this._startTime),this._monitorAudioControllers&&this._audioControllersActive?(startTime=Math.max(startTime,this._mainLevelStartTime,this._audioLevelStartTime),startTime=Math.min(startTime,this._mainLevelEndTime,this._audioLevelEndTime)):(startTime=Math.max(startTime,this._mainLevelStartTime),startTime=Math.min(startTime,this._mainLevelEndTime)),liveStream&&(startTime=Math.min(startTime,this._combinedLiveTime)),startTime}},{key:"determineBasePdt",value:function(details,type){for(var fragments=details.fragments,fragCount=fragments.length,i=0;i<fragCount;i++){var frag=fragments[i],rawPdt=frag.rawProgramDateTime;if(rawPdt){var date=new Date(new Date(rawPdt).valueOf()-1e3*frag.start);return _logger.logger.log(type+" base PDT: "+date),date}}return _logger.logger.log("no base PDT for "+type),null}},{key:"determineCombinedBasePdt",value:function(){var basePdt=void 0;return basePdt=this._resumeBasePdt?this._resumeBasePdt:this._mainBasePdt&&this._audioBasePdt?this._mainBasePdt.getTime()>=this._audioBasePdt.getTime()?this._mainBasePdt:this._audioBasePdt:this._mainBasePdt?this._mainBasePdt:null,basePdt}},{key:"_findFragList",value:function(){var fragList=void 0,hls=this.hls,levels=hls.levels,details=levels[hls.loadLevel].details;if(details)fragList=details.fragments;else for(var levelsCount=levels.length,i=0;i<levelsCount;i++)if(details=levels[i].details,details){fragList=details.fragments;break}return fragList}},{key:"getTimeForPdt",value:function(pdt){for(var baseTime=pdt.getTime(),fragList=this._findFragList(),fragCount=fragList.length,i=0;i<fragCount;i++){var frag=fragList[i],fragPdt=frag.pdt,fragEndPdt=fragPdt+1e3*frag.duration;if(baseTime>=fragPdt&&baseTime<=fragEndPdt)return Number((frag.start+(baseTime-fragPdt)/1e3).toFixed(6));if(baseTime<fragEndPdt)return Number(frag.start.toFixed(6));if(i===fragCount-1)return Number((frag.start+(baseTime-fragPdt)/1e3).toFixed(6))}return null}},{key:"getPdtForTime",value:function(time){var fragList=this._findFragList();if(time<fragList[0].start){var offset=fragList[0].start-time;return new Date(fragList[0].pdt-1e3*offset)}for(var gapTotal=0,nextGapTotal=0,fragCount=fragList.length,i=0;i<fragCount;i++){if(i===fragCount-1){var _offset=time-(fragList[i].start-gapTotal/1e3);return new Date(fragList[i].pdt+1e3*_offset)}var nextFrag=fragList[i+1];nextFrag.gap>0&&!this._audioControllersActive&&(nextGapTotal+=nextFrag.gap);var thisFrag=fragList[i];if(thisFrag.start-gapTotal/1e3<time&&nextFrag.start-nextGapTotal/1e3>time){var _offset2=time-(thisFrag.start-gapTotal/1e3);return new Date(thisFrag.pdt+1e3*_offset2)}gapTotal=nextGapTotal}return null}},{key:"startTime",set:function(value){this._startTime=value}},{key:"liveStreamsStartAtLiveTime",set:function(value){this._liveStreamsStartAtLiveTime=!!value}},{key:"startPdt",set:function(value){this._startPdt=value}},{key:"basePdt",get:function(){var basePdt=this._basePdt;return this._resumeBasePdt&&(basePdt=this._resumeBasePdt),basePdt}},{key:"resumeBasePdt",get:function(){return this._resumeBasePdt},set:function(value){_logger.logger.log("StreamCoordinator: resumeBasePdt set to "+value),this._resumeBasePdt=value}}]),StreamCoordinator}(_eventHandler2.default);exports.default=StreamCoordinator,module.exports=exports["default"]},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_events=__webpack_require__(3),_events2=_interopRequireDefault(_events),_eventHandler=__webpack_require__(5),_eventHandler2=_interopRequireDefault(_eventHandler),_logger=__webpack_require__(1);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!==typeof call&&"function"!==typeof call?self:call}function _inherits(subClass,superClass){if("function"!==typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var SubtitleStreamController=function(_EventHandler){_inherits(SubtitleStreamController,_EventHandler);function SubtitleStreamController(hls){_classCallCheck(this,SubtitleStreamController);var _this=_possibleConstructorReturn(this,(SubtitleStreamController.__proto__||Object.getPrototypeOf(SubtitleStreamController)).call(this,hls,_events2.default.ERROR,_events2.default.SUBTITLE_TRACKS_UPDATED,_events2.default.SUBTITLE_TRACK_SWITCH,_events2.default.SUBTITLE_TRACK_LOADED,_events2.default.SUBTITLE_FRAG_PROCESSED));return _this.config=hls.config,_this.vttFragSNsProcessed={},_this.vttFragQueues=void 0,_this.currentlyProcessing=null,_this.currentTrackId=-1,_this}return _createClass(SubtitleStreamController,[{key:"destroy",value:function(){_eventHandler2.default.prototype.destroy.call(this),this.config=null,this.tracks=null,this.vttFragQueues=null,this.vttFragSNsProcessed=null,this.hls=null}},{key:"clearVttFragQueues",value:function(){var _this2=this;this.vttFragQueues={},this.tracks.forEach(function(track){_this2.vttFragQueues[track.id]=[]})}},{key:"nextFrag",value:function(){if(null===this.currentlyProcessing&&this.currentTrackId>-1&&this.vttFragQueues[this.currentTrackId].length){var frag=this.currentlyProcessing=this.vttFragQueues[this.currentTrackId].shift();this.hls.trigger(_events2.default.FRAG_LOADING,{frag:frag})}}},{key:"onSubtitleFragProcessed",value:function(data){data.success&&this.vttFragSNsProcessed[data.frag.trackId].push(data.frag.sn),this.currentlyProcessing=null,this.nextFrag()}},{key:"onError",value:function(data){var frag=data.frag;frag&&"subtitle"!==frag.type||this.currentlyProcessing&&(this.currentlyProcessing=null,this.nextFrag())}},{key:"onSubtitleTracksUpdated",value:function(data){var _this3=this;_logger.logger.log("subtitle tracks updated"),this.tracks=data.subtitleTracks,this.clearVttFragQueues(),this.vttFragSNsProcessed={},this.tracks.forEach(function(track){_this3.vttFragSNsProcessed[track.id]=[]})}},{key:"onSubtitleTrackSwitch",value:function(data){this.currentTrackId=data.id,this.clearVttFragQueues()}},{key:"onSubtitleTrackLoaded",value:function(data){var processedFragSNs=this.vttFragSNsProcessed[data.id],fragQueue=this.vttFragQueues[data.id],currentFragSN=this.currentlyProcessing?this.currentlyProcessing.sn:-1,alreadyProcessed=function(frag){return processedFragSNs.indexOf(frag.sn)>-1},alreadyInQueue=function(frag){return fragQueue.some(function(fragInQueue){return fragInQueue.sn===frag.sn})};data.details.fragments.forEach(function(frag){alreadyProcessed(frag)||frag.sn===currentFragSN||alreadyInQueue(frag)||(frag.trackId=data.id,fragQueue.push(frag))}),this.hls.trigger(_events2.default.SUBTITLE_TRACK_UPDATED,{details:data.details,track:data.id}),this.nextFrag()}}]),SubtitleStreamController}(_eventHandler2.default);exports.default=SubtitleStreamController,module.exports=exports["default"]},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_events=__webpack_require__(3),_events2=_interopRequireDefault(_events),_eventHandler=__webpack_require__(5),_eventHandler2=_interopRequireDefault(_eventHandler),_logger=__webpack_require__(1);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!==typeof call&&"function"!==typeof call?self:call}function _inherits(subClass,superClass){if("function"!==typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var SubtitleTrackController=function(_EventHandler){_inherits(SubtitleTrackController,_EventHandler);function SubtitleTrackController(hls){_classCallCheck(this,SubtitleTrackController);var _this=_possibleConstructorReturn(this,(SubtitleTrackController.__proto__||Object.getPrototypeOf(SubtitleTrackController)).call(this,hls,_events2.default.MEDIA_ATTACHED,_events2.default.MEDIA_DETACHING,_events2.default.MANIFEST_LOADING,_events2.default.MANIFEST_LOADED,_events2.default.SUBTITLE_TRACK_LOADED));return _this.tracks=[],_this.trackId=-1,_this.media=void 0,_this}return _createClass(SubtitleTrackController,[{key:"destroy",value:function(){_eventHandler2.default.prototype.destroy.call(this),this.tracks=null,this.hls=null}},{key:"onMediaAttached",value:function(data){var _this2=this;this.media=data.media,this.media&&this.media.textTracks.addEventListener("change",function(){if(_this2.media){for(var trackId=-1,tracks=_this2.media.textTracks,id=0;id<tracks.length;id++)"showing"===tracks[id].mode&&(trackId=id);_this2.subtitleTrack=trackId}})}},{key:"onMediaDetaching",value:function(){this.media=void 0}},{key:"onManifestLoading",value:function(){this.tracks=[],this.trackId=-1}},{key:"onManifestLoaded",value:function(data){var _this3=this,tracks=data.subtitles||[];this.tracks=tracks,this.trackId=-1,this.hls.trigger(_events2.default.SUBTITLE_TRACKS_UPDATED,{subtitleTracks:tracks}),tracks.forEach(function(track){track.default&&(_this3.subtitleTrack=track.id)})}},{key:"onTick",value:function(){var trackId=this.trackId,subtitleTrack=this.tracks[trackId];if(subtitleTrack){var details=subtitleTrack.details;void 0!==details&&details.live!==!0||(_logger.logger.log("(re)loading playlist for subtitle track "+trackId),this.hls.trigger(_events2.default.SUBTITLE_TRACK_LOADING,{url:subtitleTrack.url,id:trackId}))}}},{key:"onSubtitleTrackLoaded",value:function(data){var _this4=this;data.id<this.tracks.length&&(_logger.logger.log("subtitle track "+data.id+" loaded"),this.tracks[data.id].details=data.details,data.details.live&&!this.timer&&(this.timer=setInterval(function(){_this4.onTick()},1e3*data.details.targetduration,this)),!data.details.live&&this.timer&&(clearInterval(this.timer),this.timer=null))}},{key:"setSubtitleTrackInternal",value:function(newId){if(newId>=0&&newId<this.tracks.length){this.timer&&(clearInterval(this.timer),this.timer=null),this.trackId=newId,_logger.logger.log("switching to subtitle track "+newId);var subtitleTrack=this.tracks[newId];this.hls.trigger(_events2.default.SUBTITLE_TRACK_SWITCH,{id:newId});var details=subtitleTrack.details;void 0!==details&&details.live!==!0||(_logger.logger.log("(re)loading playlist for subtitle track "+newId),this.hls.trigger(_events2.default.SUBTITLE_TRACK_LOADING,{url:subtitleTrack.url,id:newId}))}}},{key:"subtitleTracks",get:function(){return this.tracks}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(subtitleTrackId){this.trackId!==subtitleTrackId&&this.setSubtitleTrackInternal(subtitleTrackId)}}]),SubtitleTrackController}(_eventHandler2.default);exports.default=SubtitleTrackController,module.exports=exports["default"]},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_events=__webpack_require__(3),_events2=_interopRequireDefault(_events),_eventHandler=__webpack_require__(5),_eventHandler2=_interopRequireDefault(_eventHandler),_cea608Parser=__webpack_require__(135),_cea608Parser2=_interopRequireDefault(_cea608Parser),_webvttParser=__webpack_require__(140),_webvttParser2=_interopRequireDefault(_webvttParser),_logger=__webpack_require__(1);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!==typeof call&&"function"!==typeof call?self:call}function _inherits(subClass,superClass){if("function"!==typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}function clearCurrentCues(track){if(track&&track.cues)while(track.cues.length>0)track.removeCue(track.cues[0])}function reuseVttTextTrack(inUseTrack,manifestTrack){return inUseTrack&&inUseTrack.label===manifestTrack.name&&!(inUseTrack.textTrack1||inUseTrack.textTrack2)}function intersection(x1,x2,y1,y2){return Math.min(x2,y2)-Math.max(x1,y1)}var TimelineController=function(_EventHandler){_inherits(TimelineController,_EventHandler);function TimelineController(hls){_classCallCheck(this,TimelineController);var _this=_possibleConstructorReturn(this,(TimelineController.__proto__||Object.getPrototypeOf(TimelineController)).call(this,hls,_events2.default.MEDIA_ATTACHING,_events2.default.MEDIA_ATTACHED,_events2.default.MEDIA_DETACHING,_events2.default.FRAG_PARSING_USERDATA,_events2.default.MANIFEST_LOADING,_events2.default.MANIFEST_LOADED,_events2.default.FRAG_LOADED,_events2.default.LEVEL_SWITCHING,_events2.default.TEXT_TRACK_CHANGED,_events2.default.INIT_PTS_FOUND));if(_this.hls=hls,_this.config=hls.config,_this.enabled=!0,_this.Cues=hls.config.cueHandler,_this.textTracks=[],_this.tracks=[],_this.unparsedVttFrags=[],_this.initPTS=void 0,_this.cueRanges=[],_this.preFlushed=!1,_this.captionsOnSeekWorkaround=_this.hls.browIE||_this.hls.browEdge,_this.config.enableCEA708Captions){var self=_this,sendAddTrackEvent=function(track,media){var e=null;try{e=new window.Event("addtrack")}catch(err){e=document.createEvent("Event"),e.initEvent("addtrack",!1,!1)}e.track=track,media.dispatchEvent(e)},channel1={newCue:function(startTime,endTime,screen){if(!self.textTrack1){var existingTrack1=self.getExistingTrack("1");if(existingTrack1)self.textTrack1=existingTrack1,clearCurrentCues(self.textTrack1),sendAddTrackEvent(self.textTrack1,self.media);else{var textTrack1=self.createTextTrack("captions",self.config.captionsTextTrack1Label,self.config.captionsTextTrack1LanguageCode);textTrack1&&(textTrack1.textTrack1=!0,self.textTrack1=textTrack1)}self.hls.trigger(_events2.default.TEXT_TRACK_ADDED,{track:self.textTrack1})}self.addCues("textTrack1",startTime,endTime,screen)}},channel2={newCue:function(startTime,endTime,screen){if(!self.textTrack2){var existingTrack2=self.getExistingTrack("2");if(existingTrack2)self.textTrack2=existingTrack2,clearCurrentCues(self.textTrack2),sendAddTrackEvent(self.textTrack2,self.media);else{var textTrack2=self.createTextTrack("captions",self.config.captionsTextTrack2Label,self.config.captionsTextTrack1LanguageCode);textTrack2&&(textTrack2.textTrack2=!0,self.textTrack2=textTrack2)}self.hls.trigger(_events2.default.TEXT_TRACK_ADDED,{track:self.textTrack2})}self.addCues("textTrack2",startTime,endTime,screen)}};_this.cea608Parser=new _cea608Parser2.default(0,channel1,channel2)}return _this}return _createClass(TimelineController,[{key:"addCues",value:function(channel,startTime,endTime,screen){this.captionsOnSeekWorkaround&&this.media.textTracks.length&&this.media.textTracks[0].cues.length&&this.media.textTracks[0].cues[this.media.textTracks[0].cues.length-1].endTime>startTime&&this.clearAllCues();for(var ranges=this.cueRanges,merged=!1,i=ranges.length;i--;){var cueRange=ranges[i],overlap=intersection(cueRange[0],cueRange[1],startTime,endTime);if(overlap>=0&&(cueRange[0]=Math.min(cueRange[0],startTime),cueRange[1]=Math.max(cueRange[1],endTime),merged=!0,overlap/(endTime-startTime)>.5))return}merged||ranges.push([startTime,endTime]),this.Cues.newCue(this[channel],startTime,endTime,screen)}},{key:"onInitPtsFound",value:function(data){var _this2=this;"undefined"===typeof this.initPTS&&(this.initPTS=data.initPTS),this.unparsedVttFrags.length&&(this.unparsedVttFrags.forEach(function(frag){_this2.onFragLoaded(frag)}),this.unparsedVttFrags=[])}},{key:"clearAllCues",value:function(){clearCurrentCues(this.textTrack1),clearCurrentCues(this.textTrack2),this.cueRanges=[]}},{key:"getExistingTrack",value:function(channelNumber){var media=this.media;if(media)for(var i=0;i<media.textTracks.length;i++){var textTrack=media.textTracks[i],propName="textTrack"+channelNumber;if(textTrack[propName]===!0)return textTrack}return null}},{key:"createTextTrack",value:function(kind,label,lang){var media=this.media;return media?media.addTextTrack(kind,label,lang):null}},{key:"destroy",value:function(){this.clearAllCues(),_eventHandler2.default.prototype.destroy.call(this),this.Cues=null,this.cea608Parser=null,this.config=null,this.cueRanges=null,this.onvseeking=null,this.textTrack1&&(this.textTrack1=null),this.textTrack2&&(this.textTrack2=null),this.textTracks=null,this.tracks=null,this.unparsedVttFrags=null,this.vttCCs=null,this.hls=null}},{key:"onMediaAttaching",value:function(data){this.media=data.media}},{key:"onMediaAttached",value:function(){if(this.onvseeking=this.onMediaSeeking.bind(this),this.captionsOnSeekWorkaround&&this.media.addEventListener("seeking",this.onvseeking),this.hls.browTizen2&&!this.textTrack1){var textTrack1=this.createTextTrack("captions",this.config.captionsTextTrack1Label,this.config.captionsTextTrack1LanguageCode);textTrack1&&(textTrack1.textTrack1=!0,this.textTrack1=textTrack1,this.hls.trigger(_events2.default.TEXT_TRACK_ADDED,{track:this.textTrack1}))}}},{key:"onMediaDetaching",value:function(){this.media&&this.captionsOnSeekWorkaround&&this.media.removeEventListener("seeking",this.onvseeking),clearCurrentCues(this.textTrack1),clearCurrentCues(this.textTrack2)}},{key:"onMediaSeeking",value:function(){var media=this.media,levelController=this.hls.levelController,preFlushed=this.preFlushed;this.preFlushed=!1,media&&media.textTracks.length&&media.textTracks[0].cues.length&&media.textTracks[0].cues[media.textTracks[0].cues.length-1].endTime>media.currentTime&&levelController.chunkIDAtTime(media.textTracks[0].cues[media.textTracks[0].cues.length-1].endTime)!==levelController.chunkIDAtTime(media.currentTime)&&(preFlushed||this.hls.trigger(_events2.default.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY}),this.clearAllCues())}},{key:"onManifestLoading",value:function(){this.lastSn=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0};var media=this.media;if(media){var textTracks=media.textTracks;if(textTracks)for(var i=0;i<textTracks.length;i++)clearCurrentCues(textTracks[i])}}},{key:"onManifestLoaded",value:function(data){var _this3=this;if(this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=void 0,this.cueRanges=[],this.config.enableWebVTT){this.tracks=data.subtitles||[];var inUseTracks=this.media?this.media.textTracks:[];this.tracks.forEach(function(track,index){var textTrack=void 0,inUseTrack=inUseTracks[index];textTrack=reuseVttTextTrack(inUseTrack,track)?inUseTrack:_this3.createTextTrack("subtitles",track.name,track.lang),textTrack&&(textTrack.mode=track.default?"showing":"hidden",_this3.textTracks.push(textTrack))})}}},{key:"onLevelSwitching",value:function(){this.enabled="NONE"!==this.hls.currentLevel.closedCaptions}},{key:"onFragLoaded",value:function(data){var frag=data.frag,payload=data.payload;if("main"===frag.type){var sn=frag.sn;sn!==this.lastSn+1&&this.cea608Parser.reset(),this.lastSn=sn}else if("subtitle"===frag.type)if(payload.byteLength){if("undefined"===typeof this.initPTS)return this.unparsedVttFrags.push(data),void 0;var vttCCs=this.vttCCs;vttCCs[frag.cc]||(vttCCs[frag.cc]={start:frag.start,prevCC:this.prevCC,new:!0},this.prevCC=frag.cc);var textTracks=this.textTracks,hls=this.hls;_webvttParser2.default.parse(payload,this.initPTS,vttCCs,frag.cc,function(cues){cues.forEach(function(cue){textTracks[frag.trackId].addCue(cue)}),hls.trigger(_events2.default.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:frag})},function(e){_logger.logger.log("Failed to parse VTT cue: "+e),hls.trigger(_events2.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:frag})})}else this.hls.trigger(_events2.default.SUBTITLE_FRAG_PROCESSED,{
success:!1,frag:frag})}},{key:"onTextTrackChanged",value:function(){this.clearAllCues()}},{key:"onFragParsingUserdata",value:function(data){if(this.enabled&&this.config.enableCEA708Captions)for(var i=0;i<data.samples.length;i++){var ccdatas=this.extractCea608Data(data.samples[i].bytes);this.cea608Parser.addData(data.samples[i].pts,ccdatas)}}},{key:"extractCea608Data",value:function(byteArray){for(var count=31&byteArray[0],position=2,tmpByte=void 0,ccbyte1=void 0,ccbyte2=void 0,ccValid=void 0,ccType=void 0,actualCCBytes=[],j=0;j<count;j++)tmpByte=byteArray[position++],ccbyte1=127&byteArray[position++],ccbyte2=127&byteArray[position++],ccValid=0!==(4&tmpByte),ccType=3&tmpByte,0===ccbyte1&&0===ccbyte2||ccValid&&0===ccType&&(actualCCBytes.push(ccbyte1),actualCCBytes.push(ccbyte2));return actualCCBytes}}]),TimelineController}(_eventHandler2.default);exports.default=TimelineController,module.exports=exports["default"]},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_events=__webpack_require__(3),_events2=_interopRequireDefault(_events),_errors=__webpack_require__(4),_playlistLoader=__webpack_require__(132),_playlistLoader2=_interopRequireDefault(_playlistLoader),_fragmentLoader=__webpack_require__(131),_fragmentLoader2=_interopRequireDefault(_fragmentLoader),_keyLoader=__webpack_require__(70),_keyLoader2=_interopRequireDefault(_keyLoader),_streamController=__webpack_require__(125),_streamController2=_interopRequireDefault(_streamController),_levelController=__webpack_require__(124),_levelController2=_interopRequireDefault(_levelController),_streamCoordinator=__webpack_require__(126),_streamCoordinator2=_interopRequireDefault(_streamCoordinator),_LicenseManager=__webpack_require__(115),_LicenseManager2=_interopRequireDefault(_LicenseManager),_logger=__webpack_require__(1),_events3=__webpack_require__(60),_events4=_interopRequireDefault(_events3),_config=__webpack_require__(117),_HlsUtils=__webpack_require__(6),_HlsUtils2=_interopRequireDefault(_HlsUtils);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var Hls=function(){_createClass(Hls,null,[{key:"isSupported",value:function(){return window.MediaSource=window.MediaSource||window.WebKitMediaSource,window.MediaSource&&"function"===typeof window.MediaSource.isTypeSupported&&window.MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"')}},{key:"version",get:function(){return"3.2.1"}},{key:"Events",get:function(){return _events2.default}},{key:"ErrorTypes",get:function(){return _errors.ErrorTypes}},{key:"ErrorDetails",get:function(){return _errors.ErrorDetails}},{key:"DefaultConfig",get:function(){return Hls.defaultConfig?Hls.defaultConfig:_config.hlsDefaultConfig},set:function(defaultConfig){Hls.defaultConfig=defaultConfig}}]);function Hls(){var config=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,Hls);var defaultConfig=Hls.DefaultConfig;if((config.liveSyncDurationCount||config.liveMaxLatencyDurationCount)&&(config.liveSyncDuration||config.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");for(var prop in defaultConfig)prop in config||(config[prop]=defaultConfig[prop]);if(void 0!==config.liveMaxLatencyDurationCount&&config.liveMaxLatencyDurationCount<=config.liveSyncDurationCount)throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be gt "liveSyncDurationCount"');if(void 0!==config.liveMaxLatencyDuration&&(config.liveMaxLatencyDuration<=config.liveSyncDuration||void 0===config.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be gt "liveSyncDuration"');(0,_logger.enableLogs)(config.debug),this.config=config,this._autoLevelCapping=-1,this._minAutoBitrate=this.config.minAutoBitrate;var observer=this.observer=new _events4.default;observer.trigger=function(event){for(var _len=arguments.length,data=Array(_len>1?_len-1:0),_key=1;_key<_len;_key++)data[_key-1]=arguments[_key];observer.emit.apply(observer,[event,event].concat(data))},observer.off=function(event){for(var _len2=arguments.length,data=Array(_len2>1?_len2-1:0),_key2=1;_key2<_len2;_key2++)data[_key2-1]=arguments[_key2];observer.removeListener.apply(observer,[event].concat(data))},this.on=observer.on.bind(observer),this.off=observer.off.bind(observer),this.trigger=observer.trigger.bind(observer),this.browChrome=_HlsUtils2.default.isChrome(),this.browEdge=_HlsUtils2.default.isEdge(),this.browIE=_HlsUtils2.default.isIE(),this.browIE81=_HlsUtils2.default.isIEWin8Point1(),this.browFirefox=_HlsUtils2.default.isFirefox(),this.browSafari=_HlsUtils2.default.isSafari(),this.browTizen2=_HlsUtils2.default.isTizen2(),this.browTizen3=_HlsUtils2.default.isTizen3(),this._useSlowDetach=!1,this._inSlowDetach=!1,this.browSafari&&(this._useSlowDetach=!0),this._preBufferSeeks=!1,this.browIE81&&(this._preBufferSeeks=!0);var abrController=this.abrController=new config.abrController(this),bufferController=this.bufferController=new config.bufferController(this),capLevelController=new config.capLevelController(this),fpsController=new config.fpsController(this),playListLoader=new _playlistLoader2.default(this),fragmentLoader=new _fragmentLoader2.default(this),levelController=(this.keyLoader=new _keyLoader2.default(this),this.levelController=new _levelController2.default(this)),streamController=this.streamController=new _streamController2.default(this),networkControllers=[levelController,streamController];this.streamCoordinator=new _streamCoordinator2.default(this);if(config.obtainKeySystemConfigCallback){this.licenseManager=new _LicenseManager2.default(this,config.obtainKeySystemConfigCallback)}var Controller=config.audioStreamController;Controller&&(this.audioStreamController=new Controller(this),networkControllers.push(this.audioStreamController)),this.networkControllers=networkControllers;var coreComponents=[playListLoader,fragmentLoader,abrController,bufferController,capLevelController,fpsController];if(Controller=config.audioTrackController,Controller){var audioTrackController=new Controller(this);this.audioTrackController=audioTrackController,coreComponents.push(audioTrackController)}if(Controller=config.subtitleTrackController,Controller){var subtitleTrackController=new Controller(this);this.subtitleTrackController=subtitleTrackController,coreComponents.push(subtitleTrackController)}if(Controller=config.subtitleStreamController,Controller){var subtitleStreamController=new Controller(this);coreComponents.push(subtitleStreamController)}if(Controller=config.timelineController,Controller){var timelineController=new Controller(this);this.timelineController=timelineController,coreComponents.push(timelineController)}this.coreComponents=coreComponents}return _createClass(Hls,[{key:"destroy",value:function(){_logger.logger.log("hlsjs destroy"),this.trigger(_events2.default.DESTROYING),this.detachMedia(),this.coreComponents.push(this.keyLoader),this.coreComponents.concat(this.networkControllers).forEach(function(component){component.destroy()}),this.streamCoordinator.dispose(),this.url=null,this.observer.removeAllListeners(),this._autoLevelCapping=-1}},{key:"attachMedia",value:function(media){_logger.logger.log("hlsjs attachMedia"),this.media=media instanceof HTMLMediaElement?media:null,this.trigger(this.media?_events2.default.MEDIA_ATTACHING:_events2.default.MEDIA_DETACHED,{media:this.media})}},{key:"detachMedia",value:function(){_logger.logger.log("hlsjs detachMedia"),!this._useSlowDetach||!this.media||0===this.media.buffered.length||this.media.buffered.end(this.media.buffered.length-1)+1<this.media.currentTime?(this.trigger(_events2.default.MEDIA_DETACHING),this.media=null):this._inSlowDetach||(_logger.logger.log("slow detach start"),this._inSlowDetach=!0,this.stopFetch(),this.stopLoad(),this.media.currentTime=this.media.buffered.end(this.media.buffered.length-1)-.5)}},{key:"loadSource",value:function(url){this.url=url,this.trigger(_events2.default.MANIFEST_LOADING,{url:url})}},{key:"startLoad",value:function(){var startPosition=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,liveStreamsStartAtLiveTime=arguments.length>1&&void 0!==arguments[1]&&arguments[1];_logger.logger.log("startLoad("+startPosition+", LSSALT: "+liveStreamsStartAtLiveTime+")"),this.streamCoordinator.startTime=startPosition,this.streamCoordinator.liveStreamsStartAtLiveTime=liveStreamsStartAtLiveTime,this.networkControllers.forEach(function(controller){controller.startLoad()})}},{key:"stopLoad",value:function(){_logger.logger.log("stopLoad"),this.networkControllers.forEach(function(controller){controller.stopLoad()}),this.audioTrackController&&this.audioTrackController.stopLoad()}},{key:"stopFetch",value:function(){_logger.logger.log("stopFetch"),this.streamController.forceStopFetching=!0,this.audioStreamController&&(this.audioStreamController.forceStopFetching=!0)}},{key:"resumeFetch",value:function(){arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;_logger.logger.log("resumeFetch"),this.streamCoordinator.resetStreamTimeout(),this.streamController.forceStopFetching=!1,this.audioStreamController&&(this.audioStreamController.forceStopFetching=!1)}},{key:"swapAudioCodec",value:function(){_logger.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}},{key:"recoverMediaError",value:function(){_logger.logger.log("recoverMediaError");var media=this.media;this.detachMedia(),this.attachMedia(media)}},{key:"flushBuffers",value:function(levelFlush){return this.media?this.levelController.chunkIDAtTime(this.media.currentTime)!==-1?(levelFlush&&!this.browSafari?(this.loadLevel=-1,this.bufferController.flushLevels(0,Number.POSITIVE_INFINITY,this.levelController.chunkIDAtTime(this.media.currentTime))):(this.trigger(_events2.default.BUFFER_FLUSHING,{startOffset:this.levelController.endOfChunk(this.levelController.chunkIDAtTime(this.media.currentTime)+1),endOffset:Number.POSITIVE_INFINITY}),this.trigger(_events2.default.BUFFER_FLUSHING,{startOffset:Number.NEGATIVE_INFINITY,endOffset:this.levelController.endOfChunk(this.levelController.chunkIDAtTime(this.media.currentTime)-1)})),!0):(_logger.logger.log("cannot flush buffers: cannot find chunk timestamps"),!1):(_logger.logger.log("cannot flush buffers: media not attached"),!1)}},{key:"startPositionPdt",value:function(value){this.streamCoordinator.startPdt=value}},{key:"_doCompleteSlowDetach",value:function(){this.trigger(_events2.default.MEDIA_DETACHING),this.media=null,this.resumeFetch(),this._inSlowDetach=!1}},{key:"getTimeForPdt",value:function(pdt){return this.streamCoordinator.getTimeForPdt(pdt)}},{key:"getPdtForTime",value:function(time){return this.streamCoordinator.getPdtForTime(time)}},{key:"getCdmListAsync",value:function(){return this.licenseManager.drmCapabilities}},{key:"levels",get:function(){return this.levelController.levels}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(newLevel){_logger.logger.log("set currentLevel:"+newLevel),this.loadLevel=newLevel,this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(newLevel){_logger.logger.log("set nextLevel:"+newLevel),this.levelController.manualLevel=newLevel,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(newLevel){_logger.logger.log("set loadLevel:"+newLevel),this.levelController.manualLevel=newLevel}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(level){this.levelController.nextLoadLevel=level}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(newLevel){_logger.logger.log("set firstLevel:"+newLevel),this.levelController.firstLevel=newLevel}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(newLevel){_logger.logger.log("set startLevel:"+newLevel);var hls=this;newLevel!==-1&&(newLevel=Math.max(newLevel,hls.minAutoLevel)),hls.levelController.startLevel=newLevel}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(newLevel){_logger.logger.log("set autoLevelCapping:"+newLevel),this._autoLevelCapping=newLevel}},{key:"minAutoBitrate",get:function(){return this._minAutoBitrate},set:function(newBitrate){_logger.logger.log("set minAutoBitrate:"+newBitrate),this._minAutoBitrate=newBitrate}},{key:"autoLevelEnabled",get:function(){return this.levelController.manualLevel===-1}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){for(var hls=this,levels=hls.levels,minAutoBitrate=hls.minAutoBitrate,len=levels?levels.length:0,i=0;i<len;i++){var levelNextBitrate=levels[i].realBitrate?Math.max(levels[i].realBitrate,levels[i].bitrate):levels[i].bitrate;if(levelNextBitrate>minAutoBitrate)return i}return 0}},{key:"maxAutoLevel",get:function(){var hls=this,levels=hls.levels,autoLevelCapping=hls.autoLevelCapping,maxAutoLevel=void 0;return maxAutoLevel=autoLevelCapping===-1&&levels&&levels.length?levels.length-1:autoLevelCapping,maxAutoLevel}},{key:"nextAutoLevel",get:function(){var hls=this;return Math.min(Math.max(hls.abrController.nextAutoLevel,hls.minAutoLevel),hls.maxAutoLevel)},set:function(nextLevel){var hls=this;hls.abrController.nextAutoLevel=Math.max(hls.minAutoLevel,nextLevel)}},{key:"audioTracks",get:function(){var audioTrackController=this.audioTrackController;return audioTrackController?audioTrackController.audioTracks:[]}},{key:"audioTrack",get:function(){var audioTrackController=this.audioTrackController;return audioTrackController?audioTrackController.audioTrack:-1},set:function(audioTrackId){var audioTrackController=this.audioTrackController;audioTrackController&&(audioTrackController.audioTrack=audioTrackId),this.bufferController.sourceBuffer["audio"]&&(this.browSafari?this.trigger(_events2.default.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY}):this.trigger(_events2.default.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}))}},{key:"liveSyncPosition",get:function(){return this.streamController.liveSyncPosition}},{key:"subtitleTracks",get:function(){var subtitleTrackController=this.subtitleTrackController;return subtitleTrackController?subtitleTrackController.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var subtitleTrackController=this.subtitleTrackController;return subtitleTrackController?subtitleTrackController.subtitleTrack:-1},set:function(subtitleTrackId){var subtitleTrackController=this.subtitleTrackController;subtitleTrackController&&(subtitleTrackController.subtitleTrack=subtitleTrackId)}},{key:"subtitleIndex",set:function(value){this.trigger(_events2.default.TEXT_TRACK_CHANGED,{index:value})}},{key:"resumeBasePdt",set:function(value){this.streamCoordinator.resumeBasePdt=value}},{key:"timeouts",set:function(value){this.config.manifestLoadingTimeOut=value.manifestTimeout,this.config.manifestLoadingMaxRetryTimeout=value.manifestTimeoutMax,this.config.levelLoadingTimeOut=value.variantTimeout,this.config.levelLoadingMaxRetryTimeout=value.variantTimeoutMax,this.config.fragLoadingTimeOut=value.chunkTimeout,this.config.fragLoadingMaxRetryTimeout=value.chunkTimeoutMax,this.config.streamTimeOut=value.streamTimeout}},{key:"bufferBeforeSeeking",set:function(seconds){void 0===this.streamController.bufferBeforeSeeking&&(this.timelineController.preFlushed=!0,this.trigger(_events2.default.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY}),this.trigger(_events2.default.BUFFER_FLUSHING,{startOffset:Number.NEGATIVE_INFINITY,endOffset:0})),this.streamController.bufferBeforeSeeking=seconds,this.streamCoordinator.checkIfRenditionsAreActive&&(this.audioStreamController.bufferBeforeSeeking=seconds)}}]),Hls}();exports.default=Hls,module.exports=exports["default"]},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_events=__webpack_require__(3),_events2=_interopRequireDefault(_events),_eventHandler=__webpack_require__(5),_eventHandler2=_interopRequireDefault(_eventHandler),_errors=__webpack_require__(4),_dataTypes=__webpack_require__(37),_dataTypes2=_interopRequireDefault(_dataTypes);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!==typeof call&&"function"!==typeof call?self:call}function _inherits(subClass,superClass){if("function"!==typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var FragmentLoader=function(_EventHandler){_inherits(FragmentLoader,_EventHandler);function FragmentLoader(hls){_classCallCheck(this,FragmentLoader);var _this=_possibleConstructorReturn(this,(FragmentLoader.__proto__||Object.getPrototypeOf(FragmentLoader)).call(this,hls,_events2.default.FRAG_LOADING,_events2.default.ERROR));return _this.loaders={},_this}return _createClass(FragmentLoader,[{key:"destroy",value:function(){var loaders=this.loaders;for(var loaderName in loaders){var loader=loaders[loaderName];loader&&loader.destroy()}this.loaders={},_eventHandler2.default.prototype.destroy.call(this)}},{key:"onError",value:function(data){if(data.fatal)for(var loaderName in this.loaders)this.loaders[loaderName]&&this.loaders[loaderName].abort()}},{key:"onFragLoading",value:function(data){var frag=data.frag,type=frag.type,loader=this.loaders[type],config=this.hls.config;frag.loaded=0,loader?loader.abort():loader=this.loaders[type]=frag.loader="undefined"!==typeof config.fLoader?new config.fLoader(config):new config.loader(config),frag.loader=loader;var loaderContext=void 0,loaderConfig=void 0,loaderCallbacks=void 0;loaderContext={url:frag.url,frag:frag,responseType:"arraybuffer",progressData:!1,dataType:_dataTypes2.default.CHUNK};var start=frag.byteRangeStartOffset,end=frag.byteRangeEndOffset;isNaN(start)||isNaN(end)||(loaderContext.rangeStart=start,loaderContext.rangeEnd=end),loaderConfig={timeout:config.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:config.fragLoadingMaxRetryTimeout},loaderCallbacks={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this),onProgress:this.loadprogress.bind(this)},loader.load(loaderContext,loaderConfig,loaderCallbacks)}},{key:"loadsuccess",value:function(response,stats,context){var payload=response.data,frag=context.frag;frag.loader=void 0,this.hls.trigger(_events2.default.FRAG_LOADED,{payload:payload,frag:frag,stats:stats})}},{key:"loaderror",value:function(response,context){var loader=context.loader;loader&&loader.abort(),this.hls.trigger(_events2.default.ERROR,{type:_errors.ErrorTypes.NETWORK_ERROR,details:_errors.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:context.frag,response:response})}},{key:"loadtimeout",value:function(stats,context){var loader=context.loader;loader&&loader.abort(),this.hls.trigger(_events2.default.ERROR,{type:_errors.ErrorTypes.NETWORK_ERROR,details:_errors.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:context.frag})}},{key:"loadprogress",value:function(stats,context){var frag=context.frag;frag.loaded=stats.loaded,this.hls.trigger(_events2.default.FRAG_LOAD_PROGRESS,{frag:frag,stats:stats})}}]),FragmentLoader}(_eventHandler2.default);exports.default=FragmentLoader,module.exports=exports["default"]},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_urlToolkit=__webpack_require__(216),_urlToolkit2=_interopRequireDefault(_urlToolkit),_events=__webpack_require__(3),_events2=_interopRequireDefault(_events),_eventHandler=__webpack_require__(5),_eventHandler2=_interopRequireDefault(_eventHandler),_errors=__webpack_require__(4),_attrList=__webpack_require__(133),_attrList2=_interopRequireDefault(_attrList),_logger=__webpack_require__(1),_dataTypes=__webpack_require__(37),_dataTypes2=_interopRequireDefault(_dataTypes),_hlsDateRange=__webpack_require__(164),_hlsDateRange2=_interopRequireDefault(_hlsDateRange);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!==typeof call&&"function"!==typeof call?self:call}function _inherits(subClass,superClass){if("function"!==typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var MASTER_PLAYLIST_REGEX=/#EXT-X-STREAM-INF:([^\n\r]*)[\r\n]+([^\r\n]+)/g,MASTER_PLAYLIST_MEDIA_REGEX=/#EXT-X-MEDIA:(.*)/g,LEVEL_PLAYLIST_REGEX_FAST=/#EXTINF:(\d*(?:\.\d+)?)(?:,(.*))?|(?!#)(\S.+)|#EXT-X-BYTERANGE: *(.+)|#EXT-X-PROGRAM-DATE-TIME:(.+)|#EXT-X-DATERANGE: *(.+)|#.*/g,LEVEL_PLAYLIST_REGEX_SLOW=/(?:(?:#(EXTM3U))|(?:#EXT-X-(PLAYLIST-TYPE):(.+))|(?:#EXT-X-(MEDIA-SEQUENCE): *(\d+))|(?:#EXT-X-(TARGETDURATION): *(\d+))|(?:#EXT-X-(KEY):(.+))|(?:#EXT-X-(START):(.+))|(?:#EXT-X-(ENDLIST))|(?:#EXT-X-(DISCONTINUITY-SEQ)UENCE:(\d+))|(?:#EXT-X-(DIS)CONTINUITY))|(?:#EXT-X-(VERSION):(\d+))|(?:#EXT-X-(MAP):(.+))|(?:#EXT-X-(GAP))|(?:(#)(.*):(.*))|(?:(#)(.*))(?:.*)\r?\n?/,LevelKey=function(){function LevelKey(){_classCallCheck(this,LevelKey),this.method=null,this.key=null,this.iv=null,this._uri=null}return _createClass(LevelKey,[{key:"uri",get:function(){return!this._uri&&this.reluri&&(this._uri=_urlToolkit2.default.buildAbsoluteURL(this.baseuri,this.reluri,{alwaysNormalize:!0})),this._uri}}]),LevelKey}(),Fragment=function(){function Fragment(){_classCallCheck(this,Fragment),this._url=null,this._byteRange=null,this._decryptdata=null,this.tagList=[]}return _createClass(Fragment,[{key:"createInitializationVector",value:function(segmentNumber){for(var uint8View=new Uint8Array(16),i=12;i<16;i++)uint8View[i]=segmentNumber>>8*(15-i)&255;return uint8View}},{key:"fragmentDecryptdataFromLevelkey",value:function(levelkey,segmentNumber){var decryptdata=levelkey;return levelkey.method&&levelkey.uri&&!levelkey.iv&&(decryptdata=new LevelKey,decryptdata.method=levelkey.method,decryptdata.baseuri=levelkey.baseuri,decryptdata.reluri=levelkey.reluri,decryptdata.iv=this.createInitializationVector(segmentNumber)),decryptdata}},{key:"cloneObj",value:function(obj){return JSON.parse(JSON.stringify(obj))}},{key:"url",get:function(){return!this._url&&this.relurl&&(this._url=_urlToolkit2.default.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url},set:function(value){this._url=value}},{key:"programDateTime",get:function(){return!this._programDateTime&&this.rawProgramDateTime&&(this._programDateTime=new Date(Date.parse(this.rawProgramDateTime))),this._programDateTime}},{key:"byteRange",get:function(){if(!this._byteRange){var byteRange=this._byteRange=[];if(this.rawByteRange){var params=this.rawByteRange.split("@",2);if(1===params.length){var lastByteRangeEndOffset=this.lastByteRangeEndOffset;byteRange[0]=lastByteRangeEndOffset||0}else byteRange[0]=parseInt(params[1],10);byteRange[1]=parseInt(params[0],10)+byteRange[0]}}return this._byteRange}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"decryptdata",get:function(){return this._decryptdata||this.levelkeys||this.levelkey&&"SAMPLE-AES"!==this.levelkey.method&&"ISO-23001-7"!==this.levelkey.method&&"SAMPLE-AES-CTR"!==this.levelkey.method&&"SAMPLE-AES-CENC"!==this.levelkey.method&&(this._decryptdata=this.fragmentDecryptdataFromLevelkey(this.levelkey,this.sn)),this._decryptdata}}]),Fragment}(),PlaylistLoader=function(_EventHandler){_inherits(PlaylistLoader,_EventHandler);function PlaylistLoader(hls){_classCallCheck(this,PlaylistLoader);var _this=_possibleConstructorReturn(this,(PlaylistLoader.__proto__||Object.getPrototypeOf(PlaylistLoader)).call(this,hls,_events2.default.ERROR,_events2.default.MANIFEST_LOADING,_events2.default.LEVEL_LOADING,_events2.default.AUDIO_TRACK_LOADING,_events2.default.SUBTITLE_TRACK_LOADING));return _this.loaders={},_this.lastGap={},_this}return _createClass(PlaylistLoader,[{key:"destroy",value:function(){for(var loaderName in this.loaders){var loader=this.loaders[loaderName];loader&&loader.destroy()}this.loaders={},this.lastGap={},_eventHandler2.default.prototype.destroy.call(this)}},{key:"onManifestLoading",value:function(data){this.load(data.url,{type:"manifest"})}},{key:"onLevelLoading",value:function(data){this.load(data.url,{type:"level",level:data.level,id:data.id})}},{key:"onAudioTrackLoading",value:function(data){this.load(data.url,{type:"audioTrack",id:data.id})}},{key:"onSubtitleTrackLoading",value:function(data){this.load(data.url,{type:"subtitleTrack",id:data.id})}},{key:"onError",value:function(data){if(data.fatal)for(var loaderName in this.loaders)this.loaders[loaderName]&&this.loaders[loaderName].abort()}},{key:"load",value:function(url,context){var loader=this.loaders[context.type],config=this.hls.config,retry=void 0,timeout=void 0,retryDelay=void 0,maxRetryDelay=void 0;loader?loader.abort():loader=this.loaders[context.type]=context.loader="undefined"!==typeof config.pLoader?new config.pLoader(config):new config.loader(config),"manifest"===context.type?(retry=config.manifestLoadingMaxRetry,timeout=config.manifestLoadingTimeOut,retryDelay=config.manifestLoadingRetryDelay,maxRetryDelay=config.manifestLoadingMaxRetryTimeout):(retry=config.levelLoadingMaxRetry,timeout=config.levelLoadingTimeOut,retryDelay=config.levelLoadingRetryDelay,maxRetryDelay=config.levelLoadingMaxRetryTimeout,_logger.logger.log("loading playlist for "+context.type+" "+(context.level||context.id))),context.url=url,context.responseType="",context.dataType=_dataTypes2.default.MANIFEST;var loaderConfig=void 0,loaderCallbacks=void 0;loaderConfig={timeout:timeout,maxRetry:retry,retryDelay:retryDelay,maxRetryDelay:maxRetryDelay},loaderCallbacks={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)},loader.load(context,loaderConfig,loaderCallbacks)}},{key:"resolve",value:function(url,baseUrl){return _urlToolkit2.default.buildAbsoluteURL(baseUrl,url,{alwaysNormalize:!0})}},{key:"parseMasterPlaylist",value:function(string,baseurl){var levels=[],result=void 0;MASTER_PLAYLIST_REGEX.lastIndex=0;while(null!=(result=MASTER_PLAYLIST_REGEX.exec(string))){var level={},attrs=level.attrs=new _attrList2.default(result[1]);level.url=this.resolve(result[2],baseurl);var resolution=attrs.decimalResolution("RESOLUTION");resolution&&(level.width=resolution.width,level.height=resolution.height),level.bitrate=attrs.decimalInteger("AVERAGE-BANDWIDTH")||attrs.decimalInteger("BANDWIDTH"),level.name=attrs.NAME,level.audioGroup=attrs.AUDIO,0===levels.length?level.default=!0:level.default=!1;var codecs=attrs.CODECS;if(codecs){codecs=codecs.split(/[ ,]+/);for(var i=0;i<codecs.length;i++){var codec=codecs[i];codec.indexOf("avc1")!==-1?level.videoCodec=this.avc1toavcoti(codec):level.audioCodec=codec}}levels.push(level)}return levels}},{key:"parseMasterPlaylistMedia",value:function(string,baseurl,type){var result=void 0,medias=[],id=0;MASTER_PLAYLIST_MEDIA_REGEX.lastIndex=0;while(null!=(result=MASTER_PLAYLIST_MEDIA_REGEX.exec(string))){var media={},attrs=new _attrList2.default(result[1]);attrs.TYPE===type&&(media.groupId=attrs["GROUP-ID"],media.name=attrs.NAME,media.type=type,media.default="YES"===attrs.DEFAULT,media.autoselect="YES"===attrs.AUTOSELECT,media.forced="YES"===attrs.FORCED,attrs.URI&&(media.url=this.resolve(attrs.URI,baseurl)),media.lang=attrs.LANGUAGE,media.name||(media.name=media.lang),media.id=id++,medias.push(media))}return medias}},{key:"parseMasterPlaylistMediaGrouped",value:function(string,baseurl,type){var result=void 0,medias=[],id=0;MASTER_PLAYLIST_MEDIA_REGEX.lastIndex=0;while(null!=(result=MASTER_PLAYLIST_MEDIA_REGEX.exec(string))){var rendition={},attrs=new _attrList2.default(result[1]);if(attrs.TYPE===type){rendition.groupId=attrs["GROUP-ID"],attrs.URI&&(rendition.url=this.resolve(attrs.URI,baseurl));for(var added=!1,i=0;i<medias.length;i++)medias[i].name===attrs.NAME&&(medias[i].renditions.push(rendition),added=!0);if(!added){var media={};media.name=attrs.NAME,media.type=type,media.default="YES"===attrs.DEFAULT,media.autoselect="YES"===attrs.AUTOSELECT,media.forced="YES"===attrs.FORCED,media.lang=attrs.LANGUAGE,media.name||(media.name=media.lang),media.id=id++,media.renditions=[rendition],medias.push(media)}}}return medias}},{key:"avc1toavcoti",value:function(codec){var result=void 0,avcdata=codec.split(".");return avcdata.length>2?(result=avcdata.shift()+".",result+=parseInt(avcdata.shift(),10).toString(16),result+=("000"+parseInt(avcdata.shift(),10).toString(16)).substr(-4)):result=codec,result}},{key:"parseLevelPlaylist",value:function(string,baseurl,id,type){var currentSN=0,totalduration=0,level={type:null,version:null,url:baseurl,fragments:[],live:!0,startSN:0},levelkeys=[],cc=0,prevFrag=null,frag=new Fragment,result=void 0,index=0,clearKeys=!1;LEVEL_PLAYLIST_REGEX_FAST.lastIndex=0;while(null!==(result=LEVEL_PLAYLIST_REGEX_FAST.exec(string))){var duration=result[1];if(duration){frag.duration=parseFloat(duration),frag.manifestDuration=frag.duration;var title=(" "+result[2]).slice(1);
if(frag.title=title||null,frag.tagList.push(title?["INF",duration,title]:["INF",duration]),result[2]){var pairs=result[2].split(","),i=void 0;for(i=0;i<pairs.length;i++){var pair=pairs[i].split("=");pair[0]=pair[0].trim(),"startDTS"===pair[0]?frag.startDTS=parseInt(pair[1],10):"nextDTS"===pair[0]?frag.nextDTS=parseInt(pair[1],10):"frames"===pair[0]&&(frag.frames=parseInt(pair[1],10))}}}else if(result[3]){if(!isNaN(frag.duration)){var sn=currentSN++,length=void 0;if(frag.index=index++,frag.type=type,frag.start=totalduration,levelkeys&&levelkeys.length&&(frag.levelkey=levelkeys[levelkeys.length-1]),frag.sn=sn,frag.level=id,frag.cc=cc,frag.baseurl=baseurl,frag.relurl=(" "+result[3]).slice(1),level.fragments.push(frag),length=level.fragments.length,frag.rawProgramDateTime){var _i=void 0;if(frag.pdt=Date.parse(frag.rawProgramDateTime),length>1){if(level.fragments[length-2].pdt&&level.fragments[length-2].pdt+1e3*level.fragments[length-2].manifestDuration<level.fragments[length-1].pdt-500*level.fragments[length-1].manifestDuration){level.fragments[length-1].gap=level.fragments[length-1].pdt-(level.fragments[length-2].pdt+1e3*level.fragments[length-2].manifestDuration);var identifier=type+id;if(void 0===this.lastGap[identifier]||this.lastGap[identifier]<level.fragments[length-1].pdt){this.lastGap[identifier]=level.fragments[length-1].pdt;var data={type:_errors.ErrorTypes.MUX_ERROR,details:_errors.ErrorDetails.LEVEL_UNEXPECTED_GAP_ERROR,fatal:!1,playlistType:type,level:id,gapTime:level.fragments[length-1].start,gapStartPdt:level.fragments[length-2].pdt+1e3*level.fragments[length-2].duration,gapEndPdt:level.fragments[length-1].pdt,gapDuration:level.fragments[length-1].gap};_logger.logger.warn("gap detected in "+type+", level "+id+", time "+data.gapTime+", length "+data.gapDuration/1e3),this.hls.trigger(_events2.default.ERROR,data)}this.hls.streamController.altAudio===!0&&(totalduration+=level.fragments[length-1].gap/1e3),level.fragments[length-2].manifestDuration+=level.fragments[length-1].gap/1e3}for(_i=length-2;_i>=0&&void 0===level.fragments[_i].pdt;_i--)level.fragments[_i].pdt=level.fragments[_i+1].pdt-1e3*level.fragments[_i].manifestDuration}}else length>1&&level.fragments[length-2].pdt&&(level.fragments[length-1].pdt=level.fragments[length-2].pdt+1e3*level.fragments[length-2].duration);prevFrag=frag,totalduration+=frag.duration,frag=new Fragment}clearKeys=!0}else if(result[4]){if(frag.rawByteRange=(" "+result[4]).slice(1),prevFrag){var lastByteRangeEndOffset=prevFrag.byteRangeEndOffset;lastByteRangeEndOffset&&(frag.lastByteRangeEndOffset=lastByteRangeEndOffset)}}else if(result[6]){var thisRange=new _hlsDateRange2.default(result[6]);frag.dateRange=thisRange,frag.tagList.push(["DATERANGE",frag.dateRange])}else if(result[5])frag.rawProgramDateTime=(" "+result[5]).slice(1),frag.tagList.push(["PROGRAM-DATE-TIME",frag.rawProgramDateTime]);else{var _i2=void 0;for(result=result[0].match(LEVEL_PLAYLIST_REGEX_SLOW),_i2=1;_i2<result.length;_i2++)if(void 0!==result[_i2])break;var value1=(" "+result[_i2+1]).slice(1),value2=(" "+result[_i2+2]).slice(1);switch(result[_i2]){case"#":frag.tagList.push(value2?[value1,value2]:[value1]);break;case"PLAYLIST-TYPE":level.type=value1.toUpperCase();break;case"MEDIA-SEQUENCE":currentSN=level.startSN=parseInt(value1,10);break;case"TARGETDURATION":level.targetduration=parseFloat(value1);break;case"VERSION":level.version=parseInt(value1,10);break;case"EXTM3U":break;case"ENDLIST":level.live=!1;break;case"DIS":cc++,frag.tagList.push(["DIS"]);break;case"DISCONTINUITY-SEQ":cc=parseInt(value1,10);break;case"GAP":frag.tagList.push("GAP");break;case"KEY":var decryptparams=value1,keyAttrs=new _attrList2.default(decryptparams),decryptmethod=keyAttrs.enumeratedString("METHOD"),decrypturi=keyAttrs.URI,decryptiv=keyAttrs.hexadecimalInteger("IV"),decryptkid=null,decryptFormat="identity",decryptFormatVersions="1";if(keyAttrs["X-MLB-KEYID"]){var value=keyAttrs["X-MLB-KEYID"];"0"===value[0]&&"x"===value[1]||(value="0x"+value),value=value.replace(/-/g,""),keyAttrs["X-MLB-KEYID"]=value,decryptkid=keyAttrs.hexadecimalInteger("X-MLB-KEYID")}if(keyAttrs.enumeratedString("KEYFORMAT")&&(decryptFormat=keyAttrs.enumeratedString("KEYFORMAT")),keyAttrs.enumeratedString("KEYFORMATVERSIONS")&&(decryptFormatVersions=keyAttrs.enumeratedString("KEYFORMATVERSIONS")),decryptmethod){clearKeys&&(levelkeys=[],clearKeys=!1);var levelkey=new LevelKey;decrypturi&&["AES-128","SAMPLE-AES","ISO-23001-7","SAMPLE-AES-CTR","SAMPLE-AES-CENC"].indexOf(decryptmethod)>=0&&(levelkey.method=decryptmethod,levelkey.baseuri=baseurl,levelkey.reluri=decrypturi,levelkey.key=null,levelkey.iv=decryptiv,levelkey.kid=decryptkid,levelkey.format=decryptFormat,levelkey.formatVersions=decryptFormatVersions),levelkeys.push(levelkey)}break;case"START":var startParams=value1,startAttrs=new _attrList2.default(startParams),startTimeOffset=startAttrs.decimalFloatingPoint("TIME-OFFSET");isNaN(startTimeOffset)||(level.startTimeOffset=startTimeOffset);break;case"MAP":var mapAttrs=new _attrList2.default(value1);frag.relurl=mapAttrs.URI,frag.rawByteRange=mapAttrs.BYTERANGE,frag.baseurl=baseurl,frag.level=id,frag.type=type,frag.sn="initSegment",frag.levelkeys=levelkeys,level.initSegment=frag,frag=new Fragment;break;default:_logger.logger.warn("line parsed but not handled: "+result)}}}if(frag=prevFrag,frag&&!frag.relurl&&(level.fragments.pop(),totalduration-=frag.duration),level.fragments.length&&!level.fragments[0].pdt){var _i3=void 0;for(level.fragments[0].rawProgramDateTime="1997-08-29T00:00:00+00:00",level.fragments[0].pdt=Date.parse(level.fragments[0].rawProgramDateTime),_i3=1;_i3<level.fragments.length;_i3++)level.fragments[_i3].pdt=level.fragments[_i3-1].pdt+1e3*level.fragments[_i3-1].manifestDuration}return level.totalduration=totalduration,level.averagetargetduration=totalduration/level.fragments.length,level.endSN=currentSN-1,level}},{key:"loadsuccess",value:function(response,stats,context){var string=response.data,url=response.url,type=context.type,id=context.id,level=context.level,hls=this.hls;if(void 0!==url&&0!==url.indexOf("data:")||(url=context.url),stats.tload=performance.now(),0===string.indexOf("#EXTM3U"))if(string.indexOf("#EXTINF:")>0){var isLevel="audioTrack"!==type&&"subtitleTrack"!==type,levelId=isNaN(level)?isNaN(id)?0:id:level,levelDetails=this.parseLevelPlaylist(string,url,levelId,"audioTrack"===type?"audio":"subtitleTrack"===type?"subtitle":"main");levelDetails.tload=stats.tload,"manifest"===type&&hls.trigger(_events2.default.MANIFEST_LOADED,{levels:[{url:url,details:levelDetails}],audioTracks:[],url:url,stats:stats}),stats.tparsed=performance.now(),levelDetails.targetduration?isLevel?hls.trigger(_events2.default.LEVEL_LOADED,{details:levelDetails,level:level||0,id:id||0,stats:stats}):"audioTrack"===type?hls.trigger(_events2.default.AUDIO_TRACK_LOADED,{details:levelDetails,id:id,stats:stats}):"subtitleTrack"===type&&hls.trigger(_events2.default.SUBTITLE_TRACK_LOADED,{details:levelDetails,id:id,stats:stats}):hls.trigger(_events2.default.ERROR,{type:_errors.ErrorTypes.NETWORK_ERROR,details:_errors.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,url:url,reason:"invalid targetduration"})}else{var levels=this.parseMasterPlaylist(string,url);if(levels.length){var audioTracks=this.parseMasterPlaylistMediaGrouped(string,url,"AUDIO"),subtitles=this.parseMasterPlaylistMedia(string,url,"SUBTITLES");if(audioTracks.length){var embeddedAudioFound=!1;audioTracks.forEach(function(audioTrack){audioTrack.url||(embeddedAudioFound=!0)}),embeddedAudioFound===!1&&levels[0].audioCodec&&!levels[0].attrs.AUDIO&&(_logger.logger.log("audio codec signaled in quality level, but no embedded audio track signaled, create one"),audioTracks.unshift({type:"main",name:"main"}))}hls.trigger(_events2.default.MANIFEST_LOADED,{levels:levels,audioTracks:audioTracks,subtitles:subtitles,url:url,stats:stats})}else hls.trigger(_events2.default.ERROR,{type:_errors.ErrorTypes.NETWORK_ERROR,details:_errors.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,url:url,reason:"no level found in manifest"})}else hls.trigger(_events2.default.ERROR,{type:_errors.ErrorTypes.NETWORK_ERROR,details:_errors.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,url:url,reason:"no EXTM3U delimiter"})}},{key:"loaderror",value:function(response,context){var details=void 0,fatal=void 0,loader=context.loader;switch(context.type){case"manifest":details=_errors.ErrorDetails.MANIFEST_LOAD_ERROR,fatal=!0;break;case"level":details=_errors.ErrorDetails.LEVEL_LOAD_ERROR,fatal=!1;break;case"audioTrack":details=_errors.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal=!1}loader?(loader.abort(),this.hls.trigger(_events2.default.ERROR,{type:_errors.ErrorTypes.NETWORK_ERROR,details:details,fatal:fatal,url:loader.url,loader:loader,response:response,context:context})):this.hls.trigger(_events2.default.ERROR,{type:_errors.ErrorTypes.NETWORK_ERROR,details:details,fatal:fatal,response:response,context:context})}},{key:"loadtimeout",value:function(stats,context){var details=void 0,fatal=void 0,loader=context.loader;switch(context.type){case"manifest":details=_errors.ErrorDetails.MANIFEST_LOAD_TIMEOUT,fatal=!0;break;case"level":details=_errors.ErrorDetails.LEVEL_LOAD_TIMEOUT,fatal=!1;break;case"audioTrack":details=_errors.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT,fatal=!1}loader?(loader.abort(),this.hls.trigger(_events2.default.ERROR,{type:_errors.ErrorTypes.NETWORK_ERROR,details:details,fatal:fatal,url:loader.url,loader:loader,context:context})):this.hls.trigger(_events2.default.ERROR,{type:_errors.ErrorTypes.NETWORK_ERROR,details:details,fatal:fatal,context:context})}}]),PlaylistLoader}(_eventHandler2.default);exports.default=PlaylistLoader,module.exports=exports["default"]},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var MAX_SAFE_INTEGER=__webpack_require__(214),DECIMAL_RESOLUTION_REGEX=/^(\d+)x(\d+)$/,ATTR_LIST_REGEX=/\s*(.+?)\s*=((?:".*?")|.*?)(?:,|$)/g,AttrList=function(){function AttrList(attrs){_classCallCheck(this,AttrList);var myAttrs=attrs;"string"===typeof myAttrs&&(myAttrs=AttrList.parseAttrList(myAttrs));for(var attr in myAttrs)myAttrs.hasOwnProperty(attr)&&(this[attr]=myAttrs[attr])}return _createClass(AttrList,[{key:"decimalInteger",value:function(attrName){var intValue=parseInt(this[attrName],10);return intValue>MAX_SAFE_INTEGER?1/0:intValue}},{key:"hexadecimalInteger",value:function(attrName){if(this[attrName]){var stringValue=(this[attrName]||"0x").slice(2);stringValue=(1&stringValue.length?"0":"")+stringValue;for(var value=new Uint8Array(stringValue.length/2),i=0;i<stringValue.length/2;i++)value[i]=parseInt(stringValue.slice(2*i,2*i+2),16);return value}return null}},{key:"hexadecimalIntegerAsNumber",value:function(attrName){var intValue=parseInt(this[attrName],16);return intValue>MAX_SAFE_INTEGER?1/0:intValue}},{key:"decimalFloatingPoint",value:function(attrName){return parseFloat(this[attrName])}},{key:"enumeratedString",value:function(attrName){return this[attrName]}},{key:"decimalResolution",value:function(attrName){var res=DECIMAL_RESOLUTION_REGEX.exec(this[attrName]);if(null!==res)return{width:parseInt(res[1],10),height:parseInt(res[2],10)}}}],[{key:"parseAttrList",value:function(input){var match=void 0,attrs={},quote='"';ATTR_LIST_REGEX.lastIndex=0;while(null!==(match=ATTR_LIST_REGEX.exec(input))){var value=match[2];0===value.indexOf(quote)&&value.lastIndexOf(quote)===value.length-1&&(value=value.slice(1,-1)),attrs[match[1]]=value}return attrs}}]),AttrList}();exports.default=AttrList,module.exports=exports["default"]},function(module){"use strict";var BinarySearch={search:function(list,comparisonFunction){var minIndex=0,maxIndex=list.length-1,currentIndex=null,currentElement=null;while(minIndex<=maxIndex){currentIndex=(minIndex+maxIndex)/2|0,currentElement=list[currentIndex];var comparisonResult=comparisonFunction(currentElement);if(comparisonResult>0)minIndex=currentIndex+1;else{if(!(comparisonResult<0))return currentElement;maxIndex=currentIndex-1}}return null}};module.exports=BinarySearch},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_logger=__webpack_require__(1);function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var specialCea608CharsCodes={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},getCharForByte=function(byte){var charCode=byte;return specialCea608CharsCodes.hasOwnProperty(byte)&&(charCode=specialCea608CharsCodes[byte]),String.fromCharCode(charCode)},NR_ROWS=15,NR_COLS=100,rowsLowCh1={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},rowsHighCh1={17:2,18:4,21:6,22:8,23:10,19:13,20:15},rowsLowCh2={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},rowsHighCh2={25:2,26:4,29:6,30:8,31:10,27:13,28:15},backgroundColors=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],logger={verboseFilter:{DATA:3,DEBUG:3,INFO:2,WARNING:2,TEXT:1,ERROR:0},time:null,verboseLevel:0,setTime:function(newTime){this.time=newTime},log:function(severity,msg){var minLevel=this.verboseFilter[severity];this.verboseLevel>=minLevel&&_logger.logger.log(this.time+" ["+severity+"] "+msg)}},numArrayToHexArray=function(numArray){for(var hexArray=[],j=0;j<numArray.length;j++)hexArray.push(numArray[j].toString(16));return hexArray},PenState=function(){function PenState(foreground,underline,italics,background,flash){_classCallCheck(this,PenState),this.foreground=foreground||"white",this.underline=underline||!1,this.italics=italics||!1,this.background=background||"black",this.flash=flash||!1}return _createClass(PenState,[{key:"reset",value:function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}},{key:"setStyles",value:function(styles){for(var attribs=["foreground","underline","italics","background","flash"],i=0;i<attribs.length;i++){var style=attribs[i];styles.hasOwnProperty(style)&&(this[style]=styles[style])}}},{key:"isDefault",value:function(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash}},{key:"equals",value:function(other){return this.foreground===other.foreground&&this.underline===other.underline&&this.italics===other.italics&&this.background===other.background&&this.flash===other.flash}},{key:"copy",value:function(newPenState){this.foreground=newPenState.foreground,this.underline=newPenState.underline,this.italics=newPenState.italics,this.background=newPenState.background,this.flash=newPenState.flash}},{key:"toString",value:function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}]),PenState}(),StyledUnicodeChar=function(){function StyledUnicodeChar(uchar,foreground,underline,italics,background,flash){_classCallCheck(this,StyledUnicodeChar),this.uchar=uchar||" ",this.penState=new PenState(foreground,underline,italics,background,flash)}return _createClass(StyledUnicodeChar,[{key:"reset",value:function(){this.uchar=" ",this.penState.reset()}},{key:"setChar",value:function(uchar,newPenState){this.uchar=uchar,this.penState.copy(newPenState)}},{key:"setPenState",value:function(newPenState){this.penState.copy(newPenState)}},{key:"equals",value:function(other){return this.uchar===other.uchar&&this.penState.equals(other.penState)}},{key:"copy",value:function(newChar){this.uchar=newChar.uchar,this.penState.copy(newChar.penState)}},{key:"isEmpty",value:function(){return" "===this.uchar&&this.penState.isDefault()}}]),StyledUnicodeChar}(),Row=function(){function Row(){_classCallCheck(this,Row),this.chars=[];for(var i=0;i<NR_COLS;i++)this.chars.push(new StyledUnicodeChar);this.pos=0,this.currPenState=new PenState}return _createClass(Row,[{key:"equals",value:function(other){for(var equal=!0,i=0;i<NR_COLS;i++)if(!this.chars[i].equals(other.chars[i])){equal=!1;break}return equal}},{key:"copy",value:function(other){for(var i=0;i<NR_COLS;i++)this.chars[i].copy(other.chars[i])}},{key:"isEmpty",value:function(){for(var empty=!0,i=0;i<NR_COLS;i++)if(!this.chars[i].isEmpty()){empty=!1;break}return empty}},{key:"setCursor",value:function(absPos){this.pos!==absPos&&(this.pos=absPos),this.pos<0?(logger.log("WARN","Negative cursor position "+this.pos),this.pos=0):this.pos>NR_COLS&&(logger.log("WARN","Too large cursor position "+this.pos),this.pos=NR_COLS)}},{key:"moveCursor",value:function(relPos){var newPos=this.pos+relPos;if(relPos>1)for(var i=this.pos+1;i<newPos+1;i++){var currChar=this.chars[i];void 0!==currChar&&null!==currChar?currChar.setPenState(this.currPenState):logger.log("WARN","Cannnot set PenState; char "+currChar)}this.setCursor(newPos)}},{key:"backSpace",value:function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}},{key:"insertChar",value:function(byte){byte>=144&&this.backSpace();var char=getCharForByte(byte);return this.pos>=NR_COLS?(logger.log("WARN","Cannot insert "+byte.toString(16)+" ("+char+") at position "+this.pos+". Skipping it!"),void 0):(this.chars[this.pos].setChar(char,this.currPenState),this.moveCursor(1),void 0)}},{key:"clearFromPos",value:function(startPos){var i;for(i=startPos;i<NR_COLS;i++)this.chars[i].reset()}},{key:"clear",value:function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}},{key:"clearToEndOfRow",value:function(){this.clearFromPos(this.pos)}},{key:"getTextString",value:function(){for(var chars=[],empty=!0,i=0;i<NR_COLS;i++){var char=this.chars[i].uchar;" "!==char&&(empty=!1),chars.push(char)}return empty?"":chars.join("")}},{key:"setPenStyles",value:function(styles){this.currPenState.setStyles(styles);var currChar=this.chars[this.pos];void 0!==currChar&&null!==currChar?currChar.setPenState(this.currPenState):logger.log("ERROR","Cannnot set PenState; char "+currChar)}}]),Row}(),CaptionScreen=function(){function CaptionScreen(){_classCallCheck(this,CaptionScreen),this.rows=[];for(var i=0;i<NR_ROWS;i++)this.rows.push(new Row);this.currRow=NR_ROWS-1,this.nrRollUpRows=null,this.reset()}return _createClass(CaptionScreen,[{key:"reset",value:function(){for(var i=0;i<NR_ROWS;i++)this.rows[i].clear();this.currRow=NR_ROWS-1}},{key:"equals",value:function(other){for(var equal=!0,i=0;i<NR_ROWS;i++)if(!this.rows[i].equals(other.rows[i])){equal=!1;break}return equal}},{key:"copy",value:function(other){for(var i=0;i<NR_ROWS;i++)this.rows[i].copy(other.rows[i])}},{key:"isEmpty",value:function(){for(var empty=!0,i=0;i<NR_ROWS;i++)if(!this.rows[i].isEmpty()){empty=!1;break}return empty}},{key:"backSpace",value:function(){var row=this.rows[this.currRow];row.backSpace()}},{key:"clearToEndOfRow",value:function(){var row=this.rows[this.currRow];row.clearToEndOfRow()}},{key:"insertChar",value:function(char){var row=this.rows[this.currRow];row.insertChar(char)}},{key:"setPen",value:function(styles){var row=this.rows[this.currRow];row.setPenStyles(styles)}},{key:"moveCursor",value:function(relPos){var row=this.rows[this.currRow];row.moveCursor(relPos)}},{key:"setCursor",value:function(absPos){logger.log("INFO","setCursor: "+absPos);var row=this.rows[this.currRow];row.setCursor(absPos)}},{key:"setPAC",value:function(pacData){logger.log("INFO","pacData = "+JSON.stringify(pacData));var newRow=pacData.row-1;if(this.nrRollUpRows&&newRow<this.nrRollUpRows-1&&(newRow=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==newRow){for(var i=0;i<NR_ROWS;i++)this.rows[i].clear();var topRowIndex=this.currRow+1-this.nrRollUpRows,lastOutputScreen=this.lastOutputScreen;if(lastOutputScreen){var prevLineTime=lastOutputScreen.rows[topRowIndex].cueStartTime;if(prevLineTime&&prevLineTime<logger.time)for(var _i=0;_i<this.nrRollUpRows;_i++)this.rows[newRow-this.nrRollUpRows+_i+1].copy(lastOutputScreen.rows[topRowIndex+_i])}}this.currRow=newRow;var row=this.rows[this.currRow];if(null!==pacData.indent){var indent=pacData.indent,prevPos=Math.max(indent-1,0);row.setCursor(pacData.indent),pacData.color=row.chars[prevPos].penState.foreground}var styles={foreground:pacData.color,underline:pacData.underline,italics:pacData.italics,background:"black",flash:!1};this.setPen(styles)}},{key:"setBkgData",value:function(bkgData){logger.log("INFO","bkgData = "+JSON.stringify(bkgData)),this.backSpace(),this.setPen(bkgData),this.insertChar(32)}},{key:"setRollUpRows",value:function(nrRows){this.nrRollUpRows=nrRows}},{key:"rollUp",value:function(){if(null===this.nrRollUpRows)return logger.log("DEBUG","roll_up but nrRollUpRows not set yet"),void 0;logger.log("TEXT",this.getDisplayText());var topRowIndex=this.currRow+1-this.nrRollUpRows,topRow=this.rows.splice(topRowIndex,1)[0];topRow.clear(),this.rows.splice(this.currRow,0,topRow),logger.log("INFO","Rolling up")}},{key:"getDisplayText",value:function(asOneRow){for(var myAsOneRow=asOneRow||!1,displayText=[],text="",rowNr=-1,i=0;i<NR_ROWS;i++){var rowText=this.rows[i].getTextString();rowText&&(rowNr=i+1,myAsOneRow?displayText.push("Row "+rowNr+": '"+rowText+"'"):displayText.push(rowText.trim()))}return displayText.length>0&&(text=myAsOneRow?"["+displayText.join(" | ")+"]":displayText.join("\n")),text}},{key:"getTextAndFormat",value:function(){return this.rows}}]),CaptionScreen}(),Cea608Channel=function(){function Cea608Channel(channelNumber,outputFilter){_classCallCheck(this,Cea608Channel),this.chNr=channelNumber,this.outputFilter=outputFilter,this.mode=null,this.verbose=0,this.displayedMemory=new CaptionScreen,this.nonDisplayedMemory=new CaptionScreen,this.lastOutputScreen=new CaptionScreen,this.currRollUpRow=this.displayedMemory.rows[NR_ROWS-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}return _createClass(Cea608Channel,[{key:"reset",value:function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.currRollUpRow=this.displayedMemory.rows[NR_ROWS-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.lastCueEndTime=null}},{key:"getHandler",value:function(){return this.outputFilter}},{key:"setHandler",value:function(newHandler){this.outputFilter=newHandler}},{key:"setPAC",value:function(pacData){this.writeScreen.setPAC(pacData)}},{key:"setBkgData",value:function(bkgData){this.writeScreen.setBkgData(bkgData)}},{key:"setMode",value:function(newMode){newMode!==this.mode&&(this.mode=newMode,logger.log("INFO","MODE="+newMode),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=newMode)}},{key:"insertChars",value:function(chars){for(var i=0;i<chars.length;i++)this.writeScreen.insertChar(chars[i]);var screen=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";logger.log("INFO",screen+": "+this.writeScreen.getDisplayText(!0)),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(logger.log("TEXT","DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}},{key:"ccRCL",value:function(){logger.log("INFO","RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}},{key:"ccBS",value:function(){logger.log("INFO","BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}},{key:"ccAOF",value:function(){}},{key:"ccAON",value:function(){}},{key:"ccDER",value:function(){logger.log("INFO","DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}},{key:"ccRU",value:function(nrRows){logger.log("INFO","RU("+nrRows+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(nrRows)}},{key:"ccFON",value:function(){logger.log("INFO","FON - Flash On"),this.writeScreen.setPen({flash:!0})}},{key:"ccRDC",value:function(){logger.log("INFO","RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}},{key:"ccTR",value:function(){logger.log("INFO","TR"),this.setMode("MODE_TEXT")}},{key:"ccRTD",value:function(){logger.log("INFO","RTD"),this.setMode("MODE_TEXT")}},{key:"ccEDM",value:function(){logger.log("INFO","EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate()}},{key:"ccCR",value:function(){logger.log("CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate()}},{key:"ccENM",value:function(){logger.log("INFO","ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}},{key:"ccEOC",value:function(){if(logger.log("INFO","EOC - End Of Caption"),"MODE_POP-ON"===this.mode){var tmp=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=tmp,this.writeScreen=this.nonDisplayedMemory,logger.log("TEXT","DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate()}},{key:"ccTO",value:function(nrCols){logger.log("INFO","TO("+nrCols+") - Tab Offset"),this.writeScreen.moveCursor(nrCols)}},{key:"ccMIDROW",value:function(secondByte){var styles={flash:!1};if(styles.underline=secondByte%2===1,styles.italics=secondByte>=46,styles.italics)styles.foreground="white";else{var colorIndex=Math.floor(secondByte/2)-16,colors=["white","green","blue","cyan","red","yellow","magenta"];styles.foreground=colors[colorIndex]}logger.log("INFO","MIDROW: "+JSON.stringify(styles)),this.writeScreen.setPen(styles)}},{key:"outputDataUpdate",value:function(){var t=logger.time;null!==t&&this.outputFilter&&(this.outputFilter.updateData&&this.outputFilter.updateData(t,this.displayedMemory),null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),this.cueStartTime=this.displayedMemory.isEmpty()?null:t):this.cueStartTime=t,this.lastOutputScreen.copy(this.displayedMemory))}},{key:"cueSplitAtTime",value:function(t){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,t,this.displayedMemory),this.cueStartTime=t))}}]),Cea608Channel}(),Cea608Parser=function(){function Cea608Parser(field,out1,out2){_classCallCheck(this,Cea608Parser),this.field=field||1,this.outputs=[out1,out2],this.channels=[new Cea608Channel(1,out1),new Cea608Channel(2,out2)],this.currChNr=-1,this.lastCmdA=null,this.lastCmdB=null,this.bufferedData=[],this.startTime=null,this.lastTime=null,this.dataCounters={padding:0,char:0,cmd:0,other:0}}return _createClass(Cea608Parser,[{key:"getHandler",value:function(index){return this.channels[index].getHandler()}},{key:"setHandler",value:function(index,newHandler){this.channels[index].setHandler(newHandler)}},{key:"addData",value:function(t,byteList){try{var cmdFound=void 0,a=void 0,b=void 0,charsFound=!1;this.lastTime=t,logger.setTime(t);for(var i=0;i<byteList.length;i+=2)if(a=127&byteList[i],b=127&byteList[i+1],0!==a||0!==b){if(logger.log("DATA","["+numArrayToHexArray([byteList[i],byteList[i+1]])+"] -> ("+numArrayToHexArray([a,b])+")"),cmdFound=this.parseCmd(a,b),cmdFound||(cmdFound=this.parseMidrow(a,b)),cmdFound||(cmdFound=this.parsePAC(a,b)),cmdFound||(cmdFound=this.parseBackgroundAttributes(a,b)),!cmdFound&&(charsFound=this.parseChars(a,b),charsFound))if(this.currChNr&&this.currChNr>=0){var channel=this.channels[this.currChNr-1];channel.insertChars(charsFound)}else logger.log("WARNING","No channel found yet. TEXT-MODE?");cmdFound?this.dataCounters.cmd+=2:charsFound?this.dataCounters.char+=2:(this.dataCounters.other+=2,logger.log("WARNING","Couldn't parse cleaned data "+numArrayToHexArray([a,b])+" orig: "+numArrayToHexArray([byteList[i],byteList[i+1]])))}else this.dataCounters.padding+=2}catch(err){if("SyntaxError"!==err.message)throw err;logger.log("WARNING","Syntax error while parsing")}}},{key:"parseCmd",value:function(a,b){var chNr=null,cond1=(20===a||28===a)&&b>=32&&b<=47,cond2=(23===a||31===a)&&b>=33&&b<=35;if(!cond1&&!cond2)return!1;if(a===this.lastCmdA&&b===this.lastCmdB)return this.lastCmdA=null,this.lastCmdB=null,logger.log("DEBUG","Repeated command ("+numArrayToHexArray([a,b])+") is dropped"),!0;chNr=20===a||23===a?1:2;var channel=this.channels[chNr-1];return 20===a||28===a?32===b?channel.ccRCL():33===b?channel.ccBS():34===b?channel.ccAOF():35===b?channel.ccAON():36===b?channel.ccDER():37===b?channel.ccRU(2):38===b?channel.ccRU(3):39===b?channel.ccRU(4):40===b?channel.ccFON():41===b?channel.ccRDC():42===b?channel.ccTR():43===b?channel.ccRTD():44===b?channel.ccEDM():45===b?channel.ccCR():46===b?channel.ccENM():47===b&&channel.ccEOC():channel.ccTO(b-32),this.lastCmdA=a,this.lastCmdB=b,this.currChNr=chNr,!0}},{key:"parseMidrow",value:function(a,b){var chNr=null;if((17===a||25===a)&&b>=32&&b<=47){if(chNr=17===a?1:2,chNr!==this.currChNr)return logger.log("ERROR","Mismatch channel in midrow parsing"),!1;var channel=this.channels[chNr-1];return channel.ccMIDROW(b),logger.log("DEBUG","MIDROW ("+numArrayToHexArray([a,b])+")"),!0}return!1}},{key:"parsePAC",value:function(a,b){var chNr=null,row=null,case1=(a>=17&&a<=23||a>=25&&a<=31)&&b>=64&&b<=127,case2=(16===a||24===a)&&b>=64&&b<=95;if(!case1&&!case2)return!1;if(a===this.lastCmdA&&b===this.lastCmdB)return this.lastCmdA=null,this.lastCmdB=null,!0;chNr=a<=23?1:2,row=b>=64&&b<=95?1===chNr?rowsLowCh1[a]:rowsLowCh2[a]:1===chNr?rowsHighCh1[a]:rowsHighCh2[a];var pacData=this.interpretPAC(row,b),channel=this.channels[chNr-1];return channel.setPAC(pacData),this.lastCmdA=a,this.lastCmdB=b,this.currChNr=chNr,!0}},{key:"interpretPAC",value:function(row,byte){var pacIndex=byte,pacData={color:null,italics:!1,indent:null,underline:!1,row:row};return pacIndex=byte>95?byte-96:byte-64,pacData.underline=1===(1&pacIndex),pacIndex<=13?pacData.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(pacIndex/2)]:pacIndex<=15?(pacData.italics=!0,pacData.color="white"):pacData.indent=4*Math.floor((pacIndex-16)/2),pacData}},{key:"parseChars",value:function(a,b){var channelNr=null,charCodes=null,charCode1=null;if(a>=25?(channelNr=2,charCode1=a-8):(channelNr=1,charCode1=a),charCode1>=17&&charCode1<=19){var oneCode=b;oneCode=17===charCode1?b+80:18===charCode1?b+112:b+144,
logger.log("INFO","Special char '"+getCharForByte(oneCode)+"' in channel "+channelNr),charCodes=[oneCode]}else a>=32&&a<=127&&(charCodes=0===b?[a]:[a,b]);if(charCodes){var hexCodes=numArrayToHexArray(charCodes);logger.log("DEBUG","Char codes =  "+hexCodes.join(",")),this.lastCmdA=null,this.lastCmdB=null}return charCodes}},{key:"parseBackgroundAttributes",value:function(a,b){var bkgData=void 0,index=void 0,chNr=void 0,channel=void 0,case1=(16===a||24===a)&&b>=32&&b<=47,case2=(23===a||31===a)&&b>=45&&b<=47;return!(!case1&&!case2)&&(bkgData={},16===a||24===a?(index=Math.floor((b-32)/2),bkgData.background=backgroundColors[index],b%2===1&&(bkgData.background=bkgData.background+"_semi")):45===b?bkgData.background="transparent":(bkgData.foreground="black",47===b&&(bkgData.underline=!0)),chNr=a<24?1:2,channel=this.channels[chNr-1],channel.setBkgData(bkgData),this.lastCmdA=null,this.lastCmdB=null,!0)}},{key:"reset",value:function(){for(var i=0;i<this.channels.length;i++)this.channels[i]&&this.channels[i].reset();this.lastCmdA=null,this.lastCmdB=null}},{key:"cueSplitAtTime",value:function(t){for(var i=0;i<this.channels.length;i++)this.channels[i]&&this.channels[i].cueSplitAtTime(t)}}]),Cea608Parser}();exports.default=Cea608Parser,module.exports=exports["default"]},function(module,exports,__webpack_require__){"use strict";var _vttparser=__webpack_require__(72),_detectBrowser=__webpack_require__(47),_detectBrowser2=_interopRequireDefault(_detectBrowser),_semver=__webpack_require__(99),_semver2=_interopRequireDefault(_semver);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var Cues={newCue:function(track,startTime,endTime,captionScreen){for(var row,cue,indenting,indent,text,myEndTime=endTime,VTTCue=window.VTTCue||window.TextTrackCue,browDetected=_detectBrowser2.default,r=0;r<captionScreen.rows.length;r++)if(row=captionScreen.rows[r],indenting=!0,indent=0,text="",!row.isEmpty()){for(var c=0;c<row.chars.length;c++)row.chars[c].uchar.match(/\s/)&&indenting?indent++:(text+=row.chars[c].uchar,indenting=!1);row.cueStartTime=startTime,startTime===myEndTime&&(myEndTime+=1e-4);try{cue=new VTTCue(startTime,myEndTime,(0,_vttparser.fixLineBreaks)(text.trim())),indent>=16?indent--:indent++,"firefox"===browDetected.name?cue.line=r+1:cue.line=r>7?r-2:r+1,"tizen"===browDetected.name&&_semver2.default.satisfies(browDetected.version,"2.x.x")||(cue.align="left",cue.position=Math.max(0,Math.min(100,100*(indent/32)+("firefox"===browDetected.name?50:0))))}catch(err){}try{track.addCue(cue)}catch(err){}}}};module.exports=Cues},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_ewma=__webpack_require__(138),_ewma2=_interopRequireDefault(_ewma);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var EwmaBandWidthEstimator=function(){function EwmaBandWidthEstimator(hls,slow,fast,defaultEstimate){_classCallCheck(this,EwmaBandWidthEstimator),this.hls=hls,this.defaultEstimate_=defaultEstimate,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new _ewma2.default(slow),this.fast_=new _ewma2.default(fast)}return _createClass(EwmaBandWidthEstimator,[{key:"sample",value:function(durationMs,numBytes){var myDurationMs=Math.max(durationMs,this.minDelayMs_),bandwidth=8e3*numBytes/myDurationMs,weight=myDurationMs/1e3;this.fast_.sample(weight,bandwidth),this.slow_.sample(weight,bandwidth)}},{key:"canEstimate",value:function(){var fast=this.fast_;return fast&&fast.getTotalWeight()>=this.minWeight_}},{key:"getEstimate",value:function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}},{key:"destroy",value:function(){this.slow_=null,this.fast_=null}}]),EwmaBandWidthEstimator}();exports.default=EwmaBandWidthEstimator,module.exports=exports["default"]},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var EWMA=function(){function EWMA(halfLife){_classCallCheck(this,EWMA),this.alpha_=halfLife?Math.exp(Math.log(.5)/halfLife):0,this.estimate_=0,this.totalWeight_=0}return _createClass(EWMA,[{key:"sample",value:function(weight,value){var adjAlpha=Math.pow(this.alpha_,weight);this.estimate_=value*(1-adjAlpha)+adjAlpha*this.estimate_,this.totalWeight_+=weight}},{key:"getTotalWeight",value:function(){return this.totalWeight_}},{key:"getEstimate",value:function(){if(this.alpha_){var zeroFactor=1-Math.pow(this.alpha_,this.totalWeight_);return this.estimate_/zeroFactor}return this.estimate_}}]),EWMA}();exports.default=EWMA,module.exports=exports["default"]},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=function(){if("undefined"!==typeof window&&window.VTTCue)return window.VTTCue;var autoKeyword="auto",directionSetting={"":!0,lr:!0,rl:!0},alignSetting={start:!0,middle:!0,end:!0,left:!0,right:!0};function findDirectionSetting(value){if("string"!==typeof value)return!1;var dir=directionSetting[value.toLowerCase()];return!!dir&&value.toLowerCase()}function findAlignSetting(value){if("string"!==typeof value)return!1;var align=alignSetting[value.toLowerCase()];return!!align&&value.toLowerCase()}function extend(obj){for(var i=1;i<arguments.length;i++){var cobj=arguments[i];for(var p in cobj)obj[p]=cobj[p]}return obj}function VTTCue(startTime,endTime,text){var cue=this,isIE8=function(){if("undefined"!==typeof navigator)return/MSIE\s8\.0/.test(navigator.userAgent)}(),baseObj={};isIE8?cue=document.createElement("custom"):baseObj.enumerable=!0,cue.hasBeenReset=!1;var _id="",_pauseOnExit=!1,_startTime=startTime,_endTime=endTime,_text=text,_region=null,_vertical="",_snapToLines=!0,_line="auto",_lineAlign="start",_position=50,_positionAlign="middle",_size=50,_align="middle";if(Object.defineProperty(cue,"id",extend({},baseObj,{get:function(){return _id},set:function(value){_id=""+value}})),Object.defineProperty(cue,"pauseOnExit",extend({},baseObj,{get:function(){return _pauseOnExit},set:function(value){_pauseOnExit=!!value}})),Object.defineProperty(cue,"startTime",extend({},baseObj,{get:function(){return _startTime},set:function(value){if("number"!==typeof value)throw new TypeError("Start time must be set to a number.");_startTime=value,this.hasBeenReset=!0}})),Object.defineProperty(cue,"endTime",extend({},baseObj,{get:function(){return _endTime},set:function(value){if("number"!==typeof value)throw new TypeError("End time must be set to a number.");_endTime=value,this.hasBeenReset=!0}})),Object.defineProperty(cue,"text",extend({},baseObj,{get:function(){return _text},set:function(value){_text=""+value,this.hasBeenReset=!0}})),Object.defineProperty(cue,"region",extend({},baseObj,{get:function(){return _region},set:function(value){_region=value,this.hasBeenReset=!0}})),Object.defineProperty(cue,"vertical",extend({},baseObj,{get:function(){return _vertical},set:function(value){var setting=findDirectionSetting(value);if(setting===!1)throw new SyntaxError("An invalid or illegal string was specified.");_vertical=setting,this.hasBeenReset=!0}})),Object.defineProperty(cue,"snapToLines",extend({},baseObj,{get:function(){return _snapToLines},set:function(value){_snapToLines=!!value,this.hasBeenReset=!0}})),Object.defineProperty(cue,"line",extend({},baseObj,{get:function(){return _line},set:function(value){if("number"!==typeof value&&value!==autoKeyword)throw new SyntaxError("An invalid number or illegal string was specified.");_line=value,this.hasBeenReset=!0}})),Object.defineProperty(cue,"lineAlign",extend({},baseObj,{get:function(){return _lineAlign},set:function(value){var setting=findAlignSetting(value);if(!setting)throw new SyntaxError("An invalid or illegal string was specified.");_lineAlign=setting,this.hasBeenReset=!0}})),Object.defineProperty(cue,"position",extend({},baseObj,{get:function(){return _position},set:function(value){if(value<0||value>100)throw new Error("Position must be between 0 and 100.");_position=value,this.hasBeenReset=!0}})),Object.defineProperty(cue,"positionAlign",extend({},baseObj,{get:function(){return _positionAlign},set:function(value){var setting=findAlignSetting(value);if(!setting)throw new SyntaxError("An invalid or illegal string was specified.");_positionAlign=setting,this.hasBeenReset=!0}})),Object.defineProperty(cue,"size",extend({},baseObj,{get:function(){return _size},set:function(value){if(value<0||value>100)throw new Error("Size must be between 0 and 100.");_size=value,this.hasBeenReset=!0}})),Object.defineProperty(cue,"align",extend({},baseObj,{get:function(){return _align},set:function(value){var setting=findAlignSetting(value);if(!setting)throw new SyntaxError("An invalid or illegal string was specified.");_align=setting,this.hasBeenReset=!0}})),cue.displayState=void 0,isIE8)return cue}return VTTCue.prototype.getCueAsHTML=function(){var WebVTT=window.WebVTT;return WebVTT.convertCueToDOMTree(window,this.text)},VTTCue}(),module.exports=exports["default"]},function(module,exports,__webpack_require__){"use strict";var _vttparser=__webpack_require__(72),_vttparser2=_interopRequireDefault(_vttparser);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var cueString2millis=function(timeString){var ts=parseInt(timeString.substr(-3),10),secs=parseInt(timeString.substr(-6,2),10),mins=parseInt(timeString.substr(-9,2),10),hours=timeString.length>9?parseInt(timeString.substr(0,timeString.indexOf(":")),10):0;return isNaN(ts)||isNaN(secs)||isNaN(mins)||isNaN(hours)?-1:(ts+=1e3*secs,ts+=60*1e3*mins,ts+=60*60*1e3*hours,ts)},calculateOffset=function(vttCCs,cc,presentationTime){var currCC=vttCCs[cc],prevCC=vttCCs[currCC.prevCC];if(!prevCC||!prevCC.new&&currCC.new)return vttCCs.ccOffset=vttCCs.presentationOffset=currCC.start,currCC.new=!1,void 0;while(prevCC&&prevCC.new)vttCCs.ccOffset+=currCC.start-prevCC.start,currCC.new=!1,currCC=prevCC,prevCC=vttCCs[currCC.prevCC];vttCCs.presentationOffset=presentationTime},WebVTTParser={parse:function(vttByteArray,syncPTS,vttCCs,cc,callBack,errorCallBack){var re=/\r\n|\n\r|\n|\r/g,vttLines=String.fromCharCode.apply(null,new Uint8Array(vttByteArray)).trim().replace(re,"\n").split("\n"),cueTime="00:00.000",mpegTs=0,localTime=0,presentationTime=0,cues=[],parsingError=void 0,inHeader=!0,parser=new _vttparser2.default;parser.oncue=function(cue){var currCC=vttCCs[cc],cueOffset=vttCCs.ccOffset;currCC&&currCC.new&&(localTime?cueOffset=vttCCs.ccOffset=currCC.start:calculateOffset(vttCCs,cc,presentationTime)),presentationTime&&!localTime&&(cueOffset=presentationTime+vttCCs.ccOffset-vttCCs.presentationOffset),cue.startTime+=cueOffset-localTime,cue.endTime+=cueOffset-localTime,cue.text=decodeURIComponent(escape(cue.text)),cue.endTime>0&&cues.push(cue)},parser.onparsingerror=function(e){parsingError=e},parser.onflush=function(){return parsingError&&errorCallBack?(errorCallBack(parsingError),void 0):(callBack(cues),void 0)},vttLines.forEach(function(line){if(inHeader){if(line.startsWith("X-TIMESTAMP-MAP=")){inHeader=!1,line.substr(16).split(",").forEach(function(timestamp){timestamp.startsWith("LOCAL:")?cueTime=timestamp.substr(6):timestamp.startsWith("MPEGTS:")&&(mpegTs=parseInt(timestamp.substr(7),10))});try{syncPTS=syncPTS<0?syncPTS+8589934592:syncPTS,mpegTs-=syncPTS,localTime=cueString2millis(cueTime)/1e3,presentationTime=mpegTs/9e4,localTime===-1&&(parsingError=new Error("Malformed X-TIMESTAMP-MAP: "+line))}catch(e){parsingError=new Error("Malformed X-TIMESTAMP-MAP: "+line)}return}""===line&&(inHeader=!1)}parser.parse(line+"\n")}),parser.flush()}};module.exports=WebVTTParser},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_logger=__webpack_require__(1);function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var XhrLoader=function(){function XhrLoader(config){_classCallCheck(this,XhrLoader),config&&config.xhrSetup&&(this.xhrSetup=config.xhrSetup)}return _createClass(XhrLoader,[{key:"destroy",value:function(){this.abort(),this.loader=null}},{key:"abort",value:function(){var loader=this.loader;loader&&4!==loader.readyState&&(this.stats.aborted=!0,loader.abort()),window.clearTimeout(this.requestTimeout),this.requestTimeout=null,window.clearTimeout(this.retryTimeout),this.retryTimeout=null}},{key:"load",value:function(context,config,callbacks){this.context=context,this.config=config,this.callbacks=callbacks,this.stats={trequest:performance.now(),retry:0,aborted:!1},this.retryDelay=config.retryDelay,this.loadInternal()}},{key:"loadInternal",value:function(){var xhr=void 0,context=this.context;xhr="undefined"!==typeof XDomainRequest?this.loader=new XDomainRequest:this.loader=new XMLHttpRequest;var stats=this.stats;stats.tfirst=0,stats.loaded=0,this.xhrSetup&&this.xhrSetup(xhr,context.url,context.dataType),xhr.readyState||xhr.open("GET",context.url,!0),context.rangeEnd&&xhr.setRequestHeader("Range","bytes="+context.rangeStart+"-"+(context.rangeEnd-1)),xhr.onreadystatechange=this.readystatechange.bind(this),xhr.onprogress=this.loadprogress.bind(this),xhr.responseType=context.responseType,this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),this.config.timeout),xhr.send()}},{key:"readystatechange",value:function(event){var xhr=event.currentTarget,readyState=xhr.readyState,stats=this.stats,context=this.context,config=this.config;if(!stats.aborted&&readyState>=2)if(window.clearTimeout(this.requestTimeout),0===stats.tfirst&&(stats.tfirst=Math.max(performance.now(),stats.trequest)),4===readyState){var status=xhr.status;if(status>=200&&status<300){stats.tload=Math.max(stats.tfirst,performance.now());var data=void 0,len=void 0;"arraybuffer"===context.responseType?(data=xhr.response,len=data.byteLength):(data=xhr.responseText,len=data.length),stats.loaded=stats.total=len;var response={url:xhr.responseURL,data:data};this.callbacks.onSuccess(response,stats,context)}else stats.retry>=config.maxRetry||status>=400&&status<499?(_logger.logger.error(status+" while loading "+context.url),this.callbacks.onError({code:status,text:xhr.statusText},context)):(_logger.logger.warn(status+" while loading "+context.url+", retrying in "+this.retryDelay+"..."),this.destroy(),this.retryTimeout=window.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,config.maxRetryDelay),stats.retry++)}else this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),config.timeout)}},{key:"loadtimeout",value:function(){_logger.logger.warn("timeout while loading "+this.context.url),this.callbacks.onTimeout(this.stats,this.context)}},{key:"loadprogress",value:function(event){var stats=this.stats;stats.loaded=event.loaded,event.lengthComputable&&(stats.total=event.total);var onProgress=this.callbacks.onProgress;onProgress&&onProgress(stats,this.context,null)}}]),XhrLoader}();exports.default=XhrLoader,module.exports=exports["default"]},function(module,exports,__webpack_require__){"use strict";var _AacStream,Stream=__webpack_require__(11);_AacStream=function(){var everything=new Uint8Array(0),timeStamp=0;_AacStream.prototype.init.call(this),this.setTimestamp=function(timestamp){timeStamp=timestamp},this.parseId3TagSize=function(header,byteIndex){var returnSize=header[byteIndex+6]<<21|header[byteIndex+7]<<14|header[byteIndex+8]<<7|header[byteIndex+9],flags=header[byteIndex+5],footerPresent=(16&flags)>>4;return footerPresent?returnSize+20:returnSize+10},this.parseAdtsSize=function(header,byteIndex){var lowThree=(224&header[byteIndex+5])>>5,middle=header[byteIndex+4]<<3,highTwo=header[byteIndex+3]&3<<11;return highTwo|middle|lowThree},this.push=function(bytes){var bytesLeft,chunk,packet,tempLength,frameSize=0,byteIndex=0;everything.length?(tempLength=everything.length,everything=new Uint8Array(bytes.byteLength+tempLength),everything.set(everything.subarray(0,tempLength)),everything.set(bytes,tempLength)):everything=bytes;while(everything.length-byteIndex>=3)if(everything[byteIndex]!=="I".charCodeAt(0)||everything[byteIndex+1]!=="D".charCodeAt(0)||everything[byteIndex+2]!=="3".charCodeAt(0))if(everything[byteIndex]&255===255&&240===(240&everything[byteIndex+1])){if(everything.length-byteIndex<7)break;if(frameSize=this.parseAdtsSize(everything,byteIndex),frameSize>everything.length)break;packet={type:"audio",data:everything.subarray(byteIndex,byteIndex+frameSize),pts:timeStamp,dts:timeStamp},this.trigger("data",packet),byteIndex+=frameSize}else byteIndex++;else{if(everything.length-byteIndex<10)break;if(frameSize=this.parseId3TagSize(everything,byteIndex),frameSize>everything.length)break;chunk={type:"timed-metadata",data:everything.subarray(byteIndex,byteIndex+frameSize)},this.trigger("data",chunk),byteIndex+=frameSize}bytesLeft=everything.length-byteIndex,everything=bytesLeft>0?everything.subarray(byteIndex):new Uint8Array(0)}},_AacStream.prototype=new Stream,module.exports=_AacStream},function(module){"use strict";var ADTS_SAMPLING_FREQUENCIES=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],parseSyncSafeInteger=function(data){return data[0]<<21|data[1]<<14|data[2]<<7|data[3]},percentEncode=function(bytes,start,end){var i,result="";for(i=start;i<end;i++)result+="%"+("00"+bytes[i].toString(16)).slice(-2);return result},parseIso88591=function(bytes,start,end){return unescape(percentEncode(bytes,start,end))},parseId3TagSize=function(header,byteIndex){var returnSize=header[byteIndex+6]<<21|header[byteIndex+7]<<14|header[byteIndex+8]<<7|header[byteIndex+9],flags=header[byteIndex+5],footerPresent=(16&flags)>>4;return footerPresent?returnSize+20:returnSize+10},parseAdtsSize=function(header,byteIndex){var lowThree=(224&header[byteIndex+5])>>5,middle=header[byteIndex+4]<<3,highTwo=header[byteIndex+3]&3<<11;return highTwo|middle|lowThree},parseType=function(header,byteIndex){return header[byteIndex]==="I".charCodeAt(0)&&header[byteIndex+1]==="D".charCodeAt(0)&&header[byteIndex+2]==="3".charCodeAt(0)?"timed-metadata":header[byteIndex]&255===255&&240===(240&header[byteIndex+1])?"audio":null},parseSampleRate=function(packet){var i=0;while(i+5<packet.length){if(255===packet[i]&&240===(246&packet[i+1]))return ADTS_SAMPLING_FREQUENCIES[(60&packet[i+2])>>>2];i++}return null},parseAacTimestamp=function(packet){var frameStart,frameSize,frame,frameHeader;frameStart=10,64&packet[5]&&(frameStart+=4,frameStart+=parseSyncSafeInteger(packet.subarray(10,14)));do{if(frameSize=parseSyncSafeInteger(packet.subarray(frameStart+4,frameStart+8)),frameSize<1)return null;if(frameHeader=String.fromCharCode(packet[frameStart],packet[frameStart+1],packet[frameStart+2],packet[frameStart+3]),"PRIV"===frameHeader){frame=packet.subarray(frameStart+10,frameStart+frameSize+10);for(var i=0;i<frame.byteLength;i++)if(0===frame[i]){var owner=parseIso88591(frame,0,i);if("com.apple.streaming.transportStreamTimestamp"===owner){var d=frame.subarray(i+1),size=(1&d[3])<<30|d[4]<<22|d[5]<<14|d[6]<<6|d[7]>>>2;return size*=4,size+=3&d[7],size}break}}frameStart+=10,frameStart+=frameSize}while(frameStart<packet.byteLength);return null};module.exports={parseId3TagSize:parseId3TagSize,parseAdtsSize:parseAdtsSize,parseType:parseType,parseSampleRate:parseSampleRate,parseAacTimestamp:parseAacTimestamp}},function(module,exports,__webpack_require__){"use strict";module.exports={adts:__webpack_require__(41),h264:__webpack_require__(42)}},function(module){"use strict";var highPrefix=[33,16,5,32,164,27],lowPrefix=[33,65,108,84,1,2,4,8,168,2,4,8,17,191,252],zeroFill=function(count){var a=[];while(count--)a.push(0);return a},makeTable=function(metaTable){return Object.keys(metaTable).reduce(function(obj,key){return obj[key]=new Uint8Array(metaTable[key].reduce(function(arr,part){return arr.concat(part)},[])),obj},{})},coneOfSilence={96e3:[highPrefix,[227,64],zeroFill(154),[56]],88200:[highPrefix,[231],zeroFill(170),[56]],64e3:[highPrefix,[248,192],zeroFill(240),[56]],48e3:[highPrefix,[255,192],zeroFill(268),[55,148,128],zeroFill(54),[112]],44100:[highPrefix,[255,192],zeroFill(268),[55,163,128],zeroFill(84),[112]],32e3:[highPrefix,[255,192],zeroFill(268),[55,234],zeroFill(226),[112]],24e3:[highPrefix,[255,192],zeroFill(268),[55,255,128],zeroFill(268),[111,112],zeroFill(126),[224]],16e3:[highPrefix,[255,192],zeroFill(268),[55,255,128],zeroFill(268),[111,255],zeroFill(269),[223,108],zeroFill(195),[1,192]],12e3:[lowPrefix,zeroFill(268),[3,127,248],zeroFill(268),[6,255,240],zeroFill(268),[13,255,224],zeroFill(268),[27,253,128],zeroFill(259),[56]],11025:[lowPrefix,zeroFill(268),[3,127,248],zeroFill(268),[6,255,240],zeroFill(268),[13,255,224],zeroFill(268),[27,255,192],zeroFill(268),[55,175,128],zeroFill(108),[112]],8e3:[lowPrefix,zeroFill(268),[3,121,16],zeroFill(47),[7]]};module.exports=makeTable(coneOfSilence)},function(module,exports,__webpack_require__){"use strict";var Stream=__webpack_require__(11),CoalesceStream=function CoalesceStream(options){this.numberOfTracks=0,this.metadataStream=options.metadataStream,this.videoTags=[],this.audioTags=[],this.videoTrack=null,this.audioTrack=null,this.pendingCaptions=[],this.pendingMetadata=[],this.pendingTracks=0,this.processedTracks=0,CoalesceStream.prototype.init.call(this),this.push=function(output){return output.text?this.pendingCaptions.push(output):output.frames?this.pendingMetadata.push(output):("video"===output.track.type&&(this.videoTrack=output.track,this.videoTags=output.tags,this.pendingTracks++),"audio"===output.track.type&&(this.audioTrack=output.track,this.audioTags=output.tags,this.pendingTracks++),void 0)}};CoalesceStream.prototype=new Stream,CoalesceStream.prototype.flush=function(flushSource){var id3,caption,i,timelineStartPts,event={tags:{},captions:[],metadata:[]};if(this.pendingTracks<this.numberOfTracks){if("VideoSegmentStream"!==flushSource&&"AudioSegmentStream"!==flushSource)return;if(0===this.pendingTracks&&(this.processedTracks++,this.processedTracks<this.numberOfTracks))return}if(this.processedTracks+=this.pendingTracks,this.pendingTracks=0,!(this.processedTracks<this.numberOfTracks)){for(this.videoTrack?timelineStartPts=this.videoTrack.timelineStartInfo.pts:this.audioTrack&&(timelineStartPts=this.audioTrack.timelineStartInfo.pts),event.tags.videoTags=this.videoTags,event.tags.audioTags=this.audioTags,i=0;i<this.pendingCaptions.length;i++)caption=this.pendingCaptions[i],caption.startTime=caption.startPts-timelineStartPts,caption.startTime/=9e4,caption.endTime=caption.endPts-timelineStartPts,caption.endTime/=9e4,event.captions.push(caption);for(i=0;i<this.pendingMetadata.length;i++)id3=this.pendingMetadata[i],id3.cueTime=id3.pts-timelineStartPts,id3.cueTime/=9e4,event.metadata.push(id3);event.metadata.dispatchType=this.metadataStream.dispatchType,this.videoTrack=null,this.audioTrack=null,this.videoTags=[],this.audioTags=[],this.pendingCaptions.length=0,this.pendingMetadata.length=0,this.pendingTracks=0,this.processedTracks=0,this.trigger("data",event),this.trigger("done")}},module.exports=CoalesceStream},function(module,exports,__webpack_require__){"use strict";var FlvTag=__webpack_require__(43),getFlvHeader=function(duration,audio,video){var metadata,result,metadataLength,headBytes=new Uint8Array(3+1+1+4),head=new DataView(headBytes.buffer);return duration=duration||0,audio=void 0===audio||audio,video=void 0===video||video,head.setUint8(0,70),head.setUint8(1,76),head.setUint8(2,86),head.setUint8(3,1),head.setUint8(4,(audio?4:0)|(video?1:0)),head.setUint32(5,headBytes.byteLength),duration<=0?(result=new Uint8Array(headBytes.byteLength+4),result.set(headBytes),result.set([0,0,0,0],headBytes.byteLength),result):(metadata=new FlvTag(FlvTag.METADATA_TAG),metadata.pts=metadata.dts=0,metadata.writeMetaDataDouble("duration",duration),metadataLength=metadata.finalize().length,result=new Uint8Array(headBytes.byteLength+metadataLength),result.set(headBytes),result.set(head.byteLength,metadataLength),result)};module.exports=getFlvHeader},function(module,exports,__webpack_require__){"use strict";module.exports={tag:__webpack_require__(43),Transmuxer:__webpack_require__(150),getFlvHeader:__webpack_require__(147)}},function(module){"use strict";var TagList=function(){var self=this;this.list=[],this.push=function(tag){this.list.push({bytes:tag.bytes,dts:tag.dts,pts:tag.pts,keyFrame:tag.keyFrame,metaDataTag:tag.metaDataTag})},Object.defineProperty(this,"length",{get:function(){return self.list.length}})};module.exports=TagList},function(module,exports,__webpack_require__){"use strict";var _Transmuxer,_VideoSegmentStream,_AudioSegmentStream,collectTimelineInfo,metaDataTag,extraDataTag,Stream=__webpack_require__(11),FlvTag=__webpack_require__(43),m2ts=__webpack_require__(45),AdtsStream=__webpack_require__(41),H264Stream=__webpack_require__(42).H264Stream,CoalesceStream=__webpack_require__(146),TagList=__webpack_require__(149);collectTimelineInfo=function(track,data){"number"===typeof data.pts&&(void 0===track.timelineStartInfo.pts?track.timelineStartInfo.pts=data.pts:track.timelineStartInfo.pts=Math.min(track.timelineStartInfo.pts,data.pts)),"number"===typeof data.dts&&(void 0===track.timelineStartInfo.dts?track.timelineStartInfo.dts=data.dts:track.timelineStartInfo.dts=Math.min(track.timelineStartInfo.dts,data.dts))},metaDataTag=function(track,pts){var tag=new FlvTag(FlvTag.METADATA_TAG);return tag.dts=pts,tag.pts=pts,tag.writeMetaDataDouble("videocodecid",7),tag.writeMetaDataDouble("width",track.width),tag.writeMetaDataDouble("height",track.height),tag},extraDataTag=function(track,pts){var i,tag=new FlvTag(FlvTag.VIDEO_TAG,!0);for(tag.dts=pts,tag.pts=pts,tag.writeByte(1),tag.writeByte(track.profileIdc),tag.writeByte(track.profileCompatibility),tag.writeByte(track.levelIdc),tag.writeByte(252|3),tag.writeByte(224|1),tag.writeShort(track.sps[0].length),tag.writeBytes(track.sps[0]),tag.writeByte(track.pps.length),i=0;i<track.pps.length;++i)tag.writeShort(track.pps[i].length),tag.writeBytes(track.pps[i]);return tag},_AudioSegmentStream=function(track){var oldExtraData,adtsFrames=[];_AudioSegmentStream.prototype.init.call(this),this.push=function(data){collectTimelineInfo(track,data),track&&void 0===track.channelcount&&(track.audioobjecttype=data.audioobjecttype,track.channelcount=data.channelcount,track.samplerate=data.samplerate,track.samplingfrequencyindex=data.samplingfrequencyindex,track.samplesize=data.samplesize,track.extraData=track.audioobjecttype<<11|track.samplingfrequencyindex<<7|track.channelcount<<3),data.pts=Math.round(data.pts/90),data.dts=Math.round(data.dts/90),adtsFrames.push(data)},this.flush=function(){var currentFrame,adtsFrame,lastMetaPts,tags=new TagList;if(0===adtsFrames.length)return this.trigger("done","AudioSegmentStream"),void 0;lastMetaPts=-(1/0);while(adtsFrames.length)currentFrame=adtsFrames.shift(),(track.extraData!==oldExtraData||currentFrame.pts-lastMetaPts>=1e3)&&(adtsFrame=new FlvTag(FlvTag.METADATA_TAG),adtsFrame.pts=currentFrame.pts,adtsFrame.dts=currentFrame.dts,adtsFrame.writeMetaDataDouble("audiocodecid",10),adtsFrame.writeMetaDataBoolean("stereo",2===track.channelcount),adtsFrame.writeMetaDataDouble("audiosamplerate",track.samplerate),adtsFrame.writeMetaDataDouble("audiosamplesize",16),tags.push(adtsFrame.finalize()),oldExtraData=track.extraData,adtsFrame=new FlvTag(FlvTag.AUDIO_TAG,!0),adtsFrame.pts=currentFrame.pts,adtsFrame.dts=currentFrame.dts,adtsFrame.view.setUint16(adtsFrame.position,track.extraData),adtsFrame.position+=2,adtsFrame.length=Math.max(adtsFrame.length,adtsFrame.position),tags.push(adtsFrame.finalize()),lastMetaPts=currentFrame.pts),adtsFrame=new FlvTag(FlvTag.AUDIO_TAG),adtsFrame.pts=currentFrame.pts,adtsFrame.dts=currentFrame.dts,adtsFrame.writeBytes(currentFrame.data),tags.push(adtsFrame.finalize());oldExtraData=null,this.trigger("data",{track:track,tags:tags.list}),this.trigger("done","AudioSegmentStream")}},_AudioSegmentStream.prototype=new Stream,_VideoSegmentStream=function(track){var config,h264Frame,nalUnits=[];_VideoSegmentStream.prototype.init.call(this),this.finishFrame=function(tags,frame){if(frame){if(config&&track&&track.newMetadata&&(frame.keyFrame||0===tags.length)){var metaTag=metaDataTag(config,frame.dts).finalize(),extraTag=extraDataTag(track,frame.dts).finalize();metaTag.metaDataTag=extraTag.metaDataTag=!0,tags.push(metaTag),tags.push(extraTag),track.newMetadata=!1}frame.endNalUnit(),tags.push(frame.finalize()),h264Frame=null}},this.push=function(data){collectTimelineInfo(track,data),data.pts=Math.round(data.pts/90),data.dts=Math.round(data.dts/90),nalUnits.push(data)},this.flush=function(){var currentNal,tags=new TagList;while(nalUnits.length){if("access_unit_delimiter_rbsp"===nalUnits[0].nalUnitType)break;nalUnits.shift()}if(0===nalUnits.length)return this.trigger("done","VideoSegmentStream"),void 0;while(nalUnits.length)currentNal=nalUnits.shift(),"seq_parameter_set_rbsp"===currentNal.nalUnitType?(track.newMetadata=!0,config=currentNal.config,track.width=config.width,track.height=config.height,track.sps=[currentNal.data],track.profileIdc=config.profileIdc,track.levelIdc=config.levelIdc,track.profileCompatibility=config.profileCompatibility,h264Frame.endNalUnit()):"pic_parameter_set_rbsp"===currentNal.nalUnitType?(track.newMetadata=!0,track.pps=[currentNal.data],h264Frame.endNalUnit()):"access_unit_delimiter_rbsp"===currentNal.nalUnitType?(h264Frame&&this.finishFrame(tags,h264Frame),h264Frame=new FlvTag(FlvTag.VIDEO_TAG),h264Frame.pts=currentNal.pts,h264Frame.dts=currentNal.dts):("slice_layer_without_partitioning_rbsp_idr"===currentNal.nalUnitType&&(h264Frame.keyFrame=!0),h264Frame.endNalUnit()),h264Frame.startNalUnit(),h264Frame.writeBytes(currentNal.data);h264Frame&&this.finishFrame(tags,h264Frame),this.trigger("data",{track:track,tags:tags.list}),this.trigger("done","VideoSegmentStream")}},_VideoSegmentStream.prototype=new Stream,_Transmuxer=function(options){var packetStream,parseStream,elementaryStream,videoTimestampRolloverStream,audioTimestampRolloverStream,timedMetadataTimestampRolloverStream,adtsStream,h264Stream,videoSegmentStream,audioSegmentStream,captionStream,coalesceStream,self=this;_Transmuxer.prototype.init.call(this),options=options||{},this.metadataStream=new m2ts.MetadataStream,options.metadataStream=this.metadataStream,
packetStream=new m2ts.TransportPacketStream,parseStream=new m2ts.TransportParseStream,elementaryStream=new m2ts.ElementaryStream,videoTimestampRolloverStream=new m2ts.TimestampRolloverStream("video"),audioTimestampRolloverStream=new m2ts.TimestampRolloverStream("audio"),timedMetadataTimestampRolloverStream=new m2ts.TimestampRolloverStream("timed-metadata"),adtsStream=new AdtsStream,h264Stream=new H264Stream,coalesceStream=new CoalesceStream(options),packetStream.pipe(parseStream).pipe(elementaryStream),elementaryStream.pipe(videoTimestampRolloverStream).pipe(h264Stream),elementaryStream.pipe(audioTimestampRolloverStream).pipe(adtsStream),elementaryStream.pipe(timedMetadataTimestampRolloverStream).pipe(this.metadataStream).pipe(coalesceStream),captionStream=new m2ts.CaptionStream,h264Stream.pipe(captionStream).pipe(coalesceStream),elementaryStream.on("data",function(data){var i,videoTrack,audioTrack;if("metadata"===data.type){i=data.tracks.length;while(i--)"video"===data.tracks[i].type?videoTrack=data.tracks[i]:"audio"===data.tracks[i].type&&(audioTrack=data.tracks[i]);videoTrack&&!videoSegmentStream&&(coalesceStream.numberOfTracks++,videoSegmentStream=new _VideoSegmentStream(videoTrack),h264Stream.pipe(videoSegmentStream).pipe(coalesceStream)),audioTrack&&!audioSegmentStream&&(coalesceStream.numberOfTracks++,audioSegmentStream=new _AudioSegmentStream(audioTrack),adtsStream.pipe(audioSegmentStream).pipe(coalesceStream))}}),this.push=function(data){packetStream.push(data)},this.flush=function(){packetStream.flush()},coalesceStream.on("data",function(event){self.trigger("data",event)}),coalesceStream.on("done",function(){self.trigger("done")})},_Transmuxer.prototype=new Stream,module.exports=_Transmuxer},function(module,exports,__webpack_require__){"use strict";var USER_DATA_REGISTERED_ITU_T_T35=4,RBSP_TRAILING_BITS=128,Stream=__webpack_require__(11),parseSei=function(bytes){var i=0,result={payloadType:-1,payloadSize:0},payloadType=0,payloadSize=0;while(i<bytes.byteLength){if(bytes[i]===RBSP_TRAILING_BITS)break;while(255===bytes[i])payloadType+=255,i++;payloadType+=bytes[i++];while(255===bytes[i])payloadSize+=255,i++;if(payloadSize+=bytes[i++],!result.payload&&payloadType===USER_DATA_REGISTERED_ITU_T_T35){result.payloadType=payloadType,result.payloadSize=payloadSize,result.payload=bytes.subarray(i,i+payloadSize);break}i+=payloadSize,payloadType=0,payloadSize=0}return result},parseUserData=function(sei){return 181!==sei.payload[0]?null:49!==(sei.payload[1]<<8|sei.payload[2])?null:"GA94"!==String.fromCharCode(sei.payload[3],sei.payload[4],sei.payload[5],sei.payload[6])?null:3!==sei.payload[7]?null:sei.payload.subarray(8,sei.payload.length-1)},CaptionStream=function CaptionStream(){CaptionStream.prototype.init.call(this),this.captionPackets_=[],this.field1_=new Cea608Stream,this.field1_.on("data",this.trigger.bind(this,"data")),this.field1_.on("done",this.trigger.bind(this,"done"))};CaptionStream.prototype=new Stream,CaptionStream.prototype.push=function(event){var sei,userData;if("sei_rbsp"===event.nalUnitType&&(sei=parseSei(event.escapedRBSP),sei.payloadType===USER_DATA_REGISTERED_ITU_T_T35&&(userData=parseUserData(sei),userData))){var captionPacket={bytes:userData,pts:event.pts,type:sei.payloadType};this.captionPackets_.push(captionPacket)}},CaptionStream.prototype.flush=function(){this.captionPackets_.length&&(this.captionPackets_.forEach(function(elem,idx){elem.presortIndex=idx}),this.captionPackets_.sort(function(a,b){return a.pts===b.pts?a.presortIndex-b.presortIndex:a.pts-b.pts}),this.captionPackets_.length>0&&this.trigger("data",{userData:this.captionPackets_,text:"captions"}),this.captionPackets_.length=0)};var BASIC_CHARACTER_TRANSLATION={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608},getCharFromCode=function(code){return null===code?"":(code=BASIC_CHARACTER_TRANSLATION[code]||code,String.fromCharCode(code))},PADDING=0,RESUME_CAPTION_LOADING=5152,END_OF_CAPTION=5167,ROLL_UP_2_ROWS=5157,ROLL_UP_3_ROWS=5158,ROLL_UP_4_ROWS=5159,CARRIAGE_RETURN=5165,BACKSPACE=5153,ERASE_DISPLAYED_MEMORY=5164,ERASE_NON_DISPLAYED_MEMORY=5166,BOTTOM_ROW=14,createDisplayBuffer=function(){var result=[],i=BOTTOM_ROW+1;while(i--)result.push("");return result},Cea608Stream=function Cea608Stream(){Cea608Stream.prototype.init.call(this),this.mode_="popOn",this.topRow_=0,this.startPts_=0,this.displayed_=createDisplayBuffer(),this.nonDisplayed_=createDisplayBuffer(),this.lastControlCode_=null,this.push=function(packet){if(0===packet.type){var data,swap,char0,char1;if(data=32639&packet.ccData,data===this.lastControlCode_)return this.lastControlCode_=null,void 0;switch(4096===(61440&data)?this.lastControlCode_=data:this.lastControlCode_=null,data){case PADDING:break;case RESUME_CAPTION_LOADING:this.mode_="popOn";break;case END_OF_CAPTION:this.flushDisplayed(packet.pts),swap=this.displayed_,this.displayed_=this.nonDisplayed_,this.nonDisplayed_=swap,this.startPts_=packet.pts;break;case ROLL_UP_2_ROWS:this.topRow_=BOTTOM_ROW-1,this.mode_="rollUp";break;case ROLL_UP_3_ROWS:this.topRow_=BOTTOM_ROW-2,this.mode_="rollUp";break;case ROLL_UP_4_ROWS:this.topRow_=BOTTOM_ROW-3,this.mode_="rollUp";break;case CARRIAGE_RETURN:this.flushDisplayed(packet.pts),this.shiftRowsUp_(),this.startPts_=packet.pts;break;case BACKSPACE:"popOn"===this.mode_?this.nonDisplayed_[BOTTOM_ROW]=this.nonDisplayed_[BOTTOM_ROW].slice(0,-1):this.displayed_[BOTTOM_ROW]=this.displayed_[BOTTOM_ROW].slice(0,-1);break;case ERASE_DISPLAYED_MEMORY:this.flushDisplayed(packet.pts),this.displayed_=createDisplayBuffer();break;case ERASE_NON_DISPLAYED_MEMORY:this.nonDisplayed_=createDisplayBuffer();break;default:if(char0=data>>>8,char1=255&data,char0>=16&&char0<=23&&char1>=64&&char1<=127&&(16!==char0||char1<96)&&(char0=32,char1=null),(17===char0||25===char0)&&char1>=48&&char1<=63&&(char0=9834,char1=""),16===(240&char0))return;0===char0&&(char0=null),0===char1&&(char1=null),this[this.mode_](packet.pts,char0,char1)}}}};Cea608Stream.prototype=new Stream,Cea608Stream.prototype.flushDisplayed=function(pts){var content=this.displayed_.map(function(row){return row.trim()}).filter(function(row){return row.length}).join("\n");content.length&&this.trigger("data",{startPts:this.startPts_,endPts:pts,text:content})},Cea608Stream.prototype.popOn=function(pts,char0,char1){var baseRow=this.nonDisplayed_[BOTTOM_ROW];baseRow+=getCharFromCode(char0),baseRow+=getCharFromCode(char1),this.nonDisplayed_[BOTTOM_ROW]=baseRow},Cea608Stream.prototype.rollUp=function(pts,char0,char1){var baseRow=this.displayed_[BOTTOM_ROW];""===baseRow&&(this.flushDisplayed(pts),this.startPts_=pts),baseRow+=getCharFromCode(char0),baseRow+=getCharFromCode(char1),this.displayed_[BOTTOM_ROW]=baseRow},Cea608Stream.prototype.shiftRowsUp_=function(){var i;for(i=0;i<this.topRow_;i++)this.displayed_[i]="";for(i=this.topRow_;i<BOTTOM_ROW;i++)this.displayed_[i]=this.displayed_[i+1];this.displayed_[BOTTOM_ROW]=""},module.exports={CaptionStream:CaptionStream,Cea608Stream:Cea608Stream}},function(module,exports,__webpack_require__){"use strict";module.exports=__webpack_require__(45)},function(module,exports,__webpack_require__){"use strict";var _logger=__webpack_require__(1);"use strict";var _MetadataStream,Stream=__webpack_require__(11),StreamTypes=__webpack_require__(26),percentEncode=function(bytes,start,end){var i,result="";for(i=start;i<end;i++)result+="%"+("00"+bytes[i].toString(16)).slice(-2);return result},parseUtf8=function(bytes,start,end){return decodeURIComponent(percentEncode(bytes,start,end))},parseIso88591=function(bytes,start,end){return unescape(percentEncode(bytes,start,end))},parseSyncSafeInteger=function(data){return data[0]<<21|data[1]<<14|data[2]<<7|data[3]},tagParsers={TXXX:function(tag){var i;if(3===tag.data[0]){for(i=1;i<tag.data.length;i++)if(0===tag.data[i]){tag.description=parseUtf8(tag.data,1,i),tag.value=parseUtf8(tag.data,i+1,tag.data.length-1);break}tag.data=tag.value}},WXXX:function(tag){var i;if(3===tag.data[0])for(i=1;i<tag.data.length;i++)if(0===tag.data[i]){tag.description=parseUtf8(tag.data,1,i),tag.url=parseUtf8(tag.data,i+1,tag.data.length);break}},PRIV:function(tag){var i;for(i=0;i<tag.data.length;i++)if(0===tag.data[i]){tag.owner=parseIso88591(tag.data,0,i);break}tag.privateData=tag.data.subarray(i+1),tag.data=tag.privateData}};_MetadataStream=function(options){var i,settings={debug:!(!options||!options.debug),descriptor:options&&options.descriptor},tagSize=0,buffer=[],bufferSize=0;if(_MetadataStream.prototype.init.call(this),this.dispatchType=StreamTypes.METADATA_STREAM_TYPE.toString(16),settings.descriptor)for(i=0;i<settings.descriptor.length;i++)this.dispatchType+=("00"+settings.descriptor[i].toString(16)).slice(-2);this.push=function(chunk){var tag,frameStart,frameSize,frame,i,frameHeader;if("timed-metadata"===chunk.type){if(chunk.dataAlignmentIndicator&&(bufferSize=0,buffer.length=0),0===buffer.length&&(chunk.data.length<10||chunk.data[0]!=="I".charCodeAt(0)||chunk.data[1]!=="D".charCodeAt(0)||chunk.data[2]!=="3".charCodeAt(0)))return settings.debug&&_logger.logger.log("Skipping unrecognized metadata packet"),void 0;if(buffer.push(chunk),bufferSize+=chunk.data.byteLength,1===buffer.length&&(tagSize=parseSyncSafeInteger(chunk.data.subarray(6,10)),tagSize+=10),!(bufferSize<tagSize)){for(tag={data:new Uint8Array(tagSize),frames:[],pts:buffer[0].pts,dts:buffer[0].dts},i=0;i<tagSize;)tag.data.set(buffer[0].data.subarray(0,tagSize-i),i),i+=buffer[0].data.byteLength,bufferSize-=buffer[0].data.byteLength,buffer.shift();frameStart=10,64&tag.data[5]&&(frameStart+=4,frameStart+=parseSyncSafeInteger(tag.data.subarray(10,14)),tagSize-=parseSyncSafeInteger(tag.data.subarray(16,20)));do{if(frameSize=parseSyncSafeInteger(tag.data.subarray(frameStart+4,frameStart+8)),frameSize<1)return _logger.logger.log("Malformed ID3 frame encountered. Skipping metadata parsing.");if(frameHeader=String.fromCharCode(tag.data[frameStart],tag.data[frameStart+1],tag.data[frameStart+2],tag.data[frameStart+3]),frame={id:frameHeader,data:tag.data.subarray(frameStart+10,frameStart+frameSize+10)},frame.key=frame.id,tagParsers[frame.id]&&(tagParsers[frame.id](frame),"com.apple.streaming.transportStreamTimestamp"===frame.owner)){var d=frame.data,size=(1&d[3])<<30|d[4]<<22|d[5]<<14|d[6]<<6|d[7]>>>2;size*=4,size+=3&d[7],frame.timeStamp=size,void 0===tag.pts&&void 0===tag.dts&&(tag.pts=frame.timeStamp,tag.dts=frame.timeStamp),this.trigger("timestamp",frame)}tag.frames.push(frame),frameStart+=10,frameStart+=frameSize}while(frameStart<tagSize);this.trigger("data",tag)}}}},_MetadataStream.prototype=new Stream,module.exports=_MetadataStream},function(module,exports,__webpack_require__){"use strict";var StreamTypes=__webpack_require__(26),parsePid=function(packet){var pid=31&packet[1];return pid<<=8,pid|=packet[2],pid},parsePayloadUnitStartIndicator=function(packet){return!!(64&packet[1])},parseAdaptionField=function(packet){var offset=0;return(48&packet[3])>>>4>1&&(offset+=packet[4]+1),offset},parseType=function(packet,pmtPid){var pid=parsePid(packet);return 0===pid?"pat":pid===pmtPid?"pmt":pmtPid?"pes":null},parsePat=function(packet){var pusi=parsePayloadUnitStartIndicator(packet),offset=4+parseAdaptionField(packet);return pusi&&(offset+=packet[offset]+1),(31&packet[offset+10])<<8|packet[offset+11]},parsePmt=function(packet){var programMapTable={},pusi=parsePayloadUnitStartIndicator(packet),payloadOffset=4+parseAdaptionField(packet);if(pusi&&(payloadOffset+=packet[payloadOffset]+1),1&packet[payloadOffset+5]){var sectionLength,tableEnd,programInfoLength;sectionLength=(15&packet[payloadOffset+1])<<8|packet[payloadOffset+2],tableEnd=3+sectionLength-4,programInfoLength=(15&packet[payloadOffset+10])<<8|packet[payloadOffset+11];var offset=12+programInfoLength;while(offset<tableEnd){var i=payloadOffset+offset;programMapTable[(31&packet[i+1])<<8|packet[i+2]]=packet[i],offset+=((15&packet[i+3])<<8|packet[i+4])+5}return programMapTable}},parsePesType=function(packet,programMapTable){var pid=parsePid(packet),type=programMapTable[pid];switch(type){case StreamTypes.H264_STREAM_TYPE:return"video";case StreamTypes.ADTS_STREAM_TYPE:return"audio";case StreamTypes.METADATA_STREAM_TYPE:return"timed-metadata";default:return null}},parsePesTime=function(packet){var pusi=parsePayloadUnitStartIndicator(packet);if(!pusi)return null;var ptsDtsFlags,offset=4+parseAdaptionField(packet),pes={};return ptsDtsFlags=packet[offset+7],192&ptsDtsFlags&&(pes.pts=(14&packet[offset+9])<<27|(255&packet[offset+10])<<20|(254&packet[offset+11])<<12|(255&packet[offset+12])<<5|(254&packet[offset+13])>>>3,pes.pts*=4,pes.pts+=(6&packet[offset+13])>>>1,pes.dts=pes.pts,64&ptsDtsFlags&&(pes.dts=(14&packet[offset+14])<<27|(255&packet[offset+15])<<20|(254&packet[offset+16])<<12|(255&packet[offset+17])<<5|(254&packet[offset+18])>>>3,pes.dts*=4,pes.dts+=(6&packet[offset+18])>>>1)),pes},parseNalUnitType=function(type){switch(type){case 5:return"slice_layer_without_partitioning_rbsp_idr";case 6:return"sei_rbsp";case 7:return"seq_parameter_set_rbsp";case 8:return"pic_parameter_set_rbsp";case 9:return"access_unit_delimiter_rbsp";default:return null}},videoPacketContainsKeyFrame=function(packet){for(var nalType,offset=4+parseAdaptionField(packet),frameBuffer=packet.subarray(offset),frameI=0,frameSyncPoint=0,foundKeyFrame=!1;frameSyncPoint<frameBuffer.byteLength-3;frameSyncPoint++)if(1===frameBuffer[frameSyncPoint+2]){frameI=frameSyncPoint+5;break}while(frameI<frameBuffer.byteLength)switch(frameBuffer[frameI]){case 0:if(0!==frameBuffer[frameI-1]){frameI+=2;break}if(0!==frameBuffer[frameI-2]){frameI++;break}frameSyncPoint+3!==frameI-2&&(nalType=parseNalUnitType(31&frameBuffer[frameSyncPoint+3]),"slice_layer_without_partitioning_rbsp_idr"===nalType&&(foundKeyFrame=!0));do frameI++;while(1!==frameBuffer[frameI]&&frameI<frameBuffer.length);frameSyncPoint=frameI-2,frameI+=3;break;case 1:if(0!==frameBuffer[frameI-1]||0!==frameBuffer[frameI-2]){frameI+=3;break}nalType=parseNalUnitType(31&frameBuffer[frameSyncPoint+3]),"slice_layer_without_partitioning_rbsp_idr"===nalType&&(foundKeyFrame=!0),frameSyncPoint=frameI-2,frameI+=3;break;default:frameI+=3}return frameBuffer=frameBuffer.subarray(frameSyncPoint),frameI-=frameSyncPoint,frameSyncPoint=0,frameBuffer&&frameBuffer.byteLength>3&&(nalType=parseNalUnitType(31&frameBuffer[frameSyncPoint+3]),"slice_layer_without_partitioning_rbsp_idr"===nalType&&(foundKeyFrame=!0)),foundKeyFrame};module.exports={parseType:parseType,parsePat:parsePat,parsePmt:parsePmt,parsePayloadUnitStartIndicator:parsePayloadUnitStartIndicator,parsePesType:parsePesType,parsePesTime:parsePesTime,videoPacketContainsKeyFrame:videoPacketContainsKeyFrame}},function(module,exports,__webpack_require__){"use strict";module.exports={generator:__webpack_require__(76),Transmuxer:__webpack_require__(46).Transmuxer,AudioSegmentStream:__webpack_require__(46).AudioSegmentStream,VideoSegmentStream:__webpack_require__(46).VideoSegmentStream}},function(module){"use strict";var _findBox,parseType,timescale,startTime;_findBox=function(data,path){var i,size,type,end,subresults,results=[];if(!path.length)return null;for(i=0;i<data.byteLength;)size=data[i]<<24,size|=data[i+1]<<16,size|=data[i+2]<<8,size|=data[i+3],type=parseType(data.subarray(i+4,i+8)),end=size>1?i+size:data.byteLength,type===path[0]&&(1===path.length?results.push(data.subarray(i+8,end)):(subresults=_findBox(data.subarray(i+8,end),path.slice(1)),subresults.length&&(results=results.concat(subresults)))),i=end;return results},parseType=function(buffer){var result="";return result+=String.fromCharCode(buffer[0]),result+=String.fromCharCode(buffer[1]),result+=String.fromCharCode(buffer[2]),result+=String.fromCharCode(buffer[3]),result},timescale=function(init){var result={},traks=_findBox(init,["moov","trak"]);return traks.reduce(function(result,trak){var tkhd,version,index,id,mdhd;return tkhd=_findBox(trak,["tkhd"])[0],tkhd?(version=tkhd[0],index=0===version?12:20,id=tkhd[index]<<24|tkhd[index+1]<<16|tkhd[index+2]<<8|tkhd[index+3],mdhd=_findBox(trak,["mdia","mdhd"])[0],mdhd?(version=mdhd[0],index=0===version?12:20,result[id]=mdhd[index]<<24|mdhd[index+1]<<16|mdhd[index+2]<<8|mdhd[index+3],result):null):null},result)},startTime=function(timescale,fragment){var trafs,baseTimes,result;return trafs=_findBox(fragment,["moof","traf"]),baseTimes=[].concat.apply([],trafs.map(function(traf){return _findBox(traf,["tfhd"]).map(function(tfhd){var id,scale,baseTime;return id=tfhd[4]<<24|tfhd[5]<<16|tfhd[6]<<8|tfhd[7],scale=timescale[id]||9e4,baseTime=_findBox(traf,["tfdt"]).map(function(tfdt){var version,result;return version=tfdt[0],result=tfdt[4]<<24|tfdt[5]<<16|tfdt[6]<<8|tfdt[7],1===version&&(result*=Math.pow(2,32),result+=tfdt[8]<<24|tfdt[9]<<16|tfdt[10]<<8|tfdt[11]),result})[0],baseTime=baseTime||1/0,baseTime/scale})})),result=Math.min.apply(null,baseTimes),isFinite(result)?result:0},module.exports={parseType:parseType,timescale:timescale,startTime:startTime}},function(module){"use strict";var tagTypes={8:"audio",9:"video",18:"metadata"},hex=function(val){return"0x"+("00"+val.toString(16)).slice(-2).toUpperCase()},hexStringList=function(data){var i,arr=[];while(data.byteLength>0)i=0,arr.push(hex(data[i++])),data=data.subarray(i);return arr.join(" ")},parseAVCTag=function(tag,obj){var avcPacketTypes=["AVC Sequence Header","AVC NALU","AVC End-of-Sequence"],compositionTime=tag[1]&parseInt("01111111",2)<<16|tag[2]<<8|tag[3];return obj=obj||{},obj.avcPacketType=avcPacketTypes[tag[0]],obj.CompositionTime=tag[1]&parseInt("10000000",2)?-compositionTime:compositionTime,1===tag[0]?obj.nalUnitTypeRaw=hexStringList(tag.subarray(4,100)):obj.data=hexStringList(tag.subarray(4)),obj},parseVideoTag=function(tag,obj){var frameTypes=["Unknown","Keyframe (for AVC, a seekable frame)","Inter frame (for AVC, a nonseekable frame)","Disposable inter frame (H.263 only)","Generated keyframe (reserved for server use only)","Video info/command frame"],codecID=tag[0]&parseInt("00001111",2);return obj=obj||{},obj.frameType=frameTypes[(tag[0]&parseInt("11110000",2))>>>4],obj.codecID=codecID,7===codecID?parseAVCTag(tag.subarray(1),obj):obj},parseAACTag=function(tag,obj){var packetTypes=["AAC Sequence Header","AAC Raw"];return obj=obj||{},obj.aacPacketType=packetTypes[tag[0]],obj.data=hexStringList(tag.subarray(1)),obj},parseAudioTag=function(tag,obj){var formatTable=["Linear PCM, platform endian","ADPCM","MP3","Linear PCM, little endian","Nellymoser 16-kHz mono","Nellymoser 8-kHz mono","Nellymoser","G.711 A-law logarithmic PCM","G.711 mu-law logarithmic PCM","reserved","AAC","Speex","MP3 8-Khz","Device-specific sound"],samplingRateTable=["5.5-kHz","11-kHz","22-kHz","44-kHz"],soundFormat=(tag[0]&parseInt("11110000",2))>>>4;return obj=obj||{},obj.soundFormat=formatTable[soundFormat],obj.soundRate=samplingRateTable[(tag[0]&parseInt("00001100",2))>>>2],obj.soundSize=(tag[0]&parseInt("00000010",2))>>>1?"16-bit":"8-bit",obj.soundType=tag[0]&parseInt("00000001",2)?"Stereo":"Mono",10===soundFormat?parseAACTag(tag.subarray(1),obj):obj},parseGenericTag=function(tag){return{tagType:tagTypes[tag[0]],dataSize:tag[1]<<16|tag[2]<<8|tag[3],timestamp:tag[7]<<24|tag[4]<<16|tag[5]<<8|tag[6],streamID:tag[8]<<16|tag[9]<<8|tag[10]}},inspectFlvTag=function(tag){var header=parseGenericTag(tag);switch(tag[0]){case 8:parseAudioTag(tag.subarray(11),header);break;case 9:parseVideoTag(tag.subarray(11),header);break;case 18:}return header},inspectFlv=function(bytes){var dataSize,tag,i=9,parsedResults=[];i+=4;while(i<bytes.byteLength)dataSize=bytes[i+1]<<16,dataSize|=bytes[i+2]<<8,dataSize|=bytes[i+3],dataSize+=11,tag=bytes.subarray(i,i+dataSize),parsedResults.push(inspectFlvTag(tag)),i+=dataSize+4;return parsedResults},textifyFlv=function(flvTagArray){return JSON.stringify(flvTagArray,null,2)};module.exports={inspectTag:inspectFlvTag,inspect:inspectFlv,textify:textifyFlv}},function(module,exports,__webpack_require__){(function(global){"use strict";var inspectMp4,_textifyMp,parseType=__webpack_require__(156).parseType,parseMp4Date=function(seconds){return new Date(1e3*seconds-20828448e5)},parseSampleFlags=function(flags){return{isLeading:(12&flags[0])>>>2,dependsOn:3&flags[0],isDependedOn:(192&flags[1])>>>6,hasRedundancy:(48&flags[1])>>>4,paddingValue:(14&flags[1])>>>1,isNonSyncSample:1&flags[1],degradationPriority:flags[2]<<8|flags[3]}},nalParse=function(avcStream){var i,length,avcView=new DataView(avcStream.buffer,avcStream.byteOffset,avcStream.byteLength),result=[];for(i=0;i+4<avcStream.length;i+=length)if(length=avcView.getUint32(i),i+=4,length<=0)result.push("<span style='color:red;'>MALFORMED DATA</span>");else switch(31&avcStream[i]){case 1:result.push("slice_layer_without_partitioning_rbsp");break;case 5:result.push("slice_layer_without_partitioning_rbsp_idr");break;case 6:result.push("sei_rbsp");break;case 7:result.push("seq_parameter_set_rbsp");break;case 8:result.push("pic_parameter_set_rbsp");break;case 9:result.push("access_unit_delimiter_rbsp");break;default:result.push("UNKNOWN NAL - "+avcStream[i]&31)}return result},parse={avc1:function(data){var view=new DataView(data.buffer,data.byteOffset,data.byteLength);return{dataReferenceIndex:view.getUint16(6),width:view.getUint16(24),height:view.getUint16(26),horizresolution:view.getUint16(28)+view.getUint16(30)/16,vertresolution:view.getUint16(32)+view.getUint16(34)/16,frameCount:view.getUint16(40),depth:view.getUint16(74),config:inspectMp4(data.subarray(78,data.byteLength))}},avcC:function(data){var numOfPictureParameterSets,nalSize,offset,i,view=new DataView(data.buffer,data.byteOffset,data.byteLength),result={configurationVersion:data[0],avcProfileIndication:data[1],profileCompatibility:data[2],avcLevelIndication:data[3],lengthSizeMinusOne:3&data[4],sps:[],pps:[]},numOfSequenceParameterSets=31&data[5];for(offset=6,i=0;i<numOfSequenceParameterSets;i++)nalSize=view.getUint16(offset),offset+=2,result.sps.push(new Uint8Array(data.subarray(offset,offset+nalSize))),offset+=nalSize;for(numOfPictureParameterSets=data[offset],offset++,i=0;i<numOfPictureParameterSets;i++)nalSize=view.getUint16(offset),offset+=2,result.pps.push(new Uint8Array(data.subarray(offset,offset+nalSize))),offset+=nalSize;return result},btrt:function(data){var view=new DataView(data.buffer,data.byteOffset,data.byteLength);return{bufferSizeDB:view.getUint32(0),maxBitrate:view.getUint32(4),avgBitrate:view.getUint32(8)}},esds:function(data){return{version:data[0],flags:new Uint8Array(data.subarray(1,4)),esId:data[6]<<8|data[7],streamPriority:31&data[8],decoderConfig:{objectProfileIndication:data[11],streamType:data[12]>>>2&63,bufferSize:data[13]<<16|data[14]<<8|data[15],maxBitrate:data[16]<<24|data[17]<<16|data[18]<<8|data[19],avgBitrate:data[20]<<24|data[21]<<16|data[22]<<8|data[23],decoderConfigDescriptor:{tag:data[24],length:data[25],audioObjectType:data[26]>>>3&31,samplingFrequencyIndex:(7&data[26])<<1|data[27]>>>7&1,channelConfiguration:data[27]>>>3&15}}}},ftyp:function(data){var view=new DataView(data.buffer,data.byteOffset,data.byteLength),result={majorBrand:parseType(data.subarray(0,4)),minorVersion:view.getUint32(4),compatibleBrands:[]},i=8;while(i<data.byteLength)result.compatibleBrands.push(parseType(data.subarray(i,i+4))),i+=4;return result},dinf:function(data){return{boxes:inspectMp4(data)}},dref:function(data){return{version:data[0],flags:new Uint8Array(data.subarray(1,4)),dataReferences:inspectMp4(data.subarray(8))}},hdlr:function(data){var view=new DataView(data.buffer,data.byteOffset,data.byteLength),result={version:view.getUint8(0),flags:new Uint8Array(data.subarray(1,4)),handlerType:parseType(data.subarray(8,12)),name:""},i=8;for(i=24;i<data.byteLength;i++){if(0===data[i]){i++;break}result.name+=String.fromCharCode(data[i])}return result.name=decodeURIComponent(global.escape(result.name)),result},mdat:function(data){return{byteLength:data.byteLength,nals:nalParse(data)}},mdhd:function(data){var language,view=new DataView(data.buffer,data.byteOffset,data.byteLength),i=4,result={version:view.getUint8(0),flags:new Uint8Array(data.subarray(1,4)),language:""};return 1===result.version?(i+=4,result.creationTime=parseMp4Date(view.getUint32(i)),i+=8,result.modificationTime=parseMp4Date(view.getUint32(i)),i+=4,result.timescale=view.getUint32(i),i+=8,result.duration=view.getUint32(i)):(result.creationTime=parseMp4Date(view.getUint32(i)),i+=4,result.modificationTime=parseMp4Date(view.getUint32(i)),i+=4,result.timescale=view.getUint32(i),i+=4,result.duration=view.getUint32(i)),i+=4,language=view.getUint16(i),result.language+=String.fromCharCode((language>>10)+96),result.language+=String.fromCharCode(((960&language)>>5)+96),result.language+=String.fromCharCode((31&language)+96),result},mdia:function(data){return{boxes:inspectMp4(data)}},mfhd:function(data){return{version:data[0],flags:new Uint8Array(data.subarray(1,4)),sequenceNumber:data[4]<<24|data[5]<<16|data[6]<<8|data[7]}},minf:function(data){return{boxes:inspectMp4(data)}},mp4a:function(data){var view=new DataView(data.buffer,data.byteOffset,data.byteLength),result={dataReferenceIndex:view.getUint16(6),channelcount:view.getUint16(16),samplesize:view.getUint16(18),samplerate:view.getUint16(24)+view.getUint16(26)/65536};return data.byteLength>28&&(result.streamDescriptor=inspectMp4(data.subarray(28))[0]),result},moof:function(data){return{boxes:inspectMp4(data)}},moov:function(data){return{boxes:inspectMp4(data)}},mvex:function(data){return{boxes:inspectMp4(data)}},mvhd:function(data){var view=new DataView(data.buffer,data.byteOffset,data.byteLength),i=4,result={version:view.getUint8(0),flags:new Uint8Array(data.subarray(1,4))};return 1===result.version?(i+=4,result.creationTime=parseMp4Date(view.getUint32(i)),i+=8,result.modificationTime=parseMp4Date(view.getUint32(i)),i+=4,result.timescale=view.getUint32(i),i+=8,result.duration=view.getUint32(i)):(result.creationTime=parseMp4Date(view.getUint32(i)),i+=4,result.modificationTime=parseMp4Date(view.getUint32(i)),i+=4,result.timescale=view.getUint32(i),i+=4,result.duration=view.getUint32(i)),i+=4,result.rate=view.getUint16(i)+view.getUint16(i+2)/16,i+=4,result.volume=view.getUint8(i)+view.getUint8(i+1)/8,i+=2,i+=2,i+=2*4,result.matrix=new Uint32Array(data.subarray(i,i+9*4)),i+=9*4,i+=6*4,result.nextTrackId=view.getUint32(i),result},pdin:function(data){var view=new DataView(data.buffer,data.byteOffset,data.byteLength);return{version:view.getUint8(0),flags:new Uint8Array(data.subarray(1,4)),rate:view.getUint32(4),initialDelay:view.getUint32(8)}},sdtp:function(data){var i,result={version:data[0],flags:new Uint8Array(data.subarray(1,4)),samples:[]};for(i=4;i<data.byteLength;i++)result.samples.push({dependsOn:(48&data[i])>>4,isDependedOn:(12&data[i])>>2,hasRedundancy:3&data[i]});return result},sidx:function(data){var i,view=new DataView(data.buffer,data.byteOffset,data.byteLength),result={version:data[0],flags:new Uint8Array(data.subarray(1,4)),references:[],referenceId:view.getUint32(4),timescale:view.getUint32(8),earliestPresentationTime:view.getUint32(12),firstOffset:view.getUint32(16)},referenceCount=view.getUint16(22);for(i=24;referenceCount;i+=12,referenceCount--)result.references.push({referenceType:(128&data[i])>>>7,referencedSize:2147483647&view.getUint32(i),subsegmentDuration:view.getUint32(i+4),startsWithSap:!!(128&data[i+8]),sapType:(112&data[i+8])>>>4,sapDeltaTime:268435455&view.getUint32(i+8)});return result},smhd:function(data){return{version:data[0],flags:new Uint8Array(data.subarray(1,4)),balance:data[4]+data[5]/256}},stbl:function(data){return{boxes:inspectMp4(data)}},stco:function(data){var i,view=new DataView(data.buffer,data.byteOffset,data.byteLength),result={version:data[0],flags:new Uint8Array(data.subarray(1,4)),chunkOffsets:[]},entryCount=view.getUint32(4);for(i=8;entryCount;i+=4,entryCount--)result.chunkOffsets.push(view.getUint32(i));return result},stsc:function(data){var i,view=new DataView(data.buffer,data.byteOffset,data.byteLength),entryCount=view.getUint32(4),result={version:data[0],flags:new Uint8Array(data.subarray(1,4)),sampleToChunks:[]};for(i=8;entryCount;i+=12,entryCount--)result.sampleToChunks.push({firstChunk:view.getUint32(i),samplesPerChunk:view.getUint32(i+4),sampleDescriptionIndex:view.getUint32(i+8)});return result},stsd:function(data){return{version:data[0],flags:new Uint8Array(data.subarray(1,4)),sampleDescriptions:inspectMp4(data.subarray(8))}},stsz:function(data){var i,view=new DataView(data.buffer,data.byteOffset,data.byteLength),result={version:data[0],flags:new Uint8Array(data.subarray(1,4)),sampleSize:view.getUint32(4),entries:[]};for(i=12;i<data.byteLength;i+=4)result.entries.push(view.getUint32(i));return result},stts:function(data){var i,view=new DataView(data.buffer,data.byteOffset,data.byteLength),result={version:data[0],flags:new Uint8Array(data.subarray(1,4)),timeToSamples:[]},entryCount=view.getUint32(4);for(i=8;entryCount;i+=8,entryCount--)result.timeToSamples.push({sampleCount:view.getUint32(i),sampleDelta:view.getUint32(i+4)});return result},styp:function(data){return parse.ftyp(data)},tfdt:function(data){var ab=new ArrayBuffer(4),dv=new DataView(ab),bmdt=new Uint8Array(ab);bmdt.set([data[4],data[5],data[6],data[7]]);var result={version:data[0],flags:new Uint8Array(data.subarray(1,4)),baseMediaDecodeTime:dv.getUint32(0)};return 1===result.version&&(result.baseMediaDecodeTime*=Math.pow(2,32),bmdt.set([data[8],data[9],data[10],data[11]]),result.baseMediaDecodeTime+=dv.getUint32(0)),result},tfhd:function(data){var i,view=new DataView(data.buffer,data.byteOffset,data.byteLength),result={version:data[0],flags:new Uint8Array(data.subarray(1,4)),trackId:view.getUint32(4)},baseDataOffsetPresent=1&result.flags[2],sampleDescriptionIndexPresent=2&result.flags[2],defaultSampleDurationPresent=8&result.flags[2],defaultSampleSizePresent=16&result.flags[2],defaultSampleFlagsPresent=32&result.flags[2];return i=8,baseDataOffsetPresent&&(i+=4,result.baseDataOffset=view.getUint32(12),i+=4),sampleDescriptionIndexPresent&&(result.sampleDescriptionIndex=view.getUint32(i),i+=4),defaultSampleDurationPresent&&(result.defaultSampleDuration=view.getUint32(i),i+=4),defaultSampleSizePresent&&(result.defaultSampleSize=view.getUint32(i),i+=4),defaultSampleFlagsPresent&&(result.defaultSampleFlags=view.getUint32(i)),result},tkhd:function(data){var view=new DataView(data.buffer,data.byteOffset,data.byteLength),i=4,result={version:view.getUint8(0),flags:new Uint8Array(data.subarray(1,4))};return 1===result.version?(i+=4,result.creationTime=parseMp4Date(view.getUint32(i)),i+=8,result.modificationTime=parseMp4Date(view.getUint32(i)),i+=4,result.trackId=view.getUint32(i),i+=4,i+=8,result.duration=view.getUint32(i)):(result.creationTime=parseMp4Date(view.getUint32(i)),i+=4,result.modificationTime=parseMp4Date(view.getUint32(i)),i+=4,result.trackId=view.getUint32(i),i+=4,i+=4,result.duration=view.getUint32(i)),i+=4,i+=2*4,result.layer=view.getUint16(i),i+=2,result.alternateGroup=view.getUint16(i),i+=2,result.volume=view.getUint8(i)+view.getUint8(i+1)/8,i+=2,i+=2,result.matrix=new Uint32Array(data.subarray(i,i+9*4)),i+=9*4,result.width=view.getUint16(i)+view.getUint16(i+2)/16,i+=4,result.height=view.getUint16(i)+view.getUint16(i+2)/16,result},traf:function(data){return{boxes:inspectMp4(data)}},trak:function(data){return{boxes:inspectMp4(data)}},trex:function(data){var view=new DataView(data.buffer,data.byteOffset,data.byteLength);return{version:data[0],flags:new Uint8Array(data.subarray(1,4)),trackId:view.getUint32(4),defaultSampleDescriptionIndex:view.getUint32(8),defaultSampleDuration:view.getUint32(12),defaultSampleSize:view.getUint32(16),sampleDependsOn:3&data[20],sampleIsDependedOn:(192&data[21])>>6,sampleHasRedundancy:(48&data[21])>>4,samplePaddingValue:(14&data[21])>>1,sampleIsDifferenceSample:!!(1&data[21]),sampleDegradationPriority:view.getUint16(22)}},trun:function(data){var sample,result={version:data[0],flags:new Uint8Array(data.subarray(1,4)),samples:[]},view=new DataView(data.buffer,data.byteOffset,data.byteLength),dataOffsetPresent=1&result.flags[2],firstSampleFlagsPresent=4&result.flags[2],sampleDurationPresent=1&result.flags[1],sampleSizePresent=2&result.flags[1],sampleFlagsPresent=4&result.flags[1],sampleCompositionTimeOffsetPresent=8&result.flags[1],sampleCount=view.getUint32(4),offset=8;
dataOffsetPresent&&(result.dataOffset=view.getUint32(offset),offset+=4),firstSampleFlagsPresent&&sampleCount&&(sample={flags:parseSampleFlags(data.subarray(offset,offset+4))},offset+=4,sampleDurationPresent&&(sample.duration=view.getUint32(offset),offset+=4),sampleSizePresent&&(sample.size=view.getUint32(offset),offset+=4),sampleCompositionTimeOffsetPresent&&(sample.compositionTimeOffset=view.getUint32(offset),offset+=4),result.samples.push(sample),sampleCount--);while(sampleCount--)sample={},sampleDurationPresent&&(sample.duration=view.getUint32(offset),offset+=4),sampleSizePresent&&(sample.size=view.getUint32(offset),offset+=4),sampleFlagsPresent&&(sample.flags=parseSampleFlags(data.subarray(offset,offset+4)),offset+=4),sampleCompositionTimeOffsetPresent&&(sample.compositionTimeOffset=view.getUint32(offset),offset+=4),result.samples.push(sample);return result},"url ":function(data){return{version:data[0],flags:new Uint8Array(data.subarray(1,4))}},vmhd:function(data){var view=new DataView(data.buffer,data.byteOffset,data.byteLength);return{version:data[0],flags:new Uint8Array(data.subarray(1,4)),graphicsmode:view.getUint16(4),opcolor:new Uint16Array([view.getUint16(6),view.getUint16(8),view.getUint16(10)])}}};inspectMp4=function(data){for(var view,size,type,end,box,i=0,result=[],ab=new ArrayBuffer(data.length),v=new Uint8Array(ab),z=0;z<data.length;++z)v[z]=data[z];view=new DataView(ab);while(i<data.byteLength)size=view.getUint32(i),type=parseType(data.subarray(i+4,i+8)),end=size>1?i+size:data.byteLength,box=(parse[type]||function(data){return{data:data}})(data.subarray(i+8,end)),box.size=size,box.type=type,result.push(box),i=end;return result},_textifyMp=function(inspectedMp4,depth){var indent;return depth=depth||0,indent=new Array(2*depth+1).join(" "),inspectedMp4.map(function(box){return indent+box.type+"\n"+Object.keys(box).filter(function(key){return"type"!==key&&"boxes"!==key}).map(function(key){var prefix=indent+"  "+key+": ",value=box[key];if(value instanceof Uint8Array||value instanceof Uint32Array){var bytes=Array.prototype.slice.call(new Uint8Array(value.buffer,value.byteOffset,value.byteLength)).map(function(byte){return" "+("00"+byte.toString(16)).slice(-2)}).join("").match(/.{1,24}/g);return bytes?1===bytes.length?prefix+"<"+bytes.join("").slice(1)+">":prefix+"<\n"+bytes.map(function(line){return indent+"  "+line}).join("\n")+"\n"+indent+"  >":prefix+"<>"}return prefix+JSON.stringify(value,null,2).split("\n").map(function(line,index){return 0===index?line:indent+"  "+line}).join("\n")}).join("\n")+(box.boxes?"\n"+_textifyMp(box.boxes,depth+1):"")}).join("\n")},module.exports={inspect:inspectMp4,textify:_textifyMp}}).call(exports,function(){return this}())},function(module,exports,__webpack_require__){"use strict";var StreamTypes=__webpack_require__(26),handleRollover=__webpack_require__(75).handleRollover,probe={};probe.ts=__webpack_require__(154),probe.aac=__webpack_require__(143);var PES_TIMESCALE=9e4,MP2T_PACKET_LENGTH=188,SYNC_BYTE=71,isLikelyAacData=function(data){return data[0]==="I".charCodeAt(0)&&data[1]==="D".charCodeAt(0)&&data[2]==="3".charCodeAt(0)},parsePsi_=function(bytes,pmt){var packet,type,startIndex=0,endIndex=MP2T_PACKET_LENGTH;while(endIndex<bytes.byteLength)if(bytes[startIndex]!==SYNC_BYTE||bytes[endIndex]!==SYNC_BYTE)startIndex++,endIndex++;else{switch(packet=bytes.subarray(startIndex,endIndex),type=probe.ts.parseType(packet,pmt.pid),type){case"pat":pmt.pid||(pmt.pid=probe.ts.parsePat(packet));break;case"pmt":pmt.table||(pmt.table=probe.ts.parsePmt(packet))}if(pmt.pid&&pmt.table)return;startIndex+=MP2T_PACKET_LENGTH,endIndex+=MP2T_PACKET_LENGTH}},parseAudioPes_=function(bytes,pmt,result){var packet,type,pesType,pusi,parsed,startIndex=0,endIndex=MP2T_PACKET_LENGTH,endLoop=!1;while(endIndex<bytes.byteLength)if(bytes[startIndex]!==SYNC_BYTE||bytes[endIndex]!==SYNC_BYTE)startIndex++,endIndex++;else{switch(packet=bytes.subarray(startIndex,endIndex),type=probe.ts.parseType(packet,pmt.pid),type){case"pes":pesType=probe.ts.parsePesType(packet,pmt.table),pusi=probe.ts.parsePayloadUnitStartIndicator(packet),"audio"===pesType&&pusi&&(parsed=probe.ts.parsePesTime(packet),parsed.type="audio",result.audio.push(parsed),endLoop=!0)}if(endLoop)break;startIndex+=MP2T_PACKET_LENGTH,endIndex+=MP2T_PACKET_LENGTH}endIndex=bytes.byteLength,startIndex=endIndex-MP2T_PACKET_LENGTH,endLoop=!1;while(startIndex>=0)if(bytes[startIndex]!==SYNC_BYTE||bytes[endIndex]!==SYNC_BYTE)startIndex--,endIndex--;else{switch(packet=bytes.subarray(startIndex,endIndex),type=probe.ts.parseType(packet,pmt.pid),type){case"pes":pesType=probe.ts.parsePesType(packet,pmt.table),pusi=probe.ts.parsePayloadUnitStartIndicator(packet),"audio"===pesType&&pusi&&(parsed=probe.ts.parsePesTime(packet),parsed.type="audio",result.audio.push(parsed),endLoop=!0)}if(endLoop)break;startIndex-=MP2T_PACKET_LENGTH,endIndex-=MP2T_PACKET_LENGTH}},parseVideoPes_=function(bytes,pmt,result){var packet,type,pesType,pusi,parsed,frame,i,pes,startIndex=0,endIndex=MP2T_PACKET_LENGTH,endLoop=!1,currentFrame={data:[],size:0};while(endIndex<bytes.byteLength)if(bytes[startIndex]!==SYNC_BYTE||bytes[endIndex]!==SYNC_BYTE)startIndex++,endIndex++;else{switch(packet=bytes.subarray(startIndex,endIndex),type=probe.ts.parseType(packet,pmt.pid),type){case"pes":if(pesType=probe.ts.parsePesType(packet,pmt.table),pusi=probe.ts.parsePayloadUnitStartIndicator(packet),"video"===pesType&&(pusi&&!endLoop&&(parsed=probe.ts.parsePesTime(packet),parsed.type="video",result.video.push(parsed),endLoop=!0),!result.firstKeyFrame)){if(pusi&&0!==currentFrame.size){frame=new Uint8Array(currentFrame.size),i=0;while(currentFrame.data.length)pes=currentFrame.data.shift(),frame.set(pes,i),i+=pes.byteLength;probe.ts.videoPacketContainsKeyFrame(frame)&&(result.firstKeyFrame=probe.ts.parsePesTime(frame),result.firstKeyFrame.type="video"),currentFrame.size=0}currentFrame.data.push(packet),currentFrame.size+=packet.byteLength}}if(endLoop&&result.firstKeyFrame)break;startIndex+=MP2T_PACKET_LENGTH,endIndex+=MP2T_PACKET_LENGTH}endIndex=bytes.byteLength,startIndex=endIndex-MP2T_PACKET_LENGTH,endLoop=!1;while(startIndex>=0)if(bytes[startIndex]!==SYNC_BYTE||bytes[endIndex]!==SYNC_BYTE)startIndex--,endIndex--;else{switch(packet=bytes.subarray(startIndex,endIndex),type=probe.ts.parseType(packet,pmt.pid),type){case"pes":pesType=probe.ts.parsePesType(packet,pmt.table),pusi=probe.ts.parsePayloadUnitStartIndicator(packet),"video"===pesType&&pusi&&(parsed=probe.ts.parsePesTime(packet),parsed.type="video",result.video.push(parsed),endLoop=!0)}if(endLoop)break;startIndex-=MP2T_PACKET_LENGTH,endIndex-=MP2T_PACKET_LENGTH}},adjustTimestamp_=function(segmentInfo,baseTimestamp){if(segmentInfo.audio&&segmentInfo.audio.length){var audioBaseTimestamp=baseTimestamp;"undefined"===typeof audioBaseTimestamp&&(audioBaseTimestamp=segmentInfo.audio[0].dts),segmentInfo.audio.forEach(function(info){info.dts=handleRollover(info.dts,audioBaseTimestamp),info.pts=handleRollover(info.pts,audioBaseTimestamp),info.dtsTime=info.dts/PES_TIMESCALE,info.ptsTime=info.pts/PES_TIMESCALE})}if(segmentInfo.video&&segmentInfo.video.length){var videoBaseTimestamp=baseTimestamp;if("undefined"===typeof videoBaseTimestamp&&(videoBaseTimestamp=segmentInfo.video[0].dts),segmentInfo.video.forEach(function(info){info.dts=handleRollover(info.dts,videoBaseTimestamp),info.pts=handleRollover(info.pts,videoBaseTimestamp),info.dtsTime=info.dts/PES_TIMESCALE,info.ptsTime=info.pts/PES_TIMESCALE}),segmentInfo.firstKeyFrame){var frame=segmentInfo.firstKeyFrame;frame.dts=handleRollover(frame.dts,videoBaseTimestamp),frame.pts=handleRollover(frame.pts,videoBaseTimestamp),frame.dtsTime=frame.dts/PES_TIMESCALE,frame.ptsTime=frame.dts/PES_TIMESCALE}}},inspectAac_=function(bytes){var packet,endLoop=!1,audioCount=0,sampleRate=null,timestamp=null,frameSize=0,byteIndex=0;while(bytes.length-byteIndex>=3){var type=probe.aac.parseType(bytes,byteIndex);switch(type){case"timed-metadata":if(bytes.length-byteIndex<10){endLoop=!0;break}if(frameSize=probe.aac.parseId3TagSize(bytes,byteIndex),frameSize>bytes.length){endLoop=!0;break}null===timestamp&&(packet=bytes.subarray(byteIndex,byteIndex+frameSize),timestamp=probe.aac.parseAacTimestamp(packet)),byteIndex+=frameSize;break;case"audio":if(bytes.length-byteIndex<7){endLoop=!0;break}if(frameSize=probe.aac.parseAdtsSize(bytes,byteIndex),frameSize>bytes.length){endLoop=!0;break}null===sampleRate&&(packet=bytes.subarray(byteIndex,byteIndex+frameSize),sampleRate=probe.aac.parseSampleRate(packet)),audioCount++,byteIndex+=frameSize;break;default:byteIndex++}if(endLoop)return null}if(null===sampleRate||null===timestamp)return null;var audioTimescale=PES_TIMESCALE/sampleRate,result={audio:[{type:"audio",dts:timestamp,pts:timestamp},{type:"audio",dts:timestamp+1024*audioCount*audioTimescale,pts:timestamp+1024*audioCount*audioTimescale}]};return result},inspectTs_=function(bytes){var pmt={pid:null,table:null},result={};parsePsi_(bytes,pmt);for(var pid in pmt.table)if(pmt.table.hasOwnProperty(pid)){var type=pmt.table[pid];switch(type){case StreamTypes.H264_STREAM_TYPE:result.video=[],parseVideoPes_(bytes,pmt,result),0===result.video.length&&delete result.video;break;case StreamTypes.ADTS_STREAM_TYPE:result.audio=[],parseAudioPes_(bytes,pmt,result),0===result.audio.length&&delete result.audio}}return result},inspect=function(bytes,baseTimestamp){var result,isAacData=isLikelyAacData(bytes);return result=isAacData?inspectAac_(bytes):inspectTs_(bytes),result&&(result.audio||result.video)?(adjustTimestamp_(result,baseTimestamp),result):null};module.exports={inspect:inspect}},function(module){"use strict";var secondsToVideoTs,secondsToAudioTs,videoTsToSeconds,audioTsToSeconds,audioTsToVideoTs,videoTsToAudioTs,ONE_SECOND_IN_TS=9e4;secondsToVideoTs=function(seconds){return seconds*ONE_SECOND_IN_TS},secondsToAudioTs=function(seconds,sampleRate){return seconds*sampleRate},videoTsToSeconds=function(timestamp){return timestamp/ONE_SECOND_IN_TS},audioTsToSeconds=function(timestamp,sampleRate){return timestamp/sampleRate},audioTsToVideoTs=function(timestamp,sampleRate){return secondsToVideoTs(audioTsToSeconds(timestamp,sampleRate))},videoTsToAudioTs=function(timestamp,sampleRate){return secondsToAudioTs(videoTsToSeconds(timestamp),sampleRate)},module.exports={secondsToVideoTs:secondsToVideoTs,secondsToAudioTs:secondsToAudioTs,videoTsToSeconds:videoTsToSeconds,audioTsToSeconds:audioTsToSeconds,audioTsToVideoTs:audioTsToVideoTs,videoTsToAudioTs:videoTsToAudioTs}},function(module){"use strict";var ExpGolomb;ExpGolomb=function(workingData){var workingBytesAvailable=workingData.byteLength,workingWord=0,workingBitsAvailable=0;this.length=function(){return 8*workingBytesAvailable},this.bitsAvailable=function(){return 8*workingBytesAvailable+workingBitsAvailable},this.loadWord=function(){var position=workingData.byteLength-workingBytesAvailable,workingBytes=new Uint8Array(4),availableBytes=Math.min(4,workingBytesAvailable);if(0===availableBytes)throw new Error("no bytes available");workingBytes.set(workingData.subarray(position,position+availableBytes)),workingWord=new DataView(workingBytes.buffer).getUint32(0),workingBitsAvailable=8*availableBytes,workingBytesAvailable-=availableBytes},this.skipBits=function(count){var skipBytes;workingBitsAvailable>count?(workingWord<<=count,workingBitsAvailable-=count):(count-=workingBitsAvailable,skipBytes=Math.floor(count/8),count-=8*skipBytes,workingBytesAvailable-=skipBytes,this.loadWord(),workingWord<<=count,workingBitsAvailable-=count)},this.readBits=function(size){var bits=Math.min(workingBitsAvailable,size),valu=workingWord>>>32-bits;return workingBitsAvailable-=bits,workingBitsAvailable>0?workingWord<<=bits:workingBytesAvailable>0&&this.loadWord(),bits=size-bits,bits>0?valu<<bits|this.readBits(bits):valu},this.skipLeadingZeros=function(){var leadingZeroCount;for(leadingZeroCount=0;leadingZeroCount<workingBitsAvailable;++leadingZeroCount)if(0!==(workingWord&2147483648>>>leadingZeroCount))return workingWord<<=leadingZeroCount,workingBitsAvailable-=leadingZeroCount,leadingZeroCount;return this.loadWord(),leadingZeroCount+this.skipLeadingZeros()},this.skipUnsignedExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())},this.skipExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())},this.readUnsignedExpGolomb=function(){var clz=this.skipLeadingZeros();return this.readBits(clz+1)-1},this.readExpGolomb=function(){var valu=this.readUnsignedExpGolomb();return 1&valu?1+valu>>>1:-1*(valu>>>1)},this.readBoolean=function(){return 1===this.readBits(1)},this.readUnsignedByte=function(){return this.readBits(8)},this.loadWord()},module.exports=ExpGolomb},function(){"use strict";"function"!==typeof Object.assign&&(Object.assign=function(target){if(null===target)throw new TypeError("Cannot convert undefined or null to object");for(var to=Object(target),index=1;index<arguments.length;index++){var nextSource=arguments[index];if(null!==nextSource)for(var nextKey in nextSource)Object.prototype.hasOwnProperty.call(nextSource,nextKey)&&(to[nextKey]=nextSource[nextKey])}return to})},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_lodash=__webpack_require__(98),_lodash2=_interopRequireDefault(_lodash);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var OrderedArray=function(){function OrderedArray(){var contents=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],iteratee=arguments.length>1&&void 0!==arguments[1]?arguments[1]:_lodash2.default.identity;if(_classCallCheck(this,OrderedArray),this._values=[],this._iteratee=iteratee,!_lodash2.default.isArray(contents))throw new Error("OrderedArray, initial contents must be an array");this.insertList(contents)}return _createClass(OrderedArray,[{key:"at",value:function(n){return this._values[n]}},{key:"shift",value:function(){return this._values.shift()}},{key:"pop",value:function(){return this._values.pop()}},{key:"clear",value:function(){this.extract()}},{key:"extract",value:function(){var start=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,count=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.length-start;return this._values.splice(start,count)}},{key:"extractWithFilter",value:function(start,count,filter){if(!filter)throw new Error("OrderedArray.extractWithFilter requires a filter");var extracted=[],limit=this.length-start;count<limit&&(limit=count);for(var inRun=!1,startOfRun=void 0,runLength=void 0,i=0,next=start;i<limit;i++)filter(this._values[next])?(inRun||(startOfRun=next,runLength=0,inRun=!0),runLength++):inRun&&(extracted=extracted.concat(this._values.splice(startOfRun,runLength)),inRun=!1,next-=runLength),next++;return inRun&&(extracted=extracted.concat(this._values.splice(startOfRun,runLength))),extracted}},{key:"rangeByValue",value:function(startValue){var endValue=arguments.length>1&&void 0!==arguments[1]?arguments[1]:startValue,minValue=void 0,maxValue=void 0;this._iteratee(startValue)<=this._iteratee(endValue)?(minValue=startValue,maxValue=endValue):(minValue=endValue,maxValue=startValue);var start=this.indexStart(minValue),end=this.indexAfter(maxValue);return{start:start,end:end}}},{key:"extractByValue",value:function(startValue){var endValue=arguments.length>1&&void 0!==arguments[1]?arguments[1]:startValue,_rangeByValue=this.rangeByValue(startValue,endValue),start=_rangeByValue.start,end=_rangeByValue.end;return this.extract(start,end-start)}},{key:"extractByValueWithFilter",value:function(startValue,endValue,filter){var _rangeByValue2=this.rangeByValue(startValue,endValue),start=_rangeByValue2.start,end=_rangeByValue2.end;return this.extractWithFilter(start,end-start,filter)}},{key:"slice",value:function(){var start=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,end=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.length;return this._values.slice(start,end)}},{key:"sliceByValue",value:function(startValue){var endValue=arguments.length>1&&void 0!==arguments[1]?arguments[1]:startValue,_rangeByValue3=this.rangeByValue(startValue,endValue),start=_rangeByValue3.start,end=_rangeByValue3.end;return this.slice(start,end)}},{key:"indexStart",value:function(value){return _lodash2.default.sortedIndexBy(this._values,value,this._iteratee)}},{key:"indexOf",value:function(value){var pos=this.indexStart(value);return this._iteratee(this._values[pos])!==this._iteratee(value)&&(pos=-1),pos}},{key:"indexAfter",value:function(value){return _lodash2.default.sortedLastIndexBy(this._values,value,this._iteratee)}},{key:"insert",value:function(value){var pos=this.indexAfter(value);this._values.splice(pos,0,value)}},{key:"insertList",value:function(values){var _this=this;if(!_lodash2.default.isArray(values))throw new Error("OrderedArray.insertMultiples requires an array as input : {"+values);values.forEach(function(value){return _this.insert(value)})}},{key:"length",get:function(){return this._values.length}},{key:"values",get:function(){return this._values.slice()}}]),OrderedArray}();exports.default=OrderedArray,module.exports=exports["default"]},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_HlsUtils=__webpack_require__(6),_HlsUtils2=_interopRequireDefault(_HlsUtils);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var HlsDateRange=function(){function HlsDateRange(dateRange){_classCallCheck(this,HlsDateRange),this._rawDateRange=dateRange,this._parse()}return _createClass(HlsDateRange,[{key:"dispose",value:function(){}},{key:"set",value:function(dateRange){this._rawDateRange=dateRange,this._parse()}},{key:"clearValues",value:function(){this._id=void 0,this._startDate=void 0,this._bamcmd=void 0,this._plannedDuration=void 0,this._duration=void 0}},{key:"_parse",value:function(){if(null!=this._rawDateRange&&_HlsUtils2.default.isString(this._rawDateRange)){this._split=this._rawDateRange.split(",");for(var splitLen=this._split.length,i=0;i<splitLen;i++){var innerSplit=this._split[i].split("=");if(innerSplit.length>1){var value=innerSplit[1].replace(/^"(.*)"$/,"$1");"ID"===innerSplit[0]?this._id=value:"START-DATE"===innerSplit[0]?this._startDate=value:"PLANNED-DURATION"===innerSplit[0]?this._plannedDuration=value:"DURATION"===innerSplit[0]?this._duration=value:"X-BAM-CMD"===innerSplit[0]&&(this._bamcmd=value)}}}else this.clearValues()}},{key:"id",get:function(){return this._id}},{key:"startDate",get:function(){return this._startDate}},{key:"plannedDuration",get:function(){return this._plannedDuration}},{key:"duration",get:function(){return this._duration}},{key:"bamcmd",get:function(){return this._bamcmd}},{key:"rawDateRange",get:function(){return this._rawDateRange}}]),HlsDateRange}();exports.default=HlsDateRange,module.exports=exports["default"]},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_HlsUtils=__webpack_require__(6),_HlsUtils2=_interopRequireDefault(_HlsUtils);__webpack_require__(162);var _lodash=__webpack_require__(98),_lodash2=_interopRequireDefault(_lodash),_detectBrowser=__webpack_require__(47),_detectBrowser2=_interopRequireDefault(_detectBrowser),_dataTypes=__webpack_require__(37),_dataTypes2=_interopRequireDefault(_dataTypes);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var _hlsKeyRef=null,HlsKey=function(){function HlsKey(downloader){var config=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};_classCallCheck(this,HlsKey),this._downloader=downloader,this._keys=[],this._pendedLoads=[],this._inLoad=!1,this._browDetected=_detectBrowser2.default,"node"===this._browDetected.name?this._transType="array":this._transType="arraybuffer",_HlsUtils2.default.applyConfig(this,config),_hlsKeyRef=this}return _createClass(HlsKey,[{key:"dispose",value:function(){}},{key:"destroy",value:function(){}},{key:"_getCypher",value:function(url){var foundkey=void 0,returnval=void 0,gettingFind=function(x){return x.url===url};if(foundkey=_lodash2.default.find(this._keys,gettingFind),void 0===foundkey){var getCypherThat=this,cypher=new Promise(function(resolve,reject){var cypherGot=function(response){if(getCypherThat._inLoad=!1,void 0===response?reject(-1):resolve(response.data),0!==getCypherThat._pendedLoads.length){var pendedLoad=getCypherThat._pendedLoads.shift();getCypherThat.loadKeyIn(pendedLoad.url,pendedLoad.finishedCallback,pendedLoad.timeoutCallback,pendedLoad.getCypherThat)}},cypherTimeout=function(){getCypherThat._inLoad=!1,reject(-1)};getCypherThat.loadKeyIn(url,cypherGot,cypherTimeout,getCypherThat)});this._keys.push({url:url,cypher:cypher}),returnval=cypher}else returnval=foundkey.cypher;return returnval}},{key:"getCypher",value:function(url){var getCypherThat=this,gettingCypher=new Promise(function(resolve,reject){getCypherThat._getCypher(url).then(function(data){return resolve(data)}).catch(function(err){return reject(err)})});return gettingCypher}},{key:"hlsKeyLoadCallback",value:function(context,callbacks){_hlsKeyRef.getCypher(context.url).then(function(data){return callbacks.onSuccess(data)}).catch(function(err){return callbacks.onError(null,new Error("Could not load key "+err))})}},{key:"loadKeyIn",value:function(url,finishedCallback,timeoutCallback,getCypherThat){if(getCypherThat._inLoad)getCypherThat._pendedLoads.push({url:url,finishedCallback:finishedCallback,timeoutCallback:timeoutCallback,getCypherThat:getCypherThat});else{getCypherThat._inLoad=!0;var loaderContext={url:url,responseType:getCypherThat._transType,dataType:_dataTypes2.default.KEY},loaderConfig={timeout:1e4},loaderCallbacks={onSuccess:finishedCallback.bind(getCypherThat),onTimeout:timeoutCallback.bind(getCypherThat)};getCypherThat._downloader.load(loaderContext,loaderConfig,loaderCallbacks)}}},{key:"downloader",get:function(){return this._downloader},set:function(downloader){return this._downloader=downloader,this._downloader}},{key:"length",get:function(){return this._keys.length}}]),HlsKey}();exports.default=HlsKey,module.exports=exports["default"]},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_HlsUtils=__webpack_require__(6),_HlsUtils2=_interopRequireDefault(_HlsUtils);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var InstanceCounter=function(){function InstanceCounter(){var config=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,InstanceCounter),this._lastNumber=0,this._totalActive=0,_HlsUtils2.default.applyConfig(this,config)}return _createClass(InstanceCounter,[{key:"dispose",value:function(){}},{key:"increment",value:function(){return this._lastNumber++,this._totalActive++,this._lastNumber}},{key:"decrement",value:function(){return this._totalActive--,this._totalActive}},{key:"active",value:function(){return this._totalActive}},{key:"total",value:function(){return this._lastNumber}}]),InstanceCounter}();exports.default=InstanceCounter,module.exports=exports["default"]},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_HlsUtils=__webpack_require__(6),_HlsUtils2=_interopRequireDefault(_HlsUtils),_HlsEvents=__webpack_require__(14),_HlsEvents2=_interopRequireDefault(_HlsEvents),_eventemitter=__webpack_require__(34),_eventemitter2=_interopRequireDefault(_eventemitter);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var LogTube=function(){function LogTube(){var config=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},di=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};_classCallCheck(this,LogTube),this._emitter=di.eventEmitter||new _eventemitter2.default,this._event=_HlsEvents2.default.LOGTUBE_LOG,_HlsUtils2.default.applyConfig(this,config)}return _createClass(LogTube,[{key:"dispose",value:function(){this._emitter=null}},{key:"log",value:function(message){this._debug&&(void 0!==this._emitter.trigger?this._emitter.trigger(this._event,{message:message}):this._emitter.emit(this._event,{message:message}))}},{key:"debug",get:function(){return this._debug},set:function(value){this._debug=!!value}},{key:"event",get:function(){return this._event},set:function(value){this._event=value}}]),LogTube}();exports.default=LogTube,module.exports=exports["default"]},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_HlsUtils=__webpack_require__(6),_HlsUtils2=_interopRequireDefault(_HlsUtils),_OrderedArray=__webpack_require__(163),_OrderedArray2=_interopRequireDefault(_OrderedArray);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var MarkerM=function(){function MarkerM(){var config=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,MarkerM),this._markers=new _OrderedArray2.default([],function(x){return x.time}),this._lastTime=-(1/0),this._nextMarkerId=1,_HlsUtils2.default.applyConfig(this,config)}return _createClass(MarkerM,[{key:"dispose",value:function(){this._markers=null}},{key:"addMarker",value:function(time){var data=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,callback=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,markerId=this._nextMarkerId;if(_HlsUtils2.default.checkNotFiniteAndThrow(time,"MarkerM.addMarker: time"),this._nextMarkerId++,callback&&!_HlsUtils2.default.isFunction(callback))throw new Error("MarkerM.addMarker: callback must be a function if specified");var marker={time:time,data:data,callback:callback,markerId:markerId};return void 0!==marker&&null!==marker&&void 0!==marker.time?this._markers.insert(marker):markerId=0,markerId}},{key:"clearAllMarkers",value:function(){this._markers.clear()}},{key:"removeMarkerRange",value:function(start,end,filter){this._markers.extractByValueWithFilter(start,end,filter)}},{key:"removeMarker",value:function(markerId){var total=this._count;this._markers.extractWithFilter(0,total,function(v){return v.markerId===markerId})}},{key:"seekMarkers",value:function(time){this._lastTime=time}},{key:"_triggerMarker",value:function(marker){var callback=marker.callback;callback&&callback(marker.time,marker.data,marker.markerId)}},{key:"_triggerMarkers",value:function(markers){var _this=this;markers.forEach(function(marker){return _this._triggerMarker(marker)})}},{key:"timeUpdate",value:function(timeNow){if(this._markers.length){var pickedMarkers=this._markers.sliceByValue({time:this._lastTime},{time:timeNow});this._triggerMarkers(pickedMarkers)}}},{key:"timeUpdateWithExtract",value:function(timeNow,filter){if(this._markers.length){var pickedMarkers=this._markers.extractByValueWithFilter({time:this._lastTime},{time:timeNow},filter);this._triggerMarkers(pickedMarkers)}}},{key:"count",get:function(){return this._markers.length}}]),MarkerM}();exports.default=MarkerM,module.exports=exports["default"]},function(module){module.exports=function(it,Constructor,name,forbiddenField){if(!(it instanceof Constructor)||void 0!==forbiddenField&&forbiddenField in it)throw TypeError(name+": incorrect invocation!");return it}},function(module,exports,__webpack_require__){"use strict";var toObject=__webpack_require__(12),toAbsoluteIndex=__webpack_require__(39),toLength=__webpack_require__(9);module.exports=[].copyWithin||function(target,start){var O=toObject(this),len=toLength(O.length),to=toAbsoluteIndex(target,len),from=toAbsoluteIndex(start,len),end=arguments.length>2?arguments[2]:void 0,count=Math.min((void 0===end?len:toAbsoluteIndex(end,len))-from,len-to),inc=1;from<to&&to<from+count&&(inc=-1,from+=count-1,to+=count-1);while(count-- >0)from in O?O[to]=O[from]:delete O[to],to+=inc,from+=inc;return O}},function(module,exports,__webpack_require__){"use strict";var toObject=__webpack_require__(12),toAbsoluteIndex=__webpack_require__(39),toLength=__webpack_require__(9);module.exports=function(value){var O=toObject(this),length=toLength(O.length),aLen=arguments.length,index=toAbsoluteIndex(aLen>1?arguments[1]:void 0,length),end=aLen>2?arguments[2]:void 0,endPos=void 0===end?length:toAbsoluteIndex(end,length);
while(endPos>index)O[index++]=value;return O}},function(module,exports,__webpack_require__){var isObject=__webpack_require__(20),isArray=__webpack_require__(54),SPECIES=__webpack_require__(7)("species");module.exports=function(original){var C;return isArray(original)&&(C=original.constructor,"function"!=typeof C||C!==Array&&!isArray(C.prototype)||(C=void 0),isObject(C)&&(C=C[SPECIES],null===C&&(C=void 0))),void 0===C?Array:C}},function(module,exports,__webpack_require__){var ctx=__webpack_require__(19),call=__webpack_require__(84),isArrayIter=__webpack_require__(83),anObject=__webpack_require__(16),toLength=__webpack_require__(9),getIterFn=__webpack_require__(95),BREAK={},RETURN={},exports=module.exports=function(iterable,entries,fn,that,ITERATOR){var length,step,iterator,result,iterFn=ITERATOR?function(){return iterable}:getIterFn(iterable),f=ctx(fn,that,entries?2:1),index=0;if("function"!=typeof iterFn)throw TypeError(iterable+" is not iterable!");if(isArrayIter(iterFn)){for(length=toLength(iterable.length);length>index;index++)if(result=entries?f(anObject(step=iterable[index])[0],step[1]):f(iterable[index]),result===BREAK||result===RETURN)return result}else for(iterator=iterFn.call(iterable);!(step=iterator.next()).done;)if(result=call(iterator,f,step.value,entries),result===BREAK||result===RETURN)return result};exports.BREAK=BREAK,exports.RETURN=RETURN},function(module,exports,__webpack_require__){module.exports=!__webpack_require__(27)&&!__webpack_require__(23)(function(){return 7!=Object.defineProperty(__webpack_require__(52)("div"),"a",{get:function(){return 7}}).a})},function(module){module.exports=function(fn,args,that){var un=void 0===that;switch(args.length){case 0:return un?fn():fn.call(that);case 1:return un?fn(args[0]):fn.call(that,args[0]);case 2:return un?fn(args[0],args[1]):fn.call(that,args[0],args[1]);case 3:return un?fn(args[0],args[1],args[2]):fn.call(that,args[0],args[1],args[2]);case 4:return un?fn(args[0],args[1],args[2],args[3]):fn.call(that,args[0],args[1],args[2],args[3])}return fn.apply(that,args)}},function(module,exports,__webpack_require__){"use strict";var create=__webpack_require__(179),descriptor=__webpack_require__(56),setToStringTag=__webpack_require__(57),IteratorPrototype={};__webpack_require__(24)(IteratorPrototype,__webpack_require__(7)("iterator"),function(){return this}),module.exports=function(Constructor,NAME,next){Constructor.prototype=create(IteratorPrototype,{next:descriptor(1,next)}),setToStringTag(Constructor,NAME+" Iterator")}},function(module){module.exports=function(done,value){return{value:value,done:!!done}}},function(module,exports,__webpack_require__){var global=__webpack_require__(8),macrotask=__webpack_require__(94).set,Observer=global.MutationObserver||global.WebKitMutationObserver,process=global.process,Promise=global.Promise,isNode="process"==__webpack_require__(22)(process);module.exports=function(){var head,last,notify,flush=function(){var parent,fn;isNode&&(parent=process.domain)&&parent.exit();while(head){fn=head.fn,head=head.next;try{fn()}catch(e){throw head?notify():last=void 0,e}}last=void 0,parent&&parent.enter()};if(isNode)notify=function(){process.nextTick(flush)};else if(!Observer||global.navigator&&global.navigator.standalone)if(Promise&&Promise.resolve){var promise=Promise.resolve();notify=function(){promise.then(flush)}}else notify=function(){macrotask.call(global,flush)};else{var toggle=!0,node=document.createTextNode("");new Observer(flush).observe(node,{characterData:!0}),notify=function(){node.data=toggle=!toggle}}return function(fn){var task={fn:fn,next:void 0};last&&(last.next=task),head||(head=task,notify()),last=task}}},function(module,exports,__webpack_require__){var anObject=__webpack_require__(16),dPs=__webpack_require__(180),enumBugKeys=__webpack_require__(81),IE_PROTO=__webpack_require__(58)("IE_PROTO"),Empty=function(){},PROTOTYPE="prototype",createDict=function(){var iframeDocument,iframe=__webpack_require__(52)("iframe"),i=enumBugKeys.length,lt="<",gt=">";iframe.style.display="none",__webpack_require__(53).appendChild(iframe),iframe.src="javascript:",iframeDocument=iframe.contentWindow.document,iframeDocument.open(),iframeDocument.write(lt+"script"+gt+"document.F=Object"+lt+"/script"+gt),iframeDocument.close(),createDict=iframeDocument.F;while(i--)delete createDict[PROTOTYPE][enumBugKeys[i]];return createDict()};module.exports=Object.create||function(O,Properties){var result;return null!==O?(Empty[PROTOTYPE]=anObject(O),result=new Empty,Empty[PROTOTYPE]=null,result[IE_PROTO]=O):result=createDict(),void 0===Properties?result:dPs(result,Properties)}},function(module,exports,__webpack_require__){var dP=__webpack_require__(30),anObject=__webpack_require__(16),getKeys=__webpack_require__(88);module.exports=__webpack_require__(27)?Object.defineProperties:function(O,Properties){anObject(O);var P,keys=getKeys(Properties),length=keys.length,i=0;while(length>i)dP.f(O,P=keys[i++],Properties[P]);return O}},function(module,exports,__webpack_require__){var has=__webpack_require__(28),toObject=__webpack_require__(12),IE_PROTO=__webpack_require__(58)("IE_PROTO"),ObjectProto=Object.prototype;module.exports=Object.getPrototypeOf||function(O){return O=toObject(O),has(O,IE_PROTO)?O[IE_PROTO]:"function"==typeof O.constructor&&O instanceof O.constructor?O.constructor.prototype:O instanceof Object?ObjectProto:null}},function(module,exports,__webpack_require__){var has=__webpack_require__(28),toIObject=__webpack_require__(33),arrayIndexOf=__webpack_require__(48)(!1),IE_PROTO=__webpack_require__(58)("IE_PROTO");module.exports=function(object,names){var key,O=toIObject(object),i=0,result=[];for(key in O)key!=IE_PROTO&&has(O,key)&&result.push(key);while(names.length>i)has(O,key=names[i++])&&(~arrayIndexOf(result,key)||result.push(key));return result}},function(module,exports,__webpack_require__){var redefine=__webpack_require__(31);module.exports=function(target,src,safe){for(var key in src)redefine(target,key,src[key],safe);return target}},function(module,exports,__webpack_require__){var toInteger=__webpack_require__(32),defined=__webpack_require__(51);module.exports=function(TO_STRING){return function(that,pos){var a,b,s=String(defined(that)),i=toInteger(pos),l=s.length;return i<0||i>=l?TO_STRING?"":void 0:(a=s.charCodeAt(i),a<55296||a>56319||i+1===l||(b=s.charCodeAt(i+1))<56320||b>57343?TO_STRING?s.charAt(i):a:TO_STRING?s.slice(i,i+2):(a-55296<<10)+(b-56320)+65536)}}},function(module,exports,__webpack_require__){var isObject=__webpack_require__(20);module.exports=function(it,S){if(!isObject(it))return it;var fn,val;if(S&&"function"==typeof(fn=it.toString)&&!isObject(val=fn.call(it)))return val;if("function"==typeof(fn=it.valueOf)&&!isObject(val=fn.call(it)))return val;if(!S&&"function"==typeof(fn=it.toString)&&!isObject(val=fn.call(it)))return val;throw TypeError("Can't convert object to primitive value")}},function(module,exports,__webpack_require__){var $export=__webpack_require__(2);$export($export.P,"Array",{copyWithin:__webpack_require__(170)}),__webpack_require__(13)("copyWithin")},function(module,exports,__webpack_require__){"use strict";var $export=__webpack_require__(2),$every=__webpack_require__(17)(4);$export($export.P+$export.F*!__webpack_require__(10)([].every,!0),"Array",{every:function(callbackfn){return $every(this,callbackfn,arguments[1])}})},function(module,exports,__webpack_require__){var $export=__webpack_require__(2);$export($export.P,"Array",{fill:__webpack_require__(171)}),__webpack_require__(13)("fill")},function(module,exports,__webpack_require__){"use strict";var $export=__webpack_require__(2),$filter=__webpack_require__(17)(2);$export($export.P+$export.F*!__webpack_require__(10)([].filter,!0),"Array",{filter:function(callbackfn){return $filter(this,callbackfn,arguments[1])}})},function(module,exports,__webpack_require__){"use strict";var $export=__webpack_require__(2),$find=__webpack_require__(17)(6),KEY="findIndex",forced=!0;KEY in[]&&Array(1)[KEY](function(){forced=!1}),$export($export.P+$export.F*forced,"Array",{findIndex:function(callbackfn){return $find(this,callbackfn,arguments.length>1?arguments[1]:void 0)}}),__webpack_require__(13)(KEY)},function(module,exports,__webpack_require__){"use strict";var $export=__webpack_require__(2),$find=__webpack_require__(17)(5),KEY="find",forced=!0;KEY in[]&&Array(1)[KEY](function(){forced=!1}),$export($export.P+$export.F*forced,"Array",{find:function(callbackfn){return $find(this,callbackfn,arguments.length>1?arguments[1]:void 0)}}),__webpack_require__(13)(KEY)},function(module,exports,__webpack_require__){"use strict";var $export=__webpack_require__(2),$forEach=__webpack_require__(17)(0),STRICT=__webpack_require__(10)([].forEach,!0);$export($export.P+$export.F*!STRICT,"Array",{forEach:function(callbackfn){return $forEach(this,callbackfn,arguments[1])}})},function(module,exports,__webpack_require__){"use strict";var ctx=__webpack_require__(19),$export=__webpack_require__(2),toObject=__webpack_require__(12),call=__webpack_require__(84),isArrayIter=__webpack_require__(83),toLength=__webpack_require__(9),createProperty=__webpack_require__(80),getIterFn=__webpack_require__(95);$export($export.S+$export.F*!__webpack_require__(86)(function(iter){Array.from(iter)}),"Array",{from:function(arrayLike){var length,result,step,iterator,O=toObject(arrayLike),C="function"==typeof this?this:Array,aLen=arguments.length,mapfn=aLen>1?arguments[1]:void 0,mapping=void 0!==mapfn,index=0,iterFn=getIterFn(O);if(mapping&&(mapfn=ctx(mapfn,aLen>2?arguments[2]:void 0,2)),void 0==iterFn||C==Array&&isArrayIter(iterFn))for(length=toLength(O.length),result=new C(length);length>index;index++)createProperty(result,index,mapping?mapfn(O[index],index):O[index]);else for(iterator=iterFn.call(O),result=new C;!(step=iterator.next()).done;index++)createProperty(result,index,mapping?call(iterator,mapfn,[step.value,index],!0):step.value);return result.length=index,result}})},function(module,exports,__webpack_require__){"use strict";var $export=__webpack_require__(2),$indexOf=__webpack_require__(48)(!1),$native=[].indexOf,NEGATIVE_ZERO=!!$native&&1/[1].indexOf(1,-0)<0;$export($export.P+$export.F*(NEGATIVE_ZERO||!__webpack_require__(10)($native)),"Array",{indexOf:function(searchElement){return NEGATIVE_ZERO?$native.apply(this,arguments)||0:$indexOf(this,searchElement,arguments[1])}})},function(module,exports,__webpack_require__){var $export=__webpack_require__(2);$export($export.S,"Array",{isArray:__webpack_require__(54)})},function(module,exports,__webpack_require__){"use strict";var $export=__webpack_require__(2),toIObject=__webpack_require__(33),arrayJoin=[].join;$export($export.P+$export.F*(__webpack_require__(38)!=Object||!__webpack_require__(10)(arrayJoin)),"Array",{join:function(separator){return arrayJoin.call(toIObject(this),void 0===separator?",":separator)}})},function(module,exports,__webpack_require__){"use strict";var $export=__webpack_require__(2),toIObject=__webpack_require__(33),toInteger=__webpack_require__(32),toLength=__webpack_require__(9),$native=[].lastIndexOf,NEGATIVE_ZERO=!!$native&&1/[1].lastIndexOf(1,-0)<0;$export($export.P+$export.F*(NEGATIVE_ZERO||!__webpack_require__(10)($native)),"Array",{lastIndexOf:function(searchElement){if(NEGATIVE_ZERO)return $native.apply(this,arguments)||0;var O=toIObject(this),length=toLength(O.length),index=length-1;for(arguments.length>1&&(index=Math.min(index,toInteger(arguments[1]))),index<0&&(index=length+index);index>=0;index--)if(index in O&&O[index]===searchElement)return index||0;return-1}})},function(module,exports,__webpack_require__){"use strict";var $export=__webpack_require__(2),$map=__webpack_require__(17)(1);$export($export.P+$export.F*!__webpack_require__(10)([].map,!0),"Array",{map:function(callbackfn){return $map(this,callbackfn,arguments[1])}})},function(module,exports,__webpack_require__){"use strict";var $export=__webpack_require__(2),createProperty=__webpack_require__(80);$export($export.S+$export.F*__webpack_require__(23)(function(){function F(){}return!(Array.of.call(F)instanceof F)}),"Array",{of:function(){var index=0,aLen=arguments.length,result=new("function"==typeof this?this:Array)(aLen);while(aLen>index)createProperty(result,index,arguments[index++]);return result.length=aLen,result}})},function(module,exports,__webpack_require__){"use strict";var $export=__webpack_require__(2),$reduce=__webpack_require__(79);$export($export.P+$export.F*!__webpack_require__(10)([].reduceRight,!0),"Array",{reduceRight:function(callbackfn){return $reduce(this,callbackfn,arguments.length,arguments[1],!0)}})},function(module,exports,__webpack_require__){"use strict";var $export=__webpack_require__(2),$reduce=__webpack_require__(79);$export($export.P+$export.F*!__webpack_require__(10)([].reduce,!0),"Array",{reduce:function(callbackfn){return $reduce(this,callbackfn,arguments.length,arguments[1],!1)}})},function(module,exports,__webpack_require__){"use strict";var $export=__webpack_require__(2),html=__webpack_require__(53),cof=__webpack_require__(22),toAbsoluteIndex=__webpack_require__(39),toLength=__webpack_require__(9),arraySlice=[].slice;$export($export.P+$export.F*__webpack_require__(23)(function(){html&&arraySlice.call(html)}),"Array",{slice:function(begin,end){var len=toLength(this.length),klass=cof(this);if(end=void 0===end?len:end,"Array"==klass)return arraySlice.call(this,begin,end);for(var start=toAbsoluteIndex(begin,len),upTo=toAbsoluteIndex(end,len),size=toLength(upTo-start),cloned=new Array(size),i=0;i<size;i++)cloned[i]="String"==klass?this.charAt(start+i):this[start+i];return cloned}})},function(module,exports,__webpack_require__){"use strict";var $export=__webpack_require__(2),$some=__webpack_require__(17)(3);$export($export.P+$export.F*!__webpack_require__(10)([].some,!0),"Array",{some:function(callbackfn){return $some(this,callbackfn,arguments[1])}})},function(module,exports,__webpack_require__){"use strict";var $export=__webpack_require__(2),aFunction=__webpack_require__(15),toObject=__webpack_require__(12),fails=__webpack_require__(23),$sort=[].sort,test=[1,2,3];$export($export.P+$export.F*(fails(function(){test.sort(void 0)})||!fails(function(){test.sort(null)})||!__webpack_require__(10)($sort)),"Array",{sort:function(comparefn){return void 0===comparefn?$sort.call(toObject(this)):$sort.call(toObject(this),aFunction(comparefn))}})},function(module,exports,__webpack_require__){__webpack_require__(91)("Array")},function(module,exports,__webpack_require__){"use strict";var classof=__webpack_require__(50),test={};test[__webpack_require__(7)("toStringTag")]="z",test+""!="[object z]"&&__webpack_require__(31)(Object.prototype,"toString",function(){return"[object "+classof(this)+"]"},!0)},function(module,exports,__webpack_require__){"use strict";var Internal,newGenericPromiseCapability,OwnPromiseCapability,Wrapper,LIBRARY=__webpack_require__(87),global=__webpack_require__(8),ctx=__webpack_require__(19),classof=__webpack_require__(50),$export=__webpack_require__(2),isObject=__webpack_require__(20),aFunction=__webpack_require__(15),anInstance=__webpack_require__(169),forOf=__webpack_require__(173),speciesConstructor=__webpack_require__(93),task=__webpack_require__(94).set,microtask=__webpack_require__(178)(),newPromiseCapabilityModule=__webpack_require__(55),perform=__webpack_require__(89),promiseResolve=__webpack_require__(90),PROMISE="Promise",TypeError=global.TypeError,process=global.process,$Promise=global[PROMISE],isNode="process"==classof(process),empty=function(){},newPromiseCapability=newGenericPromiseCapability=newPromiseCapabilityModule.f,USE_NATIVE=!!function(){try{var promise=$Promise.resolve(1),FakePromise=(promise.constructor={})[__webpack_require__(7)("species")]=function(exec){exec(empty,empty)};return(isNode||"function"==typeof PromiseRejectionEvent)&&promise.then(empty)instanceof FakePromise}catch(e){}}(),isThenable=function(it){var then;return!(!isObject(it)||"function"!=typeof(then=it.then))&&then},notify=function(promise,isReject){if(!promise._n){promise._n=!0;var chain=promise._c;microtask(function(){var value=promise._v,ok=1==promise._s,i=0,run=function(reaction){var result,then,handler=ok?reaction.ok:reaction.fail,resolve=reaction.resolve,reject=reaction.reject,domain=reaction.domain;try{handler?(ok||(2==promise._h&&onHandleUnhandled(promise),promise._h=1),handler===!0?result=value:(domain&&domain.enter(),result=handler(value),domain&&domain.exit()),result===reaction.promise?reject(TypeError("Promise-chain cycle")):(then=isThenable(result))?then.call(result,resolve,reject):resolve(result)):reject(value)}catch(e){reject(e)}};while(chain.length>i)run(chain[i++]);promise._c=[],promise._n=!1,isReject&&!promise._h&&onUnhandled(promise)})}},onUnhandled=function(promise){task.call(global,function(){var result,handler,console,value=promise._v,unhandled=isUnhandled(promise);if(unhandled&&(result=perform(function(){isNode?process.emit("unhandledRejection",value,promise):(handler=global.onunhandledrejection)?handler({promise:promise,reason:value}):(console=global.console)&&console.error&&console.error("Unhandled promise rejection",value)}),promise._h=isNode||isUnhandled(promise)?2:1),promise._a=void 0,unhandled&&result.e)throw result.v})},isUnhandled=function(promise){return 1!==promise._h&&0===(promise._a||promise._c).length},onHandleUnhandled=function(promise){task.call(global,function(){var handler;isNode?process.emit("rejectionHandled",promise):(handler=global.onrejectionhandled)&&handler({promise:promise,reason:promise._v})})},$reject=function(value){var promise=this;promise._d||(promise._d=!0,promise=promise._w||promise,promise._v=value,promise._s=2,promise._a||(promise._a=promise._c.slice()),notify(promise,!0))},$resolve=function(value){var then,promise=this;if(!promise._d){promise._d=!0,promise=promise._w||promise;try{if(promise===value)throw TypeError("Promise can't be resolved itself");(then=isThenable(value))?microtask(function(){var wrapper={_w:promise,_d:!1};try{then.call(value,ctx($resolve,wrapper,1),ctx($reject,wrapper,1))}catch(e){$reject.call(wrapper,e)}}):(promise._v=value,promise._s=1,notify(promise,!1))}catch(e){$reject.call({_w:promise,_d:!1},e)}}};USE_NATIVE||($Promise=function(executor){anInstance(this,$Promise,PROMISE,"_h"),aFunction(executor),Internal.call(this);try{executor(ctx($resolve,this,1),ctx($reject,this,1))}catch(err){$reject.call(this,err)}},Internal=function(){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1},Internal.prototype=__webpack_require__(183)($Promise.prototype,{then:function(onFulfilled,onRejected){var reaction=newPromiseCapability(speciesConstructor(this,$Promise));return reaction.ok="function"!=typeof onFulfilled||onFulfilled,reaction.fail="function"==typeof onRejected&&onRejected,reaction.domain=isNode?process.domain:void 0,this._c.push(reaction),this._a&&this._a.push(reaction),this._s&&notify(this,!1),reaction.promise},catch:function(onRejected){return this.then(void 0,onRejected)}}),OwnPromiseCapability=function(){var promise=new Internal;this.promise=promise,this.resolve=ctx($resolve,promise,1),this.reject=ctx($reject,promise,1)},newPromiseCapabilityModule.f=newPromiseCapability=function(C){return C===$Promise||C===Wrapper?new OwnPromiseCapability(C):newGenericPromiseCapability(C)}),$export($export.G+$export.W+$export.F*!USE_NATIVE,{Promise:$Promise}),__webpack_require__(57)($Promise,PROMISE),__webpack_require__(91)(PROMISE),Wrapper=__webpack_require__(18)[PROMISE],$export($export.S+$export.F*!USE_NATIVE,PROMISE,{reject:function(r){var capability=newPromiseCapability(this),$$reject=capability.reject;return $$reject(r),capability.promise}}),$export($export.S+$export.F*(LIBRARY||!USE_NATIVE),PROMISE,{resolve:function(x){return promiseResolve(LIBRARY&&this===Wrapper?$Promise:this,x)}}),$export($export.S+$export.F*!(USE_NATIVE&&__webpack_require__(86)(function(iter){$Promise.all(iter)["catch"](empty)})),PROMISE,{all:function(iterable){var C=this,capability=newPromiseCapability(C),resolve=capability.resolve,reject=capability.reject,result=perform(function(){var values=[],index=0,remaining=1;forOf(iterable,!1,function(promise){var $index=index++,alreadyCalled=!1;values.push(void 0),remaining++,C.resolve(promise).then(function(value){alreadyCalled||(alreadyCalled=!0,values[$index]=value,--remaining||resolve(values))},reject)}),--remaining||resolve(values)});return result.e&&reject(result.v),capability.promise},race:function(iterable){var C=this,capability=newPromiseCapability(C),reject=capability.reject,result=perform(function(){forOf(iterable,!1,function(promise){C.resolve(promise).then(capability.resolve,reject)})});return result.e&&reject(result.v),capability.promise}})},function(module,exports,__webpack_require__){"use strict";var $export=__webpack_require__(2),flattenIntoArray=__webpack_require__(82),toObject=__webpack_require__(12),toLength=__webpack_require__(9),aFunction=__webpack_require__(15),arraySpeciesCreate=__webpack_require__(49);$export($export.P,"Array",{flatMap:function(callbackfn){var sourceLen,A,O=toObject(this);return aFunction(callbackfn),sourceLen=toLength(O.length),A=arraySpeciesCreate(O,0),flattenIntoArray(A,O,O,sourceLen,0,1,callbackfn,arguments[1]),A}}),__webpack_require__(13)("flatMap")},function(module,exports,__webpack_require__){"use strict";var $export=__webpack_require__(2),flattenIntoArray=__webpack_require__(82),toObject=__webpack_require__(12),toLength=__webpack_require__(9),toInteger=__webpack_require__(32),arraySpeciesCreate=__webpack_require__(49);$export($export.P,"Array",{flatten:function(){var depthArg=arguments[0],O=toObject(this),sourceLen=toLength(O.length),A=arraySpeciesCreate(O,0);return flattenIntoArray(A,O,O,sourceLen,0,void 0===depthArg?1:toInteger(depthArg)),A}}),__webpack_require__(13)("flatten")},function(module,exports,__webpack_require__){"use strict";var $export=__webpack_require__(2),$includes=__webpack_require__(48)(!0);$export($export.P,"Array",{includes:function(el){return $includes(this,el,arguments.length>1?arguments[1]:void 0)}}),__webpack_require__(13)("includes")},function(module,exports,__webpack_require__){"use strict";var $export=__webpack_require__(2),core=__webpack_require__(18),global=__webpack_require__(8),speciesConstructor=__webpack_require__(93),promiseResolve=__webpack_require__(90);$export($export.P+$export.R,"Promise",{finally:function(onFinally){var C=speciesConstructor(this,core.Promise||global.Promise),isFunction="function"==typeof onFinally;return this.then(isFunction?function(x){return promiseResolve(C,onFinally()).then(function(){return x})}:onFinally,isFunction?function(e){return promiseResolve(C,onFinally()).then(function(){throw e})}:onFinally)}})},function(module,exports,__webpack_require__){"use strict";var $export=__webpack_require__(2),newPromiseCapability=__webpack_require__(55),perform=__webpack_require__(89);$export($export.S,"Promise",{try:function(callbackfn){var promiseCapability=newPromiseCapability.f(this),result=perform(callbackfn);return(result.e?promiseCapability.reject:promiseCapability.resolve)(result.v),promiseCapability.promise}})},function(module,exports,__webpack_require__){for(var $iterators=__webpack_require__(96),getKeys=__webpack_require__(88),redefine=__webpack_require__(31),global=__webpack_require__(8),hide=__webpack_require__(24),Iterators=__webpack_require__(29),wks=__webpack_require__(7),ITERATOR=wks("iterator"),TO_STRING_TAG=wks("toStringTag"),ArrayValues=Iterators.Array,DOMIterables={CSSRuleList:!0,CSSStyleDeclaration:!1,CSSValueList:!1,ClientRectList:!1,DOMRectList:!1,DOMStringList:!1,DOMTokenList:!0,DataTransferItemList:!1,FileList:!1,HTMLAllCollection:!1,HTMLCollection:!1,HTMLFormElement:!1,HTMLSelectElement:!1,MediaList:!0,MimeTypeArray:!1,NamedNodeMap:!1,NodeList:!0,PaintRequestList:!1,Plugin:!1,PluginArray:!1,SVGLengthList:!1,SVGNumberList:!1,SVGPathSegList:!1,SVGPointList:!1,SVGStringList:!1,SVGTransformList:!1,SourceBufferList:!1,StyleSheetList:!0,TextTrackCueList:!1,TextTrackList:!1,TouchList:!1},collections=getKeys(DOMIterables),i=0;i<collections.length;i++){var key,NAME=collections[i],explicit=DOMIterables[NAME],Collection=global[NAME],proto=Collection&&Collection.prototype;if(proto&&(proto[ITERATOR]||hide(proto,ITERATOR,ArrayValues),proto[TO_STRING_TAG]||hide(proto,TO_STRING_TAG,NAME),Iterators[NAME]=ArrayValues,explicit))for(key in $iterators)proto[key]||redefine(proto,key,$iterators[key],!0)}},function(module){"use strict";module.exports=9007199254740991},function(module,exports){(function(global){(function(global,factory){0?"function"===typeof define&&define.amd?define(factory):global.typeDetect=factory():module.exports=factory()})(this,function(){"use strict";var promiseExists="function"===typeof Promise,globalObject="object"===typeof self?self:global,symbolExists="undefined"!==typeof Symbol,mapExists="undefined"!==typeof Map,setExists="undefined"!==typeof Set,weakMapExists="undefined"!==typeof WeakMap,weakSetExists="undefined"!==typeof WeakSet,dataViewExists="undefined"!==typeof DataView,symbolIteratorExists=symbolExists&&"undefined"!==typeof Symbol.iterator,symbolToStringTagExists=symbolExists&&"undefined"!==typeof Symbol.toStringTag,setEntriesExists=setExists&&"function"===typeof Set.prototype.entries,mapEntriesExists=mapExists&&"function"===typeof Map.prototype.entries,setIteratorPrototype=setEntriesExists&&Object.getPrototypeOf((new Set).entries()),mapIteratorPrototype=mapEntriesExists&&Object.getPrototypeOf((new Map).entries()),arrayIteratorExists=symbolIteratorExists&&"function"===typeof Array.prototype[Symbol.iterator],arrayIteratorPrototype=arrayIteratorExists&&Object.getPrototypeOf([][Symbol.iterator]()),stringIteratorExists=symbolIteratorExists&&"function"===typeof String.prototype[Symbol.iterator],stringIteratorPrototype=stringIteratorExists&&Object.getPrototypeOf(""[Symbol.iterator]()),toStringLeftSliceLength=8,toStringRightSliceLength=-1;function typeDetect(obj){var typeofObj=typeof obj;if("object"!==typeofObj)return typeofObj;if(null===obj)return"null";if(obj===globalObject)return"global";if(Array.isArray(obj)&&(symbolToStringTagExists===!1||!(Symbol.toStringTag in obj)))return"Array";if("object"===typeof window&&null!==window){if("object"===typeof window.location&&obj===window.location)return"Location";if("object"===typeof window.document&&obj===window.document)return"Document";if("object"===typeof window.navigator){if("object"===typeof window.navigator.mimeTypes&&obj===window.navigator.mimeTypes)return"MimeTypeArray";if("object"===typeof window.navigator.plugins&&obj===window.navigator.plugins)return"PluginArray"}if(("function"===typeof window.HTMLElement||"object"===typeof window.HTMLElement)&&obj instanceof window.HTMLElement){if("BLOCKQUOTE"===obj.tagName)return"HTMLQuoteElement";if("TD"===obj.tagName)return"HTMLTableDataCellElement";if("TH"===obj.tagName)return"HTMLTableHeaderCellElement"}}var stringTag=symbolToStringTagExists&&obj[Symbol.toStringTag];if("string"===typeof stringTag)return stringTag;var objPrototype=Object.getPrototypeOf(obj);return objPrototype===RegExp.prototype?"RegExp":objPrototype===Date.prototype?"Date":promiseExists&&objPrototype===Promise.prototype?"Promise":setExists&&objPrototype===Set.prototype?"Set":mapExists&&objPrototype===Map.prototype?"Map":weakSetExists&&objPrototype===WeakSet.prototype?"WeakSet":weakMapExists&&objPrototype===WeakMap.prototype?"WeakMap":dataViewExists&&objPrototype===DataView.prototype?"DataView":mapExists&&objPrototype===mapIteratorPrototype?"Map Iterator":setExists&&objPrototype===setIteratorPrototype?"Set Iterator":arrayIteratorExists&&objPrototype===arrayIteratorPrototype?"Array Iterator":stringIteratorExists&&objPrototype===stringIteratorPrototype?"String Iterator":null===objPrototype?"Object":Object.prototype.toString.call(obj).slice(toStringLeftSliceLength,toStringRightSliceLength)}return typeDetect})}).call(exports,function(){return this}())},function(module,exports){(function(root){var URL_REGEX=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/\;?#]*)?(.*?)??(;.*?)?(\?.*?)?(#.*?)?$/,FIRST_SEGMENT_REGEX=/^([^\/;?#]*)(.*)$/,SLASH_DOT_REGEX=/(?:\/|^)\.(?=\/)/g,SLASH_DOT_DOT_REGEX=/(?:\/|^)\.\.\/(?!\.\.\/).*?(?=\/)/g,URLToolkit={buildAbsoluteURL:function(baseURL,relativeURL,opts){if(opts=opts||{},baseURL=baseURL.trim(),relativeURL=relativeURL.trim(),!relativeURL){if(!opts.alwaysNormalize)return baseURL;var basePartsForNormalise=URLToolkit.parseURL(baseURL);if(!basePartsForNormalise)throw new Error("Error trying to parse base URL.");return basePartsForNormalise.path=URLToolkit.normalizePath(basePartsForNormalise.path),URLToolkit.buildURLFromParts(basePartsForNormalise)}var relativeParts=URLToolkit.parseURL(relativeURL);if(!relativeParts)throw new Error("Error trying to parse relative URL.");if(relativeParts.scheme)return opts.alwaysNormalize?(relativeParts.path=URLToolkit.normalizePath(relativeParts.path),URLToolkit.buildURLFromParts(relativeParts)):relativeURL;var baseParts=URLToolkit.parseURL(baseURL);if(!baseParts)throw new Error("Error trying to parse base URL.");if(!baseParts.netLoc&&baseParts.path&&"/"!==baseParts.path[0]){var pathParts=FIRST_SEGMENT_REGEX.exec(baseParts.path);baseParts.netLoc=pathParts[1],baseParts.path=pathParts[2]}baseParts.netLoc&&!baseParts.path&&(baseParts.path="/");var builtParts={scheme:baseParts.scheme,netLoc:relativeParts.netLoc,path:null,params:relativeParts.params,query:relativeParts.query,fragment:relativeParts.fragment};if(!relativeParts.netLoc&&(builtParts.netLoc=baseParts.netLoc,"/"!==relativeParts.path[0]))if(relativeParts.path){var baseURLPath=baseParts.path,newPath=baseURLPath.substring(0,baseURLPath.lastIndexOf("/")+1)+relativeParts.path;builtParts.path=URLToolkit.normalizePath(newPath)}else builtParts.path=baseParts.path,relativeParts.params||(builtParts.params=baseParts.params,relativeParts.query||(builtParts.query=baseParts.query));return null===builtParts.path&&(builtParts.path=opts.alwaysNormalize?URLToolkit.normalizePath(relativeParts.path):relativeParts.path),URLToolkit.buildURLFromParts(builtParts)},parseURL:function(url){var parts=URL_REGEX.exec(url);return parts?{scheme:parts[1]||"",netLoc:parts[2]||"",path:parts[3]||"",params:parts[4]||"",query:parts[5]||"",fragment:parts[6]||""}:null},normalizePath:function(path){path=path.split("").reverse().join("").replace(SLASH_DOT_REGEX,"");while(path.length!==(path=path.replace(SLASH_DOT_DOT_REGEX,"")).length);return path.split("").reverse().join("")},buildURLFromParts:function(parts){return parts.scheme+parts.netLoc+parts.path+parts.params+parts.query+parts.fragment}};0?"function"===typeof define&&define.amd?define([],function(){return URLToolkit}):"object"===typeof exports?exports["URLToolkit"]=URLToolkit:root["URLToolkit"]=URLToolkit:module.exports=URLToolkit})(this)},function(module){module.exports=function(module){return module.webpackPolyfill||(module.deprecate=function(){},module.paths=[],module.children=[],module.webpackPolyfill=1),module}},function(module,exports,__webpack_require__){function webpackBootstrapFunc(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={i:moduleId,l:!1,exports:{}};return modules[moduleId].call(module.exports,module,module.exports,__webpack_require__),module.l=!0,module.exports}__webpack_require__.m=modules,__webpack_require__.c=installedModules,__webpack_require__.i=function(value){return value},__webpack_require__.d=function(exports,name,getter){__webpack_require__.o(exports,name)||Object.defineProperty(exports,name,{configurable:!1,enumerable:!0,get:getter})},__webpack_require__.r=function(exports){Object.defineProperty(exports,"__esModule",{value:!0})},__webpack_require__.n=function(module){var getter=module&&module.__esModule?function(){return module["default"]}:function(){return module};return __webpack_require__.d(getter,"a",getter),getter},__webpack_require__.o=function(object,property){
return Object.prototype.hasOwnProperty.call(object,property)},__webpack_require__.p="/",__webpack_require__.oe=function(err){throw void 0,err};var f=__webpack_require__(__webpack_require__.s=ENTRY_MODULE);return f.default||f}var moduleNameReqExp="[\\.|\\-|\\+|\\w|/|@]+",dependencyRegExp="\\((/\\*.*?\\*/)?s?.*?("+moduleNameReqExp+").*?\\)";function quoteRegExp(str){return(str+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function getModuleDependencies(sources,module,queueName){var retval={};retval[queueName]=[];var fnString=module.toString(),wrapperSignature=fnString.match(/^function\s?\(\w+,\s*\w+,\s*(\w+)\)/);if(!wrapperSignature)return retval;var match,webpackRequireName=wrapperSignature[1],re=new RegExp("(\\\\n|\\W)"+quoteRegExp(webpackRequireName)+dependencyRegExp,"g");while(match=re.exec(fnString))"dll-reference"!==match[3]&&retval[queueName].push(match[3]);re=new RegExp("\\("+quoteRegExp(webpackRequireName)+'\\("(dll-reference\\s('+moduleNameReqExp+'))"\\)\\)'+dependencyRegExp,"g");while(match=re.exec(fnString))sources[match[2]]||(retval[queueName].push(match[1]),sources[match[2]]=__webpack_require__(match[1]).m),retval[match[2]]=retval[match[2]]||[],retval[match[2]].push(match[4]);return retval}function hasValuesInQueues(queues){var keys=Object.keys(queues);return keys.reduce(function(hasValues,key){return hasValues||queues[key].length>0},!1)}function getRequiredModules(sources,moduleId){var modulesQueue={main:[moduleId]},requiredModules={main:[]},seenModules={main:{}};while(hasValuesInQueues(modulesQueue))for(var queues=Object.keys(modulesQueue),i=0;i<queues.length;i++){var queueName=queues[i],queue=modulesQueue[queueName],moduleToCheck=queue.pop();if(seenModules[queueName]=seenModules[queueName]||{},!seenModules[queueName][moduleToCheck]&&sources[queueName][moduleToCheck]){seenModules[queueName][moduleToCheck]=!0,requiredModules[queueName]=requiredModules[queueName]||[],requiredModules[queueName].push(moduleToCheck);for(var newModules=getModuleDependencies(sources,sources[queueName][moduleToCheck],queueName),newModulesKeys=Object.keys(newModules),j=0;j<newModulesKeys.length;j++)modulesQueue[newModulesKeys[j]]=modulesQueue[newModulesKeys[j]]||[],modulesQueue[newModulesKeys[j]]=modulesQueue[newModulesKeys[j]].concat(newModules[newModulesKeys[j]])}}return requiredModules}module.exports=function(moduleId,options){options=options||{};var sources={main:__webpack_require__.m},requiredModules=options.all?{main:Object.keys(sources)}:getRequiredModules(sources,moduleId),src="";Object.keys(requiredModules).filter(function(m){return"main"!==m}).forEach(function(module){var entryModule=0;while(requiredModules[module][entryModule])entryModule++;requiredModules[module].push(entryModule),sources[module][entryModule]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",src=src+"var "+module+" = ("+webpackBootstrapFunc.toString().replace("ENTRY_MODULE",JSON.stringify(entryModule))+")({"+requiredModules[module].map(function(id){return""+JSON.stringify(id)+": "+sources[module][id].toString()}).join(",")+"});\n"}),src=src+"("+webpackBootstrapFunc.toString().replace("ENTRY_MODULE",JSON.stringify(moduleId))+")({"+requiredModules.main.map(function(id){return""+JSON.stringify(id)+": "+sources.main[id].toString()}).join(",")+"})(self);";var blob=new window.Blob([src],{type:"text/javascript"});if(options.bare)return blob;var URL=window.URL||window.webkitURL||window.mozURL||window.msURL,workerUrl=URL.createObjectURL(blob),worker=new window.Worker(workerUrl);return worker.objectURL=workerUrl,worker}},function(module){var bundleFn=arguments[3],sources=arguments[4],cache=arguments[5],stringify=JSON.stringify;module.exports=function(fn,options){for(var wkey,cacheKeys=Object.keys(cache),i=0,l=cacheKeys.length;i<l;i++){var key=cacheKeys[i],exp=cache[key].exports;if(exp===fn||exp&&exp.default===fn){wkey=key;break}}if(!wkey){wkey=Math.floor(Math.pow(16,8)*Math.random()).toString(16);for(var wcache={},i=0,l=cacheKeys.length;i<l;i++){var key=cacheKeys[i];wcache[key]=key}sources[wkey]=["function(require,module,exports){"+fn+"(self); }",wcache]}var skey=Math.floor(Math.pow(16,8)*Math.random()).toString(16),scache={};scache[wkey]=wkey,sources[skey]=["function(require,module,exports){"+"var f = require("+stringify(wkey)+");"+"(f.default ? f.default : f)(self);"+"}",scache];var workerSources={};resolveSources(skey);function resolveSources(key){workerSources[key]=!0;for(var depPath in sources[key][1]){var depKey=sources[key][1][depPath];workerSources[depKey]||resolveSources(depKey)}}var src="("+bundleFn+")({"+Object.keys(workerSources).map(function(key){return stringify(key)+":["+sources[key][0]+","+stringify(sources[key][1])+"]"}).join(",")+"},{},["+stringify(skey)+"])",URL=window.URL||window.webkitURL||window.mozURL||window.msURL,blob=new Blob([src],{type:"text/javascript"});if(options&&options.bare)return blob;var workerUrl=URL.createObjectURL(blob),worker=new Worker(workerUrl);return worker.objectURL=workerUrl,worker}}])});
//# sourceMappingURL=bam-hls.js.map